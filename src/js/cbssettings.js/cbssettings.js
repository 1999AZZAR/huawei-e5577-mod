var CBS_MAX_NUM=100,arrayList=[],station="",addList=[];function addCbssettingslist(t){var e=null,n=1;for(e='<tr class="user_add_line">',n=1;n<arguments.length;n++)e+="<td style='word-break: break-all;'>"+arguments[n]+"</td>";e+="<td class='user_options clr_blue_hover'> <span class=\"button_delete_list clr_blue\" style='float:none; padding:0;'>"+common_delete+"</span></td></tr>";var i=$(t).size();$(t).eq(i-2).after(e)}function initPage(){var t=0;button_enable("apply","0"),$(".user_add_line").remove(),getAjaxData("api/sms/get-cbschannellist",(function(e){var n=null,i=[],s=xml2object(e);"response"==s.type&&null!=(n=$.trim(s.response.channellist))&&""!=n&&(i=n.split(","));var a=null,l=null;i.length>=CBS_MAX_NUM&&button_enable("add_item","0"),null!=n&&""!=n&&($.isArray(i)?$(i).each((function(e){a=t++,l=i[e],l=XSSResolveCannotParseChar(l),addCbssettingslist($("#service_list tr"),a,l)})):(a=t,l=i,l=XSSResolveCannotParseChar(l),addCbssettingslist($("#service_list tr"),a,l)))}))}function postData(){var t="";if(addList.length>1){for(var e=0;e<addList.length-1;e++)t+=addList[e]+",";t+=addList[addList.length-1],arrayList.push(t)}1==addList.length&&(t+=addList[addList.length-1]+"",arrayList.push(t));var n=object2xml("request",{type:station,channel:arrayList});saveAjaxData("api/sms/operate-cbschannel",n,(function(t){var e=xml2object(t);isAjaxReturnOK(e)?(showInfoDialog(common_success),button_enable("apply","0")):showInfoDialog(common_failed),arrayList=[],addList=[],initPage()}))}function isValidValue(){var t=/^[0-9]+$/g;$.each($(".qtip-defaults"),(function(){$(this).remove()}));var e=$.trim($("#cbssettings_channel").val());if(""==e||null==e)return showQtip("cbssettings_channel",IDS_CBS_Settings_channel_not_null),!1;if(-1==e.indexOf("-")){if("0"!=e&&"0"==e.charAt(0))return showQtip("cbssettings_channel",IDS_CBS_Settings_channel_cue_figure),!1;if(null==e.match(t))return showQtip("cbssettings_channel",IDS_CBS_Settings_channel_cue_figure),!1;if(parseInt(e,10)<0||parseInt(e,10)>65535)return showQtip("cbssettings_channel",IDS_CBS_Settings_channel_cue_figure),!1;var n=0;if($(".user_add_line").each((function(t){if($.trim($(this).children().eq(1).text())==e)return showQtip("cbssettings_channel",IDS_CBS_Settings_cue_iterance),n=1,!1})),1==n)return!1}else{for(var i=0,s=0;s<e.length;s++)"-"==e.charAt(s)&&(i+=1);if(i>1||0==e.indexOf("-")||e.indexOf("-")==e.length-1)return showQtip("cbssettings_channel",IDS_CBS_Settings_channel_cue_figure),!1;var a=e.indexOf("-"),l=$.trim(e.substring(0,a)),r=$.trim(e.substring(a+1));if("0"!=l&&"0"==l.charAt(0)||"0"!=r&&"0"==r.charAt(0))return showQtip("cbssettings_channel",IDS_CBS_Settings_channel_cue_figure),!1;if(null==l.match(t)||null==r.match(t))return showQtip("cbssettings_channel",IDS_CBS_Settings_channel_cue_figure),!1;if(parseInt(l,10)<0||parseInt(l,10)>65535||parseInt(r,10)<0||parseInt(r,10)>65535)return showQtip("cbssettings_channel",IDS_CBS_Settings_channel_cue_figure),!1;if(parseInt(l,10)>=parseInt(r,10))return showQtip("cbssettings_channel",IDS_CBS_Settings_channel_cue_little),!1;n=0;if($(".user_add_line").each((function(t){var e=$.trim($(this).children().eq(1).text()),i=e.indexOf("-"),s=$.trim(e.substring(0,i)),a=$.trim(e.substring(i+1));if(s==l&&a==r)return showQtip("cbssettings_channel",IDS_CBS_Settings_cue_iterance),n=1,!1})),1==n)return!1}return!0}function openPortToCss(){($.browser.mozilla||$.browser.opera)&&$("#service_list").css({"table-layout":"fixed","word-break":"break-all","word-wrap":"break-word"})}redirectOnCondition(null,"cbssettings");var editIndex=null;$(document).ready((function(){button_enable("apply","0"),initPage();$("#add_item_ok").live("click",(function(){if(isValidValue()){var t=$(".user_add_line").length,e=$.trim($("#cbssettings_channel").val());hideAddItemControl(),addCbssettingslist($("#service_list tr"),t,e),button_enable("apply","1"),($(".user_add_line").length>=CBS_MAX_NUM||addList.length>=49)&&button_enable("add_item","0"),addList.push(e),station="0"}return!1})),$("#add_item_cancel").live("click",(function(){return hideAddItemControl(),!1})),$("#add_item").click((function(){isButtonEnable("add_item")&&($("#cbssettings_index").val($(".user_add_line").length),$("#cbssettings_channel").val(""),showAddItemControl(),$(".add_item_control input").eq(1).focus(),button_enable("apply","0"),$(".user_add_line").length>=CBS_MAX_NUM&&button_enable("add_item","0"))})),$(".button_delete_list").live("click",(function(){if($(".add_item_control:hidden").size()>0){var t=$(".button_delete_list").index(this),e=$("#service_list tr").eq(t+1).children().eq(1).text();call_dialog(common_delete,firewall_hint_delete_list_item,common_ok,"pop_OK",common_cancel,"pop_Cancel"),$("#pop_OK").click((function(){deleteFilter(t,$(".user_add_line")),clearDialog_table(),station="1",arrayList.push(e),postData(),button_enable("add_item","1")}))}})),$("#apply").click((function(){isButtonEnable("apply")&&showConfirmDialog(firewall_hint_submit_list_item,postData)})),openPortToCss()}));
