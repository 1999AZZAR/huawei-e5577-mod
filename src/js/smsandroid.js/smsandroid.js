var g_chat_sms_pbMatch="",g_scroll_smsList=[],g_temp_smsList=[],g_send_message_btn_status=0,g_scroll_smsList_status=0,g_temp_pageIndex_status=1,temp_sms_phone_chat_value="",CHAT_SMS_CURBOX=1,CHAT_SMS_SMSTAT=4,g_smsFeature=null,g_sms_importenabled=null,g_sms_urlenabled=null,SMS_MAXPHONESIZE=50,pb_start=0,pb_end=0,g_sms_pageIndex=1,g_sms_readCount="",g_sms_maxphonesize="",g_sms_sortType=0,g_sms_ascending=0,g_sms_unreadPreferred=0,g_sms_recordMsgSum=0,g_sms_simSum=0,g_sms_localSum=0,g_isCDMA=!1,g_pbToSmsFlag=!1,g_sendSuccessAndFailedFlag=!1,g_numberValid=!0,g_lang_edit=-1,SMS_CHAT_PGAE_URL="smsandroid.html",sms_systemBusy=113018,g_convert_type="",g_sms_totalSmsPage=0,g_sms_curMsgSum=0,g_sms_checkedList="",g_sms_smsListArray={pageindex:g_sms_pageIndex,readcount:g_sms_readCount},g_sms_smsCount={LocalUnread:0,LocalInbox:0,LocalOutbox:0,LocalDraft:0,LocalDeleted:0,SimUnread:0,SimInbox:0,SimOutbox:0,SimDraft:0,LocalMax:0,SimMax:0},g_sms_NewMsg="",g_sms_smsList=[],g_sms_android_store_status="0/0",g_sms_smscharlang=!1,g_PB_TIMEOUT_SHORT=3e4,g_pb_feature={page_size:15,max_record_size:50,max_name_size:0,max_phone_size:0,max_email_size:0,max_search_size:0,max_group_size:0,max_group_name_size:0,export_csv_path:"",export_vcard_path:""},g_pb_local_contact_list_request={GroupID:0,PageIndex:g_pb_pageIndex,ReadCount:g_pb_feature.page_size,SaveType:0,SortType:1,Ascending:1,KeyWord:""},g_pb_pageIndex="",g_pb_contactListArray=[],g_pb_curContactSum=0,phonebook=[],g_Current_Phone_Number_chat=0,g_sms_chatList=[],g_Current_Chat_Count=0,g_isForward=(g_sms_checkedList="",0),g_Current_content=null,vLocalShowContactList="<li value='%href%' style='border-bottom: solid 1px #b7b8b9;' class='linkmanInfo'>  <div id='contactName'><a title='%FormattedNameTwo%' herf='javascript:void(0);'>&nbsp;&nbsp;&nbsp;%FormattedNameTwo%</a></div>  <span id='contactNumberType'>&nbsp;&nbsp;&nbsp;%numberType%</span><div id='contactNumber'><a title='%phone%' herf='javascript:void(0);' style='color: gray;'>&nbsp;&nbsp;&nbsp;%phone%</a></div></li>",pb_feature=null,html=null,displayInformations=null;function sms_initPage(){sms_getBoxCount(),sms_initBoxCount(),g_sms_curMsgSum>0?sms_initSMS():(g_sms_curMsgSum=0,g_sms_recordMsgSum=0)}function sms_initSMS(){sms_getBoxData(),g_sms_recordMsgSum=g_sms_curMsgSum}function sms_isValidatePageIndex(e){return!(!new RegExp("^\\+?[1-9][0-9]*$").test(e)||e>g_sms_totalSmsPage)}function initChatPage(){"-1"!=g_lang_edit||g_isCDMA||0==g_smsFeature.smscharlang||void 0===g_smsFeature.smscharlang?$("#sms_count").html("160(1)"):$("#sms_count").html("155(1)")}function getChatHistory(){var e={phone:g_Current_Phone_Number_chat,pageindex:g_sms_totalSmsPage,readcount:g_smsFeature.pagesize};e.pageindex=g_sms_pageIndex;var s=object2xml("request",e);saveAjaxData("api/sms/sms-list-phone",s,(function(e){var s=xml2object(e);"response"==s.type?s.response.messages.message&&(g_sms_chatList=null,g_sms_chatList=[],$.isArray(s.response.messages.message)?g_sms_chatList=s.response.messages.message:g_sms_chatList.push(s.response.messages.message),(0==g_scroll_smsList_status||1==g_send_message_btn_status&&1==g_scroll_smsList_status)&&(g_scroll_smsList=(g_scroll_smsList=[]).concat(g_sms_chatList)),(g_Current_Chat_Count!=g_sms_curMsgSum||g_sms_pageIndex!=g_sms_pageIndex_last||"0"!=g_sms_NewMsg&&void 0!==g_sms_NewMsg&&""!=g_sms_NewMsg)&&(g_Current_Chat_Count=g_sms_curMsgSum,g_sms_pageIndex_last=g_sms_pageIndex,showChatHistory(),$(".sms_chat_list").scrollTop(parseInt($(".sms_chat_list")[0].scrollHeight,10)-parseInt($(".sms_chat_list").height(),10)),setChatSmsRead())):(g_sms_chatList=null,gotoPageWithoutHistory("smsandroid.html"),g_Current_Chat_Count=0)}),{errorCB:function(){}})}function chat_smsDelete(e){cancelLogoutTimer(),g_sms_checkedList="",g_sms_checkedList+="<Index>"+e+"</Index>";var s=object2xml("request",g_sms_checkedList);saveAjaxData("api/sms/delete-sms",s,(function(e){var s=xml2object(e);startLogoutTimer(),isAjaxReturnOK(s)?(sms_getBoxCount(),getChatHistory()):showInfoDialog(common_failed)}))}function chat_Forward(e){g_isForward=1;var s=e;sms_showSmsDialog();var t=create_button_html(common_send,"pop_send","pop_send")+"&nbsp;&nbsp;&nbsp;&nbsp;"+create_button_html(common_cancel,"pop_Cancel","pop_Cancel");cancelLogoutTimer(),$(".dialog_table_r").html(t),ieRadiusBorder(),"material"==webui_mode&&materializeButtons(),$("#message_content").val(s),sms_contentChange(s),$("#recipients_number").focus().select()}function sms_btnAddEvent(){$("#sms_table :checkbox").live("click",(function(){var e,s=$("#sms_table :checkbox");this==s[0]?s.attr("checked",this.checked):(e=s.filter(":not(:first)").filter(":checked").length+1==s.length,s.eq(0).attr("checked",e)),s.filter(":not(:first)").filter(":checked").length>0?($("#sms_android_delete_blue").show(),$("#sms_android_delete_grey").hide()):($("#sms_android_delete_blue").hide(),$("#sms_android_delete_grey").show())})),$("#sms_android_delete_blue").bind("click",(function(){showConfirmDialog(common_confirm_delete_list_item,(function(){sms_smsDelete(),$("#sms_android_delete_blue").hide(),$("#sms_android_delete_grey").show()}),(function(){}))})),$("#jump_page").bind("click",(function(){$.each($(".qtip-defaults"),(function(){$(this).remove()}));var e=$("#jump_page_index").val();sms_isValidatePageIndex(e)?sms_pageNav(e):(showQtip("jump_page_index",sms_hint_wrong_page_num),$("#jump_page_index").select())})),$("#jump_page_chat").bind("click",(function(){$.each($(".qtip-defaults"),(function(){$(this).remove()}));var e=$("#jump_page_index_chat").val();sms_isValidatePageIndex(e)?sms_pageNav(e):(showQtip("jump_page_index_chat",sms_hint_wrong_page_num),$("#jump_page_index_chat").select())})),0==g_sms_importenabled?$("#import_btn").remove():$("#import_btn").bind("click",(function(){sms_importMessage()}))}function sms_init_info(){sms_initBoxCount(),g_sms_curMsgSum>0&&(g_sms_recordMsgSum!=g_sms_curMsgSum||"0"!=g_sms_NewMsg&&void 0!==g_sms_NewMsg&&""!=g_sms_NewMsg)&&sms_initSMS()}function sms_getBoxCount(e,s){if(e=null==e,getAjaxData("api/sms/sms-count",(function(e){var t=xml2object(e);"response"==t.type&&(g_sms_smsCount=t.response,g_sms_NewMsg=t.response.NewMsg),g_sms_localSum=parseInt(g_sms_smsCount.LocalInbox,10)+parseInt(g_sms_smsCount.LocalOutbox,10)+parseInt(g_sms_smsCount.LocalDraft,10)+parseInt(g_sms_smsCount.LocalDeleted,10),g_sms_simSum=void 0!==g_sms_smsCount.SimUsed?g_sms_smsCount.SimUsed:parseInt(g_sms_smsCount.SimInbox,10)+parseInt(g_sms_smsCount.SimOutbox,10)+parseInt(g_sms_smsCount.SimDraft,10),g_sms_localSum>=g_sms_smsCount.LocalMax&&g_sms_smsCount.LocalMax>0?$("#fullMessage_tip_div").show():$("#fullMessage_tip_div").hide(),"function"==typeof s&&s()}),{sync:e,errorCB:function(){}}),-1!=window.location.href.lastIndexOf("smschat")){g_module.pb_enabled||$("#cur_box_type_android_chat").text()!=g_Current_Phone_Number_chat&&$("#cur_box_type_android_chat").text(g_Current_Phone_Number_chat);var t=object2xml("request",{phone:g_Current_Phone_Number_chat});saveAjaxData("api/sms/sms-count-contact",t,(function(e){var s=xml2object(e);"response"==s.type&&(g_sms_curMsgSum=s.response.count)}),{sync:!0,errorCB:function(){}})}else $("#cur_box_type_android").text()!=sms_label_message&&$("#cur_box_type_android").text(sms_label_message),getAjaxData("api/sms/sms-count-contact",(function(e){var s=xml2object(e);"response"==s.type&&(g_sms_curMsgSum=s.response.count)}),{sync:!0,errorCB:function(){}})}function sms_initBoxCount(){var e,s,t,a,_;if(e=g_sms_smsCount.LocalUnread,s=g_sms_smsCount.LocalInbox,t=g_sms_smsCount.LocalOutbox,a=g_sms_smsCount.LocalDraft,_=parseInt(s,10)+parseInt(t,10)+parseInt(a,10),g_sms_android_store_status=e+"/"+_,$("#label_android_status").text(g_sms_android_store_status),g_sms_curMsgSum>0){g_sms_totalSmsPage=Math.ceil(g_sms_curMsgSum/g_sms_smsListArray.readcount);var n=(g_sms_pageIndex=Math.min(g_sms_pageIndex,g_sms_totalSmsPage))+"/"+g_sms_totalSmsPage;$("#curSmsPage_chat").text(n),$("#curSmsPage_phone_chat").text(n),sms_createPageNav(),sms_createPageNav_Chat(),$(".sms_pagination div").show()}else $("#sms_check_all").removeAttr("checked"),$(".sms_list_tr").remove(),$(".sms_pagination div").hide()}function sms_getBoxData(){g_sms_smsListArray.pageindex=g_sms_pageIndex;var e=object2xml("request",g_sms_smsListArray);saveAjaxData("api/sms/sms-list-contact",e,(function(e){var s=xml2object(e);"response"==s.type&&s.response.messages.message&&(g_sms_smsList=[],$.isArray(s.response.messages.message)?g_sms_smsList=s.response.messages.message:g_sms_smsList.push(s.response.messages.message),sms_initBoxList())}),{errorCB:function(){}})}function sms_initBoxList(){var e="",s=((new Date).Format("yyyy-MM-dd hh:mm:ss"),$("#boxList_title")),t=null,a=null,_=null,n=null,r=null,o=null;$(".sms_list_tr").remove();var c={},m=[];$.each(g_sms_smsList,(function(i,c){switch(parseInt(c.smstype,10)){case 7:c.content=sms_label_setting_usesreport+common_colon+" "+common_success;break;case 8:c.content=sms_label_setting_usesreport+common_colon+" "+common_failed}e=g_sms_urlenabled?regURL(c.content):XSSResolveCannotParseChar(c.content),c.smstat;var l=c.date;l=new Date(l.replace(/-/g,"/")).Format("yyyy-MM-dd hh:mm:ss");var g=sms_enterPhone(c.phone.split(";"));""!=g&&null!=g||(g=IDS_sms_phone_not_fill),c.index,t=$("<tr class='sms_list_tr'></tr>"),(a=$("<td width='50' class='sms_td'></td>")).append("<input type='checkbox' name='checkbox' value='"+g+"' />"),t.append(a),_=$("<td  class='td_pl sms_phone_width'></td>"),parseInt(c.unreadcount,10)>0&&c.smstat==CHAT_SMS_SMSTAT?_.html("<table border='0' cellpadding='0' class='sms_msg' cellspacing='0'><tr><td class='sms_phone_number'>"+g+"<span>&nbsp;&nbsp;&nbsp;(&nbsp;"+c.unreadcount+"&nbsp;)</span>&nbsp;&nbsp;<span class='chat_send_failed_icon'>&nbsp;</span></td></tr></table>"):parseInt(c.unreadcount,10)>0&&c.smstat!=CHAT_SMS_SMSTAT?_.html("<table border='0' cellpadding='0' class='sms_msg' cellspacing='0'><tr><td class='sms_phone_number'>"+g+"<span>&nbsp;&nbsp;&nbsp;(&nbsp;"+c.unreadcount+"&nbsp;)</span></td></tr></table>"):parseInt(c.unreadcount,10)<=0&&c.smstat==CHAT_SMS_SMSTAT?_.html("<table border='0' cellpadding='0' class='sms_msg' cellspacing='0'><tr><td class='sms_phone_number'>"+g+"&nbsp;&nbsp;<span class='chat_send_failed_icon'>&nbsp;</span></td></tr></table>"):_.html("<table border='0' cellpadding='0' class='sms_msg' cellspacing='0'><tr><td class='sms_phone_number'>"+g+"</td></tr></table>"),t.append(_),n=$("<td  class='td_pl sms_content_width'></td>"),o=$("<pre class='sms_content clr_blue_a'></pre>"),e.length!=c.content.length?o.html(e):o.text(e),n.html(o),t.append(n),(r=$("<td  class='td_pl sms_date_width'></td>")).append("<label>"+l+"</label>"),t.append(r),s.after(t),s=t,m.push(c.phone)})),c={Phone:m};var l=0,g=[];if(g_module.pb_enabled)for(pb_start=0,pb_end=0,i=0;i<m.length;i++){var d=m[i].split(";");d.length<=50&&(l+d.length>50?(pb_end=i,i--,pb_match(c={Phone:g}),l=0,g=[]):(l+=d.length,g.push(m[i]),i==m.length-1&&0==l?pb_match(c={Phone:m[i]}):i==m.length-1&&0!=l&&l<=50&&(c={Phone:g},pb_end=i,pb_match(c))))}$("#sms_check_all").removeAttr("checked"),"material"==webui_mode&&materializeInputs()}function pb_match(e){var s=object2xml("request",e);saveAjaxData("api/pb/pb-match",s,(function(e){var s=xml2object(e);if("response"==s.type){var t=s.response.Name;if(t){var a=0,_=0,n="";if(g_chat_sms_pbMatch=t,$.isArray(t))for(_=pb_start;_<=pb_end;_++)""!=$(".sms_phone_number").eq(_).text()&&(_+1>pb_end&&(pb_start=pb_end),n=sms_enterPhone(t[a].split(";")),$(".sms_phone_number").eq(_).html(spaceToNbsp(n)),a++);else for(_=pb_start;_<=pb_end;_++)""!=$(".sms_phone_number").eq(_).text()&&(_+1>pb_end&&(pb_start=pb_end),n=sms_enterPhone(t.split(";")),$(".sms_phone_number").eq(_).html(spaceToNbsp(n)))}}}),{sync:!0}),e=""}function sms_enterPhone(e){for(pb_contactsName="",j=0;j<e.length;j++)e[j]=XSSResolveCannotParseChar(e[j]),j!=e.length-1?pb_contactsName+=e[j]+";<br/>":pb_contactsName+=e[j];return pb_contactsName}function sms_createPageNav(){var e,s,t,a,_,n,r="";if(e=1==g_sms_pageIndex?"javascript:void(0);":"javascript:sms_pageNav('first')",s=g_sms_pageIndex==g_sms_totalSmsPage?"javascript:void(0);":"javascript:sms_pageNav('last')","ar_sa"==LANGUAGE_DATA.current_language||"he_il"==LANGUAGE_DATA.current_language?($("#pageBegin_chat").attr("href",s),$("#pageLast_chat").attr("href",e)):($("#pageBegin_chat").attr("href",e),$("#pageLast_chat").attr("href",s)),t=1==g_sms_pageIndex?"javascript:void(0);":"javascript:sms_pageNav('prePage')",a=g_sms_pageIndex==g_sms_totalSmsPage?"javascript:void(0);":"javascript:sms_pageNav('nextPage')","ar_sa"==LANGUAGE_DATA.current_language||"he_il"==LANGUAGE_DATA.current_language?($("#prePage_chat").attr("href",a),$("#nextPage_chat").attr("href",t)):($("#prePage_chat").attr("href",t),$("#nextPage_chat").attr("href",a)),g_sms_pageIndex=parseInt(g_sms_pageIndex,10),g_sms_totalSmsPage>8?g_sms_pageIndex+4>=g_sms_totalSmsPage?_=(n=g_sms_totalSmsPage)-8:g_sms_pageIndex<=4?n=8+(_=1):(_=g_sms_pageIndex>4?g_sms_pageIndex-4:1,n=g_sms_pageIndex+4>g_sms_totalSmsPage?g_sms_totalSmsPage:g_sms_pageIndex+4):(_=1,n=g_sms_totalSmsPage),"ar_sa"==LANGUAGE_DATA.current_language||"he_il"==LANGUAGE_DATA.current_language)for(i=n;i>=_;i--)aHref=i==g_sms_pageIndex?' href="javascript:void(0);"':" href=\"javascript:sms_pageNav('"+i+'\')" style="text-decoration:underline"',r+="<a "+aHref+">"+i+"</a>";else for(i=_;i<=n;i++)aHref=i==g_sms_pageIndex?' href="javascript:void(0);"':" href=\"javascript:sms_pageNav('"+i+'\')" style="text-decoration:underline"',r+="<a "+aHref+">"+i+"</a>";$("#page_num_chat").html(r)}function sms_createPageNav_Chat(){var e,s,t,a,_,n,r="";if(e=1==g_sms_pageIndex?"javascript:void(0);":"javascript:sms_pageNav('first')",s=g_sms_pageIndex==g_sms_totalSmsPage?"javascript:void(0);":"javascript:sms_pageNav('last')","ar_sa"==LANGUAGE_DATA.current_language||"he_il"==LANGUAGE_DATA.current_language?($("#pageBegin_phone_chat").attr("href",s),$("#pageLast_phone_chat").attr("href",e)):($("#pageBegin_phone_chat").attr("href",e),$("#pageLast_phone_chat").attr("href",s)),t=1==g_sms_pageIndex?"javascript:void(0);":"javascript:sms_pageNav('prePage')",a=g_sms_pageIndex==g_sms_totalSmsPage?"javascript:void(0);":"javascript:sms_pageNav('nextPage')","ar_sa"==LANGUAGE_DATA.current_language||"he_il"==LANGUAGE_DATA.current_language?($("#prePage_phone_chat").attr("href",a),$("#nextPage_phone_chat").attr("href",t)):($("#prePage_phone_chat").attr("href",t),$("#nextPage_phone_chat").attr("href",a)),g_sms_pageIndex=parseInt(g_sms_pageIndex,10),g_sms_totalSmsPage>4?g_sms_pageIndex+2>=g_sms_totalSmsPage?_=(n=g_sms_totalSmsPage)-4:g_sms_pageIndex<=2?n=4+(_=1):(_=g_sms_pageIndex>2?g_sms_pageIndex-2:1,n=g_sms_pageIndex+2>g_sms_totalSmsPage?g_sms_totalSmsPage:g_sms_pageIndex+2):(_=1,n=g_sms_totalSmsPage),"ar_sa"==LANGUAGE_DATA.current_language||"he_il"==LANGUAGE_DATA.current_language)for(i=n;i>=_;i--)aHref=i==g_sms_pageIndex?' href="javascript:void(0);"':" href=\"javascript:sms_pageNav('"+i+'\')" style="text-decoration:underline"',r+="<a "+aHref+">"+i+"</a>";else for(i=_;i<=n;i++)aHref=i==g_sms_pageIndex?' href="javascript:void(0);"':" href=\"javascript:sms_pageNav('"+i+'\')" style="text-decoration:underline"',r+="<a "+aHref+">"+i+"</a>";$("#page_num_phone_chat").html(r)}function sms_pageNav(e){switch(g_temp_pageIndex_status=g_sms_pageIndex,e){case"first":g_sms_pageIndex=1;break;case"last":g_sms_pageIndex=g_sms_totalSmsPage;break;case"prePage":g_sms_pageIndex--;break;case"nextPage":g_sms_pageIndex++;break;default:g_sms_pageIndex=e}g_temp_pageIndex_status!=g_sms_pageIndex&&(g_scroll_smsList_status=0),$(document).scrollTop(0),-1!=window.location.href.lastIndexOf("smschat")?(sms_getBoxCount(),sms_initBoxCount(),getChatHistory()):sms_initPage(),$("#jump_page_index").val(""),$("#jump_page_index_chat").val("")}function sms_smsDelete(){cancelLogoutTimer(),g_sms_checkedList="<phone>",$("#sms_table :checkbox:gt(0):checked").each((function(){var e=this.value;e=e.replace(/<br\/>/g,""),g_sms_checkedList+=e+";"})),g_sms_checkedList=g_sms_checkedList.substring(0,g_sms_checkedList.lastIndexOf(";")),g_sms_checkedList+="</phone>";var e=object2xml("request",g_sms_checkedList);saveAjaxData("api/sms/sms-delete-phone",e,(function(e){var s=xml2object(e);startLogoutTimer(),isAjaxReturnOK(s)&&sms_initPage()}))}function sms_importMessage(){0!=g_sms_simSum?g_sms_localSum>=g_sms_smsCount.LocalMax?showInfoDialog(strid_sms_hint_no_room):($("#pop_confirm").die("click"),$("#pop_Cancel").die("click"),$(".dialog_close_btn").die("click"),$(".wait_dialog_btn").die("click"),$("#pop_OK").die("click"),showConfirmDialog(strid_sms_hint_import_conform,(function(){$(".dialog").remove(),1==g_sms_simSum?showWaitingDialog(common_waiting,STRID_sms_message_importing_message):showWaitingDialog(common_waiting,STRID_sms_message_importing_messages.replace("%d",g_sms_simSum));var e={IsMove:0,Date:(new Date).Format("yyyy-MM-dd hh:mm:ss")},s=object2xml("request",e);saveAjaxData("api/sms/backup-sim",s,(function(e){var s=xml2object(e);if(closeWaitingDialog(),"response"==s.type){if(sms_systemBusy==s.response.Code)showInfoDialog(common_system_busy);else if(""!=s.response.FailNumber&&"undefined"!=s.response.FailNumber&&""!=s.response.sucNumber&&"undefined"!=s.response.sucNumber){sms_getBoxCount();var t=parseInt(s.response.FailNumber,10),a=parseInt(s.response.SucNumber,10);showInfoDialog(a+" "+common_succeed+common_comma+t+" "+common_failed)}}else showInfoDialog(common_failed)}),{timeout:3e5,errorCB:function(){closeWaitingDialog(),showInfoDialog(common_failed)}})}),(function(){}))):showInfoDialog(strid_sms_hint_import_none)}function sms_showWaitingDialog(e,s,t){if("material"==webui_mode){var a="<h4 class='mdl-dialog__title'>"+e+"</h4><div class='mdl-dialog__content'><center><div class='preloader-wrapper big active'><div class='spinner-layer spinner-blue'><div class='circle-clipper left'><div class='circle'></div></div><div class='gap-patch'><div class='circle'></div></div><div class='circle-clipper right'><div class='circle'></div></div></div><div class='spinner-layer spinner-red'><div class='circle-clipper left'><div class='circle'></div></div><div class='gap-patch'><div class='circle'></div></div><div class='circle-clipper right'><div class='circle'></div></div></div><div class='spinner-layer spinner-yellow'><div class='circle-clipper left'><div class='circle'></div></div><div class='gap-patch'><div class='circle'></div></div><div class='circle-clipper right'><div class='circle'></div></div></div><div class='spinner-layer spinner-green'><div class='circle-clipper left'><div class='circle'></div></div><div class='gap-patch'><div class='circle'></div></div><div class='circle-clipper right'><div class='circle'></div></div></div></div><p>"+s+"</p></center><div class='mdl-dialog__actions'><a href='javascript:void(0);' id='pop_Cancel' class='mdl-button'>"+common_cancel+"</a><a href='javascript:void(0);' id='pop_Close' class='mdl-button'>"+common_close+"</a></div>",_=document.createElement("dialog");_.id="wait_table",_.className="wait_table mdl-dialog",_.innerHTML=a,$("body").append(_),$("#pop_Close").bind("click",(function(){closeWaitingDialog()})),$("#pop_Cancel").live("click",(function(){closeWaitingDialog(),"function"==typeof t&&t()})),_.showModal||dialogPolyfill.registerDialog(_),_.showModal()}else{if($("#div_wrapper").remove(),a="<div id='div_wrapper'><iframe   id='ifream_dialog'  src= '' frameborder= '0' style= 'background:#bcbcbc; width:100%; height:100%; display: block;'> </iframe></div><table colspacing='0' cellspacing='0' id='wait_table' class='wait_table'><tr><td><div class='wait_table_header'><label class='wait_title clr_white'>"+e+"</label><span class='wait_dialog_btn' id='wait_dialog_btn clr_gray' ><canvas id='sms_showWaitingCanvas' width='25px' height='25px'></canvas></span></div></td></tr><tr><td><div class='wait_table_content'><div class='wait_wrapper'><div class='wait_image'><img src='../res/waiting.gif' alt=''/></div><div class='wait_str'>"+s+"</div></div></div></td></tr><tr><td><div class='wait_table_content_sms'><span class='button_wrapper pop_Cancel'><input id='pop_Cancel' class='button_dialog' type='button' value='"+common_cancel+"'/></span></div></td></tr></table>",$("body").append(a),$.browser.msie&&9==parseInt($.browser.version,10)){$(".button_wrapper").css("border-radius","3px");var n=document.getElementById("sms_showWaitingCanvas");draw(n)}else $.browser.msie&&parseInt($.browser.version,10)<9?($(".wait_title").css("margin-top","5"),$(".wait_dialog_btn").css("margin-top","7px"),$(".wait_table_header").css({width:"377px",height:"33px"}),$(".wait_table_header").corner("top 5px"),$(".button_wrapper").css("background","#75ACD6"),$(".button_wrapper").corner("3px"),$(".button_wrapper input").css("padding-top","2px"),$(".wait_table_header span").append("<img src='../res/new_del.png' title='' alt='' />")):(n=document.getElementById("sms_showWaitingCanvas"),draw(n));reputPosition($("#wait_table"),$("#div_wrapper")),$("#wait_dialog_btn").bind("click",(function(){closeWaitingDialog()})),$("#pop_Cancel").live("click",(function(){$("#wait_table, #div_wrapper").remove(),"function"==typeof t&&t()}))}}function sms_showSmsDialog(){if("material"==webui_mode){document.querySelectorAll("#sms_dialog").forEach((function(e,s,t){e.close()})),$("#sms_dialog").remove(),g_content=null;var e="";e+="<h4 class='mdl-dialog__title'>"+sms_label_message+"</h4>",e+="<div class='mdl-dialog__content'>",e+="    <div class='sms_message'>",e+="    <p  id = 'recipients_sender'>"+sms_label_recipients+common_colon+"</p>",e+="    <div id='sms_number_wrapper'>",e+="        <div id='sms_number'>",1==g_contact_enabled&&g_module.pb_enabled?(e+="        <input type='text' id='recipients_number_pb' name='recipients_number_pb' value='' />",e+="        <img id='close_search_recipients_number' src='../res/-.png' alt='' style='display:none;'/>",e+="        <img id='search_recipients_number' src='../res/+.png' alt=''/>"):e+="        <input type='text' id='recipients_number' name='recipients_number' value='' onblur='checkNumberFormat()' />",e+="        </div>",1==g_contact_enabled&&g_module.pb_enabled&&(e+="        <div id='user_add_select' class='user_add_select'><ul id='list_contacts' ></ul></div>"),e+="    </div>",e+="    <p>"+sms_label_content+common_colon+"</p>",e+="    <textarea id='message_content'></textarea>",e+="    <p id='sms_count'></p>",e+="    </div>",e+="</div>",e+="<div class='mdl-dialog__actions'>",e+="    <a href='javascript:void(0);' id='pop_send' class='mdl-button'>"+common_send+"</a>",e+="    <a href='javascript:void(0);' id='pop_save_to_drafts' class='mdl-button'>"+sms_label_save_to_drafts+"</a>",e+="    <a href='javascript:void(0);' id='pop_Cancel' class='mdl-button'>"+common_cancel+"</a>",e+="</div>";var s=document.createElement("dialog");s.className="dialog mdl-dialog",s.id="sms_dialog",s.innerHTML=e,$(".body_bg").before(s),materializeInputs(),s.showModal||dialogPolyfill.registerDialog(s),s.showModal()}else if($("#div_wrapper").remove(),$("#sms_dialog").remove(),g_content=null,e="",$("#div_wrapper").size()<1&&(e+="<div id='div_wrapper'><iframe   id='ifream_dialog'  src= '' frameborder= '0' style= 'background:#bcbcbc; width:100%; height:100%; display: block;'> </iframe></div>"),e+="<div class='dialog' id='sms_dialog'>",e+="    <div class='sms_dialog_content'>",e+="        <div class='sms_dialog_header'>",e+="            <span class='dialog_header_left clr_white'>"+sms_label_message+"</span>",e+="            <span class='dialog_header_right'><a class='dialog_close_btn clr_gray' title='' href='javascript:void(0);'><canvas id='sms_showSmsCanvas' width='25px' height='25px'></canvas></a></span>",e+="        </div>",e+="        <div class='sms_dialog_table'>",e+="               <div class='sms_message'>",e+="               <p  id = 'recipients_sender'>"+sms_label_recipients+common_colon+"</p>",e+="               <div id='sms_number_wrapper'>",e+="                   <div id='sms_number'>",1==g_contact_enabled&&g_module.pb_enabled?(e+="                   <input type='text' id='recipients_number_pb' name='recipients_number_pb' value='' />",e+="                   <img id='close_search_recipients_number' src='../res/-.png' alt='' style='display:none;'/>",e+="                   <img id='search_recipients_number' src='../res/+.png' alt=''/>"):e+="                   <input type='text' id='recipients_number' name='recipients_number' value='' onblur='checkNumberFormat()' />",e+="                   </div>",1==g_contact_enabled&&g_module.pb_enabled&&(e+="                   <div id='user_add_select' class='user_add_select'><ul id='list_contacts' ></ul></div>"),e+="               </div>",e+="               <p>"+sms_label_content+common_colon+"</p>",e+="               <textarea id='message_content'></textarea>",e+="               <p id='sms_count'></p>",e+="               </div>",e+="        </div>",e+="        <div class='sms_dialog_table_bottom'>",e+="            <div class='dialog_table_r'>",e+="              <span class='button_wrapper pop_send'>",e+="                  <input id='pop_send' class='button_dialog' type='button' value='"+common_send+"'/></span>",e+="&nbsp;&nbsp;&nbsp;&nbsp;<span class='button_wrapper pop_save_to_drafts'>",e+="                  <input id='pop_save_to_drafts' class='button_dialog' type='button' value='"+sms_label_save_to_drafts+"'/></span>",e+="&nbsp;&nbsp;&nbsp;&nbsp;<span class='button_wrapper pop_Cancel pop_common_cancel'>",e+="                  <input id='pop_Cancel' class='button_dialog' type='button' value='"+common_cancel+"'/></span>",e+="            </div>",e+="        </div>",e+="    </div>",e+="</div>",$(".body_bg").before(e),$.browser.msie&&9==parseInt($.browser.version,10)){$(".button_wrapper").css("border-radius","3px");var t=document.getElementById("sms_showSmsCanvas");draw(t)}else $.browser.msie&&parseInt($.browser.version,10)<9?($(".dialog_header_left").css("margin-top","5"),$(".sms_dialog_header").css({width:"609px",height:"29px"}),$(".sms_dialog_header").corner("top 5px"),$(".dialog_close_btn").css("top","7"),$(".button_wrapper").css("background","#75ACD6"),$(".button_wrapper").corner("3px"),$(".button_wrapper input").css("padding-top","2px"),$(".sms_dialog_header a").append("<img src='../res/new_del.png' title='' alt='' />")):(t=document.getElementById("sms_showSmsCanvas"),draw(t));"-1"!=g_lang_edit||g_isCDMA||0==g_smsFeature.smscharlang||void 0===g_smsFeature.smscharlang?$("#sms_count").html("160(1)"):$("#sms_count").html("155(1)"),"material"!=webui_mode&&reputPosition($("#sms_dialog"),$("#div_wrapper")),disableTabKey(),1==g_contact_enabled&&g_module.pb_enabled?$("#recipients_number_pb").attr("tabindex","0"):$("#recipients_number").attr("tabindex","0"),1==g_contact_enabled&&g_module.pb_enabled&&createList()}function sms_changeNetwork(){g_net_mode_change==MACRO_NET_MODE_CHANGE&&(g_net_mode_status==MACRO_NET_MODE_C?g_isCDMA=!0:g_net_mode_status==MACRO_NET_MODE_W&&(g_isCDMA=!1),void 0!==$("#message_content").val()&&sms_contentChange($("#message_content").val()),resetNetModeChange())}function sms_newMessage(){g_sms_length=0,cancelLogoutTimer(),sms_showSmsDialog();var e=create_button_html(common_send,"pop_send","pop_send")+"&nbsp;&nbsp;&nbsp;&nbsp;"+create_button_html(common_cancel,"pop_chat_Cancel","pop_chat_Cancel");$(".dialog_table_r").html(e),ieRadiusBorder(),"material"==webui_mode&&materializeButtons(),1==g_contact_enabled&&g_module.pb_enabled?$("#recipients_number_pb").focus().select():$("#recipients_number").focus().select(),1==g_contact_enabled&&g_module.pb_enabled?$("#pop_send,#pop_chat_Cancel,.dialog_close_btn").live("click",(function(){$("#user_add_select").hide(),$("#search_recipients_number").show(),$("#close_search_recipients_number").hide()})):$("#search_recipients_number").hide()}function setSmsRead(e){$(g_sms_smsList).each((function(s){if(g_sms_smsList[s].index==e&&0==g_sms_smsList[s].smstat){var t=object2xml("request",{Index:e});saveAjaxData("api/sms/set-read",t,(function(s){var t=xml2object(s);isAjaxReturnOK(t)&&$("#smsReadStates"+e).attr("class","msg_icon read_state1")}))}}))}Date.prototype.Format=function(e){var s,t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds()};for(s in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),t)new RegExp("("+s+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[s]:("00"+t[s]).substr((""+t[s]).length)));return e};var g_SMS_UCS2_MAX_SIZE,g_SMS_8BIT_MAX_SIZE,g_SMS_7BIT_MAX_SIZE,g_station,PAGE_HANDLE_FORWARD="0",PAGE_HANDLE_REPLY="1",PAGE_HANDLE_READ="2",PAGE_HANDLE_CREATE="3",PAGE_HANDLE_NULL="4",SMS_TEXT_MODE_UCS2=0,SMS_TEXT_MODE_7BIT=1,SMS_TEXT_MODE_8BIT=2,ASCII_CODE=127,g_content=null,g_text_mode=SMS_TEXT_MODE_7BIT,g_sms_length=0,g_sms_num=1,g_ucs2_num=0,GSM_7BIT_NUM=128,SMS_STR_NUM=620,EXTENSION_ASCII=9,g_ext_7bit_tab=[[20,94],[40,123],[41,125],[47,92],[60,91],[61,126],[62,93],[64,124],[101,8364]],g_ext_7bit_tab_turkish=[[13,29],[20,94],[40,123],[41,125],[47,92],[60,91],[61,126],[62,93],[64,124],[71,286],[73,304],[83,350],[99,231],[101,8364],[103,287],[105,305],[115,351]],g_ext_7bit_tab_spanish=[[9,231],[20,94],[40,123],[41,125],[47,92],[60,91],[61,126],[62,93],[64,124],[65,193],[73,205],[79,211],[85,218],[97,225],[101,8364],[105,237],[111,243],[117,250]],g_ext_7bit_tab_Portuguese=[[5,234],[9,231],[11,212],[12,244],[14,193],[15,225],[18,934],[19,915],[20,94],[21,937],[22,928],[23,936],[24,931],[25,920],[31,202],[40,123],[41,125],[47,92],[60,91],[61,126],[62,93],[64,124],[65,192],[73,205],[79,211],[85,218],[91,195],[92,213],[97,194],[101,8364],[105,237],[111,243],[117,250],[123,227],[124,245],[127,226]],extension_char=27,ENTER_CHAR=10,CR_CHAR=13,arrayGSM_7bit=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127],arrayGSM_7DefaultTable=[64,163,36,165,232,233,249,236,242,199,10,216,248,13,197,229,916,95,934,915,923,937,928,936,931,920,926,27,198,230,223,201,32,33,34,35,164,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,161,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,196,214,209,220,167,191,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,228,246,241,252,224],arrayGSM_7ExtTable=[65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,10,65535,65535,65535,65535,65535,65535,65535,65535,65535,94,65535,65535,65535,65535,65535,65535,32,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,123,125,65535,65535,65535,65535,65535,92,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,91,126,93,65535,124,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,8364,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535],arrayGSM_7TurkishExtTable=[65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,10,65535,65535,29,65535,65535,65535,65535,65535,65535,94,65535,65535,65535,65535,65535,65535,32,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,123,125,65535,65535,65535,65535,65535,92,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,91,126,93,65535,124,65535,65535,65535,65535,65535,65535,286,65535,304,65535,65535,65535,65535,65535,65535,65535,65535,65535,350,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,231,65535,8364,65535,287,65535,305,65535,65535,65535,65535,65535,65535,65535,65535,65535,351,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535],arrayGSM_7PortugueseExtTable=[65535,65535,65535,65535,65535,234,65535,65535,65535,231,10,212,244,65535,193,225,65535,65535,934,915,94,937,928,936,931,920,65535,32,65535,65535,65535,202,65535,65535,65535,65535,65535,65535,65535,65535,123,125,65535,65535,65535,65535,65535,92,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,91,126,93,65535,124,192,65535,65535,65535,65535,65535,65535,65535,205,65535,65535,65535,65535,65535,211,65535,65535,65535,65535,65535,218,65535,65535,65535,65535,65535,195,213,65535,65535,65535,65535,194,65535,65535,65535,8364,65535,65535,65535,237,65535,65535,65535,65535,65535,243,65535,65535,65535,65535,65535,250,65535,65535,65535,65535,65535,227,245,65535,65535,226],arrayGSM_7SpanishExtTable=[65535,65535,65535,65535,65535,65535,65535,65535,65535,231,10,65535,65535,65535,65535,65535,65535,65535,65535,65535,94,65535,65535,65535,65535,65535,65535,32,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,123,125,65535,65535,65535,65535,65535,92,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,91,126,93,65535,124,193,65535,65535,65535,65535,65535,65535,65535,205,65535,65535,65535,65535,65535,211,65535,65535,65535,65535,65535,218,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,225,65535,65535,65535,8364,65535,65535,65535,237,65535,65535,65535,65535,65535,243,65535,65535,65535,65535,65535,250,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535],arrayGSM_7SpanishSpecialTable=[162,192,193,194,195,200,202,203,204,205,206,207,208,210,211,212,213,214,217,218,219,221,225,226,227,231,234,235,237,238,239,243,244,245,246,250,251,253,255,258,260,261,262,263,268,269,270,271,273,276,280,281,283,306,307,313,317,321,322,323,324,327,328,340,341,344,345,346,347,350,351,352,353,354,355,356,357,360,366,367,377,378,379,380,381,382,462,468,1168,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535];function sms_isPhoneNumber(e){var s=!0;return e.match(/^[+]{0,1}[*#0123456789]{1,20}$/)||(s=!1),s}function sms_isSendNumber(e){var s=!0;return $.isArray(e)?$(e).each((function(t){s=sms_isPhoneNumber(e[t])})):s=sms_isPhoneNumber(e),s}function sms_sendNumberCheck(){sms_clearAllErrorLabel();var e,s=0,t=!0,a=0;for(g_numberValid=!0,(e=arguments[0]).length>g_sms_maxphonesize&&(showErrorUnderTextbox("sms_number",sms_hint_maximum_number.replace("%d",g_sms_maxphonesize)),1==g_contact_enabled&&g_module.pb_enabled?$("#recipients_number_pb").focus().select():$("#recipients_number").focus().select(),t=!1,a+=10),s=0;s<e.length;s++)if(e[s]=$.trim(e[s]),0==sms_isSendNumber(e[s]))return showErrorUnderTextbox("sms_number",sms_hint_mobile_number_format),1==g_contact_enabled&&g_module.pb_enabled?$("#recipients_number_pb").focus().select():$("#recipients_number").focus().select(),"material"!=webui_mode&&(a=110+a,$("#sms_number_wrapper").css({height:a+"px"})),g_numberValid=t=!1,!1;return g_numberValid=t,t}function check_extension_ascii_for_char_number(e){var s,t=0,a=0,_=0,n=1,r=g_ext_7bit_tab,i=160,o=153;switch(g_smsFeature.smscharlang){case 0:r=g_ext_7bit_tab;break;case 1:r=g_ext_7bit_tab_turkish;break;case 2:r=g_ext_7bit_tab_spanish;break;case 3:r=g_ext_7bit_tab_Portuguese}for(0==g_smsFeature.smscharlang||void 0===g_smsFeature.smscharlang?(i=160,o=153):(i=155,o=149),t=0;t<e.length;t++){var c=1;for(s=e.charAt(t).charCodeAt(),c=1,a=0;a<r.length;a++)if(s==r[a][1]){c=2;break}1==c?_++:1==n?o-1==_?(_+=2,n=2):_+=2*o-1==_||3*o-1==_||4*o-1==_?3:2:_+=2*(o-1)==_||3*(o-1)+1==_||4*(o-1)+2==_?3:2}return _>i&&2==n&&_++,_}function check_extension_ascii_for_char_number_new(e){var s,t=0,a=0,_=0,n=1,r=g_ext_7bit_tab,i=160,o=153,c="",m=!0;switch(g_smsFeature.smscharlang){case 0:c=g_ext_7bit_tab;break;case 1:c=g_ext_7bit_tab_turkish;break;case 2:c=g_ext_7bit_tab_spanish;break;case 3:c=g_ext_7bit_tab_Portuguese}for(g_sms_smscharlang=!1,t=0;t<e.length;t++){m=!0;var l=1;for(s=e.charAt(t).charCodeAt(),l=1,a=0;a<r.length;a++)if(s==r[a][1]){l=2,i=160,o=153,m=!1;break}if(m)for(l=1,a=0;a<c.length;a++)if(s==c[a][1]){l=2,i=155,o=149,g_sms_smscharlang=!0;break}1==l?_++:1==n?o-1==_?(_+=2,n=2):_+=2*o-1==_||3*o-1==_||4*o-1==_?3:2:_+=2*(o-1)==_||3*(o-1)+1==_||4*(o-1)+2==_?3:2}return _>i&&2==n&&_++,_}function ucs2_number_check(e){var s,t,a=0,_=0,n=0,r=arrayGSM_7ExtTable;if(0==e.length)return 0;switch(g_smsFeature.smscharlang){case 0:r="2"==g_convert_type?arrayGSM_7SpanishExtTable:arrayGSM_7ExtTable;break;case 1:r=arrayGSM_7TurkishExtTable;break;case 2:r=arrayGSM_7SpanishExtTable;break;case 3:r=arrayGSM_7PortugueseExtTable}for(a=0;a<e.length;a++){for(t=0,s=e.charAt(a).charCodeAt(),_=0;_<GSM_7BIT_NUM;_++)if("2"==g_convert_type){if(s==arrayGSM_7DefaultTable[_]||s==r[_]||s==arrayGSM_7SpanishSpecialTable[_]){t=1;break}}else if(s==arrayGSM_7DefaultTable[_]||s==r[_]){t=1;break}0==t&&n++}return n}function CDMA_textmode_check(e){var s,t=0,a=SMS_TEXT_MODE_7BIT;if(0==e.length)return SMS_TEXT_MODE_7BIT;for(t=0;t<e.length;t++)if(s=e.charAt(t).charCodeAt(),SMS_TEXT_MODE_7BIT==a&&0<=s&&127>=s)a=SMS_TEXT_MODE_7BIT;else if((SMS_TEXT_MODE_7BIT==a||SMS_TEXT_MODE_8BIT==a)&&127<s&&255>=s)a=SMS_TEXT_MODE_8BIT;else if(255<s){a=SMS_TEXT_MODE_UCS2;break}return a}function sms_numberCheck(e){var s,t,a=0,_=0,n=0;g_isCDMA?(g_SMS_UCS2_MAX_SIZE=260,g_SMS_8BIT_MAX_SIZE=540,g_SMS_7BIT_MAX_SIZE=620,a=sms_hint_max_ucs2_characters_268.replace(/268/,"260"),_=sms_hint_max_8bit_characters_532.replace(/532/,"540"),n=sms_hint_max_ascii_characters_612.replace(/612/,"620")):(g_SMS_UCS2_MAX_SIZE=268,g_SMS_8BIT_MAX_SIZE=532,g_SMS_7BIT_MAX_SIZE=612,a=sms_hint_max_ucs2_characters_268,_=sms_hint_max_8bit_characters_532,n=sms_hint_max_ascii_characters_612);var r=160,i=153,o=null;if(t=e.length,SMS_TEXT_MODE_UCS2==g_text_mode?(g_isCDMA?(r=70,i=65):(r=70,i=67),t>g_SMS_UCS2_MAX_SIZE&&(o=a)):SMS_TEXT_MODE_8BIT==g_text_mode?(g_isCDMA?(r=140,i=135):(r=140,i=133),t>g_SMS_8BIT_MAX_SIZE&&(o=_)):SMS_TEXT_MODE_7BIT!=g_text_mode||g_isCDMA?SMS_TEXT_MODE_7BIT==g_text_mode&&g_isCDMA&&(r=160,t>4*(i=155)&&(o=n)):(t="-1"==g_lang_edit?check_extension_ascii_for_char_number(e):check_extension_ascii_for_char_number_new(e),"-1"!=g_lang_edit&&!g_sms_smscharlang||"-1"==g_lang_edit&&(0==g_smsFeature.smscharlang||void 0===g_smsFeature.smscharlang)?(r=160,i=153,t>g_SMS_7BIT_MAX_SIZE&&(o=n)):(r=155,t>4*(i=149)&&(o=sms_hint_max_ascii_characters_596))),null!=o?(sms_clearAllErrorLabel(),showErrorUnderTextbox("sms_count",o),g_sms_length=t,button_enable("pop_send","0")):(button_enable("pop_send","1"),sms_clearAllErrorLabel()),t<=r)document.getElementById("sms_count").innerHTML=r-t+"(1)",s=1,t<=0&&(g_content=e.substring(0));else if(t>r&&t<=4*i)s=parseInt(t/i,10)+1,0==t%i&&(s-=1),document.getElementById("sms_count").innerHTML=i*s-t+"("+s+")";else{var c=parseInt((t-4*i)/i,10),m=Math.floor(c),l=4*i+(m+1)*i-t;document.getElementById("sms_count").innerHTML=l+"("+(m+4+1)+")"}g_sms_num=s,g_sms_length=t}function sms_contentDiffUCS2Num(e){var s,t=0,a=0,_=0,n=0,r=0,i=0,o=0;if(null!=g_content&&0!=g_content.length)if(null!=e&&0!=e.length){for(s=Math.min(e.length,g_content.length),r=0;r<s&&e.charAt(r).charCodeAt()==g_content.charAt(r).charCodeAt();++r);if(r==s)(n=e.length-g_content.length)>0?i=ucs2_number_check(e.substring(r)):n<0&&(i=-1*ucs2_number_check(g_content.substring(r)));else{for(t=0,a=g_content.length-1,_=e.length-1;t<s&&a>r&&_>r&&e.charAt(_).charCodeAt()==g_content.charAt(a).charCodeAt();++t,--a,--_);o=ucs2_number_check(g_content.substring(r,a+1)),i=ucs2_number_check(e.substring(r,_+1))-o}g_ucs2_num+=i}else g_ucs2_num=0;else g_ucs2_num=ucs2_number_check(e)}function sms_contentChange(e){g_isCDMA?g_text_mode=CDMA_textmode_check(e):($.browser.msie?g_net_mode_type==MACRO_NET_DUAL_MODE&&g_net_mode_change==MACRO_NET_MODE_CHANGE?g_ucs2_num=ucs2_number_check(e):sms_contentDiffUCS2Num(e):g_ucs2_num=ucs2_number_check(e),g_text_mode=g_ucs2_num>0?SMS_TEXT_MODE_UCS2:SMS_TEXT_MODE_7BIT),sms_numberCheck(e),g_content=e}function sms_contentCheck(){var e=!0;return SMS_TEXT_MODE_UCS2==g_text_mode?g_sms_length>g_SMS_UCS2_MAX_SIZE&&(sms_clearAllErrorLabel(),showErrorUnderTextbox("sms_count",IDS_sms_hint_content_too_long),$("#message_content").select(),e=!1):SMS_TEXT_MODE_7BIT==g_text_mode?g_sms_length>g_SMS_7BIT_MAX_SIZE&&(sms_clearAllErrorLabel(),showErrorUnderTextbox("sms_count",IDS_sms_hint_content_too_long),$("#message_content").select(),e=!1):SMS_TEXT_MODE_8BIT==g_text_mode&&g_sms_length>g_SMS_8BIT_MAX_SIZE&&(sms_clearAllErrorLabel(),showErrorUnderTextbox("sms_count",IDS_sms_hint_content_too_long),$("#message_content").select(),e=!1),e}function check_lang_edit(){getAjaxData("api/sms/splitinfo-sms",(function(e){var s=xml2object(e);"response"==s.type&&(g_lang_edit=s.response.splitinfo,g_convert_type=s.response.convert_type)}),{sync:!0})}function main_executeBeforeDocumentReady(){getConfigData("config/sms/config.xml",(function(e){g_smsFeature=_xml2feature(e),g_sms_smsListArray.readcount=g_smsFeature.pagesize>50?50:g_smsFeature.pagesize,""!=(g_sms_maxphonesize=$.trim(g_smsFeature.maxphone))&&void 0!==g_sms_maxphonesize||(g_sms_maxphonesize=SMS_MAXPHONESIZE),g_sms_importenabled="1"==g_smsFeature.import_enabled,g_sms_urlenabled="1"==g_smsFeature.url_enabled,g_isCDMA="1"==g_smsFeature.cdma_enabled}),{sync:!0}),redirectOnCondition(null,"smsandroid")}function createList(){$("#list_contacts").empty(),g_pb_pageIndex=1,pb_getConfig(),pb_getLocalContactList()}main_executeBeforeDocumentReady();var g_contact_enabled=null;function get_contact(){getAjaxData("api/sms/sms-feature-switch",(function(e){var s=xml2object(e);"response"==s.type&&(g_contact_enabled=s.response.getcontactenable)}),{sync:!0})}function getChatHistoryScrollAdd(){var e={phone:g_Current_Phone_Number_chat,pageindex:g_sms_totalSmsPage,readcount:g_smsFeature.pagesize};e.pageindex=g_sms_pageIndex;var s=object2xml("request",e);saveAjaxData("api/sms/sms-list-phone",s,(function(e){var s=xml2object(e);"response"==s.type&&s.response.messages.message&&(g_sms_chatList=null,g_sms_chatList=[],g_temp_smsList=[],$.isArray(s.response.messages.message)?g_sms_chatList=s.response.messages.message:g_sms_chatList.push(s.response.messages.message),g_temp_smsList=g_temp_smsList.concat(g_sms_chatList),g_scroll_smsList=g_temp_smsList.concat(g_scroll_smsList),(g_Current_Chat_Count!=g_sms_curMsgSum||g_sms_pageIndex!=g_sms_pageIndex_last||"0"!=g_sms_NewMsg&&void 0!==g_sms_NewMsg&&""!=g_sms_NewMsg)&&(g_Current_Chat_Count=g_sms_curMsgSum,g_sms_pageIndex_last=g_sms_pageIndex),showChatHistoryScrollAdd(),setChatSmsRead())}),{errorCB:function(){}})}function showChatHistoryScrollAdd(){$(".android_img_main").hide(),g_showHistory=!0,$(".sms_main_content").hide(),$(".sms_individual_list").show();var e=$("#boxList_title_chat"),s=null,t="";(new Date).Format("yyyy-MM-dd hh:mm:ss"),$.each(g_sms_chatList,(function(a,_){switch(parseInt(_.smstype,10)){case 7:_.content=sms_label_setting_usesreport+common_colon+" "+common_success;break;case 8:_.content=sms_label_setting_usesreport+common_colon+" "+common_failed}t=g_sms_urlenabled?regURL(_.content):XSSResolveCannotParseChar(_.content);var n=_.date;if(n=new Date(n.replace(/-/g,"/")).Format("yyyy-MM-dd hh:mm:ss"),s=$("<div class='sms_chat_list_tr'></div>"),CHAT_SMS_CURBOX==_.curbox){var r="<div class='sms_chat_phone_sent'><div class='sent_content_background'><div class='sms_chat_phone_sent_content'> <pre class='sms_content_chat clr_blue_a'>"+t+"</pre></div><div class='sms_chat_phone_sent_content'>";CHAT_SMS_SMSTAT==_.smstat&&(r+="<span class='chat_send_failed_icon'>&nbsp;</span>"),r+="<span class='chat_delete_icon' id='chat_delete_icon'>&nbsp;</span><span class='chat_forward_icon' id='chat_forward_icon'>&nbsp;</span><span>"+n+"</span></div></div><div class='sms_chat_sent_img'>&nbsp;&nbsp;</div></div>",s.html(r)}else s.html("<div class='sms_chat_phone_recive'><div class='sms_chat_recive_img'>&nbsp;&nbsp;</div><div class='recive_content_background'><div class='sms_chat_phone_recive_content'> <pre class='sms_content_chat clr_blue_a'>"+t+"</pre></div><div class='sms_chat_phone_recive_content'><span class='chat_delete_icon' id='chat_delete_icon'>&nbsp;</span><span class='chat_forward_icon' id='chat_forward_icon'>&nbsp;</span><span>"+n+"</span></div></div></div>");e.after(s),e=s}))}function showChatHistory(){if($("#cur_box_type_android_chat").text(g_Current_Phone_Number_chat),g_module.pb_enabled){var e=[];e.push(g_Current_Phone_Number_chat),pb_match({Phone:e}),$("#cur_box_type_android_chat").text(g_chat_sms_pbMatch)}$(".android_img_main").hide(),g_showHistory=!0,$(".sms_main_content").hide(),$(".sms_individual_list").show();var s=$("#boxList_title_chat"),t=null;$(".sms_chat_list_tr").remove();var a="";(new Date).Format("yyyy-MM-dd hh:mm:ss"),$.each(g_sms_chatList,(function(e,_){switch(parseInt(_.smstype,10)){case 7:_.content=sms_label_setting_usesreport+common_colon+" "+common_success;break;case 8:_.content=sms_label_setting_usesreport+common_colon+" "+common_failed}a=g_sms_urlenabled?regURL(_.content):XSSResolveCannotParseChar(_.content);var n=_.date;if(n=new Date(n.replace(/-/g,"/")).Format("yyyy-MM-dd hh:mm:ss"),t=$("<div class='sms_chat_list_tr'></div>"),CHAT_SMS_CURBOX==_.curbox){var r="<div class='sms_chat_phone_sent'><div class='sent_content_background'><div class='sms_chat_phone_sent_content'> <pre class='sms_content_chat clr_blue_a'>"+a+"</pre></div><div class='sms_chat_phone_sent_content'>";CHAT_SMS_SMSTAT==_.smstat&&(r+="<span class='chat_send_failed_icon'>&nbsp;</span>"),r+="<span class='chat_delete_icon' id='chat_delete_icon'>&nbsp;</span><span class='chat_forward_icon' id='chat_forward_icon'>&nbsp;</span><span>"+n+"</span></div></div><div class='sms_chat_sent_img'>&nbsp;&nbsp;</div></div>",t.html(r)}else t.html("<div class='sms_chat_phone_recive'><div class='sms_chat_recive_img'>&nbsp;&nbsp;</div><div class='recive_content_background'><div class='sms_chat_phone_recive_content'> <pre class='sms_content_chat clr_blue_a'>"+a+"</pre></div><div class='sms_chat_phone_recive_content'><span class='chat_delete_icon' id='chat_delete_icon'>&nbsp;</span><span class='chat_forward_icon' id='chat_forward_icon'>&nbsp;</span><span>"+n+"</span></div></div></div>");s.after(t),s=t}))}function setChatSmsRead(){var e="";$(g_sms_chatList).each((function(s){0==g_sms_chatList[s].smstat&&(e+="<Index>"+g_sms_chatList[s].index+"</Index>")}));var s=object2xml("request",e);saveAjaxData("api/sms/set-read",s,(function(e){var s=xml2object(e);isAjaxReturnOK(s)}))}function sms_clearAllErrorLabel(){clearAllErrorLabel(),"material"!=webui_mode&&$("#sms_number_wrapper").css({height:"76px"})}function sms_gotoSiminboxUrl(e){var s=0;switch(g_pbToSmsFlag=!1,e){case"ok":case"cancel":$.browser.msie&&"6.0"==$.browser.version?s=setTimeout((function(){clearTimeout(s),gotoPageWithoutHistory(SMS_CHAT_PGAE_URL)}),500):gotoPageWithoutHistory(SMS_CHAT_PGAE_URL)}}function pb_showLocalContactList(){$.each(g_pb_contactListArray,(function(e,s){html=(html=pb_replace_showMobilePhone(html=vLocalShowContactList,s)).replaceString("%href%",e),$("#list_contacts").append(html),html=(html=pb_replace_showHomePhone(html=vLocalShowContactList,s)).replaceString("%href%",e),$("#list_contacts").append(html),html=(html=pb_replace_showWorkPhone(html=vLocalShowContactList,s)).replaceString("%href%",e),$("#list_contacts").append(html)})),$("#user_add_select").append($("#list_contacts")),$(".linkmanInfo").unbind("click"),$(".linkmanInfo").bind("click",(function(){var e=$.trim($(this).find("div").eq(0).text())+"<"+$.trim($(this).find("div").eq(1).text())+">";displayInformations.indexOf(e)<0&&(displayInformations+=e+";"),$("#recipients_number_pb").val(displayInformations)}))}function pb_replace_showMobilePhone(e,s){var t=e;return pb_getConfig(),s.MobilePhone?(s.FormattedName?(g_pb_nameLength=utf8_strlen(s.FormattedName),g_pb_nameLength<=g_pb_feature.max_name_size?t=t.replaceString("%FormattedNameTwo%",resolveXMLEntityReference(s.FormattedName).replace(/\s/g,"&nbsp;")):(g_pb_nameNumber=utf8_str_id(s.FormattedName,g_pb_feature.max_name_size),afterSubstrName=s.FormattedName.substr(0,g_pb_nameNumber),t=t.replaceString("%FormattedNameTwo%",resolveXMLEntityReference(afterSubstrName).replace(/\s/g,"&nbsp;")))):t=t.replaceString("%FormattedNameTwo%",""),t=(t=s.MobilePhone.length<=g_pb_feature.max_phone_size?t.replaceString("%phone%",XSSResolveCannotParseChar(s.MobilePhone)):t.replaceString("%phone%",XSSResolveCannotParseChar(s.MobilePhone.substr(0,g_pb_feature.max_phone_size)))).replaceString("%numberType%","MobilePhone:")):t="",t}function pb_replace_showHomePhone(e,s){var t=e;return pb_getConfig(),s.HomePhone?(s.FormattedName?(g_pb_nameLength=utf8_strlen(s.FormattedName),g_pb_nameLength<=g_pb_feature.max_name_size?t=t.replaceString("%FormattedNameTwo%",resolveXMLEntityReference(s.FormattedName).replace(/\s/g,"&nbsp;")):(g_pb_nameNumber=utf8_str_id(s.FormattedName,g_pb_feature.max_name_size),afterSubstrName=s.FormattedName.substr(0,g_pb_nameNumber),t=t.replaceString("%FormattedNameTwo%",resolveXMLEntityReference(afterSubstrName).replace(/\s/g,"&nbsp;")))):t=t.replaceString("%FormattedNameTwo%",""),t=(t=t.replaceString("%phone%",XSSResolveCannotParseChar(s.HomePhone))).replaceString("%numberType%","HomePhone:")):t="",t}function pb_replace_showWorkPhone(e,s){var t=e;return pb_getConfig(),s.WorkPhone?(s.FormattedName?(g_pb_nameLength=utf8_strlen(s.FormattedName),g_pb_nameLength<=g_pb_feature.max_name_size?t=t.replaceString("%FormattedNameTwo%",resolveXMLEntityReference(s.FormattedName).replace(/\s/g,"&nbsp;")):(g_pb_nameNumber=utf8_str_id(s.FormattedName,g_pb_feature.max_name_size),afterSubstrName=s.FormattedName.substr(0,g_pb_nameNumber),t=t.replaceString("%FormattedNameTwo%",resolveXMLEntityReference(afterSubstrName).replace(/\s/g,"&nbsp;")))):t=t.replaceString("%FormattedNameTwo%",""),t=(t=t.replaceString("%phone%",XSSResolveCannotParseChar(s.WorkPhone))).replaceString("%numberType%","WorkPhone:")):t="",t}function utf8_strlen(e){var s=0,t=0;for(t=0;t<e.length;t++){var a=e.charCodeAt(t);s+=a<128?1:a<2048?2:3}return s}function utf8_str_id(e,s){var t=0,a=0;for(a=0;a<e.length;a++){var _=e.charCodeAt(a);if((t+=_<128?1:_<2048?2:3)>s)break}return a}function pb_getConfig(){null==pb_feature&&getConfigData("config/pb/config.xml",(function(e){pb_feature=_xml2feature(e),$.extend(g_pb_feature,pb_feature)}),{sync:!0})}function pb_getLocalContactList(){var e;g_pb_local_contact_list_request.GroupID=0,g_pb_local_contact_list_request.PageIndex=g_pb_pageIndex,g_pb_local_contact_list_request.ReadCount=g_pb_feature.max_record_size,g_pb_local_contact_list_request.KeyWord="",e=object2xml("request",g_pb_local_contact_list_request),saveAjaxData("api/pb/pb-list",e,(function(e){var s=pb_local_xml2object(e);"response"==s.type&&(g_pb_contactListArray=[],s.response.Phonebooks.Phonebook&&($.isArray(s.response.Phonebooks.Phonebook)?g_pb_contactListArray=s.response.Phonebooks.Phonebook:g_pb_contactListArray.push(s.response.Phonebooks.Phonebook),pb_showLocalContactList()),g_pb_curContactSum=s.response.SumSize,checkPage())}),{timeout:g_PB_TIMEOUT_SHORT,errorCB:function(){}})}function checkPage(){g_pb_totalPbPage=Math.ceil(g_pb_curContactSum/g_pb_local_contact_list_request.ReadCount),g_pb_pageIndex<g_pb_totalPbPage&&(g_pb_pageIndex++,pb_getLocalContactList())}function pb_local_xml2object(e){var s={};if(e.find("response").size()>0){var t=pb_local_recursiveXml2Object(e.find("response"));s.type="response",s.response=t}else if(e.find("error").size()>0){var a=e.find("code").text(),_=e.find("message").text();s.type="error",s.error={code:a,message:_}}else s.type="unknown";return s}function pb_local_recursiveXml2Object(e){if(e.children().size()>0){var s={};return e.children().each((function(){if("Field"!=this.tagName){var e=$(this).children().size()>0?pb_local_recursiveXml2Object($(this)):$(this).text();$(this).siblings().size()>0&&$(this).siblings().get(0).tagName==this.tagName?(null==s[this.tagName]&&(s[this.tagName]=[]),s[this.tagName].push(e)):s[this.tagName]=e}else s[$(this).find("Name").text()]=$(this).find("Value").text()})),s}return e.text()}get_contact(),$(document).ready((function(){if($.browser.msie&&"7.0"==$.browser.version&&$(".sms_chat_list").css({"overflow-y":"scroll"}),getMonitoringStatus(),$(".sms_individual_list").hide(),g_net_mode_status==MACRO_NET_MODE_C?g_isCDMA=!0:g_net_mode_status==MACRO_NET_MODE_W&&(g_isCDMA=!1),g_net_mode_type==MACRO_NET_DUAL_MODE&&addStatusListener("sms_changeNetwork()"),check_lang_edit(),-1!=window.location.href.lastIndexOf("smschat")){$("#cur_box_type_android").hide();var e=window.location.href.lastIndexOf("+"),s=window.location.href.length;g_Current_Phone_Number_chat=window.location.href.substring(e+1,s),sms_getBoxCount(),sms_initBoxCount(),initChatPage(),getChatHistory()}else $("#cur_box_type_android_chat").hide(),sms_initPage();var t;function a(e){sms_clearAllErrorLabel();var s="",t="";-1==window.location.href.lastIndexOf("smschat")||g_isForward?(g_isForward=0,s=1==g_contact_enabled&&g_module.pb_enabled?$.trim($("#recipients_number_pb").val()):$.trim($("#recipients_number").val()),t=$("#message_content").val()):(g_isForward=0,s=g_Current_Phone_Number_chat,t=$("#NewMessage_textarea").val()),s.length>0&&s.lastIndexOf(";")==s.length-1&&(s=s.substring(0,s.length-1),1==g_contact_enabled&&g_module.pb_enabled?$("#recipients_number_pb").val(_):$("#recipients_number").val(s)),""==$("#message_content").val()&&(g_sms_num=1);var a=s.split(";"),n=$.trim($("#message_content").val());if(("Save"==e&&0==s.length&&0!=n.length||sms_sendNumberCheck(a))&&sms_contentCheck()){t=resolveXMLEntityReference(t);var r,i=(new Date).Format("yyyy-MM-dd hh:mm:ss"),o={Index:-1,Phones:{Phone:a},Sca:"",Content:t,Length:t.length,Reserved:g_text_mode,Date:i},c=object2xml("request",o);"Save"==e?(clearDialog(),saveAjaxData("api/sms/save-sms",c,(function(e){var s=xml2object(e);isAjaxReturnOK(s)?sms_initPage():"error"==s.type&&sms_systemBusy==s.error.code?showInfoDialog(common_system_busy):showInfoDialog(common_failed)}))):(sms_showWaitingDialog(common_waiting,sms_hint_sending+"&nbsp;1/"+g_sms_num*a.length),$(".wait_dialog_btn").show(),$("#sms_dialog").remove(),saveAjaxData("api/sms/send-sms",c,(function(e){var s=xml2object(e);if("error"==s.type)sms_systemBusy==s.error.code?($("#wait_table").remove(),showInfoDialog(common_system_busy)):($("#wait_table").remove(),showInfoDialog(common_failed));else{function t(){getAjaxData("api/sms/send-status",(function(e){var s=xml2object(e),t=(s=s.response).TotalCount,a=s.CurIndex,_=s.Phone,n=s.SucPhone,i=s.FailPhone,o=sms_hint_sending+"&nbsp;"+a+"/"+t;if($(".wait_table_content .wait_str").html(o),""==_){$("#wait_table").remove(),clearInterval(r);var c=n.split(","),m=c.length,l=i.split(","),g=l.length;""==c[m-1]&&(c.pop(),m>0?m-=1:m=0,$(".send_success_info").hide()),""==l[g-1]&&(l.pop(),g>0?g-=1:g=0,$(".send_failed_info").hide());var d="<table id='sms_success_info'><tr><td><h1><span>"+m+"&nbsp;"+common_successfully+common_comma+"</span><span>"+g+"&nbsp;"+common_failed+"</span></h1></td></tr><tr><td height='27'></td></tr>";if(g_module.pb_enabled){var p="";m>0&&(successPhonesArry=n.replace(/,/g,";"),postObject={Phone:successPhonesArry},p=object2xml("request",postObject),saveAjaxData("api/pb/pb-match",p,(function(e){var s=xml2object(e);if("response"==s.type){var t=s.response.Name;d+="<tr class='send_success_info'><td><table><tr><td rowspan='2' width='30' valign='top'><img onload = 'fixPNG(this)' src='../res/icon_sms_send_success.png' alt='' /></td><td>"+sms_label_the_message_sent_successed+common_colon+"</td></tr><tr><td class='success_phone_number'>"+spaceToNbsp(XSSResolveCannotParseChar(t)).split(";").join("; ")+"</td></tr></table></td></tr><tr class='send_failed_info'><td height='21'></td></tr>",g_sendSuccessAndFailedFlag=!0}}),{sync:!0})),g>0&&(failPhonesArry=i.replace(/,/g,";"),postObject={Phone:failPhonesArry},p=object2xml("request",postObject),saveAjaxData("api/pb/pb-match",p,(function(e){var s=xml2object(e);if("response"==s.type){var t=s.response.Name;d+="<tr class='send_failed_info'><td><table><tr><td rowspan='2' width='30' valign='top'><img onload = 'fixPNG(this)' src='../res/icon_sms_send_failed.png' alt='' /></td><td>"+sms_label_the_message_sent_failed+common_colon+"</td></tr><tr><td  class='failed_phone_number'>"+spaceToNbsp(XSSResolveCannotParseChar(t)).split(";").join("; ")+"</td></tr></table></td></tr>",g_sendSuccessAndFailedFlag=!0}}),{sync:!0}))}else m>0&&(d+="<tr class='send_success_info'><td><table><tr><td rowspan='2' width='30' valign='top'><img onload = 'fixPNG(this)' src='../res/icon_sms_send_success.png' alt='' /></td><td>"+sms_label_the_message_sent_successed+common_colon+"</td></tr><tr><td class='success_phone_number'>"+n.split(",").join("; ")+"</td></tr></table></td></tr><tr class='send_failed_info'><td height='21'></td></tr>",g_sendSuccessAndFailedFlag=!0),g>0&&(d+="<tr class='send_failed_info'><td><table><tr><td rowspan='2' width='30' valign='top'><img onload = 'fixPNG(this)'  src='../res/icon_sms_send_failed.png' alt='' /></td><td>"+sms_label_the_message_sent_failed+common_colon+"</td></tr><tr><td  class='failed_phone_number'>"+i.split(",").join("; ")+"</td></tr></table></td></tr>",g_sendSuccessAndFailedFlag=!0);d+="</table>",startLogoutTimer(),call_dialog(common_note,d,common_ok,"pop_OK"),$(".dialog_table").css("text-align","left")}}))}r=setInterval(t,g_feature.update_interval)}function a(){var e=object2xml("request",1);saveAjaxData("api/sms/cancel-send",e,(function(e){var s=xml2object(e);clearInterval(r),$("#wait_table, #div_wrapper").remove(),isAjaxReturnOK(s)&&t()}))}$("#pop_Cancel").bind("click",(function(){isButtonEnable("pop_Cancel")&&(button_enable("pop_Cancel","0"),a())})),$(".wait_dialog_btn").unbind("click").live("click",(function(){startLogoutTimer(),a()})),$("#pop_OK, .dialog_close_btn").live("click",(function(){$("#wait_div, #div_wrapper").remove(),$(".dialog").remove(),1==g_pbToSmsFlag&&sms_gotoSiminboxUrl("ok"),startLogoutTimer()}))}),{errorCB:function(){$("#wait_table").remove(),showInfoDialog(common_failed)}}))}}g_module.pb_enabled&&null!=(t=getQueryStringByName("number"))&&t.length>0&&(t.match("%23")&&(t=t.replace(/%23/g,"#")),g_pbToSmsFlag=!0,sms_newMessage(),1==g_contact_enabled&&g_module.pb_enabled?$("#recipients_number_pb").val(t):$("#recipients_number").val(t),$("#message_content").focus()),setInterval((function(){sms_getBoxCount(!1,sms_init_info()),-1!=window.location.href.lastIndexOf("smschat")&&(g_scroll_smsList_status=1,sms_getBoxCount(),sms_initBoxCount(),getChatHistory())}),g_feature.update_interval),sms_btnAddEvent(),$("#sms_android_add").live("click",(function(){sms_newMessage()})),$("#send_message_btn").bind("click",(function(){g_send_message_btn_status=1,isButtonEnable("send_message_btn")&&(a("Sent"),$("#NewMessage_textarea").val(""),initChatPage())})),$("#cancel_new_message").bind("click",(function(){gotoPageWithoutHistory("smsandroid.html")})),$(".sms_list_tr").live("click",(function(e){if("sms_raw_chkbox"!=$(e.target).attr("id")&&"sms_td"!=$(e.target).attr("class")&&"sms_td"!=$(e.target).parent().attr("class")){var s=g_sms_smsList[$(".sms_list_tr").index(this)].index;$(g_sms_smsList).each((function(e){if(g_sms_smsList[e].index==s){var t=g_sms_smsList[e].phone;-1!=t.indexOf("+")?g_Current_Phone_Number=t.substring(t.indexOf("+")+1,t.length):g_Current_Phone_Number=g_sms_smsList[e].phone}}));var t="";g_Current_Phone_Number.length>=132?(t=(t=g_Current_Phone_Number.substring(0,132)).substring(0,t.lastIndexOf(";")),gotoPageWithoutHistory("smsandroid.html?smschat+"+t)):gotoPageWithoutHistory("smsandroid.html?smschat+"+g_Current_Phone_Number)}})),$(".sms_chat_list_tr").live("click",(function(e){if("sms_td"!=$(e.target).attr("class")&&"sms_td"!=$(e.target).parent().attr("class")){var s=g_scroll_smsList[$(".sms_chat_list_tr").index(this)].index;$(g_scroll_smsList).each((function(e){g_scroll_smsList[e].index==s&&(g_Current_content=g_scroll_smsList[e].content)})),"chat_delete_icon"==$(e.target).attr("id")?showConfirmDialog(common_confirm_delete_list_item,(function(){chat_smsDelete(s),g_send_message_btn_status=1}),(function(){})):"chat_forward_icon"==$(e.target).attr("id")&&chat_Forward(g_Current_content)}})),$("#pop_send").live("click",(function(){isButtonEnable("pop_send")&&(function(){var e=!1,s="";if(""!=(_=$("#recipients_number_pb").val())&&null!=_||(e=!0,$("#recipients_number_pb").val("")),!e){var t=_.split(";");$.each(t,(function(e,t){if(t.indexOf("<")>=0&&t.indexOf(">")>=0){var a=t.lastIndexOf("<"),_=t.lastIndexOf(">");a<_&&(t=t.substring(a+1,_),s+=t+";")}else s+=t+";"})),s=s.substring(0,s.length-1),$("#recipients_number_pb").val(s)}}(),a("Sent"))})),$("#pop_chat_Cancel").live("click",(function(){isButtonEnable("pop_chat_Cancel")&&(1==g_contact_enabled&&g_module.pb_enabled?$.trim($("#recipients_number_pb").val()):$.trim($("#recipients_number").val()),function(e){sms_clearAllErrorLabel();var s="";if(s=$.trim($("#message_content").val()),sms_contentCheck()){s=resolveXMLEntityReference(s);var t=(new Date).Format("yyyy-MM-dd hh:mm:ss"),a={Index:-1,Phones:{Phone:""},Sca:"",Content:s,Length:s.length,Reserved:g_text_mode,Date:t},_=object2xml("request",a);clearDialog(),saveAjaxData("api/sms/save-sms",_,(function(e){var s=xml2object(e);isAjaxReturnOK(s)?sms_initPage():"error"==s.type&&sms_systemBusy==s.error.code?showInfoDialog(common_system_busy):showInfoDialog(common_failed)}))}}())})),$(".pop_Cancel, .dialog_close_btn").live("click",(function(){var e=0;sms_clearAllErrorLabel(),e=setTimeout((function(){clearTimeout(e),0==g_sendSuccessAndFailedFlag?1==g_pbToSmsFlag&&sms_gotoSiminboxUrl("cancel"):g_sendSuccessAndFailedFlag=!1}),500),startLogoutTimer()}));var _="";$("#search_recipients_number").live("click",(function(){(displayInformations=$("#recipients_number_pb").val()).lastIndexOf(";")!=displayInformations.length-1&&(displayInformations+=";"),$("#search_recipients_number").hide(),$("#close_search_recipients_number").show(),$(".user_add_select").show(),$(".error_message").hide(),$("#recipients_number_pb").live("focus",(function(){$("#user_add_select").hide(),$("#search_recipients_number").show(),$("#close_search_recipients_number").hide()})),$("#close_search_recipients_number").live("click",(function(){$("#user_add_select").hide(),$("#search_recipients_number").show(),$("#close_search_recipients_number").hide()})),$("#message_content").live("click",(function(){$("#user_add_select").hide(),$("#search_recipients_number").show(),$("#close_search_recipients_number").hide()}))})),$(".wait_dialog_btn").live("click",(function(){var e=0;e=setTimeout((function(){clearTimeout(e),0==g_sendSuccessAndFailedFlag?1==g_pbToSmsFlag&&sms_gotoSiminboxUrl("cancel"):g_sendSuccessAndFailedFlag=!1}),500)})),$("#message_content , #NewMessage_textarea").live("keydown keypress keyup focus change input",(function(e){$("#message_content").attr("readonly")||("keydown"!=e.type&&"keypress"!=e.type&&"keyup"!=e.type||37!=e.keyCode&&38!=e.keyCode&&39!=e.keyCode&&40!=e.keyCode)&&("message_content"==$(e.target).attr("id")&&sms_contentChange($("#message_content").val()),"NewMessage_textarea"==$(e.target).attr("id")&&sms_contentChange($("#NewMessage_textarea").val()))})),$(".sms_chat_list").scroll((function(){var e,s=parseInt($(".sms_chat_list").height(),10);e=parseInt($(this)[0].scrollHeight,10),0==parseInt($(this)[0].scrollTop,10)&&g_sms_pageIndex<g_sms_totalSmsPage&&(g_send_message_btn_status=0,g_sms_pageIndex++,sms_getBoxCount(),sms_initBoxCount(),getChatHistoryScrollAdd(),$(".sms_chat_list").scrollTop((e-s)/2))}))})),String.prototype.replaceString=function(e,s){var t=0;return this.str=this,"%href%"==e?(t=this.str.indexOf(e))>=0&&(this.str=this.str.substring(0,t)+s+this.str.substr(t+e.length)):"%FormattedNameTwo%"==e||"%GroupNameTwo%"==e?((t=this.str.indexOf(e))>=0&&(this.str=this.str.substring(0,t)+s+this.str.substr(t+e.length)),(t=this.str.lastIndexOf(e))>=0&&(this.str=this.str.substring(0,t)+s+this.str.substr(t+e.length))):(t=this.str.lastIndexOf(e))>0&&(this.str=this.str.substring(0,t)+s+this.str.substr(t+e.length)),this.str};
