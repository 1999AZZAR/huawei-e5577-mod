var ok_flag=0,add_flag=0,SPEEDDIAL_MAX_NUM=10;function isVaildSpeeddial(){var e=$.trim($("#input_speeddial_quicknumber").val()),t=$.trim($("#input_speeddial_destination").val()),i=nbspToSpace($.trim($("#input_speeddial_description").val()));if($.each($(".qtip-defaults"),(function(){$(this).remove()})),""==e)return showQtip("input_speeddial_quicknumber",IDS_VOIP_SpeedDialErrStr3),!1;if(!/^\d{1,2}$/.test(e))return showQtip("input_speeddial_quicknumber",IDS_VOIP_SpeedDialErrStr4),!1;var a=!0;return $(".user_add_line").each((function(t){if($.trim($(this).children().eq(0).text())==e)return showQtip("input_speeddial_quicknumber",IDS_VOIP_SpeedDialErrStr8),a=!1,!1})),0!=a&&(""==t?(showQtip("input_speeddial_destination",IDS_VOIP_SpeedDialErrStr5),!1):/^[\d#*]{1,32}$/.test(t)?0!=checkInputChar(i)||(showQtip("input_speeddial_description",IDS_VOIP_SPEEDDIAL_DESCRIPTION),!1):(showQtip("input_speeddial_destination",IDS_VOIP_SpeedDialErrStr2),!1))}function addSpeeddiallist(e){var t=null,i=1;for(t='<tr class="user_add_line">',i=1;i<arguments.length;i++)t+="<td style='word-break: break-all;'>"+arguments[i]+"</td>";t+="<td class='user_options clr_blue_hover'> <span class=\"button_edit_list clr_blue\">"+common_edit+'</span><span class="button_delete_list clr_blue">'+common_delete+"</span></td></tr>";var a=$(e).size();$(e).eq(a-2).after(t)}function initPage(){getAjaxData("api/voice/speeddial",(function(e){var t,i=xml2object(e);if(i.response.speeddial,null!=i.response.speeddial){var a=CreateArray(i.response.speeddial),n="",l="",d="";$(".user_add_line").remove(),$(a).each((function(e){n=XSSResolveCannotParseChar(a[e].quicknumber),l=XSSResolveCannotParseChar(a[e].destination),d=spaceToNbsp(XSSResolveCannotParseChar(a[e].description)),addSpeeddiallist($("#service_list tr"),n,l,d)})),t=a[a.length-1],$("#input_speeddial_quicknumber").val(t.quicknumber),$("#input_speeddial_destination").val(t.destination),$("#input_speeddial_description").val(t.description),a.length>=SPEEDDIAL_MAX_NUM&&button_enable("add_item","0")}else $("#input_speeddial_quicknumber").val(""),$("#input_speeddial_destination").val(""),$("#input_speeddial_description").val("")}))}function postData(){var e=[],t=1;$(".user_add_line").each((function(){var i={index:t,quicknumber:XSSResolveCannotParseChar($(this).children().eq(0).text()),destination:XSSResolveCannotParseChar($(this).children().eq(1).text()),description:XSSResolveCannotParseChar(nbspToSpace($(this).children().eq(2).html()))};t++,e.push(i)}));var i=object2xml("request",{speeddial:e});saveAjaxData("api/voice/speeddial",i,(function(e){var t=xml2object(e);isAjaxReturnOK(t)?(showInfoDialog(common_success),button_enable("apply","0")):(showInfoDialog(common_failed),initPage())}))}function openPortToCss(){($.browser.mozilla||$.browser.opera)&&$("#service_list").css({"table-layout":"fixed","word-break":"break-all","word-wrap":"break-word"})}$(document).ready((function(){button_enable("apply","0"),initPage();var e=null,t=null;$("#add_item_cancel").live("click",(function(){hideAddItemControl(),1!=add_flag&&1!=ok_flag||button_enable("apply","1")})),$("#add_item").click((function(){isButtonEnable("add_item")&&($(".button_edit_list").val($(".user_add_line").length+1),showAddItemControl(),$(".add_item_control input").eq(0).focus(),button_enable("apply","0"),$(".user_add_line").length>=SPEEDDIAL_MAX_NUM&&button_enable("add_item","0"))})),$("#add_item_ok").live("click",(function(){if(isVaildSpeeddial()){var e=XSSResolveCannotParseChar($.trim($("#input_speeddial_quicknumber").val())),t=XSSResolveCannotParseChar($.trim($("#input_speeddial_destination").val())),i=spaceToNbsp(XSSResolveCannotParseChar($.trim($("#input_speeddial_description").val())));hideAddItemControl(),addSpeeddiallist($("#service_list tr"),e,t,i),button_enable("apply","1"),$(".user_add_line").length>=SPEEDDIAL_MAX_NUM&&button_enable("add_item","0"),add_flag=1}})),$("#apply").click((function(){isButtonEnable("apply")&&showConfirmDialog(firewall_hint_submit_list_item,postData)})),$(".button_edit_list").live("click",(function(){if($(".add_item_control:hidden").size()>0&&$("#edit_item_ok").size()<1){t=$(".button_edit_list").index(this),e=$(".user_add_line").eq(t).html();var i=$(this).parent().siblings(),a=i.eq(0),n=i.eq(1),l=i.eq(2);a.html('<input type="text" value="'+a.html()+'" id="input_speeddial_quicknumber"  maxlength="2"/></td>'),n.html('<input type="text" value="'+n.html()+'" id="input_speeddial_destination" maxlength="32"></td>'),l.html('<input type="text" value="'+nbspToSpace(l.html())+'" id="input_speeddial_description" maxlength="31"></td>'),$(this).parent().html('<a class="clr_blue" id="edit_item_ok" href="javascript:void(0);">'+common_ok+'</a><a class="clr_blue" id="edit_item_cancel" href="javascript:void(0);">'+common_cancel+"</a>"),hideAddItemControl(),$(".user_add_line input").eq(0).focus(),$("#edit_item_cancel").live("click",(function(){$(".user_add_line").eq(t).html(e),$(".qtip").qtip("destroy",!0),isButtonEnable("add_item")||(button_enable("add_item","1"),1!=ok_flag&&1!=add_flag||button_enable("apply","1")),$(".user_add_line").length>=SPEEDDIAL_MAX_NUM&&button_enable("add_item","0")})),button_enable("apply","0"),button_enable("add_item","0")}})),$(".button_delete_list").live("click",(function(){if($(".add_item_control:hidden").size()>0){var e=$(".button_delete_list").index(this);call_dialog(common_delete,firewall_hint_delete_list_item,common_ok,"pop_OK",common_cancel,"pop_Cancel"),$("#pop_OK").click((function(){deleteFilter(e,$(".user_add_line")),clearDialog_table(),postData(),button_enable("add_item","1")}))}})),$("#edit_item_ok").live("click",(function(){if(isVaildSpeeddial()){var i=XSSResolveCannotParseChar($.trim($("#input_speeddial_quicknumber").val())),a=XSSResolveCannotParseChar($.trim($("#input_speeddial_destination").val())),n=spaceToNbsp(XSSResolveCannotParseChar($.trim($("#input_speeddial_description").val())));hideAddItemControl();var l=$(this).parent().siblings();l.eq(0).html(i),l.eq(1).html(a),l.eq(2).html(n),$(this).parent().html('<span class="button_edit_list clr_blue">'+common_edit+'</span><span class="button_delete_list clr_blue">'+common_delete+"</span>"),e=$(".user_add_line").eq(t).html(),button_enable("apply","1"),button_enable("add_item","1"),ok_flag=1,$(".user_add_line").length>=SPEEDDIAL_MAX_NUM&&button_enable("add_item","0")}})),openPortToCss()}));
