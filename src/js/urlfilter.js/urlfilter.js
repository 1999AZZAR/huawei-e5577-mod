var URL_FILTER_NUM=16,ok_flag=0,add_flag=0,MAX_NUMBER=63,filterStatusArray=[[FILTER_DISABLED,common_off],[FILTER_ENABLED,common_on]],g_source_num=0,firewall_status=null;function addDomainNameFilter(t){var e=null;e='<tr class="user_add_line">',e+="<td  width='420'  style='word-break: break-all;'>"+arguments[1]+"</td>",e+="<td>"+arguments[2]+"</td>",e+="<td class='user_options'><span class=\"button_edit_list clr_blue\">"+common_edit+'</span><span class="button_delete_list clr_blue">'+common_delete+"</span></td></tr>";var a=$(t).size();$(t).eq(a-2).after(e)}function isVaildValue(){$.each($(".qtip-defaults"),(function(){$(this).remove()}));var t=$.trim($("#input_domain_name").val());return""==t?(showQtip("input_domain_name",IDS_security_urlfilter_isnull),!1):isValidAscIICharset(t)&&isVaildDomainname(t)?!isStartWithChar(t)||-1==t.indexOf(".")&&""!=t||-1!=t.indexOf(".")&&1==t.length?(showQtip("input_domain_name",IDS_security_ddns_domain_contain),!1):/\.$/.exec(t)||/^\./.exec(t)||/-$/.exec(t)||/^-/.exec(t)?(showQtip("input_domain_name",IDS_security_domain_dot_char),!1):!!validEditSameDomain()||(showQtip("input_domain_name",IDS_security_ddns_domain_diff),!1):(showQtip("input_domain_name",IDS_security_urlfilter_error),!1)}function validEditSameDomain(){var t=!0,e=$.trim($("#input_domain_name").val()),a=$(".user_add_line"),i=0;for(i=0;i<a.length;i++)a.eq(i).children().eq(0).html()==e&&(t=!1);return t}function isStartWithChar(t){return/^[a-zA-Z]/.test(t)}function isVaildDomainname(t){if(""==t)return!1;for(j=0;j<t.length;j++){var e=t.charAt(j);if(!(e>="a"&&e<="z"||e>="A"&&e<="Z"||e>="0"&&e<="9"||"-"==e||"."==e))return!1}return!0}function isValidAscIICharset(t){var e=0;for(e=0;e<t.length;e++)if(!(t.charCodeAt(e)>=33&&t.charCodeAt(e)<=126))return!1;return!0}function initPage(){button_enable("apply","0"),$(".user_add_line").remove(),getAjaxData("api/security/firewall-switch",(function(t){var e=xml2object(t);"response"==e.type&&(firewall_status=e.response)}),{sync:!0}),null!=firewall_status&&0==firewall_status.FirewallMainSwitch&&(button_enable("add_item","0"),$("#service_list").attr("disabled",!0),showInfoDialog(IDS_security_message_firewall_disabled)),null!=firewall_status&&0==firewall_status.firewallurlfilterswitch&&(button_enable("add_item","0"),$("#service_list").attr("disabled",!0),showInfoDialog(IDS_security_urlfilter_disabled)),getAjaxData("api/security/url-filter",(function(t){var e="",a="",i=xml2object(t).response.urlfilters.urlfilter;i&&(i.length>=URL_FILTER_NUM&&button_enable("add_item","0"),$.isArray(i)?$(i).each((function(t){a=XSSResolveCannotParseChar(i[t].value),e=getDArrayElement(filterStatusArray,i[t].status,"value"),addDomainNameFilter($("#service_list tr"),a,e)})):(a=XSSResolveCannotParseChar(i.value),e=getDArrayElement(filterStatusArray,i.status,"value"),addDomainNameFilter($("#service_list tr"),a,e)))}))}$(document).ready((function(){URL_FILTER_NUM=parseInt(g_config_firewall.urlfilter.number,10),initPage(),openPortToCss("service_list");var t=null,e=null,a=null;function i(){var t=[],e=[],a="",i="";$(".user_add_line").each((function(l){a=$(this).children().eq(0).text(),i=getDArrayElement(filterStatusArray,$(this).children().eq(1).text(),"key"),e={value:a,status:i},t.push(e)}));var l=object2xml("request",{urlfilters:{urlfilter:t}});saveAjaxData("api/security/url-filter",l,(function(t){var e=xml2object(t);isAjaxReturnOK(e)?(showInfoDialog(common_success),button_enable("apply","0")):initPage()}))}$(".button_edit_list").live("click",(function(){if($(".add_item_control:hidden").size()>0&&$("#edit_item_ok").size()<1&&null!=firewall_status&&1==firewall_status.FirewallMainSwitch&&null!=firewall_status&&1==firewall_status.firewallurlfilterswitch){e=$(".button_edit_list").index(this),t=$(".user_add_line").eq(e).html();var i=$(this).parent().siblings(),l=i.eq(0);a=i.eq(1),l.html('<input type="text" value="'+XSSResolveHtmlReturnChar(l.html())+'" id="input_domain_name"  maxlength="63"></td>');var n=a.html();createSelect(a,"select_status",filterStatusArray),$("#select_status").val(getDArrayElement(filterStatusArray,n,"key")),$(this).parent().html('<a id="edit_item_ok" class="clr_blue" href="javascript:void(0);">'+common_ok+'</a><a id="edit_item_cancel" class="clr_blue" href="javascript:void(0);">'+common_cancel+"</a>"),hideAddItemControl(),$(".user_add_line input").eq(0).focus(),$("#edit_item_cancel").live("click",(function(){$(".user_add_line").eq(e).html(t),$(".qtip").qtip("destroy",!0),isButtonEnable("add_item")||(button_enable("add_item","1"),1!=ok_flag&&1!=add_flag||button_enable("apply","1")),$(".user_add_line").length>=URL_FILTER_NUM&&button_enable("add_item","0")})),button_enable("apply","0"),button_enable("add_item","0")}})),$("#edit_item_ok").live("click",(function(){if(isVaildValue()){var t=XSSResolveCannotParseChar($.trim($("#input_domain_name").val())),e=$("#select_status option:selected").text();hideAddItemControl();var a=$(this).parent().siblings();a.eq(0).html(t),a.eq(1).html(e),$(this).parent().html('<span class="button_edit_list clr_blue">'+common_edit+'</span><span class="button_delete_list clr_blue">'+common_delete+"</span>"),button_enable("apply","1"),button_enable("add_item","1"),ok_flag=1,$(".user_add_line").length>=URL_FILTER_NUM&&button_enable("add_item","0")}})),$("#add_item_ok").live("click",(function(){if(isVaildValue()){var t=$.trim($("#input_domain_name").val()),e=$("#select_status option:selected").text();hideAddItemControl(),addDomainNameFilter($("#service_list tr"),t,e),button_enable("apply","1"),$(".user_add_line").length>=URL_FILTER_NUM&&button_enable("add_item","0"),add_flag=1}return!1})),$("#add_item_cancel").live("click",(function(){return hideAddItemControl(),1!=add_flag&&1!=ok_flag||button_enable("apply","1"),!1})),$("#add_item").click((function(){isButtonEnable("add_item")&&(showAddItemControl(),$(".add_item_control input").eq(0).focus(),button_enable("apply","0"),$("#input_domain_name").removeAttr("disabled"))})),$(".button_delete_list").live("click",(function(){if($(".add_item_control:hidden").size()>0&&$("#edit_item_ok").size()<1&&null!=firewall_status&&1==firewall_status.FirewallMainSwitch&&null!=firewall_status&&1==firewall_status.firewallurlfilterswitch){var t=$(".button_delete_list").index(this);call_dialog(common_delete,firewall_hint_delete_list_item,common_ok,"pop_OK",common_cancel,"pop_Cancel"),$("#pop_OK").click((function(){deleteFilter(t,$(".user_add_line")),clearDialog_table(),button_enable("apply","1"),button_enable("add_item","1")}))}})),$("#apply").click((function(){isButtonEnable("apply")&&showConfirmDialog(firewall_hint_submit_list_item,i),ok_flag=0,add_flag=0})),initSelectOption("select_status",filterStatusArray)}));
