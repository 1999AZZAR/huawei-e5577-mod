var g_pinCofig=null,g_pinValidate=0,vsim_status=0;function isOptionEnable(e){return!$("#"+e).parent("li").hasClass("disable_item")}function dispalyModify(){var e;if(clearAllErrorLabel(),$("#pin_code").val(""),$("#pin_code").focus(),!isOptionEnable("pin_modify"))return $("#list_menu").slideUp(100),!1;var n="<tr id='modify_new'><td>"+dialup_label_new_pin+common_colon+"</td>";n+="<td><input type='password' autocomplete='off' id='newPin' name='newPin' maxlength='8' class='input_style' value=''/></td></tr>",n+="<tr id='modify_confirm'><td>"+dialup_label_confirm_pin+common_colon+"</td>",n+="<td><input type='password' autocomplete='off' id='confirmPin' maxlength='8' name='confirmPin' class='input_style' value=''/></td></tr>",$("tr").remove("#modify_new"),$("tr").remove("#modify_confirm"),$("tr:odd").after(n),n="",$(".button_wrapper input").attr("id","modify_apply"),e=$(".button_wrapper input").attr("id"),button_enable(e,"0"),$("input").live("keyup change input paste cut keydown",(function(){void 0!==$("#pin_code").val()&&$("#pin_code").val().length>=4&&void 0!==$("#newPin").val()&&$("#newPin").val().length>=4&&void 0!==$("#confirmPin").val()&&$("#confirmPin").val().length>=4?button_enable(e,"1"):button_enable(e,"0")}))}function pcm_exchange_modifyOrDisable(){var e="";$("#pin_code_select").change((function(){if($("#pin_code_select").val()==common_modify&&dispalyModify(),$("#pin_code_select").val()==common_disable){if(clearAllErrorLabel(),$("#pin_code").val(""),$("#pin_code").focus(),!isOptionEnable("pin_disable"))return $("#list_menu").slideUp(100),!1;$("tr").remove("#modify_new"),$("tr").remove("#modify_confirm"),$(".button_wrapper input").attr("id","pinmanagerment_apply"),e=$(".button_wrapper input").attr("id"),button_enable(e,"0"),$("input").live("keyup change input paste cut keydown",(function(){$(this).val().length>=4?button_enable(e,"1"):button_enable(e,"0")}))}if($("#pin_code_select").val()==common_enable){if(!isOptionEnable("pin_enable"))return $("#list_menu").slideUp(100),!1;$("tr").remove("#modify_new"),$("tr").remove("#modify_confirm"),$("#pin_code").focus(),$(".button_wrapper input").attr("id","pinmanagerment_apply"),e=$(".button_wrapper input").attr("id"),$("input").live("change input paste cut keydown",(function(){button_enable(e,"1")}))}if($("#pin_code_select").val()==dialup_label_validate){if(!isOptionEnable("pin_enable"))return $("#list_menu").slideUp(100),!1;$("tr").remove("#modify_new"),$("tr").remove("#modify_confirm"),$("#pin_code").focus(),$(".button_wrapper input").attr("id","pinmanagerment_apply"),e=$(".button_wrapper input").attr("id"),$("input").live("change input paste cut keydown",(function(){button_enable(e,"1")}))}}))}function pcm_getPinStatus(e,n){var i,t=$(".button_wrapper input").attr("id");button_enable(t,"0"),$("input").bind("keyup change input paste cut keydown",(function(){$(this).val().length>=4?button_enable(t,"1"):button_enable(t,"0")})),pin_status.SimState==MACRO_NO_SIM_CARD?gotoPageWithoutHistory("nocard.html"):($("."+n).html(""),pin_status.PinOptState==MACRO_PIN_DISABLE&&pin_status.SimState==MACRO_PIN_READY&&("1"==g_pinCofig.config.pin_enable&&(i="<option value='"+common_enable+"'><a id='pin_enable' href='javascript:void();'>"+common_enable+"</a></option>"),$("."+n).append(i),setTimeout((function(){$("#pin_code_select").val(common_enable)}),1),$(".button_wrapper input").attr("id","pinmanagerment_apply")),pin_status.PinOptState==MACRO_PIN_VALIDATE&&("1"==g_pinCofig.config.pin_disable&&(i="<option value='"+common_disable+"'><a id='pin_disable' href='javascript:void();'>"+common_disable+"</a></option>"),"1"==g_pinCofig.config.pin_modify&&(i="<option value='"+common_modify+"'><a id='pin_modify' href='javascript:void();'>"+common_modify+"</a></option>"),$("."+n).append(i),setTimeout((function(){$("#pin_code_select").val(common_disable)}),1),"0"==g_pinCofig.config.pin_disable&&"1"==g_pinCofig.config.pin_modify&&(dispalyModify(),setTimeout((function(){$("#pin_code_select").val(common_modify)}),1)),$(".button_wrapper input").attr("id","pinmanagerment_apply")),pin_status.PinOptState==MACRO_CPIN_FAIL&&("1"==g_pinValidate&&(i="<option value='"+dialup_label_validate+"'><a id='pin_validate' href='javascript:void();'>"+dialup_label_validate+"</a></option>"),$("."+n).append(i),setTimeout((function(){$("#pin_code_select").val(dialup_label_validate)}),1),$(".button_wrapper input").attr("id","pinmanagerment_apply")),pin_status.SimState==MACRO_PIN_REQUIRED&&("1"==g_pinValidate&&(i="<option value='"+dialup_label_validate+"'><a href='javascript:void();'>"+dialup_label_validate+"</a></option>"),$("."+n).append(i),setTimeout((function(){$("#pin_code_select").val(dialup_label_validate)}),1),$(".button_wrapper input").attr("id","pinmanagerment_apply")),pcm_exchange_modifyOrDisable())}function getPinEnable(){getConfigData("config/pincode/config.xml",(function(e){var n=xml2object(e);"config"==n.type&&(g_pinCofig=n,pcm_getPinStatus("pin_code_select","input_select"))}))}function pcm_checkPukRequired(){getAjaxData("api/pin/status",(function(e){var n=xml2object(e);"response"==n.type&&(pin_status.SimState=n.response.SimState,pin_status.PinOptState=n.response.PinOptState,pin_status.SimPinTimes=n.response.SimPinTimes,pin_status.SimPukTimes=n.response.SimPukTimes,$(".remainingtime").html(pin_status.SimPinTimes),MACRO_PUK_REQUIRED==n.response.SimState&&gotoPageWithoutHistory("pukrequired.html")),getPinEnable()}))}function pcm_validateOriPin(){var e=$(".button_wrapper input").attr("id"),n=$("#pin_code").val();return""==n||" "==n||null==n?(showErrorUnderTextbox("pin_code",dialup_hint_pin_code_valid_type,"ori_pin_wrong"),$("#pin_code").val(""),$("#pin_code").focus(),button_enable(e,"0"),!1):/^[0-9]{4,8}$/.exec(n)?(button_enable(e,"1"),!0):(showErrorUnderTextbox("pin_code",dialup_hint_pin_code_valid_type,"ori_pin_wrong"),$("#pin_code").val(""),$("#pin_code").focus(),button_enable(e,"0"),!1)}function pcm_validateNewPin(){var e=$(".button_wrapper input").attr("id"),n=$("#newPin"),i=n.val();return""==i||" "==i||null==i?(showErrorUnderTextbox("newPin",dialup_hint_pin_code_valid_type,"new_pin_wrong"),n.val(""),n.focus(),button_enable(e,"0"),!1):/^[0-9]{4,8}$/.exec(i)?(button_enable(e,"1"),!0):(showErrorUnderTextbox("newPin",dialup_hint_pin_code_valid_type,"new_pin_wrong"),n.val(""),n.focus(),button_enable(e,"0"),!1)}function pcm_validateConfirmPin(){var e=$(".button_wrapper input").attr("id"),n=$("#confirmPin"),i=$("#newPin"),t=n.val();return""==t||" "==t||null==t?(showErrorUnderTextbox("confirmPin",dialup_hint_pin_code_valid_type,"confirm_pin_wrong"),n.val(""),n.focus(),button_enable(e,"0"),!1):/^[0-9]{4,8}$/.exec(t)?t!=$("#newPin").val()?(showErrorUnderTextbox("confirmPin",dialup_hint_confirm_and_new_same,"confirm_pin_wrong"),i.val(""),n.val(""),i.focus(),button_enable(e,"0"),!1):(button_enable(e,"1"),!0):(showErrorUnderTextbox("confirmPin",dialup_hint_pin_code_valid_type,"confirm_pin_wrong"),n.val(""),n.focus(),button_enable(e,"0"),!1)}function pcm_opreatFailed(){getAjaxData("api/pin/status",(function(e){var n=xml2object(e);"response"==n.type&&(pin_status.SimState=n.response.SimState,pin_status.PinOptState=n.response.PinOptState,pin_status.SimPinTimes=n.response.SimPinTimes,pin_status.SimPukTimes=n.response.SimPukTimes,MACRO_PUK_REQUIRED==n.response.SimState?gotoPageWithoutHistory("pukrequired.html"):($("#pin_code").val(""),$("#newPin").val(""),$("#confirmPin").val(""),$(".remainingtime").html(pin_status.SimPinTimes),$("#pin_code").blur(),flag_focus=!0,setTimeout((function(){$("#pin_code").focus()}),2500)))}))}function pcm_postOperate(){$.each($("input"),(function(){$(this).blur()}));var e="",n="",i="";switch(""!=$("#pin_code").val()&&" "!=$("#pin_code").val()&&null!=$("#pin_code").val()&&(n=$("#pin_code").val()),""!=$("#newPin").val()&&" "!=$("#newPin").val()&&null!=$("#newPin").val()&&(e=$("#newPin").val()),$("#pin_code_select").val()){case common_modify:i="3";break;case common_disable:i="2";break;case common_enable:i="1";break;case dialup_label_validate:i="0";break;default:i="4"}var t={OperateType:i,CurrentPin:n,NewPin:e,PukCode:""};$("#pin_code").val(""),$("#newPin").val(""),$("#confirmPin").val("");var a=object2xml("request",t);saveAjaxData("api/pin/operate",a,(function(e){var n=xml2object(e);isAjaxReturnOK(n)?(showInfoDialog(common_success),setTimeout((function(){return refresh(),!1}),1500)):(showInfoDialog(pin_code_validate_failed),pcm_opreatFailed(),$("#pin_code").focus(),enableTabKey())}),{enc:!0}),button_enable("pinmanagerment_apply","0"),button_enable("modify_apply","0")}function pcm_initPage(){pcm_checkPukRequired(),$("#pin_code").focus(),$("#modify_apply").live("click",(function(){if(isButtonEnable("modify_apply")){clearAllErrorLabel();var e,n=!1,i=!1;(e=pcm_validateOriPin())&&(n=pcm_validateNewPin()),n&&(i=pcm_validateConfirmPin()),e&&n&&i?pcm_postOperate():button_enable("modify_apply","0")}})),$("#pinmanagerment_apply").live("click",(function(){isButtonEnable("pinmanagerment_apply")&&(clearAllErrorLabel(),pcm_validateOriPin()?pcm_postOperate():button_enable("pinmanagerment_apply","0"))})),getMonitoringStatus()}function initNetMode(){getGMonitoringStatus(),g_net_mode_type==MACRO_NET_DUAL_MODE&&MACRO_SIM_STATUS_ROMSIM==G_MonitoringStatus.response.SimStatus&&g_net_mode_status==MACRO_NET_MODE_C||g_net_mode_type==MACRO_NET_SINGLE_MODE&&MACRO_SIM_STATUS_ROMSIM==G_MonitoringStatus.response.SimStatus?($("#pin_code_select").attr("disabled","disabled"),$("#pin_code").attr("disabled","disabled"),$("#newPin").attr("disabled","disabled"),$("#confirmPin").attr("disabled","disabled"),$("#pinmanagerment_apply").attr("disabled","disabled"),void 0!==$("#pin_code_disabled").val()&&""!=typeof $("#pin_code_disabled").val()&&$("#pin_code_disabled").remove(),$(".maintitle").after("<div id='pin_code_disabled'></br><span>"+IDS_security_pin_code_management+"</span></div>")):($("#pin_code_select").removeAttr("disabled"),$("#pin_code").removeAttr("disabled"),$("#newPin").removeAttr("disabled"),$("#confirmPin").removeAttr("disabled"),$("#pinmanagerment_apply").removeAttr("disabled"),$("#pin_code_disabled").remove(),pcm_initPage())}function checkSimStatus(){g_net_mode_change==MACRO_NET_MODE_CHANGE&&(initNetMode(),resetNetModeChange())}function initVsim(){getAjaxData("api/vsim/operateswitch-vsim",(function(e){var n=xml2object(e);if("response"==n.type){var i=n.response;vsim_status=i.vsim_status}}),{sync:!0})}redirectOnCondition(null,"pincodemanagement"),$(document).ready((function(){pcm_initPage(),initNetMode(),addStatusListener("checkSimStatus ()"),1==g_moduleswitch.vsim_enabled&&(initVsim(),2!=vsim_status&&(button_enable("pinmanagerment_apply","0"),$("input:not(#lang)").attr("disabled",!0),$("select:not(#lang)").attr("disabled",!0),showInfoDialog(IDS_vsim_function_show)))}));
