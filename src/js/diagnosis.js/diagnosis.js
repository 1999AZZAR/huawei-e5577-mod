var g_ping_info={},g_traceroute_info={},MAX_PACKET_SIZE=9e3,MAX_TIMEOUT=10,MIN_TIMEOUT=1,MIN_HOPS=1,MAX_HOPS=100,TRACEROUT_SEARCHING=2,MIN_TIMEOUT_TRACE=2,MAX_TIMEOUT_TRACE=10,g_isPingSelected=!0,g_isPingResult=!1,g_isTracerouteResult=!1,g_diagnosis_result_pass=1,g_diagnosis_result_fail=0,TIMEOUT=3e3;function show_ping_detail(){$("#id_ping").show(),$("#id_traceroute").hide(),g_isPingResult?($("#id_diagnosis_result").show(),g_ping_info.result==g_diagnosis_result_pass?$("#id_pass_or_fail").text(common_success):$("#id_pass_or_fail").text(common_failed),$("#id_result_Detail").html(XSSResolveCannotParseChar(g_ping_info.resultdetail))):$("#id_diagnosis_result").hide()}function show_traceroute_detail(){$("#id_ping").hide(),$("#id_traceroute").show(),$("#trace_maxhops").val(30),$("#trace_timeout").val(4),g_isTracerouteResult?($("#id_diagnosis_result").show(),g_traceroute_info.result==g_diagnosis_result_pass?$("#id_pass_or_fail").text(common_success):$("#id_pass_or_fail").text(common_failed),$("#id_result_Detail").html(XSSResolveCannotParseChar(g_traceroute_info.resultdetail))):$("#id_diagnosis_result").hide()}function diagnosis_initPage(){$("#select_diagnosis_mode").val("ping"),show_ping_detail(),$("#ping_target_ip").val(""),$("#ping_packetsize").val(32),$("#ping_timeout").val(4)}function check_ping(){clearAllErrorLabel();var t=$.trim($("#ping_target_ip").val());if(""==t)return showErrorUnderTr("ping_target_ip_tr",IDS_diagnosis_target_empty),!1;if(/^[\.-]/.test(t))return showErrorUnderTr("ping_target_ip_tr",IDS_diagnosis_target_invalid1),!1;if(!/^[A-Za-z0-9\.-]*$/.test(t))return showErrorUnderTr("ping_target_ip_tr",IDS_diagnosis_target_invalid),!1;var e=$.trim($("#ping_packetsize").val());if(""==e)return showErrorUnderTr("ping_packetsize_tr",IDS_diagnosis_packetsize_empty),!1;if(!IsDigital(e))return showErrorUnderTr("ping_packetsize_tr",IDS_diagnosis_packetsize_invalid),!1;try{if((e=parseInt(e,10))<=0||e>MAX_PACKET_SIZE)return showErrorUnderTr("ping_packetsize_tr",IDS_diagnosis_packetsize_invalid),!1}catch(t){return showErrorUnderTr("ping_packetsize_tr",IDS_diagnosis_packetsize_invalid),!1}var r=$.trim($("#ping_timeout").val());if(""==r)return showErrorUnderTr("ping_timeout_tr",IDS_diagnosis_timeout_empty),!1;if(!IsDigital(r))return showErrorUnderTr("ping_timeout_tr",IDS_diagnosis_ping_timeout_invalid),!1;try{if((r=parseInt(r,10))<MIN_TIMEOUT||r>MAX_TIMEOUT)return showErrorUnderTr("ping_timeout_tr",IDS_diagnosis_ping_timeout_invalid),!1}catch(t){return showErrorUnderTr("ping_timeout_tr",IDS_diagnosis_ping_timeout_invalid),!1}return!0}function check_traceroute(){clearAllErrorLabel();var t=$.trim($("#traceroute_target_ip").val());if(""==t)return showErrorUnderTr("traceroute_target_ip_tr",IDS_diagnosis_target_empty),!1;if(/^[\.-]/.test(t))return showErrorUnderTr("traceroute_target_ip_tr",IDS_diagnosis_target_invalid1),!1;if(!/^[A-Za-z0-9\.-]*$/.test(t))return showErrorUnderTr("traceroute_target_ip_tr",IDS_diagnosis_target_invalid),!1;var e=$.trim($("#trace_maxhops").val());if(""==e)return showErrorUnderTr("trace_maxhops_tr",IDS_diagnosis_maxhops_empty),!1;if(!IsDigital(e))return showErrorUnderTr("trace_maxhops_tr",IDS_diagnosis_maxhops_invalid),!1;try{if((e=parseInt(e,10))<MIN_HOPS||e>MAX_HOPS)return showErrorUnderTr("trace_maxhops_tr",IDS_diagnosis_maxhops_invalid),!1}catch(t){return showErrorUnderTr("trace_maxhops_tr",IDS_diagnosis_maxhops_invalid),!1}var r=$.trim($("#trace_timeout").val());if(""==r)return showErrorUnderTr("trace_timeout_tr",IDS_diagnosis_timeout_empty),!1;if(!IsDigital(r))return showErrorUnderTr("trace_timeout_tr",IDS_diagnosis_traceroute_timeout_invalid),!1;try{if((r=parseInt(r,10))<MIN_TIMEOUT_TRACE||r>MAX_TIMEOUT_TRACE)return showErrorUnderTr("trace_timeout_tr",IDS_diagnosis_traceroute_timeout_invalid),!1}catch(t){return showErrorUnderTr("trace_timeout_tr",IDS_diagnosis_traceroute_timeout_invalid),!1}return!0}function ping_apply(){if(0==check_ping())return!1;var t=$.trim($("#ping_target_ip").val()),e=$.trim($("#ping_packetsize").val()),r=$.trim($("#ping_timeout").val()),i=$("#ping_fragment").get(0).checked?1:0,_=object2xml("request",{target:t,packetsize:e,timeout:r,fragment:i});return button_enable("apply","0"),showWaitingDialog(common_waiting,IDS_diagnosis_pinging_info),saveAjaxData("api/diagnosis/ping",_,(function(t){var e=xml2object(t);"response"==e.type?((g_ping_info=e.response).result=e.response.result,g_ping_info.resultdetail=e.response.resultdetail,closeWaitingDialog(),button_enable("apply","1"),$("#id_diagnosis_result").show(),g_ping_info.result==g_diagnosis_result_pass?$("#id_pass_or_fail").text(common_success):$("#id_pass_or_fail").text(common_failed),$.browser.msie?g_ping_info.resultdetail=g_ping_info.resultdetail.replace(/\n/g,"<br/>"):g_ping_info.resultdetail=g_ping_info.resultdetail.replace(/\n/g,"\r\n"),$("#id_result_Detail").html(XSSResolveCannotParseChar(g_ping_info.resultdetail)),g_isPingResult=!0):(button_enable("apply","1"),closeWaitingDialog(),showInfoDialog(common_fail))}),{sync:!1},{errorCB:function(){button_enable("apply","1"),closeWaitingDialog()}}),!0}function traceroute_apply(){if(0==check_traceroute())return!1;var t=$.trim($("#traceroute_target_ip").val()),e=$.trim($("#trace_maxhops").val()),r=$.trim($("#trace_timeout").val()),i=object2xml("request",{target:t,maxhops:e,timeout:r});return button_enable("apply","0"),cancelLogoutTimer(),showWaitingDialog(common_waiting,IDS_diagnosis_tracerouting_info),saveAjaxData("api/diagnosis/traceroute",i,(function(t){"response"==xml2object(t).type?setTimeout((function(){getTracerouteStatues()}),TIMEOUT):(button_enable("apply","1"),closeWaitingDialog(),showInfoDialog(common_fail),startLogoutTimer())}),{sync:!1}),!0}function getTracerouteStatues(){getAjaxData("api/diagnosis/tracerouteresult",(function(t){var e=xml2object(t);"response"==e.type&&(TRACEROUT_SEARCHING==e.response.result?setTimeout((function(){getTracerouteStatues()}),TIMEOUT):((g_traceroute_info=e.response).result=e.response.result,g_traceroute_info.resultdetail=e.response.resultdetail,closeWaitingDialog(),button_enable("apply","1"),startLogoutTimer(),$("#id_diagnosis_result").show(),g_traceroute_info.result==g_diagnosis_result_pass?$("#id_pass_or_fail").text(common_success):$("#id_pass_or_fail").text(common_failed),$.browser.msie?g_traceroute_info.resultdetail=g_traceroute_info.resultdetail.replace(/\n/g,"<br/>"):g_traceroute_info.resultdetail=g_traceroute_info.resultdetail.replace(/\n/g,"\r\n"),$("#id_result_Detail").html(XSSResolveCannotParseChar(g_traceroute_info.resultdetail)),g_isTracerouteResult=!0))}))}$(document).ready((function(){diagnosis_initPage(),$("#select_diagnosis_mode").change((function(){"ping"==$(this).val()&&(g_isPingSelected=!0,show_ping_detail()),"traceroute"==$(this).val()&&(g_isPingSelected=!1,show_traceroute_detail())})),$("#apply").click((function(){g_isPingSelected?ping_apply():traceroute_apply()}))}));
