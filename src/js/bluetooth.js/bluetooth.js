var g_promptText=null,g_current_device=null,LENGHT_OF_INDEX=8,g_bluetooth_ap_info_list=[],g_bluetooth_scanresult=[],BLUETOOTH_PREFER=1,BLUETOOTH_SCAN_END="0",BLUETOOTH_SCANING="1",g_handover_setting={btswitch:"0"},g_bluetoothscan={scan:"0"},g_current_id=null;function index_clickTurnOnBtn(){scanBluetooth(),$("#wifi_switch_button").html(create_button_html(common_turn_off,"turnOff_button")),ieRadiusBorder(),"material"==webui_mode&&materializeButtons(),$("#default_dev_div").show()}function index_clickTurnOffBtn(){$("#wifi_switch_button").html(create_button_html(common_turn_on,"turnOn_button")),ieRadiusBorder(),"material"==webui_mode&&materializeButtons(),$("#wifi_content").hide(),$("#scan_div").hide(),$("#default_dev_div").hide()}function getHandoverSetting(){getAjaxData("api/bluetooth/settings",(function(t){var e=xml2object(t);"response"==e.type&&(BLUETOOTH_PREFER==e.response.btswitch?index_clickTurnOnBtn():index_clickTurnOffBtn())}))}function setHandoverSetting(){var t=object2xml("request",g_handover_setting);showWaitingDialog(common_waiting,sd_hint_wait_a_few_moments),saveAjaxData("api/bluetooth/settings",t,(function(t){var e=xml2object(t);isAjaxReturnOK(e)?setTimeout((function(){getHandoverSuccessSetting()}),1e3):(ERROR_SYSTEM_BUSY==e.error.code?(closeWaitingDialog(),showInfoDialog(common_system_busy)):(closeWaitingDialog(),showInfoDialog(common_failed)),BLUETOOTH_PREFER==g_handover_setting.btswitch?button_enable("turnOn_button",1):button_enable("turnOff_button",1))}),{errorCB:function(){setTimeout((function(){closeWaitingDialog(),showInfoDialog(common_failed),BLUETOOTH_PREFER==g_handover_setting.btswitch?button_enable("turnOn_button",1):button_enable("turnOff_button",1)}),1e3)}})}function getHandoverSuccessSetting(){BLUETOOTH_PREFER==g_handover_setting.btswitch?index_clickTurnOnBtn():index_clickTurnOffBtn(),closeWaitingDialog()}function scanBluetooth(){checkBluetoothScanStatue(),$("#scan_div").show(),$("#bluetooth_scan").show(),$("#wifi_content").show(),$("#bluetooth_settings").hide(),$("#bluetooth_no_device").hide(),button_enable("scan_button","0");var t=object2xml("request",g_bluetoothscan);saveAjaxData("api/bluetooth/scan",t,(function(t){var e=xml2object(t);isAjaxReturnOK(e)?(g_bluetooth_ap_info_list=[],checkBluetoothScanStatue()):ERROR_SYSTEM_BUSY==e.error.code&&(showInfoDialog(common_system_busy),$("#bluetooth_scan").hide(),$("#bluetooth_no_device").show(),button_enable("scan_button","1"))}))}function checkBluetoothScanStatue(){getAjaxData("api/bluetooth/scan",(function(t){var e=xml2object(t);"response"==e.type?BLUETOOTH_SCAN_END==e.response.scanstatus?getBluetoothDeviceinfo():BLUETOOTH_SCANING==e.response.scanstatus?setTimeout((function(){checkBluetoothScanStatue()}),1e3):$("#bluetooth_scan").hide():($("#bluetooth_scan").hide(),$("#bluetooth_no_device").show(),$("#bluetooth_settings").hide(),g_bluetoothscanresult=[],button_enable("scan_button","1"))}))}function getBluetoothDeviceinfo(){getAjaxData("api/bluetooth/scan",(function(t){var e=xml2object(t);"response"==e.type&&void 0!==e.response.devicelists&&null!=e.response.devicelists&&""!=e.response.devicelists?(g_bluetooth_scanresult=e.response.devicelists.devicelist,$.isArray(g_bluetooth_scanresult)||void 0!==g_bluetooth_scanresult&&null!=g_bluetooth_scanresult&&""!=g_bluetooth_scanresult?(setBlueToothList(),createBlueToothList(),$("#bluetooth_scan").hide(),$("#bluetooth_no_device").hide(),$("#bluetooth_settings").show()):($("#bluetooth_scan").hide(),$("#bluetooth_no_device").show(),$("#bluetooth_settings").hide(),g_bluetooth_scanresult=[],button_enable("scan_button","1"))):($("#bluetooth_scan").hide(),$("#bluetooth_no_device").show(),$("#bluetooth_settings").hide(),g_bluetooth_scanresult=[],button_enable("scan_button","1"))}))}function setBlueToothList(){if(g_bluetooth_ap_info_list=[],$.isArray(g_bluetooth_scanresult))$.each(g_bluetooth_scanresult,(function(t){var e={devicename:g_bluetooth_scanresult[t].devicename,macaddress:g_bluetooth_scanresult[t].macaddress};g_bluetooth_ap_info_list.push(e)}));else{var t={devicename:g_bluetooth_scanresult.devicename,macaddress:g_bluetooth_scanresult[i].macaddress};g_bluetooth_ap_info_list.push(t)}}function createBlueToothList(){for(var t="",e=0;e<g_bluetooth_ap_info_list.length;e++){t+="<tr class='wifi_ap' id='"+("wifi_ap_"+e)+"'>",t+="<td width='240'>",t+="<div class='wifiName'><span>"+replaceSpaceOther(XSSResolveCannotParseChar(g_bluetooth_ap_info_list[e].devicename))+"</span></div>",t+="<div>MAC Address : "+XSSResolveCannotParseChar(g_bluetooth_scanresult[e].macaddress)+"</div>",t+="</td>",t+="</tr>"}$(".bluetooth_settings").html(t),button_enable("scan_button","1")}function getBluetoothIndex(t){var e=t.substring(LENGHT_OF_INDEX,t.length);return parseInt(e,10)}function showDefaultDeviceConfirmDlg(t){var e=XSSResolveCannotParseChar(g_bluetooth_ap_info_list[t].devicename),n=XSSResolveCannotParseChar(g_bluetooth_ap_info_list[t].macaddress);g_promptText=IDS_connect_bluetooth.replace("%s1",replaceSpaceOther(e)).replace("%s2",replaceSpaceOther(n)),g_current_device=IDS_current_device.replace("%s1",replaceSpaceOther(e)).replace("%s2",replaceSpaceOther(n));var o=object2xml("request",{devicename:e,macaddress:n});saveAjaxData("api/bluetooth/settings",o,(function(t){}),{sync:!0}),showConfirmDialog(g_promptText,setDefaultDevice,cancelprompt)}function setDefaultDevice(){var t="";showWaitingDialog(common_waiting,sd_hint_wait_a_few_moments),getAjaxData("api/bluetooth/settings",(function(e){var n=xml2object(e);"response"==n.type&&(t=n.response.connection)})),setTimeout((function(){closeWaitingDialog(),"1"!=t&&showInfoDialog(common_failed),$("div.default_dev_div").html(g_current_device),g_promptText="",g_current_device=""}),1e3)}function cancelprompt(){g_promptText="",g_current_device=""}$(document).ready((function(){getAjaxData("api/bluetooth/settings",(function(t){var e=xml2object(t);if("response"==e.type){var n=e.response;void 0!==n.devicename&&""!=n.devicename&&null!=n.devicename?(n.devicename=XSSResolveCannotParseChar(n.devicename),n.macaddress=XSSResolveCannotParseChar(n.macaddress),g_current_device=IDS_current_device.replace("%s1",replaceSpaceOther(n.devicename)).replace("%s2",replaceSpaceOther(n.macaddress))):g_current_device="",$("div.default_dev_div").html(g_current_device)}})),$(".wifi_ap").live("click",(function(){showDefaultDeviceConfirmDlg(getBluetoothIndex(g_current_id=this.id))})),index_clickTurnOnBtn(),$("#turnOff_button").live("click",(function(){isButtonEnable("turnOff_button")&&(g_handover_setting.btswitch="0",$("#turnOff_button").removeClass("mouse_on"),button_enable("turnOff_button","0"),setHandoverSetting())})),$("#turnOn_button").live("click",(function(){isButtonEnable("turnOn_button")&&(g_handover_setting.btswitch="1",$("#turnOn_button").removeClass("mouse_on"),button_enable("turnOn_button","0"),setHandoverSetting())})),$("#scan_button").live("click",(function(){isButtonEnable("scan_button")&&scanBluetooth()}))}));
