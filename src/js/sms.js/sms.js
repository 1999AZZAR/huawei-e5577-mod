var g_smsFeature=null,g_sms_importenabled=null,g_sms_urlenabled=null,SMS_BOXTYPE_LOCAL_INBOX=1,SMS_BOXTYPE_LOCAL_SENT=2,SMS_BOXTYPE_LOCAL_DRAFT=3,SMS_BOXTYPE_LOCAL_TRASH=4,SMS_BOXTYPE_SIM_INBOX=5,SMS_BOXTYPE_SIM_SENT=6,SMS_BOXTYPE_SIM_DRAFT=7,SMS_BOXTYPE_MIX_INBOX=8,SMS_BOXTYPE_MIX_SENT=9,SMS_BOXTYPE_MIX_DRAFT=10,SMS_MAXPHONESIZE=50,SMS_BOXTYPE_INBOX=SMS_BOXTYPE_LOCAL_INBOX,SMS_BOXTYPE_SENT=SMS_BOXTYPE_INBOX+1,SMS_BOXTYPE_DRAFT=SMS_BOXTYPE_INBOX+2,pb_start=0,pb_end=0,g_sms_boxType=SMS_BOXTYPE_INBOX,g_sms_pageIndex=1,g_sms_readCount="",g_sms_maxphonesize="",g_sms_sortType=0,g_sms_ascending=0,g_sms_unreadPreferred=0,g_sms_recordMsgSum=0,g_sms_simSum=0,g_sms_localSum=0,g_isCDMA=!1,g_pbToSmsFlag=!1,g_sendSuccessAndFailedFlag=!1,g_numberValid=!0,g_lang_edit=-1,SIMINBOX_PGAE_URL="smsinbox.html",sms_systemBusy=113018,g_convert_type="",g_sms_totalSmsPage=0,g_sms_curMsgSum=0,g_pageRefresh=0,g_pageIndex="",g_sms_checkedList="",g_sms_smsListArray={PageIndex:g_sms_pageIndex,ReadCount:g_sms_readCount,BoxType:g_sms_boxType,SortType:g_sms_sortType,Ascending:g_sms_ascending,UnreadPreferred:g_sms_unreadPreferred},g_sms_smsCount={LocalUnread:0,LocalInbox:0,LocalOutbox:0,LocalDraft:0,LocalDeleted:0,SimUnread:0,SimInbox:0,SimOutbox:0,SimDraft:0,LocalMax:0,SimMax:0},bPhoneNumberFormatChange=!1,beforeFormatChange="",g_sms_NewMsg="",g_sms_smsList=new Array,g_sms_inbox_store_status="0/0",g_sms_outbox_store_status="0",g_sms_draftbox_store_status="0",g_finishFlag=0,g_sms_smscharlang=!1,g_PB_TIMEOUT_SHORT=3e4,g_pb_feature={page_size:15,max_record_size:50,max_name_size:0,max_phone_size:0,max_email_size:0,max_search_size:0,max_group_size:0,max_group_name_size:0,export_csv_path:"",export_vcard_path:""},g_pb_local_contact_list_request={GroupID:0,PageIndex:g_pb_pageIndex,ReadCount:g_pb_feature.page_size,SaveType:0,SortType:1,Ascending:1,KeyWord:""},g_pb_pageIndex="",g_pb_contactListArray=[],g_pb_curContactSum=0,phonebook=[],vLocalShowContactList="<li value='%href%' style='border-bottom: solid 1px #b7b8b9;' class='linkmanInfo'>  <div id='contactName'><a title='%FormattedNameTwo%' herf='javascript:void(0);'>&nbsp;&nbsp;&nbsp;%FormattedNameTwo%</a></div>  <span id='contactNumberType'>&nbsp;&nbsp;&nbsp;%numberType%</span><div id='contactNumber'><a title='%phone%' herf='javascript:void(0);' style='color: gray;'>&nbsp;&nbsp;&nbsp;%phone%</a></div></li>",pb_feature=null,html=null,displayInformations=null;function sms_initPage(){isButtonEnable("ref_msg_btn")&&(sms_getBoxCount(),sms_initBoxCount(),g_sms_curMsgSum>0?(button_enable("ref_msg_btn","0"),sms_initSMS()):(g_sms_curMsgSum=0,g_sms_recordMsgSum=0))}function sms_initSMS(){sms_getBoxData(),setSmsBox(smsBoxType),g_sms_recordMsgSum=g_sms_curMsgSum}function sms_isValidatePageIndex(e){return!!new RegExp("^\\+?[1-9][0-9]*$").test(e)&&!(e>g_sms_totalSmsPage)}function sms_btnAddEvent(){$("#sms_table :checkbox").live("click",(function(){var e,s,t;"old"==webui_mode&&!force_new_sms||"new"==webui_mode&&force_old_sms||"material"==webui_mode?(this==(t=$("#sms_table :checkbox"))[0]?t.attr("checked",this.checked):(s=(e=t.filter(":not(:first)").filter(":checked").length)+1==t.length,t.eq(0).attr("checked",s)),e=t.filter(":not(:first)").filter(":checked").length,button_enable("del_msg_btn",e>0)):("new"==webui_mode&&!force_old_sms||"old"==webui_mode&&force_new_sms)&&(0==(t=$("#sms_table :checkbox").filter(":checked")).length?button_enable("new_del_msg_btn","0"):button_enable("new_del_msg_btn","1"))})),$("#del_msg_btn").bind("click",(function(){isButtonEnable("del_msg_btn")&&showConfirmDialog(common_confirm_delete_list_item,(function(){sms_smsDelete()}),(function(){}))})),$("#jump_page").bind("click",(function(){if(isButtonEnable("jump_page")){$.each($(".qtip-defaults"),(function(){$(this).remove()}));var e=$("#jump_page_index").val();sms_isValidatePageIndex(e)?sms_pageNav(e):(showQtip("jump_page_index",sms_hint_wrong_page_num),$("#jump_page_index").select())}})),0==g_sms_importenabled?$("#import_btn").remove():$("#import_btn").bind("click",(function(){isButtonEnable("import_btn")&&sms_importMessage()}))}function sms_getBoxType(){g_sms_boxType={smsinbox:SMS_BOXTYPE_INBOX,smssent:SMS_BOXTYPE_SENT,smsdrafts:SMS_BOXTYPE_DRAFT}[current_href],g_sms_smsListArray.BoxType=g_sms_boxType}function sms_init_info(){sms_initBoxCount(),g_sms_curMsgSum>0&&(g_sms_recordMsgSum!=g_sms_curMsgSum||"0"!=g_sms_NewMsg&&void 0!==g_sms_NewMsg&&""!=g_sms_NewMsg)&&(sms_initSMS(),g_pageRefresh=1,setSmsBox(smsBoxType))}function sms_getBoxCount(e,s){e=null==e,getAjaxData("api/sms/sms-count",(function(e){var t=xml2object(e);switch("response"==t.type&&(g_sms_smsCount=t.response,g_sms_NewMsg=t.response.NewMsg),g_sms_boxType){case SMS_BOXTYPE_INBOX:$("#cur_box_type").text(sms_label_inbox),g_sms_curMsgSum=g_sms_boxType==SMS_BOXTYPE_LOCAL_INBOX?g_sms_smsCount.LocalInbox:g_sms_smsCount.SimInbox;break;case SMS_BOXTYPE_SENT:$("#cur_box_type").text(sms_label_sent),g_sms_curMsgSum=g_sms_boxType==SMS_BOXTYPE_LOCAL_SENT?g_sms_smsCount.LocalOutbox:g_sms_smsCount.SimOutbox;break;case SMS_BOXTYPE_DRAFT:$("#cur_box_type").text(sms_label_drafts),g_sms_curMsgSum=g_sms_boxType==SMS_BOXTYPE_LOCAL_DRAFT?g_sms_smsCount.LocalDraft:g_sms_smsCount.SimDraft;break;default:g_sms_curMsgSum=g_sms_smsCount.LocalInbox}g_sms_localSum=parseInt(g_sms_smsCount.LocalInbox,10)+parseInt(g_sms_smsCount.LocalOutbox,10)+parseInt(g_sms_smsCount.LocalDraft,10)+parseInt(g_sms_smsCount.LocalDeleted,10),g_sms_simSum=void 0!==g_sms_smsCount.SimUsed?g_sms_smsCount.SimUsed:parseInt(g_sms_smsCount.SimInbox,10)+parseInt(g_sms_smsCount.SimOutbox,10)+parseInt(g_sms_smsCount.SimDraft,10),g_sms_localSum>=g_sms_smsCount.LocalMax&&g_sms_smsCount.LocalMax>0?$("#fullMessage_tip_div").show():$("#fullMessage_tip_div").hide(),"function"==typeof s&&s()}),{sync:e,errorCB:function(){}})}function sms_initBoxCount(){var e=0,s=0,t=0,n=0;if(SMS_BOXTYPE_INBOX==SMS_BOXTYPE_LOCAL_INBOX?(e=g_sms_smsCount.LocalUnread,s=g_sms_smsCount.LocalInbox,t=g_sms_smsCount.LocalOutbox,n=g_sms_smsCount.LocalDraft):(e=g_sms_smsCount.SimUnread,s=g_sms_smsCount.SimUnread,t=g_sms_smsCount.SimOutbox,n=g_sms_smsCount.SimDraft),sms_getBoxCount(),g_sms_inbox_store_status=e+"/"+s,g_sms_outbox_store_status=t,g_sms_draftbox_store_status=n,$("#label_inbox_status").text(g_sms_inbox_store_status),$("#label_sent_status").text(g_sms_outbox_store_status),$("#label_drafts_status").text(g_sms_draftbox_store_status),g_sms_curMsgSum>0){g_sms_totalSmsPage=Math.ceil(g_sms_curMsgSum/g_sms_smsListArray.ReadCount);var _=(g_sms_pageIndex=Math.min(g_sms_pageIndex,g_sms_totalSmsPage))+"/"+g_sms_totalSmsPage;$("#curSmsPage").text(_),sms_createPageNav(),$(".sms_pagination div").show()}else g_sms_totalSmsPage=0,$("#curSmsPage").text(""),sms_createPageNav(),$("#sms_check_all").removeAttr("checked"),$(".sms_list_tr").remove(),button_enable("del_msg_btn","0"),$(".sms_pagination div").show();g_sms_smsCount.LocalInbox>0&&"received"==smsBoxType?(button_enable("pop_reply","1"),button_enable("pop_forward","1")):0==g_sms_smsCount.LocalInbox&&"received"==smsBoxType&&(button_enable("pop_forward","0"),button_enable("pop_reply","0")),g_sms_smsCount.LocalOutbox>0&&"sent"==smsBoxType?(button_enable("pop_forward","1"),button_enable("pop_reply","0")):0==g_sms_smsCount.LocalOutbox&&"sent"==smsBoxType&&(button_enable("pop_forward","0"),button_enable("pop_reply","0"))}function sms_getBoxData(){g_sms_smsListArray.PageIndex=g_sms_pageIndex;var e=object2xml("request",g_sms_smsListArray);saveAjaxData("api/sms/sms-list",e,(function(e){var s=xml2object(e);"response"==s.type&&s.response.Messages.Message&&(g_finishFlag=1,g_sms_smsList=new Array,$.isArray(s.response.Messages.Message)?g_sms_smsList=s.response.Messages.Message:g_sms_smsList.push(s.response.Messages.Message),sms_initBoxList())}),{errorCB:function(){0==g_finishFlag&&(sms_getBoxData(),g_finishFlag=1)}})}function sms_initBoxList(){var e=null,s="",t=((new Date).Format("yyyy-MM-dd hh:mm:ss"),$("#boxList_title")),n=null,_=null,a=null,o=null,r=null,m=null;$(".sms_list_tr").remove();var l={},c=[];$.each(g_sms_smsList,(function(i,l){switch(parseInt(l.SmsType,10)){case 7:l.Content=sms_label_setting_usesreport+common_colon+" "+common_success;break;case 8:l.Content=sms_label_setting_usesreport+common_colon+" "+common_failed}s=g_sms_urlenabled?regURL(l.Content):XSSResolveCannotParseChar(l.Content),e="read_state"+l.Smstat,smsReadState2="read_sta"+l.Smstat;var d=l.Date;d=new Date(d.replace(/-/g,"/")).Format("yyyy-MM-dd hh:mm:ss");var p=sms_enterPhone(l.Phone.split(";")),g="smsReadStates"+l.Index,u="";"undefined"!=l&&"undefined"!=l.Smstat&&0==l.Smstat&&(u="style='font-weight:bold'"),n=$("<tr class='sms_list_tr'"+u+"></tr>"),(_=$("<td width='50' class='sms_td'></td>")).append("<input type='checkbox' name='checkbox' value='"+l.Index+"' />"),n.append(_),(a=$("<td  class='td_pl sms_phone_width'></td>")).html("<table border='0' cellpadding='0' class='sms_msg' cellspacing='0'><tr><td><span  id='"+g+"'  class='msg_icon "+e+" '>&nbsp;</span></td><td class='sms_phone_number "+smsReadState2+"'>"+p+"</td></tr></table>"),n.append(a),o=$("<td  class='td_pl sms_content_width'></td>"),m=$("<p class='sms_content clr_blue_a'></p>"),s.length!=l.Content.length?m.html(s):m.text(s),o.html(m),n.append(o),(r=$("<td  class='td_pl sms_date_width'></td>")).append("<label>"+d+"</label>"),n.append(r),t.after(n),t=n,c.push(l.Phone)})),l={Phone:c};var d=0,p=[];if(g_module.pb_enabled)for(pb_start=0,pb_end=0,i=0;i<c.length;i++){var g=c[i].split(";");g.length<=50&&(d+g.length>50?(pb_end=i,i--,pb_match(l={Phone:p}),d=0,p=[]):(d+=g.length,p.push(c[i]),i==c.length-1&&0==d?pb_match(l={Phone:c[i]}):i==c.length-1&&0!=d&&d<=50&&(l={Phone:p},pb_end=i,pb_match(l))))}$("#sms_check_all").removeAttr("checked"),"material"==webui_mode&&materializeInputs(),button_enable("del_msg_btn","0"),button_enable("new_del_msg_btn","0"),button_enable("ref_msg_btn","1")}function pb_match(e){var s=object2xml("request",e);saveAjaxData("api/pb/pb-match",s,(function(e){var s=xml2object(e);if("response"==s.type){var t=s.response.Name;if(t){var n=0,_=0,a="";if($.isArray(t))for(_=pb_start;_<=pb_end;_++)""!=$(".sms_phone_number").eq(_).text()&&(_+1>pb_end&&(pb_start=pb_end),a=sms_enterPhone(t[n].split(";")),$(".sms_phone_number").eq(_).html(spaceToNbsp(a)),n++);else for(_=pb_start;_<=pb_end;_++)""!=$(".sms_phone_number").eq(_).text()&&(_+1>pb_end&&(pb_start=pb_end),a=sms_enterPhone(t.split(";")),$(".sms_phone_number").eq(_).html(spaceToNbsp(a)))}}}),{sync:!0}),e=""}function sms_enterPhone(e){for(pb_contactsName="",j=0;j<e.length;j++)e[j]=XSSResolveCannotParseChar(e[j]),j!=e.length-1?pb_contactsName+=e[j]+";<br/>":pb_contactsName+=e[j];return pb_contactsName}function sms_createPageNav(){var e,s,t="";e=1==g_sms_pageIndex?"javascript:void(0);":"javascript:sms_pageNav('first')",s=g_sms_pageIndex==g_sms_totalSmsPage?"javascript:void(0);":"javascript:sms_pageNav('last')","ar_sa"==LANGUAGE_DATA.current_language||"he_il"==LANGUAGE_DATA.current_language||"fa_fa"==LANGUAGE_DATA.current_language?($("#pageBegin").attr("href",s),$("#pageLast").attr("href",e)):($("#pageBegin").attr("href",e),$("#pageLast").attr("href",s));var n,_;n=1==g_sms_pageIndex?"javascript:void(0);":"javascript:sms_pageNav('prePage')",_=g_sms_pageIndex==g_sms_totalSmsPage?"javascript:void(0);":"javascript:sms_pageNav('nextPage')","ar_sa"==LANGUAGE_DATA.current_language||"he_il"==LANGUAGE_DATA.current_language||"fa_fa"==LANGUAGE_DATA.current_language?($("#prePage").attr("href",_),$("#nextPage").attr("href",n)):($("#prePage").attr("href",n),$("#nextPage").attr("href",_));var a,o;if(g_sms_pageIndex=parseInt(g_sms_pageIndex,10),g_sms_totalSmsPage>8?g_sms_pageIndex+4>=g_sms_totalSmsPage?a=(o=g_sms_totalSmsPage)-8:g_sms_pageIndex<=4?o=(a=1)+8:(a=g_sms_pageIndex>4?g_sms_pageIndex-4:1,o=g_sms_pageIndex+4>g_sms_totalSmsPage?g_sms_totalSmsPage:g_sms_pageIndex+4):(a=1,o=g_sms_totalSmsPage),"ar_sa"==LANGUAGE_DATA.current_language||"he_il"==LANGUAGE_DATA.current_language||"fa_fa"==LANGUAGE_DATA.current_language)for(i=o;i>=a;i--)aHref=i==g_sms_pageIndex?' href="javascript:void(0);"':" href=\"javascript:sms_pageNav('"+i+'\')" style="text-decoration:underline"',t+="<a "+aHref+">"+i+"</a>";else for(i=a;i<=o;i++)aHref=i==g_sms_pageIndex?' href="javascript:void(0);"':" href=\"javascript:sms_pageNav('"+i+'\')" style="text-decoration:underline"',t+="<a "+aHref+">"+i+"</a>";$("#page_num").html(t)}function sms_pageNav(e){switch(e){case"first":g_sms_pageIndex=1;break;case"last":g_sms_pageIndex=g_sms_totalSmsPage;break;case"prePage":g_sms_pageIndex--;break;case"nextPage":g_sms_pageIndex++;break;default:g_sms_pageIndex=e}$(document).scrollTop(0),sms_initPage(),$("#jump_page_index").val("")}function sms_smsDelete(){cancelLogoutTimer(),g_sms_checkedList="",$("#sms_table :checkbox:gt(0):checked").each((function(){g_sms_checkedList+="<Index>"+this.value+"</Index>"}));var e=object2xml("request",g_sms_checkedList);saveAjaxData("api/sms/delete-sms",e,(function(e){var s=xml2object(e);startLogoutTimer(),isAjaxReturnOK(s)&&sms_initPage()}))}function sms_importMessage(){0!=g_sms_simSum?g_sms_localSum>=g_sms_smsCount.LocalMax?showInfoDialog(strid_sms_hint_no_room):($("#pop_confirm").die("click"),$("#pop_Cancel").die("click"),$(".dialog_close_btn").die("click"),$(".wait_dialog_btn").die("click"),$("#pop_OK").die("click"),showConfirmDialog(strid_sms_hint_import_conform,(function(){$(".dialog").remove(),1==g_sms_simSum?showWaitingDialog(common_waiting,STRID_sms_message_importing_message):showWaitingDialog(common_waiting,STRID_sms_message_importing_messages.replace("%d",g_sms_simSum));var e={IsMove:0,Date:(new Date).Format("yyyy-MM-dd hh:mm:ss")},s=object2xml("request",e);saveAjaxData("api/sms/backup-sim",s,(function(e){var s=xml2object(e);if(closeWaitingDialog(),"response"==s.type){if(sms_systemBusy==s.response.Code)showInfoDialog(common_system_busy);else if(""!=s.response.FailNumber&&"undefined"!=s.response.FailNumber&&""!=s.response.sucNumber&&"undefined"!=s.response.sucNumber){sms_getBoxCount();var t=parseInt(s.response.FailNumber,10),n=parseInt(s.response.SucNumber,10);showInfoDialog(n+" "+common_succeed+common_comma+t+" "+common_failed)}}else showInfoDialog(common_failed)}),{timeout:3e5,errorCB:function(){closeWaitingDialog(),showInfoDialog(common_failed)}})}),(function(){}))):showInfoDialog(strid_sms_hint_import_none)}function sms_showWaitingDialog(e,s,t){if("material"==webui_mode){var n="<h4 class='mdl-dialog__title'>"+e+"</h4><div class='mdl-dialog__content'><center><div class='preloader-wrapper big active'><div class='spinner-layer spinner-blue'><div class='circle-clipper left'><div class='circle'></div></div><div class='gap-patch'><div class='circle'></div></div><div class='circle-clipper right'><div class='circle'></div></div></div><div class='spinner-layer spinner-red'><div class='circle-clipper left'><div class='circle'></div></div><div class='gap-patch'><div class='circle'></div></div><div class='circle-clipper right'><div class='circle'></div></div></div><div class='spinner-layer spinner-yellow'><div class='circle-clipper left'><div class='circle'></div></div><div class='gap-patch'><div class='circle'></div></div><div class='circle-clipper right'><div class='circle'></div></div></div><div class='spinner-layer spinner-green'><div class='circle-clipper left'><div class='circle'></div></div><div class='gap-patch'><div class='circle'></div></div><div class='circle-clipper right'><div class='circle'></div></div></div></div><p>"+s+"</p></center><div class='mdl-dialog__actions'><a href='javascript:void(0);' id='pop_Cancel' class='mdl-button'>"+common_cancel+"</a><a href='javascript:void(0);' id='pop_Close' class='mdl-button'>"+common_close+"</a></div>",_=document.createElement("dialog");_.id="wait_table",_.className="wait_table mdl-dialog",_.innerHTML=n,$("body").append(_),$("#pop_Close").bind("click",(function(){closeWaitingDialog()})),$("#pop_Cancel").live("click",(function(){closeWaitingDialog(),"function"==typeof t&&t()})),_.showModal||dialogPolyfill.registerDialog(_),_.showModal()}else{$("#div_wrapper").remove();n="<div id='div_wrapper'><iframe   id='ifream_dialog'  src= '' frameborder= '0' style= 'background:#bcbcbc; width:100%; height:100%; display: block;'> </iframe></div>"+("<table colspacing='0' cellspacing='0' id='wait_table' class='wait_table'><tr><td><div class='wait_table_header'><label class='wait_title clr_white'>"+e+"</label><span class='wait_dialog_btn' id='wait_dialog_btn clr_gray' ><canvas id='sms_showWaitingCanvas' width='25px' height='25px'></canvas></span></div></td></tr><tr><td><div class='wait_table_content'><div class='wait_wrapper'><div class='wait_image'><img src='../res/waiting.gif' alt=''/></div><div class='wait_str'>"+s+"</div></div></div></td></tr><tr><td><div class='wait_table_content_sms'><span class='button_wrapper pop_Cancel'><input id='pop_Cancel' class='button_dialog' type='button' value='"+common_cancel+"'/></span></div></td></tr></table>");if($("body").append(n),$.browser.msie&&9==parseInt($.browser.version,10)){$(".button_wrapper").css("border-radius","3px");var a=document.getElementById("sms_showWaitingCanvas");draw(a)}else if($.browser.msie&&parseInt($.browser.version,10)<9){$(".wait_title").css("margin-top","5"),$(".wait_dialog_btn").css("margin-top","7px"),$(".wait_table_header").css({width:"377px",height:"33px"}),$(".wait_table_header").corner("top 5px"),$(".button_wrapper").css("background","#75ACD6"),$(".button_wrapper").corner("3px"),$(".button_wrapper input").css("padding-top","2px");$(".wait_table_header span").append("<img src='../res/new_del.png' title='' alt='' />")}else{a=document.getElementById("sms_showWaitingCanvas");draw(a)}reputPosition($("#wait_table"),$("#div_wrapper")),$("#wait_dialog_btn").bind("click",(function(){closeWaitingDialog()})),$("#pop_Cancel").live("click",(function(){$("#wait_table, #div_wrapper").remove(),"function"==typeof t&&t()}))}}function sms_showSmsDialog(){if("material"==webui_mode){document.querySelectorAll("#sms_dialog").forEach((function(e,s,t){e.close()})),$("#sms_dialog").remove(),g_content=null;var e="";e+="<h4 class='mdl-dialog__title'>"+sms_label_message+"</h4>",e+="<div class='mdl-dialog__content'>",e+="    <div class='sms_message'>",e+="    <p  id = 'recipients_sender'>"+sms_label_recipients+common_colon+"</p>",e+="    <div id='sms_number_wrapper'>",e+="        <div id='sms_number'>",1==g_contact_enabled&&g_module.pb_enabled?(e+="        <input type='text' id='recipients_number_pb' name='recipients_number_pb' value='' />",e+="        <img id='close_search_recipients_number' src='../res/-.png' alt='' style='display:none;'/>",e+="        <img id='search_recipients_number' src='../res/+.png' alt=''/>"):e+="        <input type='text' id='recipients_number' name='recipients_number' value='' onblur='checkNumberFormat()' />",e+="        </div>",1==g_contact_enabled&&g_module.pb_enabled&&(e+="        <div id='user_add_select' class='user_add_select'><ul id='list_contacts' ></ul></div>"),e+="    </div>",e+="    <p>"+sms_label_content+common_colon+"</p>",e+="    <textarea id='message_content'></textarea>",e+="    <p id='sms_count'></p>",e+="    </div>",e+="</div>",e+="<div class='mdl-dialog__actions'>",e+="    <a href='javascript:void(0);' id='pop_send' class='mdl-button'>"+common_send+"</a>",e+="    <a href='javascript:void(0);' id='pop_save_to_drafts' class='mdl-button'>"+sms_label_save_to_drafts+"</a>",e+="    <a href='javascript:void(0);' id='pop_Cancel' class='mdl-button'>"+common_cancel+"</a>",e+="</div>";var s=document.createElement("dialog");s.className="dialog mdl-dialog",s.id="sms_dialog",s.innerHTML=e,$(".body_bg").before(s),materializeInputs(),s.showModal||dialogPolyfill.registerDialog(s),s.showModal()}else{$("#div_wrapper").remove(),$("#sms_dialog").remove(),g_content=null;e="";if($("#div_wrapper").size()<1&&(e+="<div id='div_wrapper'><iframe   id='ifream_dialog'  src= '' frameborder= '0' style= 'background:#bcbcbc; width:100%; height:100%; display: block;'> </iframe></div>"),e+="<div class='dialog' id='sms_dialog'>",e+="    <div class='sms_dialog_content'>",e+="        <div class='sms_dialog_header'>",e+="            <span class='dialog_header_left clr_white'>"+sms_label_message+"</span>",e+="            <span class='dialog_header_right'><a class='dialog_close_btn clr_gray' title='' href='javascript:void(0);'><canvas id='sms_showSmsCanvas' width='25px' height='25px'></canvas></a></span>",e+="        </div>",e+="        <div class='sms_dialog_table'>",e+="               <div class='sms_message'>",e+="               <p  id = 'recipients_sender'>"+sms_label_recipients+common_colon+"</p>",e+="               <div id='sms_number_wrapper'>",e+="                   <div id='sms_number'>",1==g_contact_enabled&&g_module.pb_enabled?(e+="                   <input type='text' id='recipients_number_pb' name='recipients_number_pb' value='' />",e+="                   <img id='close_search_recipients_number' src='../res/-.png' alt='' style='display:none;'/>",e+="                   <img id='search_recipients_number' src='../res/+.png' alt=''/>"):e+="                   <input type='text' id='recipients_number' name='recipients_number' value='' onblur='checkNumberFormat()' />",e+="                   </div>",1==g_contact_enabled&&g_module.pb_enabled&&(e+="                   <div id='user_add_select' class='user_add_select'><ul id='list_contacts' ></ul></div>"),e+="               </div>",e+="               <p>"+sms_label_content+common_colon+"</p>",e+="               <textarea id='message_content'></textarea>",e+="               <p id='sms_count'></p>",e+="               </div>",e+="        </div>",e+="        <div class='sms_dialog_table_bottom'>",e+="            <div class='dialog_table_r'>",e+="              <span class='button_wrapper pop_send'>",e+="                  <input id='pop_send' class='button_dialog' type='button' value='"+common_send+"'/></span>",e+="&nbsp;&nbsp;&nbsp;&nbsp;<span class='button_wrapper pop_save_to_drafts'>",e+="                  <input id='pop_save_to_drafts' class='button_dialog' type='button' value='"+sms_label_save_to_drafts+"'/></span>",e+="&nbsp;&nbsp;&nbsp;&nbsp;<span class='button_wrapper pop_Cancel pop_common_cancel'>",e+="                  <input id='pop_Cancel' class='button_dialog' type='button' value='"+common_cancel+"'/></span>",e+="            </div>",e+="        </div>",e+="    </div>",e+="</div>",$(".body_bg").before(e),$.browser.msie&&9==parseInt($.browser.version,10)){$(".button_wrapper").css("border-radius","3px");var t=document.getElementById("sms_showSmsCanvas");draw(t)}else if($.browser.msie&&parseInt($.browser.version,10)<9){$(".dialog_header_left").css("margin-top","5"),$(".sms_dialog_header").css({width:"609px",height:"29px"}),$(".sms_dialog_header").corner("top 5px"),$(".dialog_close_btn").css("top","7"),$(".button_wrapper").css("background","#75ACD6"),$(".button_wrapper").corner("3px"),$(".button_wrapper input").css("padding-top","2px");$(".sms_dialog_header a").append("<img src='../res/new_del.png' title='' alt='' />")}else{t=document.getElementById("sms_showSmsCanvas");draw(t)}}"-1"!=g_lang_edit||g_isCDMA||0==g_smsFeature.smscharlang||void 0===g_smsFeature.smscharlang?$("#sms_count").html("160(1)"):$("#sms_count").html("155(1)"),"material"!=webui_mode&&reputPosition($("#sms_dialog"),$("#div_wrapper")),disableTabKey(),1==g_contact_enabled&&g_module.pb_enabled?$("#recipients_number_pb").attr("tabindex","0"):$("#recipients_number").attr("tabindex","0"),1==g_contact_enabled&&g_module.pb_enabled&&createList()}function sms_changeNetwork(){g_net_mode_change==MACRO_NET_MODE_CHANGE&&(g_net_mode_status==MACRO_NET_MODE_C?g_isCDMA=!0:g_net_mode_status==MACRO_NET_MODE_W&&(g_isCDMA=!1),void 0!==$("#message_content").val()&&sms_contentChange($("#message_content").val()),resetNetModeChange())}function sms_newMessage(){g_sms_length=0,cancelLogoutTimer(),sms_showSmsDialog();var e=create_button_html(common_send,"pop_send","pop_send")+"&nbsp;&nbsp;&nbsp;&nbsp;"+create_button_html(sms_label_save_to_drafts,"pop_save_to_drafts","pop_save_to_drafts")+"&nbsp;&nbsp;&nbsp;&nbsp;"+create_button_html(common_cancel,"pop_Cancel","pop_Cancel");$(".dialog_table_r").html(e),ieRadiusBorder(),"material"==webui_mode&&materializeButtons(),1==g_contact_enabled&&g_module.pb_enabled?$("#recipients_number_pb").focus().select():$("#recipients_number").focus().select(),1==g_contact_enabled&&g_module.pb_enabled?$("#pop_send,#pop_Cancel,.dialog_close_btn").live("click",(function(){$("#user_add_select").hide(),$("#search_recipients_number").show(),$("#close_search_recipients_number").hide()})):$("#search_recipients_number").hide()}function setSmsRead(e){$(g_sms_smsList).each((function(s){if(g_sms_smsList[s].Index==e&&0==g_sms_smsList[s].Smstat){var t=object2xml("request",{Index:e});saveAjaxData("api/sms/set-read",t,(function(s){var t=xml2object(s);isAjaxReturnOK(t)&&$("#smsReadStates"+e).attr("class","msg_icon read_state1")}))}}))}Date.prototype.Format=function(e){var s,t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds()};for(s in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),t)new RegExp("("+s+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[s]:("00"+t[s]).substr((""+t[s]).length)));return e};var g_SMS_UCS2_MAX_SIZE,g_SMS_8BIT_MAX_SIZE,g_SMS_7BIT_MAX_SIZE,g_station,PAGE_HANDLE_FORWARD="0",PAGE_HANDLE_REPLY="1",PAGE_HANDLE_READ="2",PAGE_HANDLE_CREATE="3",PAGE_HANDLE_NULL="4",SMS_TEXT_MODE_UCS2=0,SMS_TEXT_MODE_7BIT=1,SMS_TEXT_MODE_8BIT=2,ASCII_CODE=127,g_content=null,g_text_mode=SMS_TEXT_MODE_7BIT,g_sms_length=0,g_sms_num=1,g_ucs2_num=0,GSM_7BIT_NUM=128,SMS_STR_NUM=620,EXTENSION_ASCII=9,g_ext_7bit_tab=[[20,94],[40,123],[41,125],[47,92],[60,91],[61,126],[62,93],[64,124],[101,8364]],g_ext_7bit_tab_turkish=[[13,29],[20,94],[40,123],[41,125],[47,92],[60,91],[61,126],[62,93],[64,124],[71,286],[73,304],[83,350],[99,231],[101,8364],[103,287],[105,305],[115,351]],g_ext_7bit_tab_spanish=[[9,231],[20,94],[40,123],[41,125],[47,92],[60,91],[61,126],[62,93],[64,124],[65,193],[73,205],[79,211],[85,218],[97,225],[101,8364],[105,237],[111,243],[117,250]],g_ext_7bit_tab_Portuguese=[[5,234],[9,231],[11,212],[12,244],[14,193],[15,225],[18,934],[19,915],[20,94],[21,937],[22,928],[23,936],[24,931],[25,920],[31,202],[40,123],[41,125],[47,92],[60,91],[61,126],[62,93],[64,124],[65,192],[73,205],[79,211],[85,218],[91,195],[92,213],[97,194],[101,8364],[105,237],[111,243],[117,250],[123,227],[124,245],[127,226]],extension_char=27,ENTER_CHAR=10,CR_CHAR=13,arrayGSM_7bit=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127],arrayGSM_7DefaultTable=[64,163,36,165,232,233,249,236,242,199,10,216,248,13,197,229,916,95,934,915,923,937,928,936,931,920,926,27,198,230,223,201,32,33,34,35,164,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,161,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,196,214,209,220,167,191,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,228,246,241,252,224],arrayGSM_7ExtTable=[65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,10,65535,65535,65535,65535,65535,65535,65535,65535,65535,94,65535,65535,65535,65535,65535,65535,32,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,123,125,65535,65535,65535,65535,65535,92,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,91,126,93,65535,124,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,8364,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535],arrayGSM_7TurkishExtTable=[65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,10,65535,65535,29,65535,65535,65535,65535,65535,65535,94,65535,65535,65535,65535,65535,65535,32,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,123,125,65535,65535,65535,65535,65535,92,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,91,126,93,65535,124,65535,65535,65535,65535,65535,65535,286,65535,304,65535,65535,65535,65535,65535,65535,65535,65535,65535,350,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,231,65535,8364,65535,287,65535,305,65535,65535,65535,65535,65535,65535,65535,65535,65535,351,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535],arrayGSM_7PortugueseExtTable=[65535,65535,65535,65535,65535,234,65535,65535,65535,231,10,212,244,65535,193,225,65535,65535,934,915,94,937,928,936,931,920,65535,32,65535,65535,65535,202,65535,65535,65535,65535,65535,65535,65535,65535,123,125,65535,65535,65535,65535,65535,92,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,91,126,93,65535,124,192,65535,65535,65535,65535,65535,65535,65535,205,65535,65535,65535,65535,65535,211,65535,65535,65535,65535,65535,218,65535,65535,65535,65535,65535,195,213,65535,65535,65535,65535,194,65535,65535,65535,8364,65535,65535,65535,237,65535,65535,65535,65535,65535,243,65535,65535,65535,65535,65535,250,65535,65535,65535,65535,65535,227,245,65535,65535,226],arrayGSM_7SpanishExtTable=[65535,65535,65535,65535,65535,65535,65535,65535,65535,231,10,65535,65535,65535,65535,65535,65535,65535,65535,65535,94,65535,65535,65535,65535,65535,65535,32,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,123,125,65535,65535,65535,65535,65535,92,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,91,126,93,65535,124,193,65535,65535,65535,65535,65535,65535,65535,205,65535,65535,65535,65535,65535,211,65535,65535,65535,65535,65535,218,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,225,65535,65535,65535,8364,65535,65535,65535,237,65535,65535,65535,65535,65535,243,65535,65535,65535,65535,65535,250,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535],arrayGSM_7SpanishSpecialTable=[162,192,193,194,195,200,202,203,204,205,206,207,208,210,211,212,213,214,217,218,219,221,222,225,226,227,231,234,235,237,238,239,240,243,244,245,246,250,251,253,254,255,258,260,261,262,263,268,269,270,271,273,276,280,281,283,306,307,313,317,321,322,323,324,327,328,340,341,344,345,346,347,350,351,352,353,354,355,356,357,360,366,367,377,378,379,380,381,382,462,468,1168,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535];function sms_isPhoneNumber(e){var s=!0;return e.match(/^[+]{0,1}[*#()-0123456789]{1,20}$/)||(s=!1),s}function sms_isSendNumber(e){var s=!0;return $.isArray(e)?$(e).each((function(t){s=sms_isPhoneNumber(e[t])})):s=sms_isPhoneNumber(e),s}function sms_sendNumberCheck(){sms_clearAllErrorLabel();var e,s=0,t=!0,n=0;for(g_numberValid=!0,(e=arguments[0]).length>g_sms_maxphonesize&&(showErrorUnderTextbox("sms_number",sms_hint_maximum_number.replace("%d",g_sms_maxphonesize)),1==g_contact_enabled&&g_module.pb_enabled?$("#recipients_number_pb").focus().select():$("#recipients_number").focus().select(),t=!1,n+=10),s=0;s<e.length;s++)if(e[s]=$.trim(e[s]),0==sms_isSendNumber(e[s]))return showErrorUnderTextbox("sms_number",sms_hint_mobile_number_format),1==g_contact_enabled&&g_module.pb_enabled?$("#recipients_number_pb").focus().select():$("#recipients_number").focus().select(),"material"!=webui_mode&&(n=110+n,$("#sms_number_wrapper").css({height:n+"px"})),g_numberValid=t=!1,!1;return g_numberValid=t,t}function check_extension_ascii_for_char_number(e){var s,t=0,n=0,_=0,a=1,o=g_ext_7bit_tab,r=160,i=153;switch(g_smsFeature.smscharlang){case 0:o=g_ext_7bit_tab;break;case 1:o=g_ext_7bit_tab_turkish;break;case 2:o=g_ext_7bit_tab_spanish;break;case 3:o=g_ext_7bit_tab_Portuguese}for(0==g_smsFeature.smscharlang||void 0===g_smsFeature.smscharlang?(r=160,i=153):(r=155,i=149),t=0;t<e.length;t++){var m=1;for(s=e.charAt(t).charCodeAt(),m=1,n=0;n<o.length;n++)if(s==o[n][1]){m=2;break}1==m?_++:1==a?i-1==_?(_+=2,a=2):_+=2*i-1==_||3*i-1==_||4*i-1==_?3:2:_+=2*(i-1)==_||3*(i-1)+1==_||4*(i-1)+2==_?3:2}return _>r&&2==a&&_++,_}function check_extension_ascii_for_char_number_new(e){var s,t=0,n=0,_=0,a=1,o=g_ext_7bit_tab,r=160,i=153,m="",l=!0;switch(g_smsFeature.smscharlang){case 0:m=g_ext_7bit_tab;break;case 1:m=g_ext_7bit_tab_turkish;break;case 2:m=g_ext_7bit_tab_spanish;break;case 3:m=g_ext_7bit_tab_Portuguese}for(g_sms_smscharlang=!1,t=0;t<e.length;t++){l=!0;var c=1;for(s=e.charAt(t).charCodeAt(),c=1,n=0;n<o.length;n++)if(s==o[n][1]){c=2,r=160,i=153,l=!1;break}if(l)for(c=1,n=0;n<m.length;n++)if(s==m[n][1]){c=2,r=155,i=149,g_sms_smscharlang=!0;break}1==c?_++:1==a?i-1==_?(_+=2,a=2):_+=2*i-1==_||3*i-1==_||4*i-1==_?3:2:_+=2*(i-1)==_||3*(i-1)+1==_||4*(i-1)+2==_?3:2}return _>r&&2==a&&_++,_}function ucs2_number_check(e){var s,t,n=0,_=0,a=0,o=arrayGSM_7ExtTable;if(0==e.length)return 0;switch(g_smsFeature.smscharlang){case 0:o="2"==g_convert_type?arrayGSM_7SpanishExtTable:arrayGSM_7ExtTable;break;case 1:o=arrayGSM_7TurkishExtTable;break;case 2:o=arrayGSM_7SpanishExtTable;break;case 3:o=arrayGSM_7PortugueseExtTable}for(n=0;n<e.length;n++){for(t=0,s=e.charAt(n).charCodeAt(),_=0;_<GSM_7BIT_NUM;_++)if("2"==g_convert_type){if(s==arrayGSM_7DefaultTable[_]||s==o[_]||s==arrayGSM_7SpanishSpecialTable[_]){t=1;break}}else if(s==arrayGSM_7DefaultTable[_]||s==o[_]){t=1;break}0==t&&a++}return a}function CDMA_textmode_check(e){var s,t=0,n=SMS_TEXT_MODE_7BIT;if(0==e.length)return SMS_TEXT_MODE_7BIT;for(t=0;t<e.length;t++)if(s=e.charAt(t).charCodeAt(),SMS_TEXT_MODE_7BIT==n&&0<=s&&127>=s)n=SMS_TEXT_MODE_7BIT;else if((SMS_TEXT_MODE_7BIT==n||SMS_TEXT_MODE_8BIT==n)&&127<s&&255>=s)n=SMS_TEXT_MODE_8BIT;else if(255<s){n=SMS_TEXT_MODE_UCS2;break}return n}function sms_showContentCount(e){g_sms_length=e.length,document.getElementById("sms_count").innerHTML="("+g_sms_length+")"}function sms_numberCheck(e){var s,t,n=0,_=0,a=0;g_isCDMA?(g_SMS_UCS2_MAX_SIZE=260,g_SMS_8BIT_MAX_SIZE=540,g_SMS_7BIT_MAX_SIZE=620,n=sms_hint_max_ucs2_characters_268.replace(/268/,"260"),_=sms_hint_max_8bit_characters_532.replace(/532/,"540"),a=sms_hint_max_ascii_characters_612.replace(/612/,"620")):(g_SMS_UCS2_MAX_SIZE=268,g_SMS_8BIT_MAX_SIZE=532,g_SMS_7BIT_MAX_SIZE=612,n=sms_hint_max_ucs2_characters_268,_=sms_hint_max_8bit_characters_532,a=sms_hint_max_ascii_characters_612);var o=160,r=153,i=null;if(t=e.length,SMS_TEXT_MODE_UCS2==g_text_mode?(g_isCDMA?(o=70,r=65):(o=70,r=67),t>g_SMS_UCS2_MAX_SIZE&&(i=n)):SMS_TEXT_MODE_8BIT==g_text_mode?(g_isCDMA?(o=140,r=135):(o=140,r=133),t>g_SMS_8BIT_MAX_SIZE&&(i=_)):SMS_TEXT_MODE_7BIT!=g_text_mode||g_isCDMA?SMS_TEXT_MODE_7BIT==g_text_mode&&g_isCDMA&&(o=160,t>4*(r=155)&&(i=a)):(t="-1"==g_lang_edit?check_extension_ascii_for_char_number(e):check_extension_ascii_for_char_number_new(e),("-1"==g_lang_edit||g_sms_smscharlang)&&("-1"!=g_lang_edit||0!=g_smsFeature.smscharlang&&void 0!==g_smsFeature.smscharlang)?(o=155,t>4*(r=149)&&(i=sms_hint_max_ascii_characters_596)):(o=160,r=153,t>g_SMS_7BIT_MAX_SIZE&&(i=a))),null!=i?(sms_clearAllErrorLabel(),showErrorUnderTextbox("sms_count",i),g_sms_length=t,button_enable("pop_send","0"),button_enable("pop_save_to_drafts","0")):(button_enable("pop_send","1"),button_enable("pop_save_to_drafts","1"),sms_clearAllErrorLabel()),t<=o)document.getElementById("sms_count").innerHTML=o-t+"(1)",s=1,t<=0&&(g_content=e.substring(0));else if(t>o&&t<=4*r)s=parseInt(t/r,10)+1,0==t%r&&(s-=1),document.getElementById("sms_count").innerHTML=r*s-t+"("+s+")";else{var m=parseInt((t-4*r)/r,10),l=Math.floor(m),c=4*r+(l+1)*r-t;document.getElementById("sms_count").innerHTML=c+"("+(l+4+1)+")"}g_sms_num=s,g_sms_length=t}function sms_contentDiffUCS2Num(e){var s,t=0,n=0,_=0,a=0,o=0,r=0,i=0;if(null!=g_content&&0!=g_content.length)if(null!=e&&0!=e.length){for(s=Math.min(e.length,g_content.length),o=0;o<s&&e.charAt(o).charCodeAt()==g_content.charAt(o).charCodeAt();++o);if(o==s)(a=e.length-g_content.length)>0?r=ucs2_number_check(e.substring(o)):a<0&&(r=-1*ucs2_number_check(g_content.substring(o)));else{for(t=0,n=g_content.length-1,_=e.length-1;t<s&&n>o&&_>o&&e.charAt(_).charCodeAt()==g_content.charAt(n).charCodeAt();++t,--n,--_);i=ucs2_number_check(g_content.substring(o,n+1)),r=ucs2_number_check(e.substring(o,_+1))-i}g_ucs2_num+=r}else g_ucs2_num=0;else g_ucs2_num=ucs2_number_check(e)}function sms_contentChange(e){g_isCDMA?g_text_mode=CDMA_textmode_check(e):($.browser.msie?g_net_mode_type==MACRO_NET_DUAL_MODE&&g_net_mode_change==MACRO_NET_MODE_CHANGE?g_ucs2_num=ucs2_number_check(e):sms_contentDiffUCS2Num(e):g_ucs2_num=ucs2_number_check(e),g_text_mode=g_ucs2_num>0?SMS_TEXT_MODE_UCS2:SMS_TEXT_MODE_7BIT),sms_numberCheck(e),g_content=e}function sms_contentCheck(){var e=!0;return SMS_TEXT_MODE_UCS2==g_text_mode?g_sms_length>g_SMS_UCS2_MAX_SIZE&&(sms_clearAllErrorLabel(),showErrorUnderTextbox("sms_count",IDS_sms_hint_content_too_long),$("#message_content").select(),e=!1):SMS_TEXT_MODE_7BIT==g_text_mode?g_sms_length>g_SMS_7BIT_MAX_SIZE&&(sms_clearAllErrorLabel(),showErrorUnderTextbox("sms_count",IDS_sms_hint_content_too_long),$("#message_content").select(),e=!1):SMS_TEXT_MODE_8BIT==g_text_mode&&g_sms_length>g_SMS_8BIT_MAX_SIZE&&(sms_clearAllErrorLabel(),showErrorUnderTextbox("sms_count",IDS_sms_hint_content_too_long),$("#message_content").select(),e=!1),e}function check_lang_edit(){getAjaxData("api/sms/splitinfo-sms",(function(e){var s=xml2object(e);"response"==s.type&&(g_lang_edit=s.response.splitinfo,g_convert_type=s.response.convert_type)}))}function main_executeBeforeDocumentReady(){getConfigData("config/sms/config.xml",(function(e){g_smsFeature=_xml2feature(e),g_sms_smsListArray.ReadCount=g_smsFeature.pagesize>50?50:g_smsFeature.pagesize,""!=(g_sms_maxphonesize=$.trim(g_smsFeature.maxphone))&&void 0!==g_sms_maxphonesize||(g_sms_maxphonesize=SMS_MAXPHONESIZE),g_sms_importenabled="1"==g_smsFeature.import_enabled,g_sms_urlenabled="1"==g_smsFeature.url_enabled,g_isCDMA="1"==g_smsFeature.cdma_enabled}),{sync:!0}),redirectOnCondition(null,"smsinbox")}function createList(){$("#list_contacts").empty(),g_pb_pageIndex=1,pb_getConfig(),pb_getLocalContactList()}main_executeBeforeDocumentReady();var g_contact_enabled=null;function get_contact(){getAjaxData("api/sms/sms-feature-switch",(function(e){var s=xml2object(e);"response"==s.type&&(g_contact_enabled=s.response.getcontactenable)}),{sync:!0})}get_contact();var vsim_status=0;function initVsim(){getAjaxData("api/vsim/operateswitch-vsim",(function(e){var s=xml2object(e);if("response"==s.type){var t=s.response;vsim_status=t.vsim_status}}),{sync:!0})}function chang_menuli(){1==g_moduleswitch.vsim_enabled&&(initVsim(),2!=vsim_status&&(showInfoDialog(IDS_vsim_function_show),allButton_enable("0"),$("input:not(#lang)").attr("disabled",!0),$("select:not(#lang)").attr("disabled",!0)))}function sms_clearAllErrorLabel(){clearAllErrorLabel(),"material"!=webui_mode&&$("#sms_number_wrapper").css({height:"76px"})}function sms_gotoSiminboxUrl(e){var s=0;switch(g_pbToSmsFlag=!1,e){case"save_to_drafts":$.browser.safari?s=setTimeout((function(){clearTimeout(s),gotoPageWithoutHistory(SIMINBOX_PGAE_URL)}),500):gotoPageWithoutHistory(SIMINBOX_PGAE_URL);break;case"ok":case"cancel":$.browser.msie&&"6.0"==$.browser.version?s=setTimeout((function(){clearTimeout(s),gotoPageWithoutHistory(SIMINBOX_PGAE_URL)}),500):gotoPageWithoutHistory(SIMINBOX_PGAE_URL)}}function pb_showLocalContactList(){$.each(g_pb_contactListArray,(function(e,s){html=(html=pb_replace_showMobilePhone(html=vLocalShowContactList,s)).replaceString("%href%",e),$("#list_contacts").append(html),html=(html=pb_replace_showHomePhone(html=vLocalShowContactList,s)).replaceString("%href%",e),$("#list_contacts").append(html),html=(html=pb_replace_showWorkPhone(html=vLocalShowContactList,s)).replaceString("%href%",e),$("#list_contacts").append(html)})),$("#user_add_select").append($("#list_contacts")),$(".linkmanInfo").unbind("click"),$(".linkmanInfo").bind("click",(function(){var e=$.trim($(this).find("div").eq(0).text())+"<"+$.trim($(this).find("div").eq(1).text())+">";displayInformations.indexOf(e)<0&&(displayInformations+=e+";"),$("#recipients_number_pb").val(displayInformations)}))}function pb_replace_showMobilePhone(e,s){var t=e;return pb_getConfig(),s.MobilePhone?(s.FormattedName?(g_pb_nameLength=utf8_strlen(s.FormattedName),g_pb_nameLength<=g_pb_feature.max_name_size?t=t.replaceString("%FormattedNameTwo%",resolveXMLEntityReference(s.FormattedName).replace(/\s/g,"&nbsp;")):(g_pb_nameNumber=utf8_str_id(s.FormattedName,g_pb_feature.max_name_size),afterSubstrName=s.FormattedName.substr(0,g_pb_nameNumber),t=t.replaceString("%FormattedNameTwo%",resolveXMLEntityReference(afterSubstrName).replace(/\s/g,"&nbsp;")))):t=t.replaceString("%FormattedNameTwo%",""),t=(t=s.MobilePhone.length<=g_pb_feature.max_phone_size?t.replaceString("%phone%",XSSResolveCannotParseChar(s.MobilePhone)):t.replaceString("%phone%",XSSResolveCannotParseChar(s.MobilePhone.substr(0,g_pb_feature.max_phone_size)))).replaceString("%numberType%","MobilePhone:")):t="",t}function pb_replace_showHomePhone(e,s){var t=e;return pb_getConfig(),s.HomePhone?(s.FormattedName?(g_pb_nameLength=utf8_strlen(s.FormattedName),g_pb_nameLength<=g_pb_feature.max_name_size?t=t.replaceString("%FormattedNameTwo%",resolveXMLEntityReference(s.FormattedName).replace(/\s/g,"&nbsp;")):(g_pb_nameNumber=utf8_str_id(s.FormattedName,g_pb_feature.max_name_size),afterSubstrName=s.FormattedName.substr(0,g_pb_nameNumber),t=t.replaceString("%FormattedNameTwo%",resolveXMLEntityReference(afterSubstrName).replace(/\s/g,"&nbsp;")))):t=t.replaceString("%FormattedNameTwo%",""),t=(t=t.replaceString("%phone%",XSSResolveCannotParseChar(s.HomePhone))).replaceString("%numberType%","HomePhone:")):t="",t}function pb_replace_showWorkPhone(e,s){var t=e;return pb_getConfig(),s.WorkPhone?(s.FormattedName?(g_pb_nameLength=utf8_strlen(s.FormattedName),g_pb_nameLength<=g_pb_feature.max_name_size?t=t.replaceString("%FormattedNameTwo%",resolveXMLEntityReference(s.FormattedName).replace(/\s/g,"&nbsp;")):(g_pb_nameNumber=utf8_str_id(s.FormattedName,g_pb_feature.max_name_size),afterSubstrName=s.FormattedName.substr(0,g_pb_nameNumber),t=t.replaceString("%FormattedNameTwo%",resolveXMLEntityReference(afterSubstrName).replace(/\s/g,"&nbsp;")))):t=t.replaceString("%FormattedNameTwo%",""),t=(t=t.replaceString("%phone%",XSSResolveCannotParseChar(s.WorkPhone))).replaceString("%numberType%","WorkPhone:")):t="",t}function utf8_strlen(e){var s=0,t=0;for(t=0;t<e.length;t++){var n=e.charCodeAt(t);s+=n<128?1:n<2048?2:3}return s}function utf8_str_id(e,s){var t=0,n=0;for(n=0;n<e.length;n++){var _=e.charCodeAt(n);if((t+=_<128?1:_<2048?2:3)>s)break}return n}function pb_getConfig(){null==pb_feature&&getConfigData("config/pb/config.xml",(function(e){pb_feature=_xml2feature(e),$.extend(g_pb_feature,pb_feature)}),{sync:!0})}function pb_getLocalContactList(){var e;g_pb_local_contact_list_request.GroupID=0,g_pb_local_contact_list_request.PageIndex=g_pb_pageIndex,g_pb_local_contact_list_request.ReadCount=g_pb_feature.max_record_size,g_pb_local_contact_list_request.KeyWord="",e=object2xml("request",g_pb_local_contact_list_request),saveAjaxData("api/pb/pb-list",e,(function(e){var s=pb_local_xml2object(e);"response"==s.type&&(g_pb_contactListArray=[],s.response.Phonebooks.Phonebook&&($.isArray(s.response.Phonebooks.Phonebook)?g_pb_contactListArray=s.response.Phonebooks.Phonebook:g_pb_contactListArray.push(s.response.Phonebooks.Phonebook),pb_showLocalContactList()),g_pb_curContactSum=s.response.SumSize,checkPage())}),{timeout:g_PB_TIMEOUT_SHORT,errorCB:function(){}})}function checkPage(){g_pb_totalPbPage=Math.ceil(g_pb_curContactSum/g_pb_local_contact_list_request.ReadCount),g_pb_pageIndex<g_pb_totalPbPage&&(g_pb_pageIndex++,pb_getLocalContactList())}function pb_local_xml2object(e){var s={};if(e.find("response").size()>0){var t=pb_local_recursiveXml2Object(e.find("response"));s.type="response",s.response=t}else if(e.find("error").size()>0){var n=e.find("code").text(),_=e.find("message").text();s.type="error",s.error={code:n,message:_}}else s.type="unknown";return s}function pb_local_recursiveXml2Object(e){if(e.children().size()>0){var s={};return e.children().each((function(){if("Field"!=this.tagName){var e=$(this).children().size()>0?pb_local_recursiveXml2Object($(this)):$(this).text();$(this).siblings().size()>0&&$(this).siblings().get(0).tagName==this.tagName?(null==s[this.tagName]&&(s[this.tagName]=[]),s[this.tagName].push(e)):s[this.tagName]=e}else s[$(this).find("Name").text()]=$(this).find("Value").text()})),s}return e.text()}function creatSmsContent(){"new"==webui_mode&&force_old_sms?($("#new_smsmenu_list").remove(),$("#new_sms_list").remove(),$("#new_sms_text").remove()):"old"==webui_mode&&force_new_sms?($(".content *").hide(),$(".content").prepend($("#new_sms_text").detach().show()),$(".content").prepend($("#new_sms_list").detach().show()),$(".content").prepend($("#new_smsmenu_list").detach().attr("style","margin-left: 23px;").show())):($("#new_body").append($("#new_smsmenu_list").detach().show()),$("#new_body").append($("#new_sms_list").detach().show()),$("#new_body").append($("#new_sms_text").detach().show()))}function setSmsText(){$("#new_all_sms a").text(sms_lable_sms),$("#new_ussd a").text(ussd_label_ussd),$("#new_unread_sms a").text(new_unread_sms),$("#new_read_sms a").text(new_read_sms),LANGUAGE_DATA.current_language,$("#new_received_sms a").text(IDS_msg_receive),$("#new_sent_sms a").text(msg_sent),$("#message").attr("value",common_new_messages),$("#new_del_msg_btn").attr("value",common_delete),$("#pop_reply").attr("value",common_reply),$("#pop_forward").attr("value",common_forward)}function addSmsEvent(){$("#new_received_sms").click((function(){smsBoxType="received",g_sms_totalSmsPage=0,g_sms_boxType=SMS_BOXTYPE_LOCAL_INBOX,g_sms_smsListArray.BoxType=g_sms_boxType,setSmsBox(smsBoxType),window.location.hash=smsBoxType})),$("#new_sent_sms").click((function(){smsBoxType="sent",g_sms_totalSmsPage=0,g_sms_boxType=SMS_BOXTYPE_LOCAL_SENT,g_sms_smsListArray.BoxType=g_sms_boxType,setSmsBox("sent"),window.location.hash=smsBoxType})),$("#new_unread_sms").click((function(){setSmsBox(smsBoxType="unread"),window.location.hash=smsBoxType})),$("#new_read_sms").click((function(){setSmsBox(smsBoxType="read"),window.location.hash=smsBoxType})),$(".new_sms_list_tr > *:not(.sms_td)").live("click",(function(){var e=$(this).parent().find(".sms_td input").attr("value");$(".new_sms_list_tr .sms_phone_number:not(.read_sta0)").removeClass("red_color_font"),$(".new_sms_list_tr .msg_icon:not(.read_state0)").removeClass("red_color_font"),$(this).parent().attr("style",""),$(this).parent().find(".sms_phone_number").addClass("red_color_font"),$(this).parent().find(".msg_icon").addClass("red_color_font"),setSmsBox(smsBoxType,e)})),$("#select_all_sms").live("click",(function(){$("#sms_table :checkbox").attr("checked",this.checked),0==$("#sms_table :checkbox").filter(":checked").length?button_enable("new_del_msg_btn","0"):button_enable("new_del_msg_btn","1")})),button_enable("new_del_msg_btn","0"),$("#new_del_msg_btn").live("click",(function(){if(isButtonEnable("new_del_msg_btn")){if(0==$("#sms_table :checkbox").filter(":checked").length)return showInfoDialog(new_sms_select_null),void $("#select_all_sms").attr("checked",!1);showConfirmDialog(common_confirm_delete_list_item,(function(){set_smsDelete()}),(function(){$("#sms_check_all").removeAttr("checked")}))}})),$(".new_sms_text_botton").live("click",(function(){var e=$(this).next().text();e&&showConfirmDialog(common_confirm_delete_list_item,(function(){sms_OnesmsDelete(e)}),(function(){}))}))}function setSmsBox(e,s){switch(e){case"received":var t="LocalInbox",n=1;break;case"sent":t="LocalOutbox",n=2;break;case"unread":t="LocalInbox",n=1;var _="0";break;case"read":t="LocalInbox",n=1,_="1";break;default:return}$("#select_all_sms").attr("checked",!1),$("#new_all_sms + ul .red_color_font").removeClass("red_color_font"),$("#new_"+e+"_sms a").addClass("red_color_font"),$("#new_sms_class").text($("#new_"+e+"_sms a").text()),getSmsCount(t,n,_,s)}function getSmsCount(e,s,t,n){getAjaxData("api/sms/sms-count",(function(_){var a=xml2object(_);"response"==a.type&&sms_getSmsData(parseInt(a.response[e]),s,t,n)}),{sync:!0})}function sms_getSmsData(e,s,t,n){var _=[],a={PageIndex:0,ReadCount:50,BoxType:s,SortType:0,Ascending:0,UnreadPreferred:0};a.PageIndex=g_sms_pageIndex;var o=object2xml("request",a);if(saveAjaxData("api/sms/sms-list",o,(function(e){var s=xml2object(e);"response"==s.type&&s.response.Messages.Message&&($.isArray(s.response.Messages.Message)?Array.prototype.push.apply(_,s.response.Messages.Message):_.push(s.response.Messages.Message))}),{sync:!0}),void 0!==t)for(var r=0;r<_.length;r++)_[r].Smstat!==t&&(_.splice(r,1),r--);if(_.length>1&&("ru_ru"==LANGUAGE_DATA.current_language?new_sms_num_tips2=" сообщений":new_sms_num_tips2=" messages"),1==g_pageRefresh)if(g_pageRefresh=0,n=g_pageIndex,sms_initSmsList(_),void 0===n)_.length>0?setRightSmsText(_[0]):setRightSmsText(null);else for(var i=0;i<_.length;i++)if(_[i].Index===n)return setRightSmsText(_[i]),void setOpenSmsRead(n);if(g_pageIndex=n,void 0===n)_.length>0?(setRightSmsText(_[0]),setOpenSmsRead(_[0].Index)):setRightSmsText(null);else for(i=0;i<_.length;i++)if(_[i].Index===n)return setRightSmsText(_[i]),void setOneSmsRead(n);sms_initSmsList(_)}function setRightSmsText(e){if(e){$("#new_sms_text_index").text(e.Index),$("#new_sms_text_title").text(e.Phone);var s=e.Date;s=new Date(s.replace(/-/g,"/")).Format("yyyy-MM-dd hh:mm:ss"),$("#new_sms_text_data").text(s),$("#new_sms_text_content").text(e.Content)}else $("#new_sms_text_index").text(""),$("#new_sms_text_title").text(""),$("#new_sms_text_data").text(""),$("#new_sms_text_content").text("")}function sms_initSmsList(e){var s=null,t="",n=$("#new_boxList_title"),_=null,a=null,o=null,r=null,i=null,m=null;$(".new_sms_list_tr").remove(),$.each(e,(function(e,l){switch(parseInt(l.Smstat,10)){case 7:l.Content=sms_label_setting_usesreport+common_colon+" "+common_success;break;case 8:l.Content=sms_label_setting_usesreport+common_colon+" "+common_failed}l.Content.length>100&&(l.Content=l.Content.slice(0,100)+"..."),t=g_sms_urlenabled?regURL(l.Content):XSSResolveCannotParseChar(l.Content),s="read_state"+l.Smstat,smsReadState2="read_sta"+l.Smstat;var c=l.Date;c=new Date(c.replace(/-/g,"/")).Format("yyyy-MM-dd hh:mm:ss");var d=sms_enterPhone(l.Phone.split(";")),p="smsReadStates"+l.Index,g="";"undefined"!=l&&"undefined"!=l.Smstat&&0==l.Smstat&&(g="style='font-weight:bold'"),_=$("<tr class='new_sms_list_tr'"+g+"></tr>"),(a=$("<td class='sms_td'></td>")).append("<input type='checkbox' name='checkbox' value='"+l.Index+"' />"),_.append(a),(o=$("<td  class='td_pl sms_phone_width'></td>")).html("<table border='0' cellpadding='0' class='sms_msg' cellspacing='0'><tr><td><span  id='"+p+"'  class='msg_icon "+s+" '>&nbsp;</span></td><td class='sms_phone_number "+smsReadState2+"'>"+d+"</td></tr></table>"),_.append(o),(i=$("<td  class='td_pl sms_date_width'></td>")).append("<label>"+c+"</label>"),_.append(i),r=$("<td  class='td_pl sms_content_width'></td>"),m=$("<p class='sms_content clr_blue_a'></p>"),t.length!=l.Content.length?m.html(t):m.text(t),r.html(m),_.append(r),n.after(_),n=_})),$(".new_sms_list_tr:first .sms_phone_number").addClass("red_color_font"),$(".new_sms_list_tr:first .msg_icon").addClass("red_color_font"),$("#sms_check_all").removeAttr("checked")}$(document).ready((function(){var e;getMonitoringStatus(),g_net_mode_status==MACRO_NET_MODE_C?g_isCDMA=!0:g_net_mode_status==MACRO_NET_MODE_W&&(g_isCDMA=!1),g_net_mode_type==MACRO_NET_DUAL_MODE&&addStatusListener("sms_changeNetwork()"),sms_getBoxType(),check_lang_edit(),("old"==webui_mode&&!force_new_sms||"new"==webui_mode&&force_old_sms||"material"==webui_mode)&&sms_initPage(),g_module.pb_enabled&&null!=(e=getQueryStringByName("number"))&&e.length>0&&(e.match("%23")&&(e=e.replace(/%23/g,"#")),g_pbToSmsFlag=!0,sms_newMessage(),1==g_contact_enabled&&g_module.pb_enabled?$("#recipients_number_pb").val(e):$("#recipients_number").val(e),$("#message_content").focus()),setInterval((function(){sms_getBoxCount(!1,sms_init_info())}),g_feature.update_interval),sms_btnAddEvent();var s=-1;function t(e){0!=e&&setTimeout((function(){n("Save"),button_enable("pop_save_to_drafts","0")}),LOGOUT_TIMEOUT_MAIN),startLogoutTimer()}function n(e){sms_clearAllErrorLabel();var t="";t=1==g_contact_enabled&&g_module.pb_enabled?$.trim($("#recipients_number_pb").val()):$.trim($("#recipients_number").val());var n=$("#message_content").val();t.length>0&&t.lastIndexOf(";")==t.length-1&&(t=t.substring(0,t.length-1),1==g_contact_enabled&&g_module.pb_enabled?$("#recipients_number_pb").val(_):$("#recipients_number").val(t)),""==$("#message_content").val()&&(g_sms_num=1);var a=t.split(";"),o=$.trim($("#message_content").val());if(("Save"==e&&0==t.length&&0!=o.length||sms_sendNumberCheck(a))&&sms_contentCheck()){n=resolveXMLEntityReference(n);var r=-1;SMS_BOXTYPE_DRAFT==g_sms_boxType&&s>-1&&(r=s,s=-1);var i=(new Date).Format("yyyy-MM-dd hh:mm:ss"),m={Index:r,Phones:{Phone:a},Sca:"",Content:n,Length:n.length,Reserved:g_text_mode,Date:i};s=-1;var l,c=object2xml("request",m);if("Save"==e)clearDialog(),saveAjaxData("api/sms/save-sms",c,(function(e){var s=xml2object(e);isAjaxReturnOK(s)?SMS_BOXTYPE_DRAFT==g_sms_boxType&&sms_initPage():"error"==s.type&&sms_systemBusy==s.error.code?showInfoDialog(common_system_busy):showInfoDialog(common_failed)}));else sms_showWaitingDialog(common_waiting,sms_hint_sending+"&nbsp;1/"+g_sms_num*a.length),$(".wait_dialog_btn").show(),$("#sms_dialog").remove(),saveAjaxData("api/sms/send-sms",c,(function(e){var s=xml2object(e);if("error"==s.type)sms_systemBusy==s.error.code?($("#wait_table").remove(),showInfoDialog(common_system_busy)):($("#wait_table").remove(),showInfoDialog(common_failed));else{function t(){getAjaxData("api/sms/send-status",(function(e){var s=xml2object(e),t=(s=s.response).TotalCount,n=s.CurIndex,_=s.Phone,a=s.SucPhone,o=s.FailPhone,r=sms_hint_sending+"&nbsp;"+n+"/"+t;if($(".wait_table_content .wait_str").html(r),""==_){$("#wait_table").remove(),clearInterval(l);var i=a.split(","),m=i.length,c=o.split(","),d=c.length;""==i[m-1]&&(i.pop(),m>0?m-=1:m=0,$(".send_success_info").hide()),""==c[d-1]&&(c.pop(),d>0?d-=1:d=0,$(".send_failed_info").hide());var p="<table id='sms_success_info'><tr><td><h1><span>"+m+"&nbsp;"+common_successfully+common_comma+"</span><span>"+d+"&nbsp;"+common_failed+"</span></h1></td></tr><tr><td height='27'></td></tr>";if(g_module.pb_enabled){var g="";m>0&&(successPhonesArry=a.replace(/,/g,";"),postObject={Phone:successPhonesArry},g=object2xml("request",postObject),saveAjaxData("api/pb/pb-match",g,(function(e){var s=xml2object(e);if("response"==s.type){var t=s.response.Name;p+="<tr class='send_success_info'><td><table><tr><td rowspan='2' width='30' valign='top'><img onload = 'fixPNG(this)' src='../res/icon_sms_send_success.png' alt='' /></td><td>"+sms_label_the_message_sent_successed+common_colon+"</td></tr><tr><td class='success_phone_number_sms'>"+spaceToNbsp(XSSResolveCannotParseChar(t)).split(";").join("; ")+"</td></tr></table></td></tr><tr class='send_failed_info'><td height='21'></td></tr>",g_sendSuccessAndFailedFlag=!0}}),{sync:!0})),d>0&&(failPhonesArry=o.replace(/,/g,";"),postObject={Phone:failPhonesArry},g=object2xml("request",postObject),saveAjaxData("api/pb/pb-match",g,(function(e){var s=xml2object(e);if("response"==s.type){var t=s.response.Name;p+="<tr class='send_failed_info'><td><table><tr><td rowspan='2' width='30' valign='top'><img onload = 'fixPNG(this)' src='../res/icon_sms_send_failed.png' alt='' /></td><td>"+sms_label_the_message_sent_failed+common_colon+"</td></tr><tr><td  class='failed_phone_number'>"+spaceToNbsp(XSSResolveCannotParseChar(t)).split(";").join("; ")+"</td></tr></table></td></tr>",g_sendSuccessAndFailedFlag=!0}}),{sync:!0}))}else m>0&&(p+="<tr class='send_success_info'><td><table><tr><td rowspan='2' width='30' valign='top'><img onload = 'fixPNG(this)' src='../res/icon_sms_send_success.png' alt='' /></td><td>"+sms_label_the_message_sent_successed+common_colon+"</td></tr><tr><td class='success_phone_number_sms'>"+a.split(",").join("; ")+"</td></tr></table></td></tr><tr class='send_failed_info'><td height='21'></td></tr>",g_sendSuccessAndFailedFlag=!0),d>0&&(p+="<tr class='send_failed_info'><td><table><tr><td rowspan='2' width='30' valign='top'><img onload = 'fixPNG(this)'  src='../res/icon_sms_send_failed.png' alt='' /></td><td>"+sms_label_the_message_sent_failed+common_colon+"</td></tr><tr><td  class='failed_phone_number'>"+o.split(",").join("; ")+"</td></tr></table></td></tr>",g_sendSuccessAndFailedFlag=!0);p+="</table>",startLogoutTimer(),call_dialog(common_note,p,common_ok,"pop_OK"),$(".dialog_table").css("text-align","left"),(SMS_BOXTYPE_SENT==g_sms_boxType&&m>0||SMS_BOXTYPE_DRAFT==g_sms_boxType)&&(button_enable("ref_msg_btn","1"),sms_initPage())}}))}l=setInterval(t,g_feature.update_interval)}function n(){var e=object2xml("request",1);saveAjaxData("api/sms/cancel-send",e,(function(e){var s=xml2object(e);clearInterval(l),$("#wait_table, #div_wrapper").remove(),isAjaxReturnOK(s)&&t()}))}$("#pop_Cancel").bind("click",(function(){isButtonEnable("pop_Cancel")&&(button_enable("pop_Cancel","0"),n())})),$(".wait_dialog_btn").unbind("click").live("click",(function(){startLogoutTimer(),n()})),$("#pop_OK, .dialog_close_btn").live("click",(function(){$("#wait_div, #div_wrapper").remove(),$(".dialog").remove(),1==g_pbToSmsFlag&&sms_gotoSiminboxUrl("ok"),startLogoutTimer()}))}),{errorCB:function(){$("#wait_table").remove(),showInfoDialog(common_failed)}});null}else button_enable("pop_save_to_drafts","1")}$("#message").live("click",(function(){isButtonEnable("message")&&(sms_newMessage(),s=-1,t())})),$(".sms_list_tr").live("click",(function(e){if((1!=g_moduleswitch.vsim_enabled||2==vsim_status)&&"sms_td"!=$(e.target).attr("class")&&"sms_td"!=$(e.target).parent().attr("class")){!function(e){sms_showSmsDialog(),s=g_sms_smsList[e].Index;var n="",_=!1;g_sms_boxType==SMS_BOXTYPE_INBOX&&(n+=create_button_html(common_reply,"pop_reply","pop_reply")+"&nbsp;&nbsp;&nbsp;&nbsp;",$("#recipients_sender").html(sms_label_sender+common_colon),$("#search_recipients_number").hide()),g_sms_boxType==SMS_BOXTYPE_DRAFT&&(cancelLogoutTimer(),t(0),1==g_contact_enabled&&g_module.pb_enabled?$("#recipients_number_pb").focus().select():$("#recipients_number").focus().select(),n+=create_button_html(common_send,"pop_send","pop_send")+"&nbsp;&nbsp;&nbsp;&nbsp;",n+=create_button_html(sms_label_save_to_drafts,"pop_save_to_drafts","pop_save_to_drafts")+"&nbsp;&nbsp;&nbsp;&nbsp;",1==g_contact_enabled&&g_module.pb_enabled?$("#pop_send,#pop_Cancel,.dialog_close_btn").live("click",(function(){$("#user_add_select").hide(),$("#search_recipients_number").show(),$("#close_search_recipients_number").hide()})):$("#search_recipients_number").hide()),g_sms_boxType!=SMS_BOXTYPE_DRAFT&&(_=!0,1==g_contact_enabled&&g_module.pb_enabled?$("#recipients_number_pb").attr("readonly","readonly"):$("#recipients_number").attr("readonly","readonly"),$("#message_content").attr("readonly","readonly"),n+=create_button_html(common_forward,"pop_forward","pop_forward")+"&nbsp;&nbsp;&nbsp;&nbsp;",$("#search_recipients_number").hide()),n+=create_button_html(common_cancel,"pop_Cancel","pop_Cancel"),$(".dialog_table_r").html(n),ieRadiusBorder(),"material"==webui_mode&&materializeButtons(),$(g_sms_smsList).each((function(e){g_sms_smsList[e].Index==s&&(1==g_contact_enabled&&g_module.pb_enabled?$("#recipients_number_pb").val(g_sms_smsList[e].Phone):$("#recipients_number").val(g_sms_smsList[e].Phone),$("#message_content").val(g_sms_smsList[e].Content),_?sms_showContentCount($("#message_content").val()):sms_contentChange($("#message_content").val()),e)})),setSmsRead(s)}($(".sms_list_tr").index(this));for(var n=$(e.target);;){if("sms_list_tr"==n.attr("class"))return void n.css("font-weight","normal");n=n.parent()}}})),$("#pop_reply").live("click",(function(){if(isButtonEnable("pop_reply")){var e="";e=1==g_contact_enabled&&g_module.pb_enabled?$("#recipients_number_pb").val():document.getElementById("new_sms_text_title").innerText;var s=create_button_html(common_send,"pop_send","pop_send")+"&nbsp;&nbsp;&nbsp;&nbsp;"+create_button_html(sms_label_save_to_drafts,"pop_save_to_drafts","pop_save_to_drafts")+"&nbsp;&nbsp;&nbsp;&nbsp;"+create_button_html(common_cancel,"pop_Cancel","pop_Cancel");cancelLogoutTimer(),t(),sms_showSmsDialog(),$(".dialog_table_r").html(s),ieRadiusBorder(),"material"==webui_mode&&materializeButtons(),1==g_contact_enabled&&g_module.pb_enabled?$("#recipients_number_pb").val(e):($("#recipients_number").val(e),checkNumberFormat()),sms_contentChange($("#message_content").val()),$("#message_content").focus().select(),1==g_contact_enabled&&g_module.pb_enabled?$("#pop_send,#pop_Cancel,.dialog_close_btn").live("click",(function(){$("#user_add_select").hide(),$("#search_recipients_number").show(),$("#close_search_recipients_number").hide()})):$("#search_recipients_number").hide()}})),$("#pop_forward").live("click",(function(){if(isButtonEnable("pop_forward")){var e=document.getElementById("new_sms_text_content").innerText,s=create_button_html(common_send,"pop_send","pop_send")+"&nbsp;&nbsp;&nbsp;&nbsp;"+create_button_html(sms_label_save_to_drafts,"pop_save_to_drafts","pop_save_to_drafts")+"&nbsp;&nbsp;&nbsp;&nbsp;"+create_button_html(common_cancel,"pop_Cancel","pop_Cancel");cancelLogoutTimer(),t(),sms_showSmsDialog(),$(".dialog_table_r").html(s),ieRadiusBorder(),"material"==webui_mode&&materializeButtons(),$("#message_content").val(e),sms_contentChange($("#message_content").val()),1==g_contact_enabled&&g_module.pb_enabled?$("#recipients_number_pb").focus().select():$("#recipients_number").focus().select(),1==g_contact_enabled&&g_module.pb_enabled?$("#pop_send,#pop_Cancel,.dialog_close_btn").live("click",(function(){$("#user_add_select").hide(),$("#search_recipients_number").show(),$("#close_search_recipients_number").hide()})):$("#search_recipients_number").hide()}})),$("#pop_send").live("click",(function(){isButtonEnable("pop_send")&&(a(),phone_number_format_reverse(),n("Sent"))})),$(".pop_Cancel, .dialog_close_btn").live("click",(function(){var e=0;null,sms_clearAllErrorLabel(),e=setTimeout((function(){clearTimeout(e),0==g_sendSuccessAndFailedFlag?1==g_pbToSmsFlag&&sms_gotoSiminboxUrl("cancel"):g_sendSuccessAndFailedFlag=!1}),500),startLogoutTimer()}));var _="";function a(){var e=!1,s="";if(""!=(_=$("#recipients_number_pb").val())&&null!=_||(e=!0,$("#recipients_number_pb").val("")),!e){var t=_.split(";");$.each(t,(function(e,t){if(t.indexOf("<")>=0&&t.indexOf(">")>=0){var n=t.lastIndexOf("<"),_=t.lastIndexOf(">");n<_&&(t=t.substring(n+1,_),s+=t+";")}else s+=t+";"})),s=s.substring(0,s.length-1),$("#recipients_number_pb").val(s)}}$("#search_recipients_number").live("click",(function(){(displayInformations=$("#recipients_number_pb").val()).lastIndexOf(";")!=displayInformations.length-1&&(displayInformations+=";"),$("#search_recipients_number").hide(),$("#close_search_recipients_number").show(),$(".user_add_select").show(),$(".error_message").hide(),$("#recipients_number_pb").live("focus",(function(){$("#user_add_select").hide(),$("#search_recipients_number").show(),$("#close_search_recipients_number").hide()})),$("#close_search_recipients_number").live("click",(function(){$("#user_add_select").hide(),$("#search_recipients_number").show(),$("#close_search_recipients_number").hide()})),$("#message_content").live("click",(function(){$("#user_add_select").hide(),$("#search_recipients_number").show(),$("#close_search_recipients_number").hide()}))})),$(".wait_dialog_btn").live("click",(function(){var e=0;e=setTimeout((function(){clearTimeout(e),0==g_sendSuccessAndFailedFlag?1==g_pbToSmsFlag&&sms_gotoSiminboxUrl("cancel"):g_sendSuccessAndFailedFlag=!1}),500)})),$("#pop_delete").live("click",(function(){if(isButtonEnable("pop_delete")){startLogoutTimer(),button_enable("pop_delete","0"),clearDialog();var e=object2xml("request",{Index:s});saveAjaxData("api/sms/delete-sms",e,(function(e){sms_initPage()}))}})),$("#pop_save_to_drafts").live("click",(function(){isButtonEnable("pop_save_to_drafts")&&(a(),startLogoutTimer(),button_enable("pop_save_to_drafts","0"),n("Save"),1==g_pbToSmsFlag&&1==g_numberValid&&sms_gotoSiminboxUrl("save_to_drafts"),1==g_contact_enabled&&g_module.pb_enabled&&($("#user_add_select").hide(),$("#search_recipients_number").show(),$("#close_search_recipients_number").hide()))})),$("#message_content").live("keydown keypress keyup focus change input",(function(e){$("#message_content").attr("readonly")||("keydown"!=e.type&&"keypress"!=e.type&&"keyup"!=e.type||37!=e.keyCode&&38!=e.keyCode&&39!=e.keyCode&&40!=e.keyCode)&&(sms_numberCheck($("#message_content").val()),sms_contentChange($("#message_content").val()))})),chang_menuli()})),String.prototype.replaceString=function(e,s){var t=0;return this.str=this,"%href%"==e?(t=this.str.indexOf(e))>=0&&(this.str=this.str.substring(0,t)+s+this.str.substr(t+e.length)):"%FormattedNameTwo%"==e||"%GroupNameTwo%"==e?((t=this.str.indexOf(e))>=0&&(this.str=this.str.substring(0,t)+s+this.str.substr(t+e.length)),(t=this.str.lastIndexOf(e))>=0&&(this.str=this.str.substring(0,t)+s+this.str.substr(t+e.length))):(t=this.str.lastIndexOf(e))>0&&(this.str=this.str.substring(0,t)+s+this.str.substr(t+e.length)),this.str};var smsBoxType="";function set_smsDelete(){cancelLogoutTimer(),g_sms_checkedList="",$("#sms_table :checkbox").filter(":checked").each((function(){g_sms_checkedList+="<Index>"+this.value+"</Index>"}));var e=object2xml("request",g_sms_checkedList);saveAjaxData("api/sms/delete-sms",e,(function(e){var s=xml2object(e);startLogoutTimer(),isAjaxReturnOK(s)&&(button_enable("new_del_msg_btn","0"),setSmsBox(smsBoxType))}))}function sms_OnesmsDelete(e){g_sms_checkedList+="<Index>"+e+"</Index>";var s=object2xml("request",g_sms_checkedList);saveAjaxData("api/sms/delete-sms",s,(function(e){var s=xml2object(e);startLogoutTimer(),isAjaxReturnOK(s)&&setSmsBox(smsBoxType)}))}function setOneSmsRead(e){var s=object2xml("request",{Index:e});saveAjaxData("api/sms/set-read",s,(function(s){var t=xml2object(s);isAjaxReturnOK(t)&&($("#smsReadStates"+e).attr("class","msg_icon read_state1"),$("#smsReadStates"+e).parent().next("td").attr("class","sms_phone_number read_sta1"),setOpenSmsRead(e))}))}function setOpenSmsRead(e){$("#smsReadStates"+e).attr("style",""),$("#smsReadStates"+e).parent().next("td").attr("class","sms_phone_number red_color_font"),$("#smsReadStates"+e).parent().find(".msg_icon").addClass("red_color_font")}function checkNumberFormat(){var e=document.getElementById("recipients_number");if(""!=e.value){var s=e.value;strPhoneNumber2="";var t=/[-)+(]/g;s.length>0&&s.lastIndexOf(";")==s.length-1&&(s=s.substring(0,s.length-1),$("#recipients_number").val(s));var n=s.split(";"),_=sms_sendNumberCheck(n);if(1==bPhoneNumberFormatChange)for(var a=0;a<n.length;a++)n[a]=n[a].replace(t,"");1==_?(phone_number_format(),button_enable("pop_send","1")):button_enable("pop_send","0")}}function phone_number_format(){var e=document.getElementById("recipients_number"),s=e.value;bPhoneNumberFormatChange=!0,strPhoneNumber2="";for(var t=s.split(";"),n=/[-)+(]/g,_=0;_<t.length;_++){var a=t[_];if(a.length>9)if("+"==a[0]&&"7"==a[1]){a=a.replace(n,""),t[_]=a.replace(n,""),c={1:"(",4:")",7:"-",9:"-"},strPhoneNumber3="";for(var o=0;o<a.length;o++)strPhoneNumber3+=(c[o]||"")+a[o];strPhoneNumber3="+"+strPhoneNumber3,strPhoneNumber2+=strPhoneNumber3,_!=t.length-1&&(strPhoneNumber2+=";")}else if("8"==a[0]){for(a=a.replace(n,""),t[_]=a.replace(n,""),c={1:"(",4:")",7:"-",9:"-"},o=0;o<a.length;o++)strPhoneNumber2+=(c[o]||"")+a[o];_!=t.length-1&&(strPhoneNumber2+=";")}else if("7"==a[0]){for(a=a.replace(n,""),t[_]=a.replace(n,""),c={0:"+",1:"(",4:")",7:"-",9:"-"},o=0;o<a.length;o++)strPhoneNumber2+=(c[o]||"")+a[o];_!=t.length-1&&(strPhoneNumber2+=";")}else strPhoneNumber2+=a,_!=t.length-1&&(strPhoneNumber2+=";");else strPhoneNumber2+=a,_!=t.length-1&&(strPhoneNumber2+=";")}e.value=strPhoneNumber2}function phone_number_format_reverse(){var e="",s=/[-)(]/g;if(bPhoneNumberFormatChange){for(var t=document.getElementById("recipients_number"),n=t.value.split(";"),_=0;_<n.length;_++){n[_];e+=n[_].replace(s,""),_!=n.length-1&&(e+=";")}t.value=e}}$(document).ready((function(){"new"!=webui_mode||force_old_sms||$("#wrapper").css("display","none"),creatSmsContent(),("new"==webui_mode&&!force_old_sms||"old"==webui_mode&&force_new_sms)&&(setSmsText(),addSmsEvent(),""===window.location.hash&&(window.location.hash="received"),setSmsBox(smsBoxType=window.location.hash.slice(1)))}));
