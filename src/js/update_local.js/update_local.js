var g_updateStatus=0,UPDATE_STATUS_INTERVAL=3e3,UPDATE_DOWNLOAD_FAILED=20,UPDATE_DOWNLOAD_PROGRESSING=30,UPDATE_BATTERY_LOW=51,UPDATE_PROGRESSING=60,UPDATE_FAILED_HAVEDATA=70,UPDATE_FAILED_NODATA=80,UPDATE_SUCCESSFUL_HAVEDATA=90,UPDATE_SUCCESSFUL_NODATA=100,ONLINE_UPDATE_STATUS_INTERVAL=1e4;function update_uploadFile(){if($.isArray(g_requestVerificationToken)){if(!(g_requestVerificationToken.length>0))return void setTimeout((function(){update_uploadFile()}),50);$("#csrf_token").val("csrf:"+g_requestVerificationToken[0])}cancelLogoutTimer(),showWaitingDialog(common_updates,STRID_update_hint_dont_close_browse);var t={url:"../api/filemanager/upload",success:function(t,e){"string"==typeof t&&-1==t.toLowerCase().indexOf("ok")&&(closeWaitingDialog(),showConfirmDialog(update_label_failed),startLogoutTimer())}};$("#form_update").ajaxSubmit(t),clearTimeout(g_decive_timer),clearTimeout(g_simcard_timer),clearTimeout(g_heart_beat_timer),setTimeout(localUploadStatus,2*UPDATE_STATUS_INTERVAL)}function checkGoHome(){getAjaxData("api/user/state-login",(function(t){var e=xml2object(t);"response"==e.type&&0!=e.response.State&&gotoPageWithoutHistory("home.html")}),{sync:!0})}function localUploadStatus(){getAjaxData("api/monitoring/check-notifications",(function(t){var e=xml2object(t);if("response"==e.type){if(G_NotificationsStatus=e.response,(g_updateStatus=parseInt(G_NotificationsStatus.OnlineUpdateStatus,10))==UPDATE_FAILED_HAVEDATA||g_updateStatus==UPDATE_FAILED_NODATA||g_updateStatus==UPDATE_DOWNLOAD_FAILED)return closeWaitingDialog(),showConfirmDialog(update_label_failed,checkGoHome),void startLogoutTimer();if(g_updateStatus==UPDATE_SUCCESSFUL_HAVEDATA||g_updateStatus==UPDATE_SUCCESSFUL_NODATA)return closeWaitingDialog(),showConfirmDialog(system_up_to_date,checkGoHome),void startLogoutTimer();if(g_updateStatus==UPDATE_BATTERY_LOW)return closeWaitingDialog(),showConfirmDialog(IDS_update_battery_low_warning,checkGoHome),void startLogoutTimer()}setTimeout(localUploadStatus,UPDATE_STATUS_INTERVAL)}),{errorCB:function(){setTimeout(localUploadStatus,ONLINE_UPDATE_STATUS_INTERVAL)}})}function checkUploadFileName(){var t=$("#up_nodite").val();/\.bin$|\.zip$/i.test(t)?(clearAllErrorLabel(),button_enable("local_update","1")):(clearAllErrorLabel(),showErrorUnderTextbox("up_nodite",system_hint_file_name_empty),button_enable("local_update","0"))}function update_executeBeforeDocumentReady(){"-1"==g_coulometer_status&&getAjaxData("api/device/device-feature-switch",(function(t){var e=xml2object(t);"response"==e.type&&(g_coulometer_status=e.response.coulometer_enabled)}),{sync:!0}),IDS_update_battery_low_warning=coulometerCheck(IDS_update_battery_low_warning),STRID_update_hint_battery_prower_low=coulometerCheck(STRID_update_hint_battery_prower_low),"1"==g_feature.battery_enabled&&(STRID_update_hint_dont_close_browse+=STRID_update_hint_battery_prower_low)}update_executeBeforeDocumentReady(),$(document).ready((function(){button_enable("local_update","0"),$("#up_nodite").val(""),$("#up_nodite").change((function(){var t=$("#up_nodite").val();t.indexOf("\\")>-1&&(t=t.substring(t.lastIndexOf("\\")+1)),$("#textbox_path").val("OU:"+t),checkUploadFileName()})),$("#local_update").click((function(){getAjaxData("api/monitoring/status",(function(t){var e=xml2object(t);"response"==e.type&&(G_MonitoringStatus=e)}),{sync:!0}),1!=G_MonitoringStatus.response.voice_busy?isButtonEnable("local_update")&&(G_NotificationsStatus.OnlineUpdateStatus==UPDATE_DOWNLOAD_PROGRESSING||G_NotificationsStatus.OnlineUpdateStatus==UPDATE_PROGRESSING?showInfoDialog(IDS_update_updateing_try_again):update_uploadFile()):gotoPageWithoutHistory(VOICE_BUSY_URL)}))}));
