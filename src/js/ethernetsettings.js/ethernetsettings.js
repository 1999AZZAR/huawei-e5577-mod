var g_ethernet_dialmode_display="0",g_wan_select_mode=null,g_wan_dial_mode=null,g_ethernet_select_mode=null,g_ethernet_dial_mode=null,WANSETTING_AUTO="0",WANSETTING_PPPOE_DYNAMICIP="1",WANSETTING_PPPOE="2",WANSETTING_DYNAMICIP="3",WANSETTING_STATICIP="4",WANSETTING_LAN="5",g_cradledialInfo=null,CONNECTIONMODE={0:common_auto,1:IDS_ethernet_pppoe_plus_dynamic,2:IDS_wan_setting_pppoe,3:IDS_wan_setting_dynamicip,4:IDS_ethernet_setting_staticip,5:IDS_ethernet_settings_mode_lan},DIALINGMODE={0:common_auto,1:IDS_ethernet_dialing_ondemand},DIALING_AUTO="0",DIALING_ONDEMAND="1",g_setting_connMode=null,g_setting_dialMode=null,g_setting_connectionModeList=[[0,CONNECTIONMODE[0]],[1,CONNECTIONMODE[1]],[2,CONNECTIONMODE[2]],[3,CONNECTIONMODE[3]],[4,CONNECTIONMODE[4]],[5,CONNECTIONMODE[5]]],g_setting_dialModeList=[[0,DIALINGMODE[0]],[1,DIALINGMODE[1]]],MIN_SIZE_RANGE=576,DEFAULT_PPPOE_SIZE=1480,MAX_PPPOE_SIZE=1492,MAX_DYNAMIC_STATIC_SIZE=1500,MIN_CONN_TIME=30,MAX_CONN_TIME=7200,dhcp_data=null,dhcp_ipaddress=null,dhcp_netmask=null;function getDhcpData(){getAjaxData("api/dhcp/settings",(function(e){var t=xml2object(e);"response"==t.type&&(dhcp_data=t.response,dhcp_netmask=dhcp_data.DhcpLanNetmask,dhcp_ipaddress=dhcp_data.DhcpIPAddress)}))}function verifyIpInput(){clearAllErrorLabel();var e=$("#input_ip_address").val(),t=$("#input_subnet_mask").val(),_=$("#input_gate_way").val(),n=$("#input_dns_server").val(),a=$("#input_spare_server").val(),i=ipPlusip(t,dhcp_netmask),r=ipPlusip(e,i),s=ipPlusip(dhcp_ipaddress,i),d=ipPlusip(_,i),o=ipPlusip(n,i),l=ipPlusip(a,i);if(!validStaticIp(e))return showErrorUnderTr("ip_address",dialup_hint_ip_address_empty),$("#input_ip_address").focus(),$("#input_ip_address").val(""),!1;if(!isValidSubnetMask(t))return showErrorUnderTr("subnet_mask",IDS_ethernet_subnet_mask_error),$("#input_subnet_mask").focus(),$("#input_subnet_mask").val(""),!1;if(r==s)return showErrorUnderTr("ip_address",IDS_ethernet_vefify_ipdhcpip),$("#input_ip_address").focus(),$("#input_ip_address").val(""),!1;if(!obverseMask(e,t))return showErrorUnderTr("ip_address",dialup_hint_ip_address_empty),$("#input_ip_address").focus(),$("#input_ip_address").val(""),!1;if(!validStaticIp(_))return showErrorUnderTr("gate_way",IDS_ethernet_gateway_address_error),$("#input_gate_way").focus(),$("#input_gate_way").val(""),!1;if(d==s)return showErrorUnderTr("gate_way",IDS_ethernet_vefify_gatewaydhcpip),$("#input_gate_way").focus(),$("#input_gate_way").val(""),!1;if(!obverseMask(_,t))return showErrorUnderTr("gate_way",IDS_ethernet_gateway_address_error),$("#input_gate_way").focus(),$("#input_gate_way").val(""),!1;if(!isSameSubnetAddrs(e,_,t))return showErrorUnderTr("gate_way",IDS_ethernet_verify_ipgateway),$("#input_gate_way").focus(),$("#input_gate_way").val(""),!1;if(""!=n&&"0.0.0.0"!=n){if(!validStaticIp(n))return showErrorUnderTr("dns_server",IDS_ethernet_primary_dns),$("#input_dns_server").focus(),$("#input_dns_server").val(""),!1;if(o==s)return showErrorUnderTr("dns_server",IDS_ethernet_vefify_dnsdhcip),$("#input_dns_server").focus(),$("#input_dns_server").val(""),!1}if(""!=a&&"0.0.0.0"!=a){if(!validStaticIp(a))return showErrorUnderTr("spare_dns_server",IDS_ethernet_secondary_dns),$("#input_spare_server").focus(),$("#input_spare_server").val(""),!1;if(l==s)return showErrorUnderTr("spare_dns_server",IDS_ethernet_vefify_sparednsdhcip),$("#input_spare_server").focus(),$("#input_spare_server").val(""),!1}return!0}function ipPlusip(e,t){var _="",n=e.split("."),a=t.split(".");for(i=0;i<4;i++)_+=Number(n[i])&Number(a[i]),_+=".";return _.substring(0,_.length-1)}function validDynamicDns(){clearAllErrorLabel();var e=$.trim($("#dynamic_dns_server").val()),t=$.trim($("#dynamic_spare_server").val());if(WANSETTING_AUTO==g_ethernet_select_mode||WANSETTING_PPPOE_DYNAMICIP==g_ethernet_select_mode||WANSETTING_DYNAMICIP==g_ethernet_select_mode){if(!$("#dynamic_manual").attr("checked"))return!0;if(!validStaticIp(e))return showErrorUnderTr("set_primary_dns",IDS_ethernet_primary_dns),$("#dynamic_dns_server").focus(),$("#dynamic_dns_server").val(""),!1;if(""!=t&&"0.0.0.0"!=t&&!validStaticIp(t))return showErrorUnderTr("set_spare_dns",IDS_ethernet_secondary_dns),$("#dynamic_spare_server").focus(),$("#dynamic_spare_server").val(""),!1}return!0}function validMtusize(){clearAllErrorLabel();var e=$.trim($("#input_mtu_size").val()),t=$.trim($("#dynamic_mtu_size").val()),_=$.trim($("#static_mtu_size").val()),n=IDS_ethernet_mtu_size_range.replace("%d",MIN_SIZE_RANGE).replace("%e",MAX_PPPOE_SIZE),a=IDS_ethernet_mtu_size_range.replace("%d",MIN_SIZE_RANGE).replace("%e",MAX_DYNAMIC_STATIC_SIZE);return WANSETTING_AUTO!=g_ethernet_select_mode&&WANSETTING_PPPOE_DYNAMICIP!=g_ethernet_select_mode&&WANSETTING_PPPOE!=g_ethernet_select_mode||!(!IsDigital(e)||e<MIN_SIZE_RANGE||e>MAX_PPPOE_SIZE)?WANSETTING_AUTO!=g_ethernet_select_mode&&WANSETTING_PPPOE_DYNAMICIP!=g_ethernet_select_mode&&WANSETTING_DYNAMICIP!=g_ethernet_select_mode||!(!IsDigital(t)||t<MIN_SIZE_RANGE||t>MAX_DYNAMIC_STATIC_SIZE)?WANSETTING_STATICIP!=g_ethernet_select_mode||!(!IsDigital(_)||_<MIN_SIZE_RANGE||_>MAX_DYNAMIC_STATIC_SIZE)||($("#static_mtuinfo").hide(),showErrorUnderTr("static_mtusize",a),$("#static_mtu_size").focus(),$("#static_mtu_size").val(""),!1):($("#dynamic_mtuinfo").hide(),showErrorUnderTr("dynamic_mtusize",a),$("#dynamic_mtu_size").focus(),$("#dynamic_mtu_size").val(""),!1):($("#ondemand_mtuinfo").hide(),showErrorUnderTr("ondemand_mtusize",n),$("#input_mtu_size").focus(),$("#input_mtu_size").val(""),!1)}function validateUsernameAndPassword(){clearAllErrorLabel();var e=$.trim($("#input_ethernet_username").val()),t=$.trim($("#input_ethernet_password").val());return""==e||null==e?(showErrorUnderTr("ondemand_username",settings_hint_user_name_empty),$("#input_ethernet_username").focus(),$("#input_ethernet_username").val(""),!1):0==checkInputPPPoEChar(e)?(showErrorUnderTr("ondemand_username",IDS_ethernet_pppoe_username),$("#input_ethernet_username").focus(),$("#input_ethernet_username").val(""),!1):""==t||null==t?(showErrorUnderTr("ondemand_password",dialup_hint_password_empty),$("#input_ethernet_password").focus(),$("#input_ethernet_password").val(""),!1):0!=checkInputPPPoEChar(t)||(showErrorUnderTr("ondemand_password",IDS_ethernet_pppoe_password),$("#input_ethernet_password").focus(),$("#input_ethernet_password").val(""),!1)}function validateTime(){clearAllErrorLabel();var e=$.trim($("#input_disconn_time").val()),t=IDS_ethernet_idle_time.replace("%d",MIN_CONN_TIME).replace("%e",MAX_CONN_TIME);return!(!IsDigital(e)||e<MIN_CONN_TIME||e>MAX_CONN_TIME)||(showErrorUnderTr("auto_disconnect",t),$("#input_disconn_time").focus(),$("#input_disconn_time").val(""),!1)}function ethernetSettingApply(){if(isButtonEnable("apply_button")){clearAllErrorLabel(),g_ethernet_select_mode=$("#select_wan_connection_mode").val(),g_ethernet_dial_mode=$("#select_wan_dialing_mode").val();var e=null;if(WANSETTING_AUTO==g_ethernet_select_mode||WANSETTING_PPPOE_DYNAMICIP==g_ethernet_select_mode||WANSETTING_PPPOE==g_ethernet_select_mode){if(!validateUsernameAndPassword())return;if(g_ethernet_dial_mode==DIALING_ONDEMAND&&!validateTime())return;if(!validMtusize())return;if(WANSETTING_PPPOE!=g_ethernet_select_mode&&!validDynamicDns())return}else if(WANSETTING_DYNAMICIP==g_ethernet_select_mode){if(!validMtusize())return;if(!validDynamicDns())return}else if(WANSETTING_STATICIP==g_ethernet_select_mode){if(!verifyIpInput())return;if(!validMtusize())return}else WANSETTING_LAN==g_ethernet_select_mode&&(g_ethernet_select_mode=$("#select_wan_connection_mode").val());var t=$.trim($("#input_ethernet_username").val()),_=wifiSsidResolveCannotParseChar(t),n=$.trim($("#input_ethernet_password").val()),a=wifiSsidResolveCannotParseChar(n),i=$.trim($("#input_disconn_time").val()),r=$.trim($("#input_mtu_size").val()),s=$.trim($("#dynamic_mtu_size").val()),d=$.trim($("#static_mtu_size").val()),o=$.trim($("#input_ip_address").val()),l=$.trim($("#input_subnet_mask").val()),c=$.trim($("#input_gate_way").val());""!=c&&"0.0.0.0"!=c||(c="0.0.0.0");var p=$.trim($("#input_dns_server").val());""!=p&&"0.0.0.0"!=p||(p="0.0.0.0");var u=$.trim($("#input_spare_server").val());""!=u&&"0.0.0.0"!=u||(u="0.0.0.0");var m=$.trim($("#dynamic_dns_server").val()),I=$.trim($("#dynamic_spare_server").val());$("#dynamic_manual").attr("checked")?(setDynamicDns="1",""==I&&(I="0.0.0.0")):(setDynamicDns="0",m="0.0.0.0",I="0.0.0.0"),e={connectionmode:g_ethernet_select_mode,pppoeuser:_,pppoepwd:a,dialmode:g_ethernet_dial_mode,maxidletime:i,pppoemtu:r,dynamicipmtu:s,ipaddress:o,netmask:l,gateway:c,primarydns:p,secondarydns:u,staticipmtu:d,dynamicsetdnsmanual:setDynamicDns,dynamicprimarydns:m,dynamicsecondarydns:I},button_enable("apply_button","0"),checkPostIndex(0)&&delete e.pppoepwd;var h=object2xml("request",e);saveAjaxData("api/cradle/basic-info",h,(function(e){mousedownIndexList=[];var t=xml2object(e);isAjaxReturnOK(t)?(showInfoDialog(common_success),button_enable("apply_button","0"),initEthernet()):(showInfoDialog(common_failed),button_enable("apply_button","1"))}),{enc:!0})}}function wan_setting_initSelectOption(){var e="";$.each(g_setting_connectionModeList,(function(t,_){e='<option style="vertical-align:middle;" value = '+_[0]+">"+_[1]+"</option>",$("#select_wan_connection_mode").append(e)}));var t="";$.each(g_setting_dialModeList,(function(e,_){t="<option value = "+_[0]+">"+_[1]+"</option>",$("#select_wan_dialing_mode").append(t)}))}function initEthernet(){getAjaxData("api/cradle/basic-info",(function(e){var t=xml2object(e);"response"==t.type?(g_cradledialInfo=t.response,void 0!==g_moduleswitch.encrypt_enabled&&1==g_moduleswitch.encrypt_enabled&&void 0!==g_cradledialInfo.pppoeuser&&null!=g_cradledialInfo.pppoeuser&&""!=g_cradledialInfo.pppoeuser&&(g_cradledialInfo.pppoepwd=COMMON_PASSWORD_VALUE),init_select_value(),wansetting_select_mode()):showInfoDialog(common_failed)}),{sync:!0})}function init_ethernet_value(){$("#select_wan_dialing_mode").val(g_cradledialInfo.dialmode),$("#input_ethernet_username").val(g_cradledialInfo.pppoeuser),$("#input_ethernet_password").val(g_cradledialInfo.pppoepwd),$("#input_disconn_time").val(g_cradledialInfo.maxidletime),$("#input_ip_address").val(g_cradledialInfo.ipaddress),$("#input_subnet_mask").val(g_cradledialInfo.netmask),$("#input_gate_way").val(g_cradledialInfo.gateway),$("#input_dns_server").val(g_cradledialInfo.primarydns),$("#input_spare_server").val(g_cradledialInfo.secondarydns),$("#static_mtu_size").val(g_cradledialInfo.staticipmtu),$("#dynamic_mtu_size").val(g_cradledialInfo.dynamicipmtu),"1"==g_cradledialInfo.dynamicsetdnsmanual?($("#dynamic_manual").attr("checked",!0),$("#dynamic_dns_server").removeAttr("disabled"),$("#dynamic_spare_server").removeAttr("disabled")):($("#dynamic_manual").attr("checked",!1),$("#dynamic_dns_server").attr("disabled",!0),$("#dynamic_spare_server").attr("disabled",!0)),$("#dynamic_dns_server").val(g_cradledialInfo.dynamicprimarydns),$("#dynamic_spare_server").val(g_cradledialInfo.dynamicsecondarydns),$("#input_mtu_size").val(g_cradledialInfo.pppoemtu),$("#ondemand_mtuinfo").show(),$("#dynamic_mtuinfo").show(),$("#static_mtuinfo").show()}function init_select_value(){$("#select_wan_connection_mode").val(g_cradledialInfo.connectionmode),g_setting_connMode=$("#select_wan_connection_mode").val(),init_ethernet_value()}function wansetting_select_mode(){clearAllErrorLabel(),$("#pppoe_cut_line").hide(),$("#user_table").hide(),$("#static_table").hide(),$("#dynamic_mtu_line").hide(),$("#dynamic_mtu_table").hide(),$(".set_dns_manual").hide();var e=IDS_ethernet_default_mtu.replace("%d",DEFAULT_PPPOE_SIZE);$("#pppoe_default_mtu").text(e);var t=IDS_ethernet_default_mtu.replace("%d",MAX_DYNAMIC_STATIC_SIZE);$("#dynamic_default_mtu").text(t),$("#static_default_mtu").text(t),WANSETTING_AUTO==g_setting_connMode||WANSETTING_PPPOE_DYNAMICIP==g_setting_connMode?($("#pppoe_cut_line").show(),$("#user_table").show(),$("#dynamic_mtu_line").show(),$("#dynamic_mtu_table").show(),$(".set_dns_manual").show(),WANSETTING_AUTO==g_setting_connMode?$("#option_change_showinfo").html(IDS_ethernet_auto_clew_msg):WANSETTING_PPPOE_DYNAMICIP==g_setting_connMode&&$("#option_change_showinfo").html(IDS_ethernet_pppoe_dynamic_clew_msg)):WANSETTING_PPPOE==g_setting_connMode?($("#user_table").show(),$("#option_change_showinfo").html(IDS_ethernet_pppoe_clew_msg)):WANSETTING_DYNAMICIP==g_setting_connMode?($("#option_change_showinfo").html(IDS_ethernet_dynamic_clew_msg),$("#dynamic_mtu_table").show(),$(".set_dns_manual").show()):WANSETTING_STATICIP==g_setting_connMode?($("#option_change_showinfo").html(IDS_ethernet_static_clew_msg),$("#static_table").show()):WANSETTING_LAN==g_setting_connMode&&$("#option_change_showinfo").html(IDS_ethernet_lan_clew_msg),$("#select_wan_dialing_mode").val(g_cradledialInfo.dialmode),wanSetting_dialMode(g_cradledialInfo.dialmode)}function wanSetting_dialMode(e){clearAllErrorLabel(),e==DIALING_ONDEMAND?$("#input_disconn_time").val(g_cradledialInfo.maxidletime):e==DIALING_AUTO&&$("#auto_disconnect").hide()}function initDnsSetup(){clearAllErrorLabel(),$("#dynamic_manual").attr("checked")?($("#dynamic_dns_server").removeAttr("disabled"),$("#dynamic_spare_server").removeAttr("disabled"),$("#dynamic_dns_server").val(g_cradledialInfo.dynamicprimarydns),$("#dynamic_spare_server").val(g_cradledialInfo.dynamicsecondarydns)):($("#dynamic_dns_server").attr("disabled",!0),$("#dynamic_spare_server").attr("disabled",!0),$("#dynamic_dns_server").val("0.0.0.0"),$("#dynamic_spare_server").val("0.0.0.0"))}$(document).ready((function(){clickPasswordEvent("input_ethernet_password",0),button_enable("apply_button","0"),$("input").bind("change input paste cut keydown",(function(e){MACRO_KEYCODE!=e.keyCode&&button_enable("apply_button","1")})),wan_setting_initSelectOption(),initEthernet(),getAjaxData("api/cradle/feature-switch",(function(e){var t=xml2object(e);"response"==t.type&&("1"==(g_ethernet_dialmode_display=t.response.dialmode_display)?($("#dial").show(),"1"==g_cradledialInfo.dialmode&&$("#auto_disconnect").show()):($("#dial").hide(),$("#auto_disconnect").hide()))})),$("#select_wan_connection_mode").change((function(){g_setting_connMode=$("#select_wan_connection_mode").val(),init_ethernet_value(),wansetting_select_mode(),"1"==g_cradledialInfo.dialmode&&"1"==g_ethernet_dialmode_display&&$("#auto_disconnect").show(),button_enable("apply_button","1")})),$("#select_wan_dialing_mode").change((function(){1==this.value&&$("#auto_disconnect").show(),wanSetting_dialMode(this.value),button_enable("apply_button","1")})),$("#dynamic_manual").bind("click",initDnsSetup),getDhcpData(),$("#apply_button").bind("click",ethernetSettingApply)}));
