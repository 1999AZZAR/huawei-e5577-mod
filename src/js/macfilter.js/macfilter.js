var FWMACFILTER_POLICY_DISABLED=0,FWMACFILTER_POLICY_ALLOW=1,FWMACFILTER_POLICY_DENY=2,MAX_MAC_FILTER_NUM=10,g_MacfilterData={policy:FWMACFILTER_POLICY_DISABLED,macInfo:[]};function initPage(){getAjaxData("api/security/firewall-switch",(function(a){var t=xml2object(a);"response"==t.type&&(firewall_status=t.response)}),{sync:!0}),getAjaxData("api/security/mac-filter",(function(a){var t=xml2object(a),i=t.response.policy,e=t.response.macfilters.macfilter;return g_MacfilterData.policy=0==i?FWMACFILTER_POLICY_DENY:1==i?FWMACFILTER_POLICY_ALLOW:FWMACFILTER_POLICY_DISABLED,e?(g_MacfilterData.macInfo=CreateArray(e),0!=e.length&&0!=g_MacfilterData.macInfo[0].status||(g_MacfilterData.policy=FWMACFILTER_POLICY_DISABLED)):g_MacfilterData.policy=FWMACFILTER_POLICY_DISABLED,setData(),null!=firewall_status&&0==firewall_status.FirewallMainSwitch?($("#fw_mac_policy").attr("disabled","disabled"),$("#fw_mac_list :input").attr("disabled","disabled"),showInfoDialog(IDS_security_message_firewall_disabled),!1):null!=firewall_status&&0==firewall_status.firewallmacfilterswitch?($("#fw_mac_policy").attr("disabled","disabled"),$("#fw_mac_list :input").attr("disabled","disabled"),showInfoDialog(IDS_security_macfilter_message_disabled),!1):void 0}),{sync:!0})}function fwmacfilter_SetInputAttr(){$("#fw_mac_policy").val()==FWMACFILTER_POLICY_DISABLED?(clearData(),$("#fw_mac_list :input").attr("disabled","disabled")):$("#fw_mac_list :input").removeAttr("disabled")}function clearData(){$("#fw_mac_list :input").val("")}function setData(){var a=0;if($("#fw_mac_policy").val(g_MacfilterData.policy),FWMACFILTER_POLICY_DISABLED!=g_MacfilterData.policy)for(;MAX_MAC_FILTER_NUM>a;a++)g_MacfilterData.macInfo.length>a?$("#input_fwMacFilterMac"+a).val(g_MacfilterData.macInfo[a].value):$("#input_fwMacFilterMac"+a).val("");fwmacfilter_SetInputAttr()}function getData(){var a=0;if(g_MacfilterData.policy=$("#fw_mac_policy").val(),g_MacfilterData.macInfo=[],FWMACFILTER_POLICY_DISABLED!=g_MacfilterData.policy)for(;MAX_MAC_FILTER_NUM>a;a++){var t=$.trim($("#input_fwMacFilterMac"+a).val());if(""!=t){var i={value:t,status:1};g_MacfilterData.macInfo.push(i)}}}function isValidMacAddress(a){var t=0,i=0,e=0;if("ff:ff:ff:ff:ff:ff"==(a=(a=$.trim(a)).toLowerCase())||"00:00:00:00:00:00"==a)return!1;var l=a.split(":");if(6!=l.length)return!1;for(i=0;i<6;i++){if(2!=l[i].length)return!1;for(e=0;e<l[i].length;e++)if(!((t=l[i].charAt(e))>="0"&&t<="9"||t>="a"&&t<="f"))return!1}return!((t=parseInt(l[0].charAt(1),16))%2)}function checkAllMac(){var a=!0,t=0;if($("#fw_mac_list :input").each((function(i){$.trim($(this).val()).length>0&&!isValidMacAddress($(this).val())||0==$.trim($(this).val()).length&&$(this).val().length>0?($(this).focus(),showErrorUnderTextbox("input_fwMacFilterMac"+i,wlan_hint_mac_address_invalid),a=!1):0==$(this).val().length&&t++})),10==t){var i=$("#fw_mac_policy").val();FWMACFILTER_POLICY_DISABLED!=i&&(showInfoDialog(wlan_hint_mac_address_invalid),$.browser.msie||$("#input_fwMacFilterMac0").focus(),a=!1)}return a}function onApply(){clearAllErrorLabel(),checkAllMac()&&showConfirmDialog(firewall_hint_submit_list_item,postData,(function(){}))}function postData(){var a,t=[],i=0,e=0;for(getData(),FWMACFILTER_POLICY_DISABLED!=g_MacfilterData.policy&&(i=1);MAX_MAC_FILTER_NUM>e&&g_MacfilterData.macInfo.length>e;e++){var l={value:g_MacfilterData.macInfo[e].value,status:i};t.push(l)}a={policy:g_MacfilterData.policy,macfilters:{macfilter:t}};var r=object2xml("request",a);saveAjaxData("api/security/mac-filter",r,(function(a){var t=xml2object(a);isAjaxReturnOK(t)?($("#macfilter_input").hide(),initPage(),showInfoDialog(common_success),button_enable("apply","0")):void 0!==t.error&&t.error.code==ERROR_SYSTEM_BUSY?showInfoDialog(common_system_busy):showInfoDialog(common_fail)}))}function checkRepeat(){clearAllErrorLabel();for(var a=[],t="",i=!0,e=0;e<10;e++)t=$.trim($("#input_fwMacFilterMac"+e).val()).toLowerCase(),a.push(t);for(e=0;e<a.length;e++)for(var l=e+1;l<a.length;l++){var r=a[e],c=a[l];if(r==c&&r.length>0&&c.length>0)return showErrorUnderTextbox("input_fwMacFilterMac"+l,wlan_label_mac_address_exist),$("#input_fwMacFilterMac"+l).focus(),void(i=!1)}return i}$(document).ready((function(){button_enable("apply","0"),$("#fw_mac_list :input").val(""),$("#fw_mac_list :input").removeAttr("disabled"),initPage(),$("#fw_mac_list :input").bind("input change cut paste keydown",(function(a){MACRO_KEYCODE!=a.keyCode&&button_enable("apply","1")})),$("#apply").click((function(){isButtonEnable("apply")&&checkRepeat()&&onApply()})),$("#fw_mac_policy").bind("change",(function(){var a=$("#fw_mac_policy").val();fwmacfilter_SetInputAttr(),$(".error_message").remove(),a==g_MacfilterData.policy?(setData(),button_enable("apply","0")):(clearData(),button_enable("apply","1"))}))}));
