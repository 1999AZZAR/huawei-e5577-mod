var g_server=null;function get_data(){g_server.proxyserveraddress=$.trim($("#input_proxyserveradd").val()),g_server.proxyserverport=$.trim($("#input_proxyserverport").val()),g_server.registerserveraddress=$.trim($("#input_regserveradd").val()),g_server.registerserverport=$.trim($("#input_regserverport").val()),g_server.sipserverdomain=$.trim($("#input_regserverdoma").val()),1==$("#check_snd").get(0).checked?(g_server.secondproxyserveraddress=$.trim($("#input_snd_proxyserveradd").val()),g_server.secondproxyserverport=$.trim($("#input_snd_proxyserverport").val()),g_server.secondregisterserveraddress=$.trim($("#input_snd_regserveradd").val()),g_server.secondregisterserverport=$.trim($("#input_snd_regserverport").val()),g_server.secondsipserverdomain=$.trim($("#input_snd_regserverdoma").val())):(g_server.secondproxyserveraddress="",g_server.secondregisterserveraddress="",g_server.secondsipserverdomain="")}function set_data(){$("#input_proxyserveradd").val(g_server.proxyserveraddress),$("#input_proxyserverport").val(g_server.proxyserverport),$("#input_regserveradd").val(g_server.registerserveraddress),$("#input_regserverport").val(g_server.registerserverport),$("#input_regserverdoma").val(g_server.sipserverdomain),$("#input_snd_proxyserveradd").val(g_server.secondproxyserveraddress),$("#input_snd_proxyserverport").val(g_server.secondproxyserverport),$("#input_snd_regserveradd").val(g_server.secondregisterserveraddress),$("#input_snd_regserverport").val(g_server.secondregisterserverport),$("#input_snd_regserverdoma").val(g_server.secondsipserverdomain),""!=g_server.secondproxyserveraddress||""!=g_server.secondregisterserveraddress||""!=g_server.secondsipserverdomain?$("#check_snd").attr("checked",1):$("#check_snd").attr("checked",0)}function apply(){if(clearAllErrorLabel(),!check_server())return!1;get_data(),button_enable("apply","0");var r=object2xml("request",{sipserver:g_server});saveAjaxData("api/voice/sipserver",r,(function(r){var e=xml2object(r);isAjaxReturnOK(e)?(init_server(),showInfoDialog(common_success)):(button_enable("apply","1"),void 0!==e.error&&e.error.code==ERROR_SYSTEM_BUSY?showInfoDialog(common_system_busy):showInfoDialog(common_fail))}))}function init_server(){getAjaxData("api/voice/sipserver",(function(r){var e=xml2object(r);"response"==e.type&&(g_server=e.response.sipserver,set_data())}),{sync:!0})}function show_hide_snd(){1==$("#check_snd").get(0).checked?($("#tr_snd_proxyserveradd").show(),$("#tr_snd_proxyserverport").show(),$("#tr_snd_regserveradd").show(),$("#tr_snd_regserverport").show(),$("#tr_snd_regserverdoma").show()):(clearAllErrorLabel(),$("#tr_snd_proxyserveradd").hide(),$("#tr_snd_proxyserverport").hide(),$("#tr_snd_regserveradd").hide(),$("#tr_snd_regserverport").hide(),$("#tr_snd_regserverdoma").hide())}function check_port(r){return!!IsDigital(r)&&!(1>r||r>65535)}function isValidAscIICharset(r){var e=0;for(e=0;e<r.length;e++)if(!(r.charCodeAt(e)>=33&&r.charCodeAt(e)<=126))return!1;return!0}function isVaildDomainNameChar(r){if(""==r)return!1;for(j=0;j<r.length;j++){var e=r.charAt(j);if(!(e>="a"&&e<="z")&&!(e>="A"&&e<="Z"||e>="0"&&e<="9"||"-"==e||"."==e))return!1}return!0}function isStartWithChar(r){return/^[a-zA-Z]/.test(r)}function isValidDomainName(r){return!(!isValidAscIICharset(r)||!isVaildDomainNameChar(r))&&(!(-1==r.indexOf(".")&&""!=r||-1!=r.indexOf(".")&&1==r.length)&&!(/\.$/.exec(r)||/^\./.exec(r)||/-$/.exec(r)||/^-/.exec(r)))}function isInteger(r){return!!/^(\+|-)?\d+$/.test(r)}function isPlusInteger(r){return!!(isInteger(r)&&parseInt(r,10)>=0)}function isIpFormat(r){var e=r.split(".");if(4!=e.length)return!1;for(var s=0;s<e.length;s++)if(0==isPlusInteger(e[s]))return!1;return!0}function isValid_IpAddress(r){var e=0;if("0.0.0.0"==r||"255.255.255.255"==r)return!1;var s=r.split(".");if(4!=s.length)return!1;for(e=0;e<4;e++){if(isNaN(s[e])||""==s[e]||"+"==s[e].charAt(0)||"-"==s[e].charAt(0)||"0"==s[e].charAt(0)&&s[e].length>1)return!1;if(s[e].length>3||s[e].length<1)return!1;if(!isInteger(s[e])||s[e]<0)return!1;if(num=parseInt(s[e],10),0==e&&0==num)return!1;if(num<0||num>255)return!1}return!0}function isWanAbc_IpAddress(r){if(0==isValid_IpAddress(r))return!1;var e,s=r.split(".");return!((e=parseInt(s[0],10))<1||e>=224||127==e)}function is_ValidUrl(r){var e=r.match("^[https:/]*([^/]*)");if(e[1]){var s=e[1].match("^([A-Za-z0-9-_]+.){1,}([A-Za-z]+)$");try{return s[0]}catch(r){}}return!1}function Check_IsValidDomain(r,e){return!(r.length=r.length>e)&&0!=isValidDomainName(r)}function CheckisValidIPDomain(r,e){if(""==r)return!1;if(isIpFormat(r)){if(0==isWanAbc_IpAddress(r))return!1}else if(0==Check_IsValidDomain(r,e))return!1;return!0}function check_server(r){if(0==CheckisValidIPDomain($.trim($("#input_proxyserveradd").val())))return showErrorUnderTrEx("input_proxyserveradd",IDS_VOIP_SipServerErrStr3),!1;if(!check_port($.trim($("#input_proxyserverport").val())))return showErrorUnderTrEx("input_proxyserverport",IDS_VOIP_SipServerErrStr5),!1;if(0==CheckisValidIPDomain($.trim($("#input_regserveradd").val())))return showErrorUnderTrEx("input_regserveradd",IDS_VOIP_SipServerErrStr1),!1;if(!check_port($.trim($("#input_regserverport").val())))return showErrorUnderTrEx("input_regserverport",IDS_VOIP_SipServerErrStr2),!1;if($.trim($("#input_regserverport").val())==$.trim(g_server.useragentport))return showErrorUnderTrEx("input_regserverport",IDS_VOIP_VoiceAdvanceErrStr10),!1;var e=$.trim($("#input_regserverdoma").val());if(!(""==e||isValidAscIICharset(e)&&isVaildDomainNameChar(e)))return showErrorUnderTrEx("input_regserverdoma",IDS_security_urlfilter_error),!1;if(-1==e.indexOf(".")&&""!=e||-1!=e.indexOf(".")&&1==e.length)return showErrorUnderTrEx("input_regserverdoma",IDS_security_sip_domain_contain),!1;if(/\.$/.exec(e)||/^\./.exec(e)||/-$/.exec(e)||/^-/.exec(e))return showErrorUnderTrEx("input_regserverdoma",IDS_security_domain_dot_char),!1;if(1==$("#check_snd").get(0).checked){var s=$.trim($("#input_snd_proxyserveradd").val());if(""!=s&&0==CheckisValidIPDomain(s))return showErrorUnderTrEx("input_snd_proxyserveradd",IDS_VOIP_SipServerErrStr3),!1;if(!check_port($.trim($("#input_snd_proxyserverport").val())))return showErrorUnderTrEx("input_snd_proxyserverport",IDS_VOIP_SipServerErrStr5),!1;var t=$.trim($("#input_snd_regserveradd").val());if(""!=t&&0==CheckisValidIPDomain(t))return showErrorUnderTrEx("input_snd_regserveradd",IDS_VOIP_SipServerErrStr1),!1;if($.trim($("#input_regserveradd").val())==$.trim($("#input_snd_regserveradd").val()))return showErrorUnderTrEx("input_snd_regserveradd",IDS_VOIP_SipServerErrStr9),!1;if(!check_port($.trim($("#input_snd_regserverport").val())))return showErrorUnderTrEx("input_snd_regserverport",IDS_VOIP_SipServerErrStr2),!1;var n=$.trim($("#input_snd_regserverdoma").val());if(!(""==n||isValidAscIICharset(n)&&isVaildDomainNameChar(n)))return showErrorUnderTrEx("input_snd_regserverdoma",IDS_security_urlfilter_error),!1;if(-1==n.indexOf(".")&&""!=n||-1!=n.indexOf(".")&&1==n.length)return showErrorUnderTrEx("input_snd_regserverdoma",IDS_security_sip_domain_contain),!1;if(/\.$/.exec(n)||/^\./.exec(n)||/-$/.exec(n)||/^-/.exec(n))return showErrorUnderTrEx("input_snd_regserverdoma",IDS_security_domain_dot_char),!1;if($.trim($("#input_snd_regserverdoma").val())==$.trim($("#input_regserverdoma").val())&&""!=$.trim($("#input_snd_regserverdoma").val()))return showErrorUnderTrEx("input_snd_regserverdoma",IDS_VOIP_SipServerErrStr9),!1}return!0}$(document).ready((function(){init_server(),show_hide_snd(),$("#apply").click((function(){isButtonEnable("apply")&&apply()})),$("#check_snd").click((function(){button_enable("apply","1"),show_hide_snd()})),button_enable("apply","0"),$(".input_style").bind("input change cut paste keydown",(function(r){MACRO_KEYCODE!=r.keyCode&&button_enable("apply","1")}))}));
