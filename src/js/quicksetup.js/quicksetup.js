var passWordStrength=0,encryption_mode=0,g_quicksetup_wifiBasicData=[],g_quicksetup_wifiSecurityData=[],g_quicksetup_old_wifiBasicData=[],g_quicksetup_old_wifiSecurityData=[],g_quicksetup_saveDataOK=!1,g_quicksetup_saveWlanDataOK=!1,g_quicksetup_savePasswordOK=!1,g_quicksetup_nochangepwd_saveDataOK=!1,QUICKSETUP_WIFIAUTHMODE_AUTO="AUTO",QUICKSETUP_WIFIAUTHMODE_OPEN="OPEN",QUICKSETUP_WIFIAUTHMODE_SHARE="SHARE",QUICKSETUP_WIFIAUTHMODE_WPA_PSK="WPA-PSK",QUICKSETUP_WIFIAUTHMODE_WPA2_PSK="WPA2-PSK",QUICKSETUP_WIFIAUTHMODE_WPA_WPA2_PSK="WPA/WPA2-PSK",QUICKSETUP_WIFIBASICENCRYPMODE_NONE="NONE",QUICKSETUP_WIFIBASICENCRYPMODE_WEP="WEP",g_backup_pwd=[],g_quicksetup="",QUICK_SETUP_STEP1=1,QUICK_SETUP_STEP2=2,QUICK_SETUP_STEP3=3,SETUP_STEP1_WLAN=1,SETUP_STEP2_UPDATE=2,SETUP_STEP3_PASSWORD=3,MODIFYPASSWORD_SHOW=108008,g_auto_update_ret="",COMMON_WEP_PASSWORD_VALUE="*****",supportFeatureSwitch_flag=!1,g_backup_ssid_name="";function getDAesString(e,i,s){i=CryptoJS.enc.Hex.parse(i),s=CryptoJS.enc.Hex.parse(s);return CryptoJS.AES.decrypt(e,i,{iv:s,mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7}).toString(CryptoJS.enc.Latin1)}function quicksetup_initPage_wifi(){getAjaxData("api/wlan/security-settings",(function(e){var i=xml2object(e);if("response"==i.type&&(g_quicksetup_wifiSecurityData=i.response,1==g_scarm_login)){var s=CryptoJS.SCRAM(),t=s.nonce().toString(),a=s.nonce().toString(),_=doRSAEncrypt(t+a),r=object2xml("request",{module:"wlan",nonce:_});saveAjaxData("api/user/pwd",r,(function(e){var i=xml2object(e);if("response"==i.type){var _=i.response.pwd,r=CryptoJS.enc.Hex.parse(a),n=i.response.iter,o=s.saltedPassword(t,r,n),c=(o=o.toString()).substring(0,32),u=o.substring(32,48),p=o.substring(48,64),d=s.signature(CryptoJS.enc.Hex.parse(_),CryptoJS.enc.Hex.parse(p));if(d=d.toString(),i.response.hash==d){var f,w=getDAesString(CryptoJS.enc.Base64.stringify(CryptoJS.enc.Hex.parse(_)),c,u);if("string"==typeof(w=XSS_UnescapesSpecialChar(w.substring(w.indexOf("<response>"))))||"number"==typeof w)if(window.ActiveXObject)(f=new ActiveXObject("Microsoft.XMLDOM")).async=!1,f.loadXML(w);else f=(new DOMParser).parseFromString(w,"text/xml");else f=w;var l=xml2object($(f));if("response"==l.type){var g=l.response.Ssids.Ssid;g_quicksetup_wifiSecurityData.WifiWpapsk=g.WifiWpapsk,g_quicksetup_wifiSecurityData.WifiWepKey1=g.WifiWepKey1,g_quicksetup_wifiSecurityData.WifiWepKey2=g.WifiWepKey2,g_quicksetup_wifiSecurityData.WifiWepKey3=g.WifiWepKey3,g_quicksetup_wifiSecurityData.WifiWepKey4=g.WifiWepKey4}}}}),{sync:!0})}}),{sync:!0}),getAjaxData("api/wlan/basic-settings",(function(e){var i=xml2object(e);"response"==i.type&&(g_quicksetup=i.response)}),{sync:!0});var e={WifiSsid:g_quicksetup.WifiSsid,WifiEnable:g_quicksetup.WifiEnable,WifiAuthmode:g_quicksetup_wifiSecurityData.WifiAuthmode,WifiWepKey1:g_quicksetup_wifiSecurityData.WifiWepKey1,WifiBasicencryptionmodes:g_quicksetup_wifiSecurityData.WifiBasicencryptionmodes,WifiWpapsk:g_quicksetup_wifiSecurityData.WifiWpapsk};$(".editordisable").removeAttr("disabled"),$("#ssid_wifiName").val(e.WifiSsid),QUICKSETUP_WIFIAUTHMODE_AUTO==e.WifiAuthmode||QUICKSETUP_WIFIAUTHMODE_OPEN==e.WifiAuthmode||QUICKSETUP_WIFIAUTHMODE_SHARE==e.WifiAuthmode?($("#div_ssid_encrypt_way1").show(),$("#div_ssid_encrypt_way2").hide(),$("#ssid_neworkKey1").val(e.WifiWepKey1),QUICKSETUP_WIFIBASICENCRYPMODE_NONE==e.WifiBasicencryptionmodes?$("#ssid_network_key").hide():QUICKSETUP_WIFIBASICENCRYPMODE_WEP==e.WifiBasicencryptionmodes&&$("#ssid_network_key").show()):($("#div_ssid_encrypt_way2").show(),$("#div_ssid_encrypt_way1").hide(),$("#ssid_wpa_key").val(e.WifiWpapsk)),0==e.WifiEnable&&$(".editordisable").attr("disabled","disabled"),g_quicksetup_wifiBasicData.push(e)}function quicksetup_initPage_wifiMultiSSID(){getAjaxData("api/wlan/multi-basic-settings",(function(e){var i=xml2object(e);if("response"==i.type){if(g_quicksetup_wifiBasicData=CreateArray(i.response.Ssids.Ssid),1==g_scarm_login){var s=CryptoJS.SCRAM(),t=s.nonce().toString(),a=s.nonce().toString(),_=doRSAEncrypt(t+a),r=object2xml("request",{module:"wlan",nonce:_});saveAjaxData("api/user/pwd",r,(function(e){var i=xml2object(e);if("response"==i.type){var _=i.response.pwd,r=CryptoJS.enc.Hex.parse(a),n=i.response.iter,o=s.saltedPassword(t,r,n),c=(o=o.toString()).substring(0,32),u=o.substring(32,48),p=o.substring(48,64),d=s.signature(CryptoJS.enc.Hex.parse(_),CryptoJS.enc.Hex.parse(p));if(d=d.toString(),i.response.hash==d){var f,w=getDAesString(CryptoJS.enc.Base64.stringify(CryptoJS.enc.Hex.parse(_)),c,u);if("string"==typeof(w=XSS_UnescapesSpecialChar(w.substring(w.indexOf("<response>"))))||"number"==typeof w)if(window.ActiveXObject)(f=new ActiveXObject("Microsoft.XMLDOM")).async=!1,f.loadXML(w);else f=(new DOMParser).parseFromString(w,"text/xml");else f=w;var l=xml2object($(f));if("response"==l.type){var g=l.response.Ssids.Ssid,k=CreateArray(g);$(g_quicksetup_wifiBasicData).each((function(e){g_quicksetup_wifiBasicData[e].WifiWpapsk=k[e].WifiWpapsk,g_quicksetup_wifiBasicData[e].MixWifiWpapsk=k[e].MixWifiWpapsk,g_quicksetup_wifiBasicData[e].WifiWepKey1=k[e].WifiWepKey1,g_quicksetup_wifiBasicData[e].WifiWepKey2=k[e].WifiWepKey2,g_quicksetup_wifiBasicData[e].WifiWepKey3=k[e].WifiWepKey3,g_quicksetup_wifiBasicData[e].WifiWepKey4=k[e].WifiWepKey4}))}}}}),{sync:!0})}$(g_quicksetup_wifiBasicData).each((function(e){var i={};i.WifiWpapsk=g_quicksetup_wifiBasicData[e].WifiWpapsk,i.WifiWepKey1=g_quicksetup_wifiBasicData[e].WifiWepKey1,g_backup_pwd.push(i),delete g_quicksetup_wifiBasicData[e].WifiWep128Key1,delete g_quicksetup_wifiBasicData[e].WifiWep128Key2,delete g_quicksetup_wifiBasicData[e].WifiWep128Key3,delete g_quicksetup_wifiBasicData[e].WifiWep128Key4})),showData(g_quicksetup_wifiBasicData[0])}}),{sync:!0})}function showData(e){$(".editordisable").removeAttr("disabled"),$("#ssid_wifiName").val(e.WifiSsid),g_backup_ssid_name=e.WifiSsid,QUICKSETUP_WIFIAUTHMODE_AUTO==e.WifiAuthmode||QUICKSETUP_WIFIAUTHMODE_OPEN==e.WifiAuthmode||QUICKSETUP_WIFIAUTHMODE_SHARE==e.WifiAuthmode?($("#div_ssid_encrypt_way1").show(),$("#div_ssid_encrypt_way2").hide(),$("#ssid_neworkKey1").val(e.WifiWepKey1),QUICKSETUP_WIFIBASICENCRYPMODE_NONE==e.WifiBasicencryptionmodes?$("#ssid_network_key").hide():QUICKSETUP_WIFIBASICENCRYPMODE_WEP==e.WifiBasicencryptionmodes&&$("#ssid_network_key").show()):($("#div_ssid_encrypt_way2").show(),$("#div_ssid_encrypt_way1").hide(),$("#ssid_wpa_key").val(e.WifiWpapsk)),0==e.WifiEnable&&$(".editordisable").attr("disabled","disabled")}function refreshData(){"0"!=g_quicksetup_wifiBasicData[0].WifiEnable&&(g_quicksetup_wifiBasicData[0].WifiSsid=$.trim($("#ssid_wifiName").val()),QUICKSETUP_WIFIAUTHMODE_AUTO==g_quicksetup_wifiBasicData[0].WifiAuthmode||QUICKSETUP_WIFIAUTHMODE_OPEN==g_quicksetup_wifiBasicData[0].WifiAuthmode||QUICKSETUP_WIFIAUTHMODE_SHARE==g_quicksetup_wifiBasicData[0].WifiAuthmode?g_quicksetup_wifiBasicData[0].WifiWepKey1=$("#ssid_neworkKey1").val():g_quicksetup_wifiBasicData[0].WifiWpapsk=$("#ssid_wpa_key").val())}function quicksetup_initPageData(){if(1==supportFeatureSwitch_flag||g_module.multi_ssid_enabled?quicksetup_initPage_wifiMultiSSID():quicksetup_initPage_wifi(),"1"==g_auto_update_enable){"1"==g_setup_wizard_page||"1"==g_auto_update_ret.auto_update?$('input[name="update_selection"]').eq(0).attr("checked",!0):$('input[name="update_selection"]').eq(1).attr("checked",!0),$("#auto_update_notes").text(IDS_common_updateDialog_radioE5);var e=(t=IDS_wizard_quick_setup_step).replace("%d",QUICK_SETUP_STEP1).replace("%e",QUICK_SETUP_STEP3),i=t.replace("%d",QUICK_SETUP_STEP2).replace("%e",QUICK_SETUP_STEP3),s=t.replace("%d",QUICK_SETUP_STEP3).replace("%e",QUICK_SETUP_STEP3);$("#step_1").text(e),$("#step_2").text(i),$("#step_3").text(s),1==g_default_password_status&&(e=t.replace("%d",QUICK_SETUP_STEP1).replace("%e",QUICK_SETUP_STEP2),i=t.replace("%d",QUICK_SETUP_STEP2).replace("%e",QUICK_SETUP_STEP2),$("#step_1").text(e),$("#step_2").text(i),$("#Wlan_no_finish_button").show(),$("#Update_finish_button").show()),0==g_default_password_status&&($("#Wlan_no_finish_button").show(),$("#Update_no_finish_button").show())}else{var t;e=(t=IDS_wizard_quick_setup_step).replace("%d",QUICK_SETUP_STEP1).replace("%e",QUICK_SETUP_STEP1);$("#step_1").text(e),$("#Wlan_finish_button").show()}}function quicksetup_validateSsid(e){var i=null,s=$.trim($("#"+e+"_wifiName").val());return i="1"==g_wifiFeatureSwitch.chinesessid_enable?checkInputSsidNameValid(e+"_wifiName",s):validateSsid(s),common_ok==i||(showErrorUnderTr(e+"_wifiName_error_msg",i),$("#"+e+"_wifiName").focus(),$("#"+e+"_wifiName").select(),!1)}function quicksetup_validateNeworkKeyPwd(e){var i=$("#"+e).val(),s=null,t=!1;return 0==i.length?s=dialup_hint_password_empty:hasSpaceOrTabAtHead(i)?s=input_cannot_begin_with_space:5==i.length||13==i.length?checkInputChar(i)?t=!0:s=wlan_hint_wep_key_valid_type:s=wlan_hint_64_or_128_bit_key,t||(showErrorUnderTr(e+"_error",s),$("#"+e).focus(),$("#"+e).select()),t}function quicksetup_validateWpaPwd(e){var i=$("#"+e).val(),s=null,t=!1;return 0==i.length?s=dialup_hint_password_empty:hasSpaceOrTabAtHead(i)?s=input_cannot_begin_with_space:i.length>=8&&i.length<=63?checkInputChar(i)?t=!0:s=wlan_hint_wps_psk_valid_char:s=wlan_hint_wps_psk_valid_type,t||(showErrorUnderTr(e+"_error",s),$("#"+e).focus(),$("#"+e).select()),t}function quicksetup_ValidateWifiSecurity(e){var i=g_quicksetup_wifiBasicData[0].WifiAuthmode;if(i==QUICKSETUP_WIFIAUTHMODE_WPA_PSK||i==QUICKSETUP_WIFIAUTHMODE_WPA2_PSK||i==QUICKSETUP_WIFIAUTHMODE_WPA_WPA2_PSK){if(!quicksetup_validateWpaPwd(e+"_wpa_key"))return!1}else if(i==QUICKSETUP_WIFIAUTHMODE_AUTO||i==QUICKSETUP_WIFIAUTHMODE_OPEN||i==QUICKSETUP_WIFIAUTHMODE_SHARE){if(g_quicksetup_wifiBasicData[0].WifiBasicencryptionmodes==QUICKSETUP_WIFIBASICENCRYPMODE_NONE)return!0;if(!quicksetup_validateNeworkKeyPwd(e+"_neworkKey1"))return!1}return!0}function quicksetup_settings(e){startLogoutTimer(),clearAllErrorLabel(),showSetupStep(e)}function showSetupStep(e){var i;for(i=1;i<=3;i++)$("#quicksetup"+i).css("display","none");$("#quicksetup"+e).css("display","block")}function quicksetup_postData_wifi(){g_quicksetup_saveWlanDataOK=!0,g_quicksetup_nochangepwd_saveDataOK=!0,g_quicksetup.WifiSsid=g_quicksetup_wifiBasicData[0].WifiSsid,g_quicksetup.WifiRestart=0,g_quicksetup_wifiSecurityData.WifiAuthmode=g_quicksetup_wifiBasicData[0].WifiAuthmode,g_quicksetup_wifiSecurityData.WifiWpaencryptionmodes=g_quicksetup_wifiBasicData[0].WifiWpaencryptionmodes,g_quicksetup_wifiSecurityData.WifiBasicencryptionmodes=g_quicksetup_wifiBasicData[0].WifiBasicencryptionmodes,g_quicksetup_wifiSecurityData.WifiRestart=1,"AUTO"!=g_quicksetup_wifiSecurityData.WifiAuthmode&&"OPEN"!=g_quicksetup_wifiSecurityData.WifiAuthmode&&"SHARE"!=g_quicksetup_wifiSecurityData.WifiAuthmode||"WEP"!=g_quicksetup_wifiSecurityData.WifiBasicencryptionmodes?g_quicksetup_wifiSecurityData.WifiWpapsk=g_quicksetup_wifiBasicData[0].WifiWpapsk:(g_quicksetup_wifiSecurityData.WifiWepKey1=g_quicksetup_wifiBasicData[0].WifiWepKey1,g_quicksetup_wifiSecurityData.WifiWepKeyIndex="1");var e=object2xml("request",g_quicksetup);getAjaxData("api/wlan/basic-settings",(function(e){var i=xml2object(e);"response"==i.type&&(g_quicksetup_old_wifiBasicData=i.response)}),{sync:!0}),getAjaxData("api/wlan/security-settings",(function(e){var i=xml2object(e);if("response"==i.type&&(g_quicksetup_old_wifiSecurityData=i.response,1==g_scarm_login)){var s=CryptoJS.SCRAM(),t=s.nonce().toString(),a=s.nonce().toString(),_=doRSAEncrypt(t+a),r=object2xml("request",{module:"wlan",nonce:_});saveAjaxData("api/user/pwd",r,(function(e){var i=xml2object(e);if("response"==i.type){var _=i.response.pwd,r=CryptoJS.enc.Hex.parse(a),n=i.response.iter,o=s.saltedPassword(t,r,n),c=(o=o.toString()).substring(0,32),u=o.substring(32,48),p=o.substring(48,64),d=s.signature(CryptoJS.enc.Hex.parse(_),CryptoJS.enc.Hex.parse(p));if(d=d.toString(),i.response.hash==d){var f,w=getDAesString(CryptoJS.enc.Base64.stringify(CryptoJS.enc.Hex.parse(_)),c,u);if("string"==typeof(w=XSS_UnescapesSpecialChar(w.substring(w.indexOf("<response>"))))||"number"==typeof w)if(window.ActiveXObject)(f=new ActiveXObject("Microsoft.XMLDOM")).async=!1,f.loadXML(w);else f=(new DOMParser).parseFromString(w,"text/xml");else f=w;var l=xml2object($(f));if("response"==l.type){var g=l.response.Ssids.Ssid;g_quicksetup_old_wifiSecurityData.WifiWpapsk=g.WifiWpapsk,g_quicksetup_old_wifiSecurityData.WifiWepKey1=g.WifiWepKey1,g_quicksetup_old_wifiSecurityData.WifiWepKey2=g.WifiWepKey2,g_quicksetup_old_wifiSecurityData.WifiWepKey3=g.WifiWepKey3,g_quicksetup_old_wifiSecurityData.WifiWepKey4=g.WifiWepKey4}}}}),{sync:!0})}}),{sync:!0}),g_quicksetup_old_wifiBasicData.WifiSsid==g_quicksetup_wifiBasicData[0].WifiSsid&&g_quicksetup_old_wifiSecurityData.WifiWepKey1==g_quicksetup_wifiBasicData[0].WifiWepKey1&&g_quicksetup_old_wifiSecurityData.WifiWpapsk==g_quicksetup_wifiBasicData[0].WifiWpapsk||saveAjaxData("api/wlan/basic-settings",e,(function(e){var i=xml2object(e);isAjaxReturnOK(i)||(g_quicksetup_saveDataOK=!1,g_quicksetup_saveWlanDataOK=!1,g_quicksetup_nochangepwd_saveDataOK=!1);var s=object2xml("request",g_quicksetup_wifiSecurityData);saveAjaxData("api/wlan/security-settings",s,(function(e){var i=xml2object(e);isAjaxReturnOK(i)||(g_quicksetup_saveDataOK=!1,g_quicksetup_saveWlanDataOK=!1,g_quicksetup_nochangepwd_saveDataOK=!1)}),{enc:!0,sync:!0})}),{sync:!0})}function quicksetup_postData_wifiMultiSSID(){var e="";if(g_quicksetup_saveWlanDataOK=!0,g_quicksetup_nochangepwd_saveDataOK=!0,$(g_quicksetup_wifiBasicData).each((function(i){g_quicksetup_wifiBasicData[i].WifiSsid=wifiSsidResolveCannotParseChar(g_quicksetup_wifiBasicData[i].WifiSsid),g_backup_pwd[i].WifiWpapsk==g_quicksetup_wifiBasicData[i].WifiWpapsk?delete g_quicksetup_wifiBasicData[i].WifiWpapsk:(g_quicksetup_wifiBasicData[i].WifiWpapsk=doRSAEncrypt(wifiSsidResolveCannotParseChar(g_quicksetup_wifiBasicData[i].WifiWpapsk)),e+="WifiWpapsk,"),g_backup_pwd[i].WifiWepKey1==g_quicksetup_wifiBasicData[i].WifiWepKey1?delete g_quicksetup_wifiBasicData[i].WifiWepKey1:(g_quicksetup_wifiBasicData[i].WifiWepKey1=doRSAEncrypt(wifiSsidResolveCannotParseChar(g_quicksetup_wifiBasicData[i].WifiWepKey1)),e+="WifiWepKey1,"),delete g_quicksetup_wifiBasicData[i].MixWifiWpapsk,delete g_quicksetup_wifiBasicData[i].WifiWepKey2,delete g_quicksetup_wifiBasicData[i].WifiWepKey3,delete g_quicksetup_wifiBasicData[i].WifiWepKey4})),g_backup_ssid_name!=g_quicksetup_wifiBasicData[0].WifiSsid||""!=e){var i=!1;""!=e&&(i=!0);var s=object2xml("request",{Ssids:{Ssid:g_quicksetup_wifiBasicData},WifiRestart:1});saveAjaxData("api/wlan/multi-basic-settings",s,(function(e){var i=xml2object(e);isAjaxReturnOK(i)||(g_quicksetup_saveDataOK=!1,g_quicksetup_saveWlanDataOK=!1,g_quicksetup_nochangepwd_saveDataOK=!1)}),{sync:!0,enp:i,enpstring:e})}}function updateCookie(){g_set_cookie_flag=!0,getAjaxData("api/monitoring/status",(function(e){}),{sync:!0})}function quicksetup_login(){updateCookie();var e=$("#new_password").val();if(refreshToken(),1==g_scarm_login){var i=CryptoJS.SCRAM(),s=i.nonce().toString(),t={username:"admin",firstnonce:s,mode:RSA_LOGIN_MODE},a=object2xml("request",t);saveAjaxData("api/user/challenge_login",a,(function(t){var a=xml2object(t);if("response"==a.type){g_scarm_salt=CryptoJS.enc.Hex.parse(a.response.salt);var _=a.response.iterations,r=a.response.servernonce,n=s+","+r+","+r,o=i.saltedPassword(e,g_scarm_salt,_);o=o.toString();var c=i.clientKey(CryptoJS.enc.Hex.parse(o));c=c.toString();var u=i.serverKey(CryptoJS.enc.Hex.parse(o));u=u.toString();var p=i.clientProof(e,g_scarm_salt,_,n);p=p.toString();var d=object2xml("request",{clientproof:p,finalnonce:r});saveAjaxData("api/user/authentication_login",d,(function(s){if("response"==(a=xml2object(s)).type){var t=i.serverProof(e,g_scarm_salt,_,n);if(t=t.toString(),a.response.serversignature==t){var r=a.response.rsan,o=i.signature(CryptoJS.enc.Hex.parse(r),CryptoJS.enc.Hex.parse(u));o=o.toString(),a.response.rsapubkeysignature==o?(g_encPublickey.e=a.response.rsae,g_encPublickey.n=a.response.rsan,storagePubkey(g_encPublickey.n,g_encPublickey.e),quicksetup_postData()):g_quicksetup_saveDataOK=!1}else g_quicksetup_saveDataOK=!1}else g_quicksetup_saveDataOK=!1}))}else g_quicksetup_saveDataOK=!1}))}else{getAjaxData("api/user/state-login",(function(e){var i=xml2object(e);"response"==i.type&&(g_password_type=i.response.password_type)}),{sync:!0});var _="admin";e=$("#new_password").val();$.isArray(g_requestVerificationToken)?g_requestVerificationToken.length>0&&(e="4"==g_password_type?base64encode(SHA256(_+base64encode(SHA256($("#new_password").val()))+g_requestVerificationToken[0])):base64encode($("#new_password").val())):e=base64encode($("#new_password").val());t={Username:_,Password:e,password_type:g_password_type},a=object2xml("request",t);saveAjaxData("api/user/login",a,(function(e){"response"==xml2object(e).type?quicksetup_postData():g_quicksetup_saveDataOK=!1}),{enc:!0})}}function quicksetup_postDataSetupwizard(){if("1"==g_setup_wizard_page){g_quicksetup_nochangepwd_saveDataOK=!0;var e=object2xml("request",{restore_default_status:0,autoupdate_guide_status:0});saveAjaxData("api/device/basic_information",e,(function(e){var i=xml2object(e);isAjaxReturnOK(i)||(g_quicksetup_saveDataOK=!1,g_quicksetup_nochangepwd_saveDataOK=!1)}),{sync:!0})}}function quicksetup_postData(){if("1"==g_auto_update_enable){g_quicksetup_nochangepwd_saveDataOK=!0;var e={auto_update:$('[name="update_selection"]:checked').val(),ui_download:g_auto_update_ret.ui_download},i=object2xml("request",e);saveAjaxData("api/online-update/autoupdate-config",i,(function(e){"response"==xml2object(e).type?quicksetup_postDataSetupwizard():(g_quicksetup_saveDataOK=!1,g_quicksetup_nochangepwd_saveDataOK=!1)}),{sync:!0})}1==supportFeatureSwitch_flag?quicksetup_postData_wifiMultiSSID():g_module.multi_ssid_enabled?0!=g_quicksetup_wifiBasicData[0].WifiEnable&&quicksetup_postData_wifiMultiSSID():quicksetup_postData_wifi()}function vilidatePassword(){clearAllErrorLabel();var e=$("#current_password").val(),i=$("#new_password").val(),s=$("#confirm_password").val();return""==e?(showErrorUnderTextbox("current_password",system_hint_current_password_empty),setTimeout((function(){$("#current_password").focus()}),10),!1):""==i?(showErrorUnderTextbox("new_password",system_hint_new_password_empty),setTimeout((function(){$("#new_password").focus()}),10),!1):""==s?(showErrorUnderTextbox("confirm_password",system_hint_new_confirm_password_empty),setTimeout((function(){$("#confirm_password").focus()}),10),!1):0==checkInputChar(e)?(showErrorUnderTextbox("current_password",system_hint_wrong_password),$("#current_password").val(""),setTimeout((function(){$("#current_password").focus()}),10),!1):0==checkInputChar(i)?(showErrorUnderTextbox("new_password",dialup_hilink_hint_password_invalidate),setTimeout((function(){$("#new_password").focus()}),10),!1):1==hasSpaceOrTabAtHead(i)?(showErrorUnderTextbox("new_password",input_cannot_begin_with_space),setTimeout((function(){$("#new_password").focus()}),10),!1):1==hasSpaceOrTabAtHead(s)?(showErrorUnderTextbox("confirm_password",input_cannot_begin_with_space),setTimeout((function(){$("#confirm_password").focus()}),10),!1):i==e?(showErrorUnderTextbox("new_password",IDS_common_same_password_error),setTimeout((function(){$("#new_password").focus()}),10),!1):i!=s?(showErrorUnderTextbox("confirm_password",IDS_modify_password_wrong_msg),$("#new_password").val(""),$("#confirm_password").val(""),setTimeout((function(){$("#new_password").focus()}),10),!1):passWordStrength!=MACRO_PASSWORD_LOW||(showErrorUnderTextbox("new_password",IDS_psw_login_remind),setTimeout((function(){$("#new_password").focus()}),10),!1)}function quicksetup_first_postPassword(){if(1==g_scarm_login){g_quicksetup_saveDataOK=!0,g_quicksetup_savePasswordOK=!0;var e=$("#current_password").val(),i=$("#new_password").val(),s={username:"admin",currentpassword:XSSResolveCannotParseChar(e),newpassword:XSSResolveCannotParseChar(i)},t=object2xml("request",s);clearTimeout(g_decive_timer),saveAjaxData("api/user/password_scram",t,(function(e){var i=xml2object(e);isAjaxReturnOK(i)?quicksetup_login():"error"==i.type&&(g_quicksetup_savePasswordOK=!1,clearAllErrorLabel(),i.error.code==MODIFYPASSWORD_SHOW?(showErrorUnderTextbox("current_password",IDS_current_password_inputshow),$("#current_password").val(""),$("#current_password").focus()):(showErrorUnderTextbox("current_password",system_hint_wrong_password),$("#current_password").val(""),$("#current_password").focus()))}),{enc:!0,sync:!0})}else{getAjaxData("api/user/password",(function(e){var i=xml2object(e);"response"==i.type&&(encryption_mode=i.response.encryption_enable)}),{sync:!0}),g_quicksetup_saveDataOK=!0,g_quicksetup_savePasswordOK=!0;var a="admin";e=$("#current_password").val(),i=$("#new_password").val(),s={Username:a,CurrentPassword:e=1==encryption_mode&&$.isArray(g_requestVerificationToken)&&g_requestVerificationToken.length>0?base64encode(SHA256(a+base64encode(SHA256(e))+g_requestVerificationToken[0])):base64encode(e),NewPassword:i=base64encode(i),encryption_enable:encryption_mode},t=object2xml("request",s);clearTimeout(g_decive_timer),saveAjaxData("api/user/password",t,(function(e){var i=xml2object(e);isAjaxReturnOK(i)?quicksetup_login():"error"==i.type&&(g_quicksetup_savePasswordOK=!1,clearAllErrorLabel(),i.error.code==MODIFYPASSWORD_SHOW?(showErrorUnderTextbox("current_password",IDS_current_password_inputshow),$("#current_password").val(""),$("#current_password").focus()):(showErrorUnderTextbox("current_password",system_hint_wrong_password),$("#current_password").val(""),$("#current_password").focus()))}),{enc:!0,sync:!0})}}function doRedirect(){gotoPageWithoutHistory(HOME_PAGE_URL)}function quicksetup_finish(){if((clearAllErrorLabel(),"1"==g_auto_update_enable)&&(0==g_default_password_status&&($("#new_password").focus(),!vilidatePassword())))return;showWaitingDialog(common_waiting,sd_hint_wait_a_few_moments),setTimeout((function(){"1"==g_auto_update_enable&&0==g_default_password_status?quicksetup_first_postPassword():quicksetup_postData(),setTimeout((function(){if("1"==g_auto_update_enable){if(0==g_default_password_status&&!g_quicksetup_savePasswordOK)return void closeWaitingDialog();1==g_quicksetup_saveDataOK||1==g_quicksetup_nochangepwd_saveDataOK?(closeWaitingDialog(),"1"==g_setup_wizard_page?showInfoDialog(common_success,!1,doRedirect):showInfoDialog(common_success,!1,refresh)):(closeWaitingDialog(),showInfoDialog(common_failed,!1,refresh))}else g_quicksetup_saveWlanDataOK?(closeWaitingDialog(),showInfoDialog(common_success,!1,refresh)):(closeWaitingDialog(),showInfoDialog(common_failed,!1,refresh))}),3e3)}),1e3)}function quicksetup_bindButtonClick(){$("#ssid_wifiName").keyup((function(){checkInputSsidNameValid($(this).attr("id"),$.trim($(this).val()))})),$("#modifyWlanPswOption_w1 input").click((function(){1==$("#WlanPsw_check_w1").get(0).checked?($("#ssid_neworkKey1_error").removeClass("hidden"),$("#ssid_neworkKey1").val("").focus()):($("tr.error_message").remove(),$("#ssid_neworkKey1_error").addClass("hidden"),$("#ssid_neworkKey1").val(g_quicksetup_wifiBasicData[0].WifiWepKey1))})),$("#showPswForW1").click((function(){if(1==$("#showPswForW1").get(0).checked){var e=$("#ssid_neworkKey1").val(),i="<input id='ssid_neworkKey1' type='text' autocomplete='off' class='input_style editordisable' maxlength='26'>";$("#ssid_neworkKey1").after(i).remove(),$("#ssid_neworkKey1").val(e)}else{e=$("#ssid_neworkKey1").val(),i="<input id='ssid_neworkKey1' type='password' autocomplete='off' class='input_style editordisable' maxlength='26'>";$("#ssid_neworkKey1").after(i).remove(),$("#ssid_neworkKey1").val(e)}})),$("#modifyWlanPswOption_w2 input").click((function(){1==$("#WlanPsw_check_w2").get(0).checked?($("#ssid_wpa_key_error").removeClass("hidden"),$("#ssid_wpa_key").val("").focus()):($("tr.error_message").remove(),$("#ssid_wpa_key_error").addClass("hidden"),$("#ssid_wpa_key").val(g_quicksetup_wifiBasicData[0].WifiWpapsk))})),$("#showPswForW2").click((function(){if(1==$("#showPswForW2").get(0).checked){var e=$("#ssid_wpa_key").val(),i="<input name='wpa_key' id='ssid_wpa_key' type='text' autocomplete='off' class='input_style editordisable' maxlength='63'>";$("#ssid_wpa_key").after(i).remove(),$("#ssid_wpa_key").val(e)}else{e=$("#ssid_wpa_key").val(),i="<input name='wpa_key' id='ssid_wpa_key' type='password' autocomplete='off' class='input_style editordisable' maxlength='63'>";$("#ssid_wpa_key").after(i).remove(),$("#ssid_wpa_key").val(e)}})),"1"==g_auto_update_enable?$("#step1_next").click((function(){if(isButtonEnable("step1_next"))if(clearAllErrorLabel(),2==g_wifiFeatureSwitch.maxapnum&&g_quicksetup_wifiBasicData[1].WifiSsid==$.trim($("#ssid_wifiName").val())||3==g_wifiFeatureSwitch.maxapnum&&(g_quicksetup_wifiBasicData[1].WifiSsid==$.trim($("#ssid_wifiName").val())||g_quicksetup_wifiBasicData[2].WifiSsid==$.trim($("#ssid_wifiName").val()))||4==g_wifiFeatureSwitch.maxapnum&&(g_quicksetup_wifiBasicData[1].WifiSsid==$.trim($("#ssid_wifiName").val())||g_quicksetup_wifiBasicData[2].WifiSsid==$.trim($("#ssid_wifiName").val())||g_quicksetup_wifiBasicData[3].WifiSsid==$.trim($("#ssid_wifiName").val())))showInfoDialog(multi_ssid_same_message);else{if(0!=g_quicksetup_wifiBasicData[0].WifiEnable){if(!quicksetup_validateSsid("ssid"))return;if(!quicksetup_ValidateWifiSecurity("ssid"))return;refreshData()}quicksetup_settings(SETUP_STEP2_UPDATE)}})):$("#step_Wlan_finish").click((function(){if(isButtonEnable("step_Wlan_finish"))if(clearAllErrorLabel(),2==g_wifiFeatureSwitch.maxapnum&&g_quicksetup_wifiBasicData[1].WifiSsid==$.trim($("#ssid_wifiName").val())||3==g_wifiFeatureSwitch.maxapnum&&(g_quicksetup_wifiBasicData[1].WifiSsid==$.trim($("#ssid_wifiName").val())||g_quicksetup_wifiBasicData[2].WifiSsid==$.trim($("#ssid_wifiName").val()))||4==g_wifiFeatureSwitch.maxapnum&&(g_quicksetup_wifiBasicData[1].WifiSsid==$.trim($("#ssid_wifiName").val())||g_quicksetup_wifiBasicData[2].WifiSsid==$.trim($("#ssid_wifiName").val())||g_quicksetup_wifiBasicData[3].WifiSsid==$.trim($("#ssid_wifiName").val())))showInfoDialog(multi_ssid_same_message);else{if(0!=g_quicksetup_wifiBasicData[0].WifiEnable){if(!quicksetup_validateSsid("ssid"))return;if(!quicksetup_ValidateWifiSecurity("ssid"))return;refreshData()}quicksetup_finish()}})),$("#step2_back,#step2_back_new").click((function(){quicksetup_settings(SETUP_STEP1_WLAN)})),$("#step2_next").click((function(){isButtonEnable("step2_next")&&(quicksetup_settings(SETUP_STEP3_PASSWORD),$("#current_password").focus())})),$("#step3_back").click((function(){quicksetup_settings(SETUP_STEP2_UPDATE)})),$("#step_Update_finish,#step_finish").click((function(){quicksetup_finish()})),$("#new_password").live("keydown keypress keyup focus change",(function(e){("keydown"!=e.type&&"keypress"!=e.type&&"keyup"!=e.type||37!=e.keyCode&&38!=e.keyCode&&39!=e.keyCode&&40!=e.keyCode)&&($("#new_password").val().length>0?setPWStrengthColor(checkPWStrength($.trim($("#new_password").val()))):setPWStrengthColor(0))})),$("#current_password, #new_password").bind("keydown",(function(e){if(13==e.which){if(!vilidatePassword())return;quicksetup_finish()}})),$("#confirm_password").bind("keydown",(function(e){13==e.which&&quicksetup_finish()}))}function setPWStrengthColor(e){passWordStrength=e,MACRO_PASSWORD_LOW==e?($("#psw_strength_low").css({"background-color":"red"}),$("#psw_strength_mid, #psw_strength_hig").css({"background-color":"gray"})):MACRO_PASSWORD_MID==e?($("#psw_strength_mid").css({"background-color":"red"}),$("#psw_strength_low, #psw_strength_hig").css({"background-color":"gray"})):MACRO_PASSWORD_HIG==e?($("#psw_strength_hig").css({"background-color":"red"}),$("#psw_strength_mid, #psw_strength_low").css({"background-color":"gray"})):$("#psw_strength_low, #psw_strength_mid, #psw_strength_hig").css({"background-color":"gray"})}function main_executeBeforeDocumentReady(){"1"!=g_auto_update_enable&&getAjaxData("api/device/basic_information",(function(e){var i=xml2object(e);if("response"==i.type&&(basic_infos=i.response,"1"==basic_infos.restore_default_status)){var s=object2xml("request",{restore_default_status:0});saveAjaxData("api/device/basic_information",s,(function(e){}),{sync:!0})}}),{sync:!0});var e=object2xml("request",{PrsiteClear:1,prsite_type:3});saveAjaxData("api/prsite/clear",e,(function(e){var i=xml2object(e);isAjaxReturnOK(i)}),{sync:!0}),getDefaultPass(),"1"==g_auto_update_enable&&getAjaxData("api/online-update/autoupdate-config",(function(e){var i=xml2object(e);"response"==i.type&&(g_auto_update_ret=i.response)}),{sync:!0}),""==g_wifiFeatureSwitch?getAjaxData("api/wlan/wifi-feature-switch",(function(e){var i=xml2object(e);"response"==i.type&&(supportFeatureSwitch_flag=!0,g_wifiFeatureSwitch=i.response)}),{sync:!0}):supportFeatureSwitch_flag=!0}main_executeBeforeDocumentReady(),$(document).ready((function(){$("#WlanPsw_check_w1").get(0).checked=!1,$("#WlanPsw_check_w2").get(0).checked=!1,$("#showPswForW1").get(0).checked=!1,$("#showPswForW2").get(0).checked=!1,quicksetup_initPageData(),quicksetup_bindButtonClick(),setPWStrengthColor(0),getLoginStatus()}));
