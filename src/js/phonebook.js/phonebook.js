var g_PB_TIMEOUT_LONG=6e4,g_PB_TIMEOUT_SHORT=3e4,g_PB_TIMEOUT_IMPORT=6e5,g_pb_pageIndex=1,g_pb_totalPbPage=0,g_pb_curContactSum=0,g_pb_curGroupId=0,g_pb_curPhoneBook="",g_pb_curGroupCount=0,g_pb_selectListNum="",g_pb_contactListArray=[],g_pb_groupListArray=[],g_pb_fieldMap=[],g_pb_fieldCount=0,g_pb_editgroupID=0,g_pb_editgroupFlag=!1,g_pb_nameLength=0,g_pb_nameNumber=0,afterSubstrName="",g_pb_status=0,g_pb_feature={page_size:0,max_name_size:0,max_phone_size:0,max_email_size:0,max_search_size:0,max_group_size:0,max_group_name_size:0,export_csv_path:"",export_vcard_path:""},g_pb_local_count={LocalUsed:0,SimUsed:0,LocalMax:0,SimMax:0},g_pb_local_contact_list_request={GroupID:0,PageIndex:g_pb_pageIndex,ReadCount:g_pb_feature.page_size,SaveType:0,SortType:1,Ascending:1,KeyWord:""},g_pb_local_group_list_request={PageIndex:1,ReadCount:g_pb_feature.max_group_size,SortType:2,Ascending:1};function pb_getConfig(){getConfigData("config/pb/config.xml",(function(e){var t=_xml2feature(e);$.extend(g_pb_feature,t)}),{sync:!0}),redirectOnCondition(null,"phonebook")}function pb_initPage(e){pb_clearPage("clear_all"),pb_controlBtnShow("hide_all"),pb_getLocalCount(),e?pb_getLocalGroupList():pb_getLocalGroupList("count_only"),0!=g_pb_local_count.SimUsed&&0!=g_pb_local_count.LocalUsed&&0!=g_pb_local_count.LocalMax&&0!=g_pb_local_count.SimMax||setTimeout((function(){pb_getLocalCount()}),1500),pb_getLocalContactList()}function pb_clearPage(e){switch(e){case"clear_all":g_pb_selectListNum="",$(".pb_pagination div").hide(),$("#list_contacts").empty(),$("#div_local_detail").empty(),$("#pb_check_all").removeAttr("checked"),button_enable("btn_del_contact","0"),button_enable("btn_send_msg","0"),button_enable("btn_move_to_group","0");break;case"clear_search":g_pb_pageIndex=1,g_pb_selectListNum="",$(".pb_pagination div").hide(),$("#list_contacts").empty(),$("#pb_check_all").removeAttr("checked"),button_enable("btn_del_contact","0"),button_enable("btn_send_msg","0"),button_enable("btn_move_to_group","0");break;case"clear_group":g_pb_curGroupId=0,g_pb_pageIndex=1,g_pb_selectListNum="",$("#pb_add_group").empty(),$("#pb_search").val(common_search),$("#pb_search").removeClass("pb_search_init"),$("#pb_search").addClass("pb_search_init"),$("#pb_search").addClass("clr_gray"),$(".pb_pagination div").hide(),$("#list_contacts").empty(),$("#div_local_detail").empty(),$("#pb_check_all").removeAttr("checked"),button_enable("btn_del_contact","0"),button_enable("btn_send_msg","0"),button_enable("btn_move_to_group","0");break;case"clear_edit_group":g_pb_curGroupId=0,g_pb_pageIndex=1,g_pb_selectListNum="",$("#pb_add_group").empty(),$(".pb_pagination div").hide(),$("#list_contacts").empty(),$("#div_local_detail").empty(),$("#pb_check_all").removeAttr("checked"),button_enable("btn_del_contact","0"),button_enable("btn_send_msg","0"),button_enable("btn_move_to_group","0")}}function pb_new_contactClick(){$("#btn_new_contact").click((function(){parseInt(g_pb_local_count.LocalUsed,10)>=parseInt(g_pb_local_count.LocalMax,10)?showInfoDialog(strid_pb_hint_no_room):(pb_localShowAddContact(),pb_controlBtnShow("show_edit"))}))}function pb_import_Click(){$("#btn_pb_import").click((function(){return pb_localCopySimContact(),!1}))}function pb_initBtnClick(){$("#btn_new_contact").click((function(){parseInt(g_pb_local_count.LocalUsed,10)>=parseInt(g_pb_local_count.LocalMax,10)?showInfoDialog(strid_pb_hint_no_room):(pb_localShowAddContact(),pb_controlBtnShow("show_edit"))})),$("#btn_del_contact").click((function(){isButtonEnable("btn_del_contact")&&(button_enable("btn_del_contact",0),$("#pop_confirm").die("click"),showConfirmDialog(common_confirm_delete_list_item,(function(){pb_clearDialog(),pb_localDeleteContact()}),(function(){button_enable("btn_del_contact",1)})),$(".dialog_close_btn").bind("click",(function(){button_enable("btn_del_contact",1)})))})),$("#btn_send_msg").click((function(){isButtonEnable("btn_send_msg")&&(button_enable("btn_send_msg",0),pb_localSendMsg())})),$(".pb_table_details img").live("click",(function(){var e=$(this).parents("pre");pb_localSendMsg($(e).text())})),$("#btn_move_to_group").click((function(){isButtonEnable("btn_move_to_group")&&pb_showLocalMoveToGroup()})),$("#btn_del_contact_b").click((function(){isButtonEnable("btn_del_contact_b")&&(button_enable("btn_del_contact_b",0),$("#pop_confirm").die("click"),showConfirmDialog(common_confirm_delete_list_item,(function(){pb_clearDialog();var e=$("#hiddenNum").val();pb_localDeleteContact(-1==e?g_pb_curPhoneBook.Index:g_pb_contactListArray[e].Index)}),(function(){button_enable("btn_del_contact_b",1)})),$(".dialog_close_btn").bind("click",(function(){button_enable("btn_del_contact_b",1)})))})),$("#btn_edit_contact").click((function(){pb_localShowEditContact($("#hiddenNum").val()),pb_controlBtnShow("show_edit")})),$("#btn_save_contact").click((function(){isButtonEnable("btn_save_contact")&&(button_enable("btn_save_contact",0),$("#hiddenIndex").val()?pb_localEditContact():pb_localAddContact())})),$("#pb_check_all").click((function(){var e,t=$("#list_contacts :checkbox");t.attr("checked",this.checked),e=t.filter(":checked").length,button_enable("btn_del_contact",e>0),button_enable("btn_send_msg",e>0),g_pb_groupListArray.length>0&&button_enable("btn_move_to_group",e>0)})),$("#list_contacts li").live("mouseover",(function(){var e="li_hover";e!=$(this).attr("class")&&($(this).removeClass(e),$(this).addClass(e))})),$("#list_contacts li").live("mouseout",(function(){$(this).removeAttr("class")})),$("#list_contacts li").live("click",(function(e){var t=$(this).find("input:checkbox");"pb_checkbox"!=$(e.target).attr("id")&&"div_checkbox"!=$(e.target).attr("id")?($(t).attr("checked","checked"),(t=$("#list_contacts :checkbox").not($(t))).removeAttr("checked")):"div_checkbox"==$(e.target).attr("id")&&$(t).attr("checked",!$(t).attr("checked"));var o,a=$("#list_contacts :checkbox");o=a.filter(":checked").length,$("#pb_check_all").attr("checked",a.length==o),button_enable("btn_del_contact",o>0),button_enable("btn_send_msg",o>0),g_pb_groupListArray.length>0&&button_enable("btn_move_to_group",o>0),pb_showLocalContactsDetail(pb_getLocalHrefNum(this)),pb_controlBtnShow("show_detail")})),$("#btn_cancel_contact").click((function(){""==g_pb_selectListNum?0==g_pb_contactListArray.length?($("#div_local_detail").empty(),pb_controlBtnShow("hide_all")):(pb_showLocalContactsDetail(0),pb_controlBtnShow("show_detail")):(pb_showLocalContactsDetail(g_pb_selectListNum),pb_controlBtnShow("show_detail"))})),$("#jump_page").click((function(){var e=parseInt($.trim($("#jump_page_index").val()),10);isNaN(e)||e<1||e>g_pb_totalPbPage?(showQtip("jump_page_index",sms_hint_wrong_page_num),$("#jump_page_index").select()):pb_pageNav(e)})),$("#pb_search").val(common_search),$("#pb_search").attr("maxlength",g_pb_feature.max_search_size),$("#pb_search").keydown((function(e){13==e.keyCode&&(pb_clearPage("clear_search"),pb_getLocalContactList(),$("#div_local_detail").empty(),pb_controlBtnShow("hide_all"))})),$("#pb_img_search").click((function(){pb_clearPage("clear_search"),pb_getLocalContactList(),$("#div_local_detail").empty(),pb_controlBtnShow("hide_all")})),$("#pb_search").focus((function(){$("#pb_search").hasClass("pb_search_init")&&(this.className="",this.value="")})),$("#pb_search").blur((function(){""==this.value&&(this.className="pb_search_init clr_gray",this.value=common_search)})),$("#pb_new_group").click((function(){$("#btn_new_contact").unbind("click"),$("#btn_pb_import").unbind("click"),g_pb_status=0,$(".menu_group input").size()||pb_localShowNewGroup()})),$("#pb_new_group").live("mouseover",(function(){$(this).css({color:"#12A5D6"})})),$("#pb_new_group").live("mouseout",(function(){$(this).css({color:"#000"})})),$("#pb_group_list li").live("click",(function(){if($(this).removeClass("click"),$(this).addClass("click"),pb_clearPage(1==g_pb_editgroupFlag?"clear_edit_group":"clear_group"),g_pb_editgroupFlag=!1,pb_controlBtnShow("hide_all"),0==(g_pb_curGroupId=pb_getLocalHrefNum(this)))$("#cur_group_type").html(pb_label_all_contacts);else if(0==$("#txtEditorGroup").length){var e=pb_getLocalHrefNum($(this).find("span"));$("#cur_group_type").html(resolveXMLEntityReference(g_pb_groupListArray[e].GroupName).replace(/\s/g,"&nbsp;"))}else $("#cur_group_type").html(resolveXMLEntityReference($("#txtEditorGroup").val()).replace(/\s/g,"&nbsp;"));pb_getLocalContactList()})),$("#pb_delete_group").live("click",(function(){var e=pb_getLocalHrefNum($(this).parents("li"));$("#pop_confirm").die("click"),showConfirmDialog(common_confirm_delete_list_item,(function(){pb_clearDialog(),pb_deleteGroup(e)}),(function(){}))})),$("#pb_editor_group").live("click",(function(){$(".menu_group input").size()||($("#btn_new_contact").unbind("click"),$("#btn_pb_import").unbind("click"),pb_localShowEditorGroup(this))})),$("#btn_pb_import").click((function(){return pb_localCopySimContact(),!1})),$("#txtFormattedName, #txtMobilePhone, #txtHomePhone, #txtWorkPhone, #txtWorkEmail").live("keydown",(function(e){13==e.keyCode&&(pb_checkName($("#txtFormattedName")),$("#btn_save_contact").trigger("click"))}))}function pb_sent_record_maxlength(){var e=pb_local_object2xml("request",{Field_FormattedName:g_pb_feature.max_name_size,Field_MobilePhone:g_pb_feature.max_phone_size,Field_HomePhone:g_pb_feature.max_phone_size,Field_WorkPhone:g_pb_feature.max_phone_size,Field_WorkEmail:g_pb_feature.max_email_size});e=e.replace(/(Value)/g,"Length"),saveAjaxData("api/pb/pb-import-length",e,(function(e){var t=xml2object(e);isAjaxReturnOK(t)}),{timeout:g_PB_TIMEOUT_SHORT,errorCB:function(){}})}function pb_controlBtnShow(e){switch(e){case"show_detail":$("#span_btn_save_contact").hide(),$("#span_btn_del_contact_b").show(),button_enable("btn_del_contact_b",1),$("#span_btn_edit_contact").show(),$("#span_btn_cancel_contact").hide();break;case"hide_all":$("#span_btn_save_contact").hide(),$("#span_btn_del_contact_b").hide(),$("#span_btn_edit_contact").hide(),$("#span_btn_cancel_contact").hide();break;case"show_edit":$("#span_btn_save_contact").show(),$("#span_btn_del_contact_b").hide(),$("#span_btn_edit_contact").hide(),$("#span_btn_cancel_contact").show()}}function pb_initPagination(){if(g_pb_curContactSum>0){g_pb_totalPbPage=Math.ceil(g_pb_curContactSum/g_pb_local_contact_list_request.ReadCount);var e=(g_pb_pageIndex=Math.min(g_pb_pageIndex,g_pb_totalPbPage))+"/"+g_pb_totalPbPage;$("#curPbPage").text(e),pb_createPageNav(),$(".pb_pagination div").show()}else $(".pb_pagination div").hide()}function pb_createPageNav(){var e,t,o,a,n="";e=1==g_pb_pageIndex?"javascript:void(0);":"javascript:pb_pageNav('first')",t=g_pb_pageIndex>=g_pb_totalPbPage?"javascript:void(0);":"javascript:pb_pageNav('last')",$("#pageBegin").attr("href",e),$("#pageLast").attr("href",t),o=1==g_pb_pageIndex?"javascript:void(0);":"javascript:pb_pageNav('prePage')",a=g_pb_pageIndex>=g_pb_totalPbPage?"javascript:void(0);":"javascript:pb_pageNav('nextPage')",$("#prePage").attr("href",o),$("#nextPage").attr("href",a);var _=0,i=0;(g_pb_pageIndex=parseInt(g_pb_pageIndex,10))+parseInt(2.5,10)>=g_pb_totalPbPage?_=(i=g_pb_totalPbPage)-5+1>1?i-5+1:1:g_pb_pageIndex<=parseInt(2.5,10)?i=5+(_=1)-1>g_pb_totalPbPage?g_pb_totalPbPage:_+5-1:(_=g_pb_pageIndex-parseInt(2.5,10)>1?g_pb_pageIndex-parseInt(2.5,10):1,i=g_pb_pageIndex+parseInt(2.5,10)>g_pb_totalPbPage?g_pb_totalPbPage:g_pb_pageIndex+parseInt(2.5,10));var r=0;if("ar_sa"==LANGUAGE_DATA.current_language||"he_il"==LANGUAGE_DATA.current_language||"fa_fa"==LANGUAGE_DATA.current_language)for(r=i;r>=_;r--)aHref=r==g_pb_pageIndex?' href="javascript:void(0);"':" href=\"javascript:pb_pageNav('"+r+'\')" style="text-decoration:underline"',n+="<a "+aHref+">"+r+"</a>";else for(r=_;r<=i;r++)aHref=r==g_pb_pageIndex?' href="javascript:void(0);"':" href=\"javascript:pb_pageNav('"+r+'\')" style="text-decoration:underline"',n+="<a "+aHref+">"+r+"</a>";$("#page_num").html(n)}function pb_pageNav(e){switch(e){case"first":g_pb_pageIndex=1;break;case"last":g_pb_pageIndex=g_pb_totalPbPage;break;case"prePage":g_pb_pageIndex--;break;case"nextPage":g_pb_pageIndex++;break;default:g_pb_pageIndex=e}$(document).scrollTop(0),pb_initPage(),$("#jump_page_index").val("")}function pb_getLocalCount(){getAjaxData("api/pb/pb-count",(function(e){var t=xml2object(e);"response"==t.type?(g_pb_local_count.LocalUsed=t.response.LocalUsed,g_pb_local_count.SimUsed=t.response.SimUsed,g_pb_local_count.LocalMax=t.response.LocalMax,g_pb_local_count.SimMax=t.response.SimMax,$("#all_contacts_count").text(g_pb_local_count.LocalUsed)):showInfoDialog(common_error),$("#all_contacts_count").text(g_pb_local_count.LocalUsed)}),{sync:!0,timeout:g_PB_TIMEOUT_SHORT,errorCB:function(){showInfoDialog(common_error)}})}function pb_getLocalGroupList(e){var t;g_pb_local_group_list_request.ReadCount=g_pb_feature.max_group_size,t=object2xml("request",g_pb_local_group_list_request),saveAjaxData("api/pb/group-list",t,(function(t){var o=xml2object(t);g_pb_groupListArray=[],"response"==o.type?(o.response.Groups.Group&&($.isArray(o.response.Groups.Group)?g_pb_groupListArray=o.response.Groups.Group:g_pb_groupListArray.push(o.response.Groups.Group)),"not_update_count"!=e&&(g_pb_curGroupCount=o.response.Count)):showInfoDialog(common_failed),"count_only"==e?pb_updateLocalGroupContactNum():pb_showLocalGroupList(e)}),{timeout:g_PB_TIMEOUT_SHORT,errorCB:function(){showInfoDialog(common_failed),pb_showLocalGroupList(e)}})}function pb_getLocalContactList(){var e;if(g_pb_local_contact_list_request.GroupID=g_pb_curGroupId,g_pb_local_contact_list_request.PageIndex=g_pb_pageIndex,g_pb_local_contact_list_request.ReadCount=g_pb_feature.page_size,$("#pb_search").hasClass("pb_search_init"))g_pb_local_contact_list_request.KeyWord="";else{var t=$.trim($("#pb_search").val());g_pb_local_contact_list_request.KeyWord=resolveXMLEntityReference(t),$("#pb_search").val(t)}e=object2xml("request",g_pb_local_contact_list_request),saveAjaxData("api/pb/pb-list",e,(function(e){var t=pb_local_xml2object(e);"response"==t.type?(g_pb_contactListArray=[],t.response.Phonebooks.Phonebook&&($.isArray(t.response.Phonebooks.Phonebook)?g_pb_contactListArray=t.response.Phonebooks.Phonebook:g_pb_contactListArray.push(t.response.Phonebooks.Phonebook),pb_showLocalContactList()),g_pb_curContactSum=t.response.SumSize,pb_initPagination()):showInfoDialog(common_failed)}),{timeout:g_PB_TIMEOUT_SHORT,errorCB:function(){showInfoDialog(common_failed)}})}function pb_localAddContact(){if(!pb_checkContactDetail())return button_enable("btn_save_contact",1),!1;var e=pb_local_object2xml("request",{GroupID:$("#hiddenGroupID").val(),SaveType:0,Field_FormattedName:resolveXMLEntityReference($("#txtFormattedName").val()),Field_MobilePhone:$("#txtMobilePhone").val(),Field_HomePhone:$("#txtHomePhone").val(),Field_WorkPhone:$("#txtWorkPhone").val(),Field_WorkEmail:resolveXMLEntityReference($("#txtWorkEmail").val())});saveAjaxData("api/pb/pb-new",e,(function(e){var t=pb_local_xml2object(e);"response"==t.type?(pb_initPage(),g_pb_curPhoneBook=t.response,pb_showLocalContactsDetail(-1),pb_controlBtnShow("show_detail")):showInfoDialog(common_failed),button_enable("btn_save_contact",1),startLogoutTimer()}),{timeout:g_PB_TIMEOUT_SHORT,errorCB:function(){showInfoDialog(common_failed),button_enable("btn_save_contact",1)}})}function pb_localEditContact(){if(!pb_checkContactDetail())return button_enable("btn_save_contact",1),!1;var e={GroupID:$("#hiddenGroupID").val(),Index:$("#hiddenIndex").val(),SaveType:0,Field_FormattedName:resolveXMLEntityReference($("#txtFormattedName").val()),Field_MobilePhone:$("#txtMobilePhone").val(),Field_HomePhone:$("#txtHomePhone").val(),Field_WorkPhone:$("#txtWorkPhone").val(),Field_WorkEmail:resolveXMLEntityReference($("#txtWorkEmail").val())},t=pb_local_object2xml("request",e);saveAjaxData("api/pb/pb-update",t,(function(t){var o=xml2object(t);isAjaxReturnOK(o)?(g_pb_curPhoneBook={GroupID:e.GroupID,Index:e.Index,SaveType:0,FormattedName:$("#txtFormattedName").val(),MobilePhone:e.Field_MobilePhone,HomePhone:e.Field_HomePhone,WorkPhone:e.Field_WorkPhone,WorkEmail:$("#txtWorkEmail").val()},pb_initPage(),pb_showLocalContactsDetail(-1),pb_controlBtnShow("show_detail")):showInfoDialog(common_failed),button_enable("btn_save_contact",1)}),{timeout:g_PB_TIMEOUT_SHORT,errorCB:function(){showInfoDialog(common_failed),button_enable("btn_save_contact",1)}})}function pb_localDeleteContact(e){var t="",o=0,a=$("#list_contacts :checkbox");e?(o++,t+="<Index>"+e+"</Index>"):a.filter(":checked").each((function(){o++,t+="<Index>"+this.value+"</Index>"}));var n=object2xml("request",t);saveAjaxData("api/pb/pb-delete",n,(function(e){var t=xml2object(e);isAjaxReturnOK(t)&&o==a.length&&g_pb_pageIndex>1&&(g_pb_pageIndex=Math.min(g_pb_pageIndex,g_pb_totalPbPage-1)),pb_initPage()}),{timeout:g_PB_TIMEOUT_SHORT,errorCB:function(){showInfoDialog(common_failed),button_enable("btn_del_contact",1),button_enable("btn_del_contact_b",1)}})}function pb_localSendMsg(e){var t,o=!1;t=1==g_sms_mode?"smsandroid.html?url&number=":"smsinbox.html?url&number=";var a=";",n=$("#list_contacts :checkbox");e?(t+=e+a,o=!0):n.filter(":checked").each((function(){var e=$(this).parents("li"),n=g_pb_contactListArray[pb_getLocalHrefNum(e)];n.MobilePhone?(o=!0,t+=n.MobilePhone.substr(0,g_pb_feature.max_phone_size)+a):n.HomePhone?(o=!0,t+=n.HomePhone.substr(0,g_pb_feature.max_phone_size)+a):n.WorkPhone&&(o=!0,t+=n.WorkPhone.substr(0,g_pb_feature.max_phone_size)+a)})),o?(t.match("#")&&(t=t.replace(/\#/g,"%23")),window.location.href=t,button_enable("btn_send_msg",1)):showInfoDialog(IDS_pb_send_sms)}function pb_localCopySimContact(){0==g_pb_local_count.SimUsed&&pb_getLocalCount(),0!=g_pb_local_count.SimUsed?parseInt(g_pb_local_count.LocalUsed,10)>=parseInt(g_pb_local_count.LocalMax,10)?showInfoDialog(strid_pb_hint_no_room):($("#pop_confirm").die("click"),showConfirmDialog(strid_pb_hint_import_sim_conform,(function(){$(".dialog").remove();var e=0,t=$("#pb_group_list :first-child").attr("class");if(""==$.trim(t)){var o=pb_getLocalHrefNum($("#pb_group_list .click").find("span"));e=g_pb_groupListArray[o].GroupID}pb_showWaitingDialog(common_waiting,strid_pb_hint_import_sim_doing.replace("%d",g_pb_local_count.SimUsed));var a=object2xml("request",{GroupID:e});saveAjaxData("api/pb/pb-copySIM",a,(function(e){var t=xml2object(e);if(pb_closeWaitingDialog(),"response"==t.type){var o,a=parseInt(t.response.TotalNum,10),n=parseInt(t.response.SucceedNum,10),_=a-n;o=0==t.response.FULL?pb_copy_complete+"&nbsp;"+n+"&nbsp;"+common_succeed+common_comma+_+"&nbsp;"+common_failed:pb_local_full+"&nbsp;"+n+"&nbsp;"+common_succeed+common_comma+_+"&nbsp;"+common_failed,showInfoDialog(o)}else showInfoDialog(common_failed);pb_initPage()}),{timeout:g_PB_TIMEOUT_LONG,errorCB:function(){pb_closeWaitingDialog(),showInfoDialog(common_failed)}})}),(function(){}))):showInfoDialog(strid_pb_hint_import_none)}function pb_localExportContact(e){var t="",o=0;if(e){if(0==g_pb_local_count.LocalUsed)return void showInfoDialog(common_no_record);t+="<Indexs>all</Indexs>",o=g_pb_local_count.LocalUsed}else{var a=$("#list_contacts :checkbox").filter(":checked");if(0==a.length)return void showInfoDialog(common_no_record_selected);t+="<Indexs>",a.each((function(){t+="<Index>"+this.value+"</Index>"})),t+="</Indexs>",o=a.length}t+="<SaveType>0</SaveType>",t+="<FileType>csv</FileType>",$("#pop_confirm").die("click"),showConfirmDialog(e?pb_export_all_contacts_confirm:pb_export_sel_contacts_confirm,(function(){$(".dialog").remove(),pb_showWaitingDialog(common_waiting,strid_pb_hint_export_doing.replace("%d",o));var e=object2xml("request",t);saveAjaxData("api/pb/pb-export",e,(function(e){var t=xml2object(e);pb_closeWaitingDialog(),isAjaxReturnOK(t)?$.browser.mozilla?window.open(g_pb_feature.export_csv_path):window.location.href=g_pb_feature.export_csv_path:showInfoDialog(common_failed)}),{timeout:g_PB_TIMEOUT_LONG,errorCB:function(){pb_closeWaitingDialog(),showInfoDialog(common_failed)}})}),(function(){}))}function pb_importFile(){var e=0,t=$("#pb_group_list :first-child").attr("class");if(""==$.trim(t)){var o=pb_getLocalHrefNum($("#pb_group_list .click").find("span"));e=g_pb_groupListArray[o].GroupID}var a=object2xml("request",{GroupID:e,SaveType:0,FileType:"csv"});saveAjaxData("api/pb/pb-import",a,(function(e){var t=xml2object(e);if(pb_closeWaitingDialog(),"response"==t.type){var o,a=t.response.TotalNum,n=t.response.SucceedNum;o=0==t.response.FULL?pb_copy_complete+"&nbsp;"+pb_total_count+"&nbsp;"+a+pb_success_count+"&nbsp;"+n:pb_local_full+"&nbsp;"+pb_success+"&nbsp;"+n,showInfoDialog(o)}else showInfoDialog(common_failed);pb_initPage()}),{timeout:g_PB_TIMEOUT_IMPORT,errorCB:function(){pb_closeWaitingDialog(),showInfoDialog(common_failed),pb_initPage()}})}function pb_matchFieldMap(){var e=pb_local_object2xml("request",{Field_FormattedName:g_pb_fieldMap[0],Field_MobilePhone:g_pb_fieldMap[1],Field_HomePhone:g_pb_fieldMap[2],Field_WorkPhone:g_pb_fieldMap[3],Field_WorkEmail:g_pb_fieldMap[4]});e=e.replace(/(Value)/g,"ImportName"),saveAjaxData("api/pb/pb-import-match",e,(function(e){var t=xml2object(e);if(isAjaxReturnOK(t))return pb_showWaitingDialog(strid_sms_label_import,strid_pb_hint_import_file_doing),void pb_importFile();showInfoDialog(common_failed)}),{timeout:g_PB_TIMEOUT_SHORT,errorCB:function(){showInfoDialog(common_failed)}})}function pb_showFieldMapDlg(){var e=0,t="<option value=''></option>",o=g_pb_fieldMap[0],a=g_pb_fieldMap[1],n=g_pb_fieldMap[2],_=g_pb_fieldMap[3],i=g_pb_fieldMap[4];for(e=0;e<g_pb_fieldCount;e++)""!=g_pb_fieldMap[e]&&(t=t+"<option value='"+g_pb_fieldMap[e]+"'>"+g_pb_fieldMap[e]+"</option>");var r="<div id='field_map_title' height='25px'>"+pb_field_tips+"</div><table id='pb_import_field'><tr height='50px'><td  class='pb_field_match'>"+common_name+":</td><td><select id='name_map_select' class='input_select'>"+t+"</select></td></tr><tr height='50px'><td class='pb_field_match'>"+pb_label_mobile_phone+":</td><td><select id='mphone_map_select' class='input_select'>"+t+"</select></td></tr><tr height='50px'><td class='pb_field_match'>"+pb_label_home_phone+":</td><td><select id='hphone_map_select' class='input_select'>"+t+"</select></td></tr><tr height='50px'><td class='pb_field_match'>"+pb_label_office_phone+":</td><td><select id='ophone_map_select' class='input_select'>"+t+"</select></td></tr><tr height='50px'><td class='pb_field_match'>"+pb_label_email+":</td><td><select id='email_map_select' class='input_select'>"+t+"</select></td></tr></table><div height='20px'>&nbsp;</div><div height='20px'>&nbsp;</div>";cancelLogoutTimer(),call_dialog(pb_field_map,r,common_ok,"pop_OK",common_cancel,"pop_Cancel"),$("#name_map_select").val(o),$("#mphone_map_select").val(a),$("#hphone_map_select").val(n),$("#ophone_map_select").val(_),$("#email_map_select").val(i),$("#pop_OK").bind("click",(function(){isButtonEnable("pop_OK")&&(startLogoutTimer(),g_pb_fieldMap[0]=$("#name_map_select").val(),g_pb_fieldMap[1]=$("#mphone_map_select").val(),g_pb_fieldMap[2]=$("#hphone_map_select").val(),g_pb_fieldMap[3]=$("#ophone_map_select").val(),g_pb_fieldMap[4]=$("#email_map_select").val(),$("#div_wrapper,.dialog").hide(),pb_matchFieldMap())})),$("#pop_Cancel").bind("click",(function(){startLogoutTimer()}))}function pb_importMap(){getAjaxData("api/pb/pb-import-field",(function(e){var t=xml2object(e);if(pb_closeWaitingDialog(),"response"==t.type){if(1==t.response.FieldMatch)return pb_showWaitingDialog(strid_sms_label_import,strid_pb_hint_import_file_doing),void pb_importFile();g_pb_fieldCount=t.response.Fields.Count,g_pb_fieldMap=[];var o=0;for(o=0;o<g_pb_fieldCount;o++)g_pb_fieldMap[o]=t.response.Fields.Name[o];if(1==g_pb_fieldCount&&(g_pb_fieldMap[0]=t.response.Fields.Name),5>g_pb_fieldCount)for(o=g_pb_fieldCount;o<5;o++)g_pb_fieldMap[o]="";pb_showFieldMapDlg()}else showInfoDialog(common_error);$("#all_contacts_count").text(g_pb_local_count.LocalUsed)}),{sync:!0,timeout:g_PB_TIMEOUT_SHORT,errorCB:function(){pb_closeWaitingDialog(),showInfoDialog(common_error)}})}function pb_uploadFile(){pb_showWaitingDialog(common_waiting,pb_hint_get_mapfield);var e={url:"../api/filemanager/upload",success:function(e,t){"success"==t?pb_importMap():(pb_closeWaitingDialog(),showInfoDialog(common_error))},error:function(){pb_closeWaitingDialog(),showInfoDialog(common_error)}};$("#form_update").ajaxSubmit(e)}function pb_newGroup(){if(""==$.trim($("#txtNewGroup").val()))return showInfoDialog(pb_group_empty),$("#pb_add_group").empty(),g_pb_curGroupCount--,setTimeout((function(){$("#btn_new_contact").bind("click",pb_new_contactClick())}),1e3),void setTimeout((function(){$("#btn_pb_import").bind("click",pb_import_Click())}),1e3);var e={GroupName:$.trim($("#txtNewGroup").val())};if(pb_checkGroupExist(e.GroupName,0))return showInfoDialog(strid_pb_hint_group_exist),$("#pb_add_group").empty(),g_pb_curGroupCount--,setTimeout((function(){$("#btn_new_contact").bind("click",pb_new_contactClick())}),1e3),void setTimeout((function(){$("#btn_pb_import").bind("click",pb_import_Click())}),1e3);e.GroupName=resolveXMLEntityReference(e.GroupName);var t=object2xml("request",e);saveAjaxData("api/pb/group-new",t,(function(e){"response"==xml2object(e).type?(pb_clearPage("clear_group"),pb_getLocalContactList(),pb_getLocalGroupList("not_update_count")):(showInfoDialog(common_failed),$("#pb_add_group").empty(),g_pb_curGroupCount--)}),{timeout:g_PB_TIMEOUT_SHORT,errorCB:function(){showInfoDialog(common_failed),$("#pb_add_group").empty(),g_pb_curGroupCount--}}),$("#btn_new_contact").bind("click",pb_new_contactClick()),$("#btn_pb_import").bind("click",pb_import_Click())}function pb_updateGroup(e,t){var o={GroupID:pb_getLocalHrefNum(e),GroupName:$.trim($("#txtEditorGroup").val())};if(""==o.GroupName&&(showInfoDialog(pb_group_empty),$("#txtEditorGroup").select(),o.GroupName=t),pb_checkGroupExist(o.GroupName,o.GroupID))return showInfoDialog(strid_pb_hint_group_exist),void(window.navigator.userAgent.indexOf("Firefox")>0?(setTimeout((function(){$("#txtEditorGroup").focus()}),0),$(".dialog_close_btn").click((function(){setTimeout((function(){$("#txtEditorGroup").focus()}),0)}))):($("#txtEditorGroup").focus(),$(".dialog_close_btn").click((function(){$("#txtEditorGroup").focus()}))));o.GroupName=resolveXMLEntityReference(o.GroupName),g_pb_editgroupID=o.GroupID;var a=object2xml("request",o);saveAjaxData("api/pb/group-update",a,(function(e){var t=xml2object(e);isAjaxReturnOK(t)?pb_getLocalGroupList("edit_group"):(showInfoDialog(common_failed),$("#txtEditorGroup").select())}),{timeout:g_PB_TIMEOUT_SHORT,errorCB:function(){showInfoDialog(common_failed),$("#txtEditorGroup").select()}}),$("btn_new_contact").bind("click",pb_new_contactClick()),$("btn_pb_import").bind("click",pb_import_Click())}function pb_deleteGroup(e){var t=object2xml("request",{GroupID:e});saveAjaxData("api/pb/group-delete",t,(function(e){var t=xml2object(e);isAjaxReturnOK(t)?(pb_clearPage("clear_group"),pb_getLocalContactList(),pb_getLocalGroupList(),pb_initPage()):showInfoDialog(common_failed)}),{timeout:g_PB_TIMEOUT_SHORT,errorCB:function(){showInfoDialog(common_failed)}})}function pb_moveToGroup(e){var t="",o=$("#list_contacts :checkbox").filter(":checked");t+="<Indexs>",o.each((function(){t+="<Index>"+this.value+"</Index>"})),t+="</Indexs>",t+="<SaveType>0</SaveType>",t+="<GroupID>"+e+"</GroupID>";var a=object2xml("request",t);saveAjaxData("api/pb/pb-move",a,(function(t){pb_getLocalGroupList("count_only"),0==e?$("#pb_group_list li").eq(0).click():$("#pb_group_list li").eq(pb_getLocalGroupListNum(e)+1).click()}),{timeout:g_PB_TIMEOUT_SHORT,errorCB:function(){pb_closeWaitingDialog(),showInfoDialog(common_failed)}})}function pb_getLocalHrefNum(e){return $(e).attr("href").match(/\d*/)}function pb_getLocalGroupListNum(e){var t=0,o=0;for(t=0;t<g_pb_groupListArray.length;t++)if(e==g_pb_groupListArray[t].GroupID){o=t;break}return o}function pb_showLocalContactList(){$("#list_contacts").empty(),$.each(g_pb_contactListArray,(function(e,t){var o=vLocalShowContactList;o=replaceString(o=pb_local_replaceVLocalShowContactList(o,t),"%href%",e),$("#list_contacts").append(o)})),g_pb_contactListArray.length>0&&""==$("#div_local_detail").html()&&(pb_showLocalContactsDetail(0),pb_controlBtnShow("show_detail"))}function pb_updateLocalGroupContactNum(){$("#pb_group_list label").each((function(e){$(this).text(g_pb_groupListArray[e].Number)}))}function pb_showLocalMoveToGroup(){var e="",t=$("#pb_group_list :first-child").attr("class");""==$.trim(t)&&(e+=vMoveAllContacts),$.each(g_pb_groupListArray,(function(t,o){g_pb_curGroupId!=o.GroupID&&(e+=pb_local_replaceVLocalShowMoveToGroup(vLocalShowMoveToGroup,o))}));var o="<div id='pb_move_pop_title' height='25px'>"+pb_move_sel_contacts_to+"</div><table align='center' class='pb_move_pop_table'>"+e+"</table><div height='25px'>&nbsp;</div>";call_dialog(common_move,o,common_ok,"pop_OK",common_cancel,"pop_Cancel"),button_enable("pop_OK","0"),$("input[name=radioGroup]").bind("click",(function(){button_enable("pop_OK","1")})),$("#pop_OK").live("click",(function(){if(isButtonEnable("pop_OK"))return $("#div_wrapper,.dialog").hide(),pb_moveToGroup($("input[name=radioGroup]:checked").val()),!1}))}function pb_showLocalGroupList(e){$("#pb_group_list").empty(),$("#pb_group_list").append(vLocalAllContacts),$("#all_contacts_count").text(g_pb_local_count.LocalUsed),"edit_group"!=e&&($("#cur_group_type").html(pb_label_all_contacts),$("#pb_group_list li").removeClass("click"),$("#pb_group_list li").addClass("click")),$.each(g_pb_groupListArray,(function(e,t){var o=pb_local_replaceVLocalShowGroupList(vLocalShowGroupList,t);o=replaceString(o,"%NumberVLocalShowGroupList%",e),$("#pb_group_list").append(o)})),"edit_group"==e&&(g_pb_editgroupFlag=!0,$("#pb_group_list li.margin_b").eq(pb_getLocalGroupListNum(g_pb_editgroupID)).click()),g_pb_editgroupFlag=!1,clickMenu("menu_pb"),$("#pb_group_list img").hide(),$("#pb_group_list li").bind("mouseover",(function(){$(this).find("label").hide(),$(this).find("img").fadeTo("normal",1,(function(){$(this).find("img").show()}))})),$("#pb_group_list li").bind("mouseleave",(function(){$(this).find("img").hide(),$(this).find("label").show()})),"material"==webui_mode&&materializeLeftMenu()}function pb_showLocalContactsDetail(e){var t=pb_localFillContactInfo(e,vLocalShowContact);t=replaceString(t,"%Num%",e),g_pb_selectListNum=e,$("#div_local_detail").html(t),$(".pb_table_details img").hide(),$(".pb_pre").each((function(){""!=$.trim($(this).text())&&($(this).find("img").show(),$(this).find("a").show())}))}function pb_localShowAddContact(){$("#div_local_detail").html(get_vLocalAddContact());var e=$("#pb_group_list :first-child").attr("class");if(""==$.trim(e)){var t=$("#pb_group_list .click").attr("href");$("#hiddenGroupID").attr("value",t)}$("#txtFormattedName").focus()}function pb_localShowEditContact(e){var t=-1==e?g_pb_curPhoneBook:g_pb_contactListArray[e],o=pb_local_replaceVLocalModifyContact(get_vLocalModifyContact(),t);$("#div_local_detail").html(o),t.WorkEmail.length<=g_pb_feature.max_email_size?$("#txtWorkEmail").val(t.WorkEmail):$("#txtWorkEmail").val(t.WorkEmail.substr(0,g_pb_feature.max_email_size)),$("#txtFormattedName").focus(),(g_pb_nameLength=utf8_strlen(t.FormattedName))<=g_pb_feature.max_name_size?$("#txtFormattedName").val(t.FormattedName):(g_pb_nameNumber=utf8_str_id(t.FormattedName,g_pb_feature.max_name_size),$("#txtFormattedName").val(t.FormattedName.substr(0,g_pb_nameNumber)))}function pb_localFillContactInfo(e,t){return pb_local_replaceVLocalShowContact(t,-1==e?g_pb_curPhoneBook:g_pb_contactListArray[e])}function pb_localShowImportContact(){parseInt(g_pb_local_count.LocalUsed,10)>=parseInt(g_pb_local_count.LocalMax,10)?showInfoDialog(strid_pb_hint_no_room):(call_dialog(strid_import_contacts,vLocalImportContact,strid_sms_label_import,"pop_OK",common_cancel,"pop_Cancel"),button_enable("pop_OK","0"),$("#pop_OK").bind("click",(function(){isButtonEnable("pop_OK")&&($("#div_wrapper,.dialog").hide(),$("#hilink_uploadpath").val("FS:contacts.csv"),pb_uploadFile())})))}function pb_localShowNewGroup(){if(parseInt(g_pb_curGroupCount,10)>=parseInt(g_pb_feature.max_group_size,10))return showInfoDialog(strid_pb_group_hint_no_room),setTimeout((function(){$("#btn_new_contact").bind("click",pb_new_contactClick())}),1e3),void setTimeout((function(){$("#btn_pb_import").bind("click",pb_import_Click())}),1e3);g_pb_curGroupCount++,$("#pb_add_group").append(get_vLocalNewGroup()),$("#txtNewGroup").select(),$("#txtNewGroup").focus(),$("#txtNewGroup").bind("blur",(function(){0==g_pb_status&&(pb_newGroup(),g_pb_status=1)})),$("#txtNewGroup").bind("keydown",(function(e){13==e.keyCode&&0==g_pb_status&&(pb_newGroup(),g_pb_status=1)}))}function pb_localShowEditorGroup(e){var t=$(e).parents("li"),o=t.find("span"),a=pb_getLocalHrefNum(o),n=g_pb_groupListArray[a].GroupName;$(o).empty(),$(t.find("a")).remove(),$(t.find("p")).remove(),$(t).append(get_vLocalEditorGroup()),$("#txtEditorGroup").val(n),$("#txtEditorGroup").focus(),$("#txtEditorGroup").select(),$("#txtEditorGroup").bind("blur",(function(){pb_updateGroup(t,n)})),$("#txtEditorGroup").bind("keydown",(function(e){13==e.keyCode&&pb_updateGroup(t,n)}))}function pb_clearDialog(){$(".dialog").fadeOut((function(){$(".dialog").remove()}))}function pb_checkRgExp(e,t,o){var a=!0;return o&&e.length>o?a=!1:(0!=e.length&&e.match(t)||(a=!1),a)}function utf8_strlen(e){var t=0,o=0;for(o=0;o<e.length;o++){var a=e.charCodeAt(o);t+=a<128?1:a<2048?2:3}return t}function pb_checkName(e){}function pb_checkNameLength(e){$("#"+$(e).attr("id")+"_error").text("");var t=$.trim($(e).val()),o=0,a=0;for($(e).val(t),a=0;a<t.length;a++)o+=utf8_strlen(t.charAt(a));return g_pb_feature.max_name_size<o?($("#"+$(e).attr("id")+"_error").text(IDS_sms_hint_content_too_long),$(e).focus(),!1):-1==t.indexOf(";")||($("#"+$(e).attr("id")+"_error").text(IDS_pb_name_valid_char),$(e).focus(),!1)}function pb_checkPhoneNumber(e){if($("#"+$(e).attr("id")+"_error").text(""),$(e).val($.trim($(e).val())),""==$(e).val())return!0;var t=g_pb_feature.max_phone_size;return!!pb_checkRgExp($(e).val(),/^[+]{0,1}[*#0123456789]*$/,t)||($("#"+$(e).attr("id")+"_error").text(pb_hint_number_format.replace("%d",t)),$(e).focus(),!1)}function pb_checkEmail(e){if($("#"+$(e).attr("id")+"_error").text(""),$(e).val($.trim($(e).val())),""==$(e).val())return!0;var t=g_pb_feature.max_email_size;return!!pb_checkRgExp($(e).val(),/^[\x00-\x7F]*@[\x00-\x7F]*$/,t)||($("#"+$(e).attr("id")+"_error").text(pb_hint_email_format),$(e).focus(),!1)}function pb_checkContactDetail(){if(""==$.trim($("#txtFormattedName").val())&&$("#txtFormattedName").val($.trim($("#txtFormattedName").val())),!pb_checkNameLength($("#txtFormattedName"))|!pb_checkEmail($("#txtWorkEmail"))|!pb_checkPhoneNumber($("#txtWorkPhone"))|!pb_checkPhoneNumber($("#txtHomePhone"))|!pb_checkPhoneNumber($("#txtMobilePhone")))return!1;if(""==$("#txtFormattedName").val())if(""!=$("#txtMobilePhone").val())$("#txtFormattedName").val($("#txtMobilePhone").val().substr(0,g_pb_feature.max_name_size));else if(""!=$("#txtHomePhone").val())$("#txtFormattedName").val($("#txtHomePhone").val().substr(0,g_pb_feature.max_name_size));else{if(""==$("#txtWorkPhone").val())return showInfoDialog(strid_pb_input_contact),$("#txtFormattedName").focus(),!1;$("#txtFormattedName").val($("#txtWorkPhone").val().substr(0,g_pb_feature.max_name_size))}return!0}function pb_checkUploadFileName(){var e=$("#up_nodite").val();/\.csv$/i.test(e)?(clearAllErrorLabel(),button_enable("pop_OK","1")):(clearAllErrorLabel(),showErrorUnderTextbox("up_nodite",system_hint_file_name_empty),button_enable("pop_OK","0"))}function pb_checkGroupExist(e,t){var o=0;for(o=0;o<g_pb_groupListArray.length;o++)if(e==g_pb_groupListArray[o].GroupName&&t!=g_pb_groupListArray[o].GroupID)return!0;return!1}function pb_local_xml2object(e){var t={};if(e.find("response").size()>0){var o=pb_local_recursiveXml2Object(e.find("response"));t.type="response",t.response=o}else if(e.find("error").size()>0){var a=e.find("code").text(),n=e.find("message").text();t.type="error",t.error={code:a,message:n}}else t.type="unknown";return t}function pb_local_recursiveXml2Object(e){if(e.children().size()>0){var t={};return e.children().each((function(){if("Field"!=this.tagName){var e=$(this).children().size()>0?pb_local_recursiveXml2Object($(this)):$(this).text();$(this).siblings().size()>0&&$(this).siblings().get(0).tagName==this.tagName?(null==t[this.tagName]&&(t[this.tagName]=[]),t[this.tagName].push(e)):t[this.tagName]=e}else t[$(this).find("Name").text()]=$(this).find("Value").text()})),t}return e.text()}function pb_local_object2xml(e,t){return'<?xml version="1.0" encoding="UTF-8"?>'+pb_local_recursiveObject2Xml(e,t)}function pb_local_recursiveObject2Xml(e,t){var o="";return"string"==typeof t||"number"==typeof t?o=_createNodeStr(e,t):jQuery.isArray(t)?jQuery.each(t,(function(t,a){o+=pb_local_recursiveObject2Xml(e,a)})):"object"==typeof t&&(o+="<"+e+">",jQuery.each(t,(function(e,t){var a=/^Field_(.*)$/;e.match(a)?o+=pb_local_createNodeStr(e.replace(a,"$1"),t):o+=pb_local_recursiveObject2Xml(e,t)})),o+="</"+e+">"),o}function pb_local_createNodeStr(e,t){return"<Field><Name>"+e+"</Name><Value>"+t+"</Value></Field>"}function pb_local_replaceVLocalModifyContact(e,t){var o=e;return o=t.MobilePhone?t.MobilePhone.length<=g_pb_feature.max_phone_size?replaceString(o,"%MobilePhone%",t.MobilePhone):replaceString(o,"%MobilePhone%",t.MobilePhone.substr(0,g_pb_feature.max_phone_size)):replaceString(o,"%MobilePhone%",""),o=t.HomePhone?t.HomePhone.length<=g_pb_feature.max_phone_size?replaceString(o,"%HomePhone%",t.HomePhone):replaceString(o,"%HomePhone%",t.HomePhone.substr(0,g_pb_feature.max_phone_size)):replaceString(o,"%HomePhone%",""),o=t.WorkPhone?t.WorkPhone.length<=g_pb_feature.max_phone_size?replaceString(o,"%WorkPhone%",t.WorkPhone):replaceString(o,"%WorkPhone%",t.WorkPhone.substr(0,g_pb_feature.max_phone_size)):replaceString(o,"%WorkPhone%",""),o=t.GroupID?replaceString(o,"%GroupID%",t.GroupID):replaceString(o,"%GroupID%","0"),t.Index?replaceString(o,"%Index%",t.Index):replaceString(o,"%Index%","")}function pb_local_replaceVLocalShowContactList(e,t){var o=e;return o=t.Index?replaceString(o,"%Index%",t.Index):replaceString(o,"%Index%",""),t.FormattedName?(g_pb_nameLength=utf8_strlen(t.FormattedName))<=g_pb_feature.max_name_size?o=replaceString(o,"%FormattedNameTwo%",resolveXMLEntityReference(t.FormattedName).replace(/\s/g,"&nbsp;")):(g_pb_nameNumber=utf8_str_id(t.FormattedName,g_pb_feature.max_name_size),afterSubstrName=t.FormattedName.substr(0,g_pb_nameNumber),o=replaceString(o,"%FormattedNameTwo%",resolveXMLEntityReference(afterSubstrName).replace(/\s/g,"&nbsp;"))):o=replaceString(o,"%FormattedNameTwo%",""),o}function utf8_str_id(e,t){var o=0,a=0;for(a=0;a<e.length;a++){var n=e.charCodeAt(a);if((o+=n<128?1:n<2048?2:3)>t)break}return a}function pb_local_replaceVLocalShowContact(e,t){var o=e;return t.FormattedName?(g_pb_nameLength=utf8_strlen(t.FormattedName))<=g_pb_feature.max_name_size?o=replaceString(o,"%FormattedNameOne%",resolveXMLEntityReference(t.FormattedName).replace(/\s/g,"&nbsp;")):(g_pb_nameNumber=utf8_str_id(t.FormattedName,g_pb_feature.max_name_size),afterSubstrName=t.FormattedName.substr(0,g_pb_nameNumber),o=replaceString(o,"%FormattedNameOne%",resolveXMLEntityReference(afterSubstrName).replace(/\s/g,"&nbsp;"))):o=replaceString(o,"%FormattedNameOne%",""),o=t.MobilePhone?t.MobilePhone.length<=g_pb_feature.max_phone_size?replaceString(o,"%MobilePhone%",t.MobilePhone):replaceString(o,"%MobilePhone%",t.MobilePhone.substr(0,g_pb_feature.max_phone_size)):replaceString(o,"%MobilePhone%",""),o=t.HomePhone?t.HomePhone.length<=g_pb_feature.max_phone_size?replaceString(o,"%HomePhone%",t.HomePhone):replaceString(o,"%HomePhone%",t.HomePhone.substr(0,g_pb_feature.max_phone_size)):replaceString(o,"%HomePhone%",""),o=t.WorkPhone?t.WorkPhone.length<=g_pb_feature.max_phone_size?replaceString(o,"%WorkPhone%",t.WorkPhone):replaceString(o,"%WorkPhone%",t.WorkPhone.substr(0,g_pb_feature.max_phone_size)):replaceString(o,"%WorkPhone%",""),t.WorkEmail?t.WorkEmail.length<=g_pb_feature.max_email_size?replaceString(o,"%WorkEmail%",resolveXMLEntityReference(t.WorkEmail).replace(/\s/g,"&nbsp;")):replaceString(o,"%WorkEmail%",resolveXMLEntityReference(t.WorkEmail.substr(0,g_pb_feature.max_email_size)).replace(/\s/g,"&nbsp;")):replaceString(o,"%WorkEmail%","")}function pb_local_replaceVLocalShowMoveToGroup(e,t){var o=e;return t.GroupID?(o=replaceString(o,"%GroupID%",t.GroupID),o=replaceString(o,"%MoveGroupID%",t.GroupID)):(o=replaceString(o,"%GroupID%",""),o=replaceString(o,"%MoveGroupID%","")),t.GroupName?replaceString(o,"%GroupNameOne%",resolveXMLEntityReference(t.GroupName).replace(/\s/g,"&nbsp;")):replaceString(o,"%GroupNameOne%","")}function pb_local_replaceVLocalShowGroupList(e,t){var o=e;return o=t.GroupID?replaceString(o,"%GroupID%",t.GroupID):replaceString(o,"%GroupID%",""),o=t.GroupName?replaceString(o,"%GroupNameTwo%",resolveXMLEntityReference(t.GroupName).replace(/\s/g,"&nbsp;")):replaceString(o,"%GroupNameTwo%",""),t.Number?replaceString(o,"%Number%",t.Number):replaceString(o,"%Number%","0")}function get_vLocalAddContact(){return"<table class='pb_table_details' border='0' cellpadding='0' cellspacing='0'>  <tr height='30px'>    <th>"+common_name+common_colon+"</th>    <td><input class='pb_input_style' type='text' id='txtFormattedName' tabindex='1' onchange='pb_checkName(this)'/></td>  </tr>  <tr height='20px'>    <th></th>    <td valign='top' class='pb_error_message'><label id='txtFormattedName_error'></label></td>  </tr>  <tr height='30px'>    <th>"+pb_label_mobile_phone+common_colon+"</th>    <td><input class='pb_input_style success_phone_number' type='text' id='txtMobilePhone' tabindex='2' maxlength='"+g_pb_feature.max_phone_size+"'/></td>  </tr>  <tr height='20px'>    <th></th>    <td valign='top' class='pb_error_message'><label id='txtMobilePhone_error'></label></td>  </tr>  <tr height='30px'>    <th>"+pb_label_home_phone+common_colon+"</th>    <td><input class='pb_input_style success_phone_number' type='text' id='txtHomePhone' tabindex='3' maxlength='"+g_pb_feature.max_phone_size+"'/></td>  </tr>  <tr height='20px'>    <th></th>    <td valign='top' class='pb_error_message'><label id='txtHomePhone_error'></label></td>  </tr>  <tr height='30px'>    <th>"+pb_label_office_phone+common_colon+"</th>    <td><input class='pb_input_style success_phone_number' type='text' id='txtWorkPhone' tabindex='4' maxlength='"+g_pb_feature.max_phone_size+"'/></td>  </tr>  <tr height='20px'>    <th></th>    <td valign='top' class='pb_error_message'><label id='txtWorkPhone_error'></label></td>  </tr>  <tr>    <th>"+pb_label_email+common_colon+"</th>    <td><input class='pb_input_style success_phone_number' type='text' id='txtWorkEmail' tabindex='5' maxlength='"+g_pb_feature.max_email_size+"'/></td>  </tr>  <tr height='20px'>    <th></th>    <td valign='top' class='pb_error_message'><label id='txtWorkEmail_error'></label></td>  </tr>  <input type='hidden' id='hiddenGroupID' value='0'/></table>"}function get_vLocalModifyContact(){return"<table class='pb_table_details' border='0' cellpadding='0' cellspacing='0'>  <tr height='30px'>    <th>"+common_name+common_colon+"</th>    <td>      <input class='pb_input_style' type='text' id='txtFormattedName' tabindex='1' onchange='pb_checkName(this)'/>    </td>  </tr>  <tr height='20px'>    <th></th>    <td valign='top' class='pb_error_message'><label id='txtFormattedName_error'></label></td>  </tr>  <tr height='30px'>    <th>"+pb_label_mobile_phone+common_colon+"</th>    <td><input class='pb_input_style success_phone_number' type='text' id='txtMobilePhone' tabindex='2' value='%MobilePhone%' maxlength='"+g_pb_feature.max_phone_size+"'/></td>  </tr>  <tr height='20px'>    <th></th>    <td valign='top' class='pb_error_message'><label id='txtMobilePhone_error'></label></td>  </tr>  <tr height='30px'>    <th>"+pb_label_home_phone+common_colon+"</th>    <td><input class='pb_input_style success_phone_number' type='text' id='txtHomePhone' tabindex='3' value='%HomePhone%' maxlength='"+g_pb_feature.max_phone_size+"'/></td>  </tr>  <tr height='20px'>    <th></th>    <td valign='top' class='pb_error_message'><label id='txtHomePhone_error'></label></td>  </tr>  <tr height='30px'>    <th>"+pb_label_office_phone+common_colon+"</th>    <td><input class='pb_input_style success_phone_number' type='text' id='txtWorkPhone' tabindex='4' value='%WorkPhone%' maxlength='"+g_pb_feature.max_phone_size+"'/></td>  </tr>  <tr height='20px'>    <th></th>    <td valign='top' class='pb_error_message'><label id='txtWorkPhone_error'></label></td>  </tr>  <tr height='30px'>    <th>"+pb_label_email+common_colon+"</th>    <td><input class='pb_input_style success_phone_number' type='text' id='txtWorkEmail' tabindex='5' maxlength='"+g_pb_feature.max_email_size+"'/></td>  </tr>  <tr height='20px'>    <th></th>    <td valign='top' class='pb_error_message'><label id='txtWorkEmail_error'></label></td>  </tr>  <input type='hidden' id='hiddenGroupID' value='%GroupID%'/>  <input type='hidden' name='hiddenIndex' id='hiddenIndex' value='%Index%'></table>"}pb_getConfig();var vLocalShowContact="<table class='pb_table_details' border='0' cellpadding='0' cellspacing='0'>  <tr height='50px'>    <th valign='top'>"+common_name+common_colon+"</th>    <td valign='top'><pre class='pb_pre'>%FormattedNameOne%</pre></td>  </tr>  <tr height='50px'>    <th valign='top'>"+pb_label_mobile_phone+common_colon+"</th>    <td valign='top'><pre class='pb_pre success_phone_number'>%MobilePhone%<img src='../res/msg.gif'/></pre></td>  </tr>  <tr height='50px'>    <th valign='top'>"+pb_label_home_phone+common_colon+"</th>    <td valign='top'><pre class='pb_pre success_phone_number'>%HomePhone%<img src='../res/msg.gif'/></pre></td>  </tr>  <tr height='50px'>    <th valign='top'>"+pb_label_office_phone+common_colon+"</th>    <td valign='top'><pre class='pb_pre success_phone_number'>%WorkPhone%<img src='../res/msg.gif'/></pre></td>  </tr>  <tr height='50px'>    <th valign='top'>"+pb_label_email+common_colon+"</th>    <td valign='top'><pre class='pb_pre success_phone_number'>%WorkEmail%</pre></td>  </tr>  <input type='hidden' name='hiddenNum' id='hiddenNum' value='%Num%'></table>",vLocalShowContactList="<li href='%href%'>  <div id='div_checkbox'>&nbsp;&nbsp;&nbsp;<input type='checkbox' id='pb_checkbox' name='pb_checkbox' value='%Index%'/></div>  <div style='width: 163px; overflow: hidden; white-space: nowrap;'><a title='%FormattedNameTwo%' herf='javascript:void(0);'>&nbsp;&nbsp;&nbsp;%FormattedNameTwo%</a></div></li>",vLocalAllContacts="<li href='0'><a>  <span style='width:175px'>"+pb_label_all_contacts+"</span>  <p><b id='all_contacts_count'></b>&nbsp;&nbsp;&nbsp;</p></a></li>",vLocalShowGroupList="<li class='margin_b' href='%GroupID%'><a title='%GroupNameTwo%'>  <span style='width:175px;overflow:hidden;white-space:nowrap' href='%NumberVLocalShowGroupList%'>%GroupNameTwo%</span>  <p><label>%Number%</label><img id='pb_editor_group' src='../res/editor.gif'/>&nbsp;&nbsp;&nbsp;<img id='pb_delete_group' src='../res/delete.gif'/></p></a></li>";function get_vLocalNewGroup(){return"<li><span><input type='text' maxlength="+g_pb_feature.max_group_name_size+" id='txtNewGroup' value=''/></span></li>"}function get_vLocalEditorGroup(){return"<input type='text' maxlength="+g_pb_feature.max_group_name_size+" id='txtEditorGroup'/>"}var vLocalImportContact="<form id='form_update' enctype='multipart/form-data' method='post'>  <table align='center'><tr>    <td><input type='hidden' id='hilink_uploadpath' name='hilink_uploadpath' value=''></td>    <td class='up_nodite'><input type='file' id='up_nodite' name='up_nodite'  class='pb_up_file' size='55' onChange='pb_checkUploadFileName()'/></td>  </tr></table></form>",vLocalShowMoveToGroup="<tr><td><input class='radio' type='radio' name='radioGroup' value='%GroupID%'><span value='%MoveGroupID%'>%GroupNameOne%</span></td></tr>",vMoveAllContacts="<tr'><td><input class='radio' type='radio' name='radioGroup' value='0'><span value='0'>"+pb_label_all_contacts+"</span></td></tr>";function pb_showWaitingDialog(e,t){cancelLogoutTimer(),showWaitingDialog(e,t)}function pb_closeWaitingDialog(){startLogoutTimer(),closeWaitingDialog()}function replaceString(e,t,o){var a=0,n=e;return"%href%"==t?(a=n.indexOf(t))>=0&&(n=n.substring(0,a)+o+n.substr(a+t.length)):"%FormattedNameTwo%"==t||"%GroupNameTwo%"==t?((a=n.indexOf(t))>=0&&(n=n.substring(0,a)+o+n.substr(a+t.length)),(a=n.lastIndexOf(t))>=0&&(n=n.substring(0,a)+o+n.substr(a+t.length))):(a=n.lastIndexOf(t))>0&&(n=n.substring(0,a)+o+n.substr(a+t.length)),n}$(document).ready((function(){pb_initPage(!0),pb_initBtnClick(),pb_sent_record_maxlength()}));
