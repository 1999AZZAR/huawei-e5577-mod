function showUploadStatus(e){var a="";if(SD_FILE_UPLOAD_SUCCESS==e)return a=sd_hint_upload_file_success,initSdCardCapacity(),folderlists(folder_path.CurrentPath),void showInfoDialog(a);a=SD_FILE_UPLOAD_FAIL==e?sd_hint_upload_file_failed:SD_FILE_UPLOAD_FAIL_NOSPACE==e?sd_hint_not_enough_space_available:SD_FILE_UPLOAD_FAIL_NOSD==e?sd_label_no_sd_card:SD_FILE_UPLOAD_FAIL_2GB==e?sd_hint_file_size_over_2gb:SD_FILE_UPLOAD_FAILED_WRONG_FILENAME==e?sd_hint_wrong_file_name:SD_FILE_UPLOAD_FAILED_SD_REMOVED==e?sd_hint_sd_card_removed:SD_FILE_UPLOAD_FAILED_NAME_LONGER==e?IDS_sd_file_name_longer:SD_FILE_UPLOAD_FAILED_ACCESS_RIGHTS==e?IDS_sd_no_access_rights:sd_hint_upload_file_failed,initSdCardCapacity(),showInfoDialog(a),setTimeout((function(){gotoPageWithHistory("sdcardsharing.html")}),2500)}function showUploadProgressDialog(e,a){var o="";if(a){if("material"==webui_mode){o+="<h4 class='mdl-dialog__title'>"+sd_label_upload+"</h4>",o+="<div class='mdl-dialog__content'>",o+="    <table cellspacing='0' cellpadding='0' class='get_table' width='400'>",o+="        <tr>",o+="            <td><span id='uploadInfo'></span></td>",o+="        </tr>",o+="        <tr>",o+="            <td>",o+="                <div class='graph'>",o+="                    <div class='persent_download'><img src='../res/persent_download.jpg' class='press'/></div>",o+="                </div>",o+="            </td>",o+="        </tr>",o+="        <tr>",o+="            <td><span id='downloadProcess'></span></td>",o+="        </tr>",o+="    </table>",o+="</div>",o+="<div class='mdl-dialog__actions'>",o+="    <a href='javascript:void(0);' id='pop_Cancel' class='mdl-button'>"+common_cancel+"</a>",o+="</div>",$("#pop_Cancel").live("click",(function(){window.location.href="sdcardsharing.html?"+rfc3986_url_resolveSpecialChar(folder_path.CurrentPath).replace(/\//g,"%2F")}));var t=document.createElement("dialog");t.className="dialog mdl-dialog",t.innerHTML=o,$(".body_bg").before(t),t.showModal||dialogPolyfill.registerDialog(t),t.showModal(),$("#uploadInfo").html(sd_label_uploading)}else{if($("#div_wrapper").remove(),$("#div_wrapper").size()<1&&(o+="<div id='div_wrapper'><iframe   id='ifream_dialog'  src= '' frameborder= '0' style= 'background:#bcbcbc; position:absolute; width:100%; height:100%; z-index:-1; display: block;'> </iframe></div>"),o+="<div class='dialog'>",o+="    <div class='dialog_content'>",o+="        <div class='dialog_header'>",o+="            <span class='dialog_header_left clr_white'>"+sd_label_upload+"</span>",o+="            <span class='dialog_header_right'><a href='javascript:void(0);' title='' class='dialog_close_btn clr_gray'><canvas id='sdUploadFileCanvas' width='25px' height='25px'></canvas></a></span>",o+="        </div>",o+="        <div class='dialog_table'>",o+="            <table cellspacing='0' cellpadding='0' class='get_table' width='400'>",o+="                <tr>",o+="                    <td><span id='uploadInfo'></span></td>",o+="                </tr>",o+="                <tr>",o+="                    <td>",o+="                        <div class='graph'>",o+="                            <div class='persent_download'><img src='../res/persent_download.jpg' class='press'/></div>",o+="                        </div>",o+="                    </td>",o+="                </tr>",o+="                <tr>",o+="                    <td><span id='downloadProcess'></span></td>",o+="                </tr>",o+="            </table>",o+="        </div>",o+="        <div class='dialog_table_bottom'>",o+="            <div class='dialog_table_r'>",o+="                <span class='button_wrapper pop_Cancel'>",o+="                    <input id='pop_Cancel' class='button_dialog' type='button' value='"+common_cancel+"'/></span>",o+="            </div>",o+="        </div>",o+="    </div>",o+="</div>",$(".dialog_close_btn,#pop_Cancel").live("click",(function(){window.location.href="sdcardsharing.html?"+rfc3986_url_resolveSpecialChar(folder_path.CurrentPath).replace(/\//g,"%2F")})),$(".body_bg").before(o),$.browser.msie&&9==parseInt($.browser.version,10)){$(".button_wrapper").css("border-radius","3px");var l=document.getElementById("sdUploadFileCanvas");draw(l)}else $.browser.msie&&parseInt($.browser.version,10)<9?($(".dialog_header_left").css("margin-top","5"),$(".dialog_header").css({width:"500px",height:"29px"}),$(".dialog_header").corner("top 5px"),$(".button_wrapper").css("background","#75ACD6"),$(".button_wrapper").corner("3px"),$(".button_wrapper input").css("padding-top","2px"),$(".dialog_header a").css("top","7px"),$(".dialog_header a").append("<img src='../res/dialog_close_btn.png' title='' alt='' />")):(l=document.getElementById("sdUploadFileCanvas"),draw(l));$("#uploadInfo").html(sd_label_uploading),hiddenSelect(!0),reputPosition($(".dialog"),$("#div_wrapper"))}disableTabKey()}var i=e,s=formatFloat(parseInt(i,10)/100,2),d=$(".graph").width()-8;d=parseInt(d*s,10),$(".press").css({width:d+"px"}),$("#downloadProcess").html(e+"%"),parseInt(i,10)<100?button_enable("pop_Cancel","1"):button_enable("pop_Cancel","0"),setTimeout((function(){getUploadState(!1)}),2e3)}function getUploadState(e){getAjaxData("api/sdcard/sdfilestate",(function(a){var o=xml2object(a);if("response"==o.type){var t=o.response.sduploadstatus.State,l=o.response.sduploadstatus.UploadProgress;SD_FILE_UPLOADING==t?showUploadProgressDialog(l,e):(clearDialog(),showUploadStatus(t),LOGIN_STATE_NOMAL==login_state.response.State&&startLogoutTimer(),$("#upload_dialog").remove())}}),{errorCB:function(){clearDialog(),showInfoDialog(sd_hint_upload_file_failed),LOGIN_STATE_NOMAL==login_state.response.State&&startLogoutTimer(),$("#upload_dialog").remove()}})}function doUploadFile(){if(LOGIN_STATE_NOMAL==login_state.response.State&&cancelLogoutTimer(),$.isArray(g_requestVerificationToken)){if(!(g_requestVerificationToken.length>0))return void setTimeout((function(){doUploadFile()}),50);$("#csrf_token").val("csrf:"+g_requestVerificationToken[0])}var e=new Date,a={Year:e.getFullYear(),Month:e.getMonth()+1,Day:e.getDate(),Hour:e.getHours(),Min:e.getMinutes(),Sec:e.getSeconds()};$("#wait_dialog_btn").show().bind("click",(function(){window.location.href="sdcardsharing.html?"+rfc3986_url_resolveSpecialChar(folder_path.CurrentPath).replace(/\//g,"%2F")})),$("#cur_path").val("<"+folder_path.CurrentPath+">"),$("#page").val("sdcardsharing.html"),$("#upload_year").val(a.Year),$("#upload_month").val(a.Month),$("#upload_day").val(a.Day),$("#upload_hours").val(a.Hour),$("#upload_minutes").val(a.Min),$("#upload_secondes").val(a.Sec),$("#upload_file_form").submit(),getUploadState(!0)}function cancle_upload(){getAjaxData("api/sdcard/Check_file_exist")}function confirm_exist(e){$("#upload_dialog").css({"z-index":"-1000"}).hide(),folder_path.CurrentPath=$(".micro_sd").children().html();var a=object2xml("request",e);saveAjaxData("api/sdcard/Check_file_exist",a,(function(e){var a=xml2object(e);if("response"==a.type){if("OK"!=a.response)return showInfoDialog(common_failed),!1;doUploadFile()}else{if("error"!=a.type||"114001"!=a.error.code)return showInfoDialog(common_failed),!1;$(".dialog_close_btn").live("click",(function(){getAjaxData("api/sdcard/Check_file_exist")})),$("#pop_confirm").die("click"),$("#pop_Cancel").die("click"),showConfirmDialog(sd_hint_overwrite_existed_file,doUploadFile,cancle_upload,0)}}))}function getFileName(e){var a="",o=0;if((o=e.lastIndexOf("\\"))>0)a=e.substr(o+1);else{if(!((o=e.lastIndexOf("/"))>0))return e;a=e.substr(o+1)}return a}function uploadfile(){var e=$(".micro_sd").children().html();e=""==e?"/":e;var a=$("#fileField2").val();a=getFileName(a);var o={CurrentPath:e,FileName:a=resolveXMLEntityReference(a)};getAjaxData("api/sdcard/uploadflag",(function(e){var a=xml2object(e);if("response"!=a.type||0!=a.response.Uploadflag)return showInfoDialog(IDS_sd_message_uploading_file_conflict),!1;confirm_exist(o)}))}
