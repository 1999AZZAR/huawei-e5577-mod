var dhcp_value=null,g_DHCP_SERVER_ENABLE=1,g_DHCP_SERVER_DISABLE=0,DHCP_PING_INTERVA=5e4,DHCP_MIN_LEASE_TIME=24,DHCP_MAX_LEASE_TIME=168,DHCP_DEFAULT_LEASE_TIME=24,g_dhcpSubmark="";function createIpDialogHtml(){var d="<input type='text'  id='input_dhcp_startip'  size='4' maxlength='3'/>"+dhcp_label_dhcp_ip_address_range.replace("%s1","").replace("%s2","")+"<input type='text'  id='input_dhcp_endip'  size='4' maxlength='3'/>";$("#input_dhcp_ip").append(d)}function enableDHCP(){var d,p="",e="";p=""!=dhcp_value.DhcpStartIPAddress&&"0"!=dhcp_value.DhcpStartIPAddress&&"0.0.0.0"!=dhcp_value.DhcpStartIPAddress?dhcp_value.DhcpStartIPAddress:dhcp_value.DhcpIPAddress.slice(0,dhcp_value.DhcpIPAddress.lastIndexOf("."))+".100",e=""!=dhcp_value.DhcpEndIPAddress&&"0"!=dhcp_value.DhcpEndIPAddress&&"0.0.0.0"!=dhcp_value.DhcpEndIPAddress?dhcp_value.DhcpEndIPAddress:dhcp_value.DhcpIPAddress.slice(0,dhcp_value.DhcpIPAddress.lastIndexOf("."))+".200",d=""!=dhcp_value.DhcpLeaseTime&&"0"!=dhcp_value.DhcpLeaseTime?dhcp_value.DhcpLeaseTime:"DHCP_DEFAULT_LEASE_TIME";var t=p.split("."),_=e.split("."),i=dhcp_label_dhcp_ip_address_range.replace("%s1",p).replace("%s2",e);$("#input_dhcp_startip").val(t[3]).attr("disabled",!1),$("#input_dhcp_endip").val(_[3]).attr("disabled",!1),"0"==dhcp_value.DnsStatus?($("#input_primary_dns").val(dhcp_value.PrimaryDns).attr("disabled",!1),$("#input_secondary_dns").val(dhcp_value.SecondaryDns).attr("disabled",!1)):($("#input_primary_dns").val("").attr("disabled",!1),$("#input_secondary_dns").val("").attr("disabled",!1)),$("#input_dhcp_leasetime").val(d/3600).attr("disabled",!1),$("#dhcp_ip_range").text(i),dhcp_value.DhcpStatus=g_DHCP_SERVER_ENABLE}function disabledDHCP(){if(clearAllErrorLabel(),g_DHCP_SERVER_ENABLE==dhcp_value.DhcpStatus){var d=g_feature.title,p=dhcp_label_dhcp_server_close.replace("%s",d);showConfirmDialog(p,(function(){return disabledDHCPInit(),!1}),(function(){enableDHCP(),$("input[name='radio_dhcp_status'][value="+dhcp_value.DhcpStatus+"]").attr("checked",!0)}),0,(function(){enableDHCP(),$("input[name='radio_dhcp_status'][value="+dhcp_value.DhcpStatus+"]").attr("checked",!0)})),dhcp_value.DhcpStatus=g_DHCP_SERVER_DISABLE}}function disabledDHCPInit(){clearAllErrorLabel(),$("#input_dhcp_startip").val("").attr("disabled",!0),$("#input_dhcp_endip").val("").attr("disabled",!0),$("#dhcp_ip_range").text(""),$("#input_static_ip").attr("disable",!0),$("#input_primary_dns").attr("disabled",!0),$("#input_secondary_dns").attr("disabled",!0),$("#input_dhcp_leasetime").val("").attr("disabled",!0)}function initPageData(){getAjaxData("api/dhcp/settings",(function(d){var p;if("response"==(p=xml2object(d)).type){(dhcp_value=p.response).DhcpStatus=parseInt(dhcp_value.DhcpStatus,10),g_dhcpSubmark=dhcp_value.DhcpLanNetmask;var e=dhcp_value.DhcpIPAddress.split(".");$("#input_dhcp_ipaddr_first").val(e[0]),$("#input_dhcp_ipaddr_second").val(e[1]),$("#input_dhcp_ipaddr_third").val(e[2]),$("#input_dhcp_ipaddr_forth").val(e[3]),$("input[name='radio_dhcp_status'][value="+dhcp_value.DhcpStatus+"]").attr("checked",!0),dhcp_value.ShowDnsSetting="1","1"==dhcp_value.ShowDnsSetting?($("#dhcp_primary_dns").show(),$("#dhcp_secondary_dns").show()):($("#dhcp_primary_dns").hide(),$("#dhcp_secondary_dns").hide()),g_DHCP_SERVER_ENABLE==dhcp_value.DhcpStatus?enableDHCP():disabledDHCPInit()}}))}function postData(){var d=$("#input_dhcp_ipaddr_first").val(),p=$("#input_dhcp_ipaddr_second").val(),e=$("#input_dhcp_ipaddr_third").val(),t=$("#input_dhcp_ipaddr_forth").val();dhcp_value.DhcpIPAddress=d+"."+p+"."+e+"."+t,dhcp_value.DhcpLanNetmask=g_dhcpSubmark,dhcp_value.DhcpStatus=$("input[name='radio_dhcp_status']:checked").val(),dhcp_value.DhcpStartIPAddress=d+"."+p+"."+e+"."+$("#input_dhcp_startip").val(),dhcp_value.DhcpEndIPAddress=d+"."+p+"."+e+"."+$("#input_dhcp_endip").val(),dhcp_value.PrimaryDns=$.trim($("#input_primary_dns").val()),dhcp_value.SecondaryDns=$.trim($("#input_secondary_dns").val()),""!=dhcp_value.PrimaryDns||""!=dhcp_value.SecondaryDns?dhcp_value.DnsStatus=0:dhcp_value.DnsStatus=1,dhcp_value.DhcpLeaseTime=$.trim(3600*$("#input_dhcp_leasetime").val()),button_enable("apply","0");var _=object2xml("request",dhcp_value);saveAjaxData("api/dhcp/settings",_,(function(d){var p=xml2object(d);isAjaxReturnOK(p)?(showWaitingDialog(common_waiting,sd_hint_wait_a_few_moments,(function(){})),ping_setPingAddress(dhcp_value.DhcpIPAddress),setTimeout(startPing,DHCP_PING_INTERVA)):initPageData()}))}function isBetweenStartIPAndEndIP(d,p,e){var t,_,i,r=d.split("."),a=p.split("."),s=e.split(".");return t=256*Number(r[0])*256*256+256*Number(r[1])*256+256*Number(r[2])+Number(r[3]),_=256*Number(a[0])*256*256+256*Number(a[1])*256+256*Number(a[2])+Number(a[3]),i=256*Number(s[0])*256*256+256*Number(s[1])*256+256*Number(s[2])+Number(s[3]),t>=_&&t<=i}function ValidIpAddressMore(d){var p=d.split(".");return 10==p[0]||172==p[0]&&p[1]>=16&&p[1]<=31||192==p[0]&&168==p[1]}function verifyUserInput(){var d=$("#input_dhcp_ipaddr_first").val(),p=$("#input_dhcp_ipaddr_second").val(),e=$("#input_dhcp_ipaddr_third").val(),t=d+"."+p+"."+e+"."+$("#input_dhcp_ipaddr_forth").val(),_=d+"."+p+"."+e+"."+$("#input_dhcp_startip").val(),i=d+"."+p+"."+e+"."+$("#input_dhcp_endip").val(),r=g_dhcpSubmark,a=$("input[name='radio_dhcp_status']:checked").val(),s=$.trim($("#input_primary_dns").val()),n=$.trim($("#input_secondary_dns").val()),c=$("#input_dhcp_leasetime").val(),u=!0;if(clearAllErrorLabel(),!isValidIpAddress(t))return showErrorUnderTextbox("input_dhcp_ipaddr",dialup_hint_ip_address_empty),1==dhcpIpAddressNum?$("#input_dhcp_ipaddr_first").focus():2==dhcpIpAddressNum?$("#input_dhcp_ipaddr_second").focus():3==dhcpIpAddressNum?$("#input_dhcp_ipaddr_third").focus():4==dhcpIpAddressNum&&$("#input_dhcp_ipaddr_forth").focus(),!1;if(!ValidIpAddressMore(t))return showErrorUnderTextbox("input_dhcp_ipaddr",dialup_hint_ip_address_ERROR),$("#input_dhcp_ipaddr_first").focus(),!1;if(!isBroadcastOrNetworkAddress(t,r))return showErrorUnderTextbox("input_dhcp_ipaddr",dialup_hint_ip_address_empty),1==dhcpIpAddressNum?$("#input_dhcp_ipaddr_first").focus():2==dhcpIpAddressNum?$("#input_dhcp_ipaddr_second").focus():3==dhcpIpAddressNum?$("#input_dhcp_ipaddr_third").focus():4==dhcpIpAddressNum&&$("#input_dhcp_ipaddr_forth").focus(),!1;if(1==a){if(!isValidIpAddress(_)||t==_)return showErrorUnderTextbox("input_dhcp_ip",dhcp_hint_start_ip_address_invalid),$("#input_dhcp_startip").focus(),!1;if(!isBroadcastOrNetworkAddress(_,r))return showErrorUnderTextbox("input_dhcp_ip",dhcp_hint_start_ip_address_invalid),$("#input_dhcp_startip").focus(),!1;if(!isValidIpAddress(i)||t==i)return showErrorUnderTextbox("input_dhcp_ip",dhcp_hint_end_ip_address_invalid),$("#input_dhcp_endip").focus(),!1;if(!isBroadcastOrNetworkAddress(i,r))return showErrorUnderTextbox("input_dhcp_ip",dhcp_hint_end_ip_address_invalid),$("#input_dhcp_endip").focus(),!1;if(!isSameSubnetAddrs(_,t,r))return showErrorUnderTextbox("input_dhcp_ip",dhcp_hint_start_ip_address_same_subnet),$("#input_dhcp_startip").focus(),!1;if(!isSameSubnetAddrs(i,t,r))return showErrorUnderTextbox("input_dhcp_ip",dhcp_hint_end_ip_address_same_subnet),$("#input_dhcp_endip").focus(),!1;if(!compareStartIpAndEndIp(_,i))return showErrorUnderTextbox("input_dhcp_ip",dhcp_hint_end_ip_greater_start_ip),$("#input_dhcp_endip").focus(),!1;if(""!=n&&0==isValidIpAddress(n)&&(showErrorUnderTextbox("secondary_error",dialup_hint_ip_address_empty),$("#input_secondary_dns").focus(),$("#input_secondary_dns").select(),u=!1),(""==s&&""!=n||""!=s&&0==isValidIpAddress(s))&&(showErrorUnderTextbox("input_primary_dns",dialup_hint_ip_address_empty),$("#input_primary_dns").focus(),$("#input_primary_dns").select(),u=!1),!u)return!1;if(-1!=c.indexOf("."))return showErrorUnderTextbox("input_dhcp_leasetime_prompt",dhcp_hint_dhcp_lease_time_integer),$("#input_dhcp_leasetime").focus(),!1;if(1==isNaN(c))return showErrorUnderTextbox("input_dhcp_leasetime_prompt",dhcp_hint_dhcp_lease_time_number),$("#input_dhcp_leasetime").focus(),!1;if(0==c.indexOf("0")&&0!=c)return showErrorUnderTextbox("input_dhcp_leasetime_prompt",dhcp_hint_dhcp_lease_time_invalid),$("#input_dhcp_leasetime").focus(),!1;if(c<DHCP_MIN_LEASE_TIME||c>DHCP_MAX_LEASE_TIME)return showErrorUnderTextbox("input_dhcp_leasetime_prompt",dhcp_hint_dhcp_lease_time_range),$("#input_dhcp_leasetime").focus(),!1;if(isBetweenStartIPAndEndIP(t,_,i))return showErrorUnderTextbox("input_dhcp_ipaddr",dhcp_message_ip_address_in_start_end),$("#input_dhcp_ipaddr_forth").focus(),!1}return!0}function onApply(){isButtonEnable("apply")&&verifyUserInput()&&showConfirmDialog(system_hint_operation_restart_device,postData,(function(){}))}var dhcpIpAddressNum=0;function getDhcpIPAddressRange(){var d=$("#input_dhcp_ipaddr_first").val(),p=$("#input_dhcp_ipaddr_second").val(),e=$("#input_dhcp_ipaddr_third").val(),t=d+"."+p+"."+e+"."+$("#input_dhcp_startip").val(),_=d+"."+p+"."+e+"."+$("#input_dhcp_endip").val(),i=dhcp_label_dhcp_ip_address_range.replace("%s1",t).replace("%s2",_);$("#dhcp_ip_range").text(i)}$(document).ready((function(){$("#all_content").show(),createIpDialogHtml(),initPageData(),$("input").bind("change input paste cut keydown",(function(d){MACRO_KEYCODE!=d.keyCode&&button_enable("apply","1")})),button_enable("apply","0"),$("#apply").click((function(){onApply()})),$("#input_dhcp_ipaddr_first").bind("blur",(function(d){g_DHCP_SERVER_ENABLE==dhcp_value.DhcpStatus&&getDhcpIPAddressRange(),dhcpIpAddressNum=1})),$("#input_dhcp_ipaddr_second").bind("blur",(function(d){g_DHCP_SERVER_ENABLE==dhcp_value.DhcpStatus&&getDhcpIPAddressRange(),dhcpIpAddressNum=2})),$("#input_dhcp_ipaddr_third").bind("blur",(function(d){g_DHCP_SERVER_ENABLE==dhcp_value.DhcpStatus&&getDhcpIPAddressRange(),dhcpIpAddressNum=3})),$("#input_dhcp_ipaddr_forth").bind("blur",(function(d){dhcpIpAddressNum=4})),$("#input_dhcp_startip").bind("blur",(function(d){getDhcpIPAddressRange()})),$("#input_dhcp_endip").bind("blur",(function(d){getDhcpIPAddressRange()}))}));
