var SIP_FILTER_NUM=1,index=null,editIndex=null,delIndex=null,edIndex=null,offorno=0,DELETE_SIPACCOUNT="api/voice/deletesipaccount",GET_SIPACCOUNT="api/voice/sipaccount",ADD_SIPACCOUNT="api/voice/addsipaccount";function addSipBasicFilter(e){var t=null;t='<tr class="user_add_line">',t+="<td style='word-break: break-all;' >"+arguments[1]+"</td>",t+="<td style='word-break: break-all;'>"+arguments[2]+"</td>",t+="<td> <input type='password' autocomplete='off' style='background:#f2f2f2; word-break: break-all;width:115px;' readonly='true' value='' ></input></td>",t+="0"==arguments[4]?"<td style='background:#f2f2f2; word-break: break-all' readonly='true';> "+IDS_VOIP_Status_U+"</td>":"1"==arguments[4]?"<td style='background:#f2f2f2; word-break: break-all' readonly='true'> "+IDS_VOIP_Status_I+"</td>":"<td style='background:#f2f2f2; word-break: break-all' readonly='true'> "+IDS_VOIP_Status_R+"</td>",t+="<td class='user_options clr_blue_hover' width='20%'><span class=\"button_edit_list clr_blue\">"+common_edit+'</span><span class="button_delete_list clr_blue">'+common_delete+"</span></td></tr>";var a=$(e).size();$(e).eq(a-2).after(t),$(".user_add_line").length>=SIP_FILTER_NUM&&button_enable("add_item","0")}function adaptatSDK(){getAjaxData("api/voice/featureswitch",(function(e){var t=xml2object(e);"response"==t.type&&(offorno=t.response.specialcharenable)}),{sync:!0})}function initPage(){getAjaxData("api/voice/sipadvance",(function(e){var t=xml2object(e);"response"==t.type&&(g_sipadvance=t.response,$("#callwaitingenable").val(g_sipadvance.callwaitingenable),1==g_sipadvance.callwaitingenable?$("#callwaitingenable").attr("checked",!0):$("#callwaitingenable").attr("checked",!1))}),{sync:!0}),getAjaxData("api/voice/sipaccount",(function(e){var t=xml2object(e);if(null!=t.response.account){var a=CreateArray(t.response.account);void 0!==g_moduleswitch.encrypt_enabled&&1==g_moduleswitch.encrypt_enabled&&$(a).each((function(e){void 0!==a[e].username&&null!=a[e].username&&""!=a[e].username&&(a[e].password=COMMON_PASSWORD_VALUE)})),a.length>=SIP_FILTER_NUM&&button_enable("add_item","0");var i="",n="",l="",s="";$(".user_add_line").remove(),$(a).each((function(e){index=a[e].index,i=a[e].directorynumber,n=spaceToNbsp(XSSResolveCannotParseChar(a[e].username)),l=spaceToNbsp(XSSResolveCannotParseChar(a[e].password)),s=a[e].registerstatus,addSipBasicFilter($("#service_list tr"),i,n,l,s),$(".user_add_line").length>0&&$(".user_add_line").each((function(e){$(this).children().eq(2).children().val(a[e].password)}))}));var r=a[a.length-1];$("#input_sip_account").val(r.directorynumber),$("#input_sip_username").val(r.username),$("#input_sip_password").val(r.password),$("#input_sip_registStatus").val(r.registerstatus)}else $("#callwaitingenable").attr("disabled","disabled"),$("#input_sip_account").val(""),$("#input_sip_username").val(""),$("#input_sip_password").val(""),$("#input_sip_registStatus").val("")}))}function isVaildValue(){nbspToSpace($.trim($("#input_sip_account").val()));var e=nbspToSpace($.trim($("#input_sip_username").val())),t=nbspToSpace($.trim($("#input_sip_password").val()));if(null==$.trim($("#input_sip_account").val()).match(/^[A-Za-z0-9_.+]+$/g))return showQtip("input_sip_account",IDS_VOIP_SipAccountErrStr5),!1;if(0==offorno){if(""==e||0==checkInputChar(e))return showQtip("input_sip_username",dialup_hilink_hint_username_invalidate),!1}else if(""==e||0==checkInputPPPoEChar(e))return showQtip("input_sip_username",sip_account_username_invalidate),!1;if(0==offorno){if(""==t||0==checkInputChar(t))return showQtip("input_sip_password",dialup_hilink_hint_password_invalidate),!1}else if(""==t||0==checkInputPPPoEChar(t))return showQtip("input_sip_password",sip_account_password_invalidate),!1;return!0}function apply(){clearAllErrorLabel(),1==$("#callwaitingenable").get(0).checked?g_sipadvance.callwaitingenable=1:g_sipadvance.callwaitingenable=0;var e=object2xml("request",g_sipadvance);saveAjaxData("api/voice/sipadvance",e,(function(e){var t=xml2object(e);isAjaxReturnOK(t)?(initPage(),showInfoDialog(common_success)):void 0!==t.error&&t.error.code==ERROR_SYSTEM_BUSY?showInfoDialog(common_system_busy):(showInfoDialog(common_fail),initPage())}))}function postData(e){var t={},a=[];$(".user_add_line").length>0?$(".user_add_line").each((function(i){var n,l,s,r;if(n=$(this).children().eq(0).text(),l=nbspToSpace($(this).children().eq(1).html()),s=XSSResolveCannotParseChar(nbspToSpace($(this).children().eq(2).children().val())),r=$(this).children().eq(3).val(),e==GET_SIPACCOUNT){var o={directorynumber:n,username:l,password:s,registerstatus:r,index:editIndex};a.push(o),t={account:a}}else if(e==ADD_SIPACCOUNT){o={directorynumber:n,username:l,password:s,registerstatus:r};a.push(o),t={account:a}}else a.push(delIndex),t={index:a}})):(a.push(delIndex),t={index:a}),e==GET_SIPACCOUNT&&checkPostIndex(0)&&delete t.account[editIndex-1].password;var i=object2xml("request",t);saveAjaxData(e,i,(function(e){mousedownIndexList=[];var t=xml2object(e);isAjaxReturnOK(t)?showInfoDialog(common_success):(showInfoDialog(common_failed),initPage())}),{enc:!0}),button_enable("sip_refresh","1")}$(document).ready((function(){clickPasswordEvent("input_sip_password",0);var e=null,t=null,a=null,i=null,n=null;adaptatSDK(),initPage(),$("#callwaitingenable").click((function(){isButtonEnable("callwaitingenable")&&apply()})),$(".button_edit_list").live("click",(function(){if(button_enable("sip_refresh","0"),$(".add_item_control:hidden").size()>0&&$("#edit_item_ok").size()<1){edIndex=$(".button_edit_list").index(this),editIndex=edIndex+1,e=$(".user_add_line").eq(edIndex).html();var l=$(this).parent().siblings();t=l.eq(0),a=l.eq(1),i=l.eq(2),n=l.eq(3);var s=i.children().val();t.html('<input type="text" style="width:116px;" value="'+XSSResolveHtmlReturnChar(t.html())+'" id="input_sip_account" maxlength="31" ></td>'),1==offorno?(a.html('<input type="text" style="width:116px;" value="'+XSSResolveHtmlReturnChar(nbspToSpace(a.html()))+'" id="input_sip_username" maxlength="127" ></td>'),i.html('<input type="password" autocomplete="off" style="width:116px;" value="" id="input_sip_password" maxlength="127"></td>')):(a.html('<input type="text" style="width:116px;" value="'+XSSResolveHtmlReturnChar(a.html())+'" id="input_sip_username" maxlength="32" ></td>'),i.html('<input type="password" autocomplete="off" style="width:116px;" value="" id="input_sip_password" maxlength="32"></td>')),n.html('<input type="text" style="width:116px;" value="'+XSSResolveHtmlReturnChar(n.html())+'" id="input_sip_registerStatus" readonly="true" style="background:#f2f2f2;"></td>'),$(this).parent().html('<a class="clr_blue" id="edit_item_ok" href="javascript:void(0);">'+common_ok+'</a><a class="clr_blue" id="edit_item_cancel" href="javascript:void(0);">'+common_cancel+"</a>"),hideAddItemControl(),$("#input_sip_password").val(s),$("#edit_item_cancel").live("click",(function(){button_enable("sip_refresh","1"),$(".user_add_line").eq(edIndex).html(e),$(".qtip").qtip("destroy",!0),isButtonEnable("add_item")||button_enable("add_item","1"),$(".user_add_line").length>=SIP_FILTER_NUM&&button_enable("add_item","0")})),$("#add_item").live("click",(function(){button_enable("sip_refresh","0"),isButtonEnable("add_item")&&($(".user_add_line").eq(edIndex).html(e),$(".qtip").qtip("destroy",!0))})),button_enable("add_item","0"),$("#input_sip_account").focus()}})),$("#edit_item_ok").live("click",(function(){if(isVaildValue()){var t=XSSResolveCannotParseChar($.trim($("#input_sip_account").val())),a=spaceToNbsp(XSSResolveCannotParseChar($.trim($("#input_sip_username").val()))),i=XSSResolveCannotParseChar($.trim($("#input_sip_password").val())),n=XSSResolveCannotParseChar($.trim($("#input_sip_registerStatus").val()));hideAddItemControl();var l=$(this).parent().siblings();l.eq(0).html(t),l.eq(1).html(a),l.eq(2).html('<input type="password" autocomplete="off" style="width:115px;" readonly="true" style="background:#f2f2f2;" value=""/>'),l.eq(3).html(n),l.eq(2).children().val(i),$(this).parent().html('<span class="button_edit_list clr_blue">'+common_edit+'</span><span class="button_delete_list clr_blue">'+common_delete+"</span>"),e=$(".user_add_line").eq(edIndex).html(),$(".user_add_line").length>=SIP_FILTER_NUM?button_enable("add_item","0"):button_enable("add_item","1"),postData(GET_SIPACCOUNT)}})),$(".button_delete_list").live("click",(function(){if($(".add_item_control:hidden").size()>0&&$("#edit_item_ok").size()<1){var e=$(".button_delete_list").index(this);delIndex=e+1,call_dialog(common_delete,firewall_hint_delete_list_item,common_ok,"pop_OK",common_cancel,"pop_Cancel"),$("#pop_OK").click((function(){deleteFilter(e,$(".user_add_line")),postData(DELETE_SIPACCOUNT),clearDialog_table(),button_enable("add_item","1"),$(".user_add_line").length<1&&$("#callwaitingenable").attr("disabled","disabled")}))}})),$("#add_item").click((function(){isButtonEnable("add_item")&&(getAjaxData("api/voice/sipserver",(function(e){var t=xml2object(e);"response"==t.type&&(g_server=t.response.sipserver)}),{sync:!0}),null!=g_server&&(""==g_server.proxyserveraddress||""==g_server.registerserveraddress?showInfoDialog(IDS_VOIP_Error_Message):(button_enable("sip_refresh","0"),showAddItemControl(),1==offorno&&($("#input_sip_username").attr("maxlength",127),$("#input_sip_password").attr("maxlength",127)),$(".add_item_control input").eq(0).focus(),$(".add_item_control input").eq(3).val(""))))})),$("#add_item_ok").live("click",(function(){if(isVaildValue()){var e=$.trim($("#input_sip_account").val()),t=spaceToNbsp(XSSResolveCannotParseChar($.trim($("#input_sip_username").val()))),a=$.trim($("#input_sip_password").val());$.trim($("#input_sip_registerStatus").val());hideAddItemControl(),addSipBasicFilter($("#service_list tr"),e,t,XSSResolveCannotParseChar(a),"0"),$(".user_add_line").length>0&&$(".user_add_line").each((function(e){e==$(".user_add_line").length-1&&$(this).children().eq(2).children().val(a)})),$(".user_add_line").length>=SIP_FILTER_NUM&&button_enable("add_item","0"),postData(ADD_SIPACCOUNT),$("#callwaitingenable").removeAttr("disabled")}return!1})),$("#add_item_cancel").live("click",(function(){return hideAddItemControl(),$("#callwaitingenable").attr("disabled","0"),button_enable("sip_refresh","1"),!1})),$("#sip_refresh").bind("click",(function(){initPage()}))}));
