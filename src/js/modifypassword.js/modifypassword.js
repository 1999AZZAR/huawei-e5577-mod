var base64EncodeChars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",base64DecodeChars=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1],MODIFYPASSWORD_SHOW=108008,hilink_login_eable=1,hilink_login_diable=0,hilink_login_status=0,hilink_show_checkbox=1,encryption_mode=0,passWordStrength=0;function base64encode(e){var s,o,r,n,t,a;for(r=e.length,o=0,s="";o<r;){if(n=255&e.charCodeAt(o++),o==r){s+=base64EncodeChars.charAt(n>>2),s+=base64EncodeChars.charAt((3&n)<<4),s+="==";break}if(t=e.charCodeAt(o++),o==r){s+=base64EncodeChars.charAt(n>>2),s+=base64EncodeChars.charAt((3&n)<<4|(240&t)>>4),s+=base64EncodeChars.charAt((15&t)<<2),s+="=";break}a=e.charCodeAt(o++),s+=base64EncodeChars.charAt(n>>2),s+=base64EncodeChars.charAt((3&n)<<4|(240&t)>>4),s+=base64EncodeChars.charAt((15&t)<<2|(192&a)>>6),s+=base64EncodeChars.charAt(63&a)}return s}function vilidatePassword(){clearAllErrorLabel();var e=$("#current_password").val(),s=$("#new_password").val(),o=$("#confirm_password").val();return""==e?(showErrorUnderTextbox("current_password",system_hint_current_password_empty),setTimeout((function(){$("#current_password").focus()}),10),!1):""==s?(showErrorUnderTextbox("new_password",system_hint_new_password_empty),setTimeout((function(){$("#new_password").focus()}),10),!1):""==o?(showErrorUnderTextbox("confirm_password",system_hint_new_confirm_password_empty),setTimeout((function(){$("#confirm_password").focus()}),10),!1):0==checkInputChar(e)?(showErrorUnderTextbox("current_password",system_hint_wrong_password),$("#current_password").val(""),setTimeout((function(){$("#current_password").focus()}),10),!1):0==checkInputChar(s)?(showErrorUnderTextbox("new_password",dialup_hilink_hint_password_invalidate),setTimeout((function(){$("#new_password").focus()}),10),!1):1==hasSpaceOrTabAtHead(s)?(showErrorUnderTextbox("new_password",input_cannot_begin_with_space),setTimeout((function(){$("#new_password").focus()}),10),!1):1==hasSpaceOrTabAtHead(o)?(showErrorUnderTextbox("confirm_password",input_cannot_begin_with_space),setTimeout((function(){$("#confirm_password").focus()}),10),!1):s==e?(showErrorUnderTextbox("new_password",IDS_common_same_password_error),setTimeout((function(){$("#new_password").focus()}),10),!1):s!=o?(showErrorUnderTextbox("confirm_password",IDS_modify_password_wrong_msg),$("#new_password").val(""),$("#confirm_password").val(""),setTimeout((function(){$("#new_password").focus()}),10),!1):passWordStrength!=MACRO_PASSWORD_LOW||(showErrorUnderTextbox("new_password",IDS_psw_login_remind),setTimeout((function(){$("#new_password").focus()}),10),!1)}function apply(){if(isButtonEnable("apply_button")&&(clearAllErrorLabel(),$("#new_password").focus(),vilidatePassword())){var e="admin",s=$("#current_password").val(),o=$("#new_password").val();if(1==g_scarm_login){var r={username:e,currentpassword:XSSResolveCannotParseChar(s),newpassword:XSSResolveCannotParseChar(o)},n=object2xml("request",r);button_enable("apply_button","0"),clearTimeout(g_decive_timer),clearTimeout(g_simcard_timer),saveAjaxData("api/user/password_scram",n,(function(e){var s=xml2object(e);isAjaxReturnOK(s)?(button_enable("apply_button","0"),$("#current_password").val(""),$("#new_password").val(""),$("#confirm_password").val(""),showInfoDialog(common_success),setTimeout(userOut,1e3)):"error"==s.type&&(clearAllErrorLabel(),s.error.code==MODIFYPASSWORD_SHOW?(showErrorUnderTextbox("current_password",IDS_current_password_inputshow),$("#current_password").val(""),$("#current_password").focus()):(showErrorUnderTextbox("current_password",system_hint_wrong_password),$("#current_password").val(""),$("#current_password").focus()))}),{enc:!0,sync:!0})}else{s=1==encryption_mode&&$.isArray(g_requestVerificationToken)&&g_requestVerificationToken.length>0?base64encode(SHA256(e+base64encode(SHA256(s))+g_requestVerificationToken[0])):base64encode(s),o=base64encode(o);r={Username:e,CurrentPassword:XSSResolveCannotParseChar(s),NewPassword:XSSResolveCannotParseChar(o),encryption_enable:encryption_mode},n=object2xml("request",r);button_enable("apply_button","0"),saveAjaxData("api/user/password",n,(function(e){var s=xml2object(e);isAjaxReturnOK(s)?(button_enable("apply_button","0"),$("#current_password").val(""),$("#new_password").val(""),$("#confirm_password").val(""),showInfoDialog(common_success),setTimeout(userOut,1e3)):"error"==s.type&&(clearAllErrorLabel(),s.error.code==MODIFYPASSWORD_SHOW?(showErrorUnderTextbox("current_password",IDS_current_password_inputshow),$("#current_password").val(""),$("#current_password").focus()):(showErrorUnderTextbox("current_password",system_hint_wrong_password),$("#current_password").val(""),$("#current_password").focus()))}),{enc:!0,sync:!0})}}}function setPWStrengthColor(e){passWordStrength=e,MACRO_PASSWORD_LOW==e?($("#psw_strength_low").css({"background-color":"red"}),$("#psw_strength_mid, #psw_strength_hig").css({"background-color":"#aaa"})):MACRO_PASSWORD_MID==e?($("#psw_strength_mid").css({"background-color":"red"}),$("#psw_strength_low, #psw_strength_hig").css({"background-color":"#aaa"})):MACRO_PASSWORD_HIG==e?($("#psw_strength_hig").css({"background-color":"red"}),$("#psw_strength_mid, #psw_strength_low").css({"background-color":"#aaa"})):$("#psw_strength_low, #psw_strength_mid, #psw_strength_hig").css({"background-color":"#aaa"})}function getPWRemindStatus(){getAjaxData("api/user/remind",(function(e){var s=xml2object(e);"response"==s.type&&(1!=hilink_login_status&&1!=hilink_show_checkbox||($("#tr_psw_strength").show(),1==g_default_password_status?$("#tr_psw_remind").hide():$("#tr_psw_remind").show()),"1"==s.response.remindstate?$("#check_psw_modify_remind").attr("checked","checked"):$("#check_psw_modify_remind").removeAttr("checked"))}))}function currentPEncryption(){getAjaxData("api/user/password",(function(e){var s=xml2object(e);"response"==s.type&&(encryption_mode=s.response.encryption_enable)}),{sync:!0})}function getHilinkLoginStatus(){getAjaxData("api/user/hilink_login",(function(e){var s=xml2object(e);"response"==s.type&&(hilink_login_status=s.response.hilink_login,0==hilink_show_checkbox&&(0==hilink_login_status&&($(".apply_button").hide(),$("#tr_current_passwd").hide(),$("#tr_new_passwd").hide(),$("#tr_psw_strength").hide(),$("#tr_confirm_password").hide(),$("#tr_psw_remind").hide()),$("#tr_login_eable").show()),1==s.response.hilink_login?$("#login_eable").attr("checked","checked"):$("#login_eable").removeAttr("checked"))}),{sync:!0})}function setHilinkLoginStatus(e){var s=object2xml("request",{hilink_login:e});saveAjaxData("api/user/hilink_login",s,(function(e){var s=xml2object(e);isAjaxReturnOK(s)&&(showInfoDialog(common_success),setTimeout((function(){g_login_checking_flag=!1,gotoPageWithoutHistory(HOME_PAGE_URL)}),3e3))}),{sync:!0})}$(document).ready((function(){getDefaultPass(),0==g_default_password_status?showInfoDialog(IDS_default_password_note):window.onload=function(){setTimeout((function(){$("#current_password").focus()}),500)},getConfigData("config/global/config.xml",(function(e){hilink_show_checkbox=1==g_feature.login?isFirmwareSupportsModule("/api/wlan/basic-settings")?1:0:g_feature.login}),{sync:!0}),$("#apply_button").click((function(){apply()})),button_enable("apply_button","0"),$("input:not(.modify_password_checkbox)").bind("change input paste cut keydown",(function(){button_enable("apply_button","1")})),$("#new_password").live("keydown keypress keyup focus change",(function(e){("keydown"!=e.type&&"keypress"!=e.type&&"keyup"!=e.type||37!=e.keyCode&&38!=e.keyCode&&39!=e.keyCode&&40!=e.keyCode)&&($("#new_password").val().length>0?setPWStrengthColor(checkPWStrength($("#new_password").val())):setPWStrengthColor(0))})),$("#check_psw_modify_remind").live("click",(function(){$("#check_psw_modify_remind").get(0).checked?setPWRemindStatus(MACRO_PASSWORD_REMIND_OFF):setPWRemindStatus(MACRO_PASSWORD_REMIND_ON)})),$("#login_eable").live("click",(function(){1!=g_login_checking_flag&&(g_login_checking_flag=!0,$("#login_eable").get(0).checked?setHilinkLoginStatus(hilink_login_eable):setHilinkLoginStatus(hilink_login_diable))})),currentPEncryption(),getHilinkLoginStatus(),setPWStrengthColor(0),getPWRemindStatus()}));
