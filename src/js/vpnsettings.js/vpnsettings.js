var g_vpn_settings=null,PRO_AUTHMODE_PAP="2",PRO_AUTHMODE_CHAP="1",g_VPN_ENABLE=1,g_VPN_DISABLE=0;function get_data(){g_vpn_settings.enable=$("#vpn_connection_type").val(),g_vpn_settings.lns_addr=$.trim($("#input_vpn_lns_address").val()),g_vpn_settings.hostname=$.trim($("#input_vpn_hostname").val()),g_vpn_settings.tunnel_password=$.trim($("#input_vpn_tunnel_password").val()),g_vpn_settings.interval=$.trim($("#input_hello_interval").val()),g_vpn_settings.ppp_username=$.trim($("#input_vpn_pppusername").val()),g_vpn_settings.ppp_password=$.trim($("#input_vpn_ppppassword").val()),g_vpn_settings.auth_type=$("#auth_type").val()}function apply(){if(clearAllErrorLabel(),!check_vpn_input())return!1;get_data(),button_enable("apply_button","0");var n=g_vpn_settings;checkPostIndex(0)&&delete n.tunnel_password,checkPostIndex(1)&&delete n.ppp_password;var t=object2xml("request",n);saveAjaxData("api/vpn/l2tp_settings",t,(function(n){mousedownIndexList=[];var t=xml2object(n);isAjaxReturnOK(t)?(showInfoDialog(common_success),init_page()):(button_enable("apply_button","1"),void 0!==t.error&&t.error.code==ERROR_SYSTEM_BUSY?showInfoDialog(common_system_busy):showInfoDialog(common_fail))}),{enc:!0})}function set_data(){$("#input_vpn_lns_address").val(g_vpn_settings.lns_addr),$("#input_vpn_hostname").val(g_vpn_settings.hostname),$("#input_vpn_tunnel_password").val(g_vpn_settings.tunnel_password),$("#input_hello_interval").val(g_vpn_settings.interval),$("#input_vpn_pppusername").val(g_vpn_settings.ppp_username),$("#input_vpn_ppppassword").val(g_vpn_settings.ppp_password),$("#vpn_connection_type").val(g_vpn_settings.enable),g_VPN_ENABLE==g_vpn_settings.enable?($("#option_table").show(),g_vpn_settings.enable=g_VPN_ENABLE):($("#option_table").hide(),g_vpn_settings.enable=g_VPN_DISABLE),g_vpn_settings.auth_type==PRO_AUTHMODE_CHAP?$("#auth_type").val(PRO_AUTHMODE_CHAP):g_vpn_settings.auth_type==PRO_AUTHMODE_PAP?$("#auth_type").val(PRO_AUTHMODE_PAP):$("#auth_type").val("")}function init_page(){getAjaxData("api/vpn/l2tp_settings",(function(n){var t=xml2object(n);"response"==t.type&&(g_vpn_settings=t.response,void 0!==g_moduleswitch.encrypt_enabled&&1==g_moduleswitch.encrypt_enabled&&(void 0!==g_vpn_settings.ppp_username&&null!=g_vpn_settings.ppp_username&&""!=g_vpn_settings.ppp_username&&(g_vpn_settings.ppp_password=COMMON_PASSWORD_VALUE),g_vpn_settings.tunnel_password=COMMON_PASSWORD_VALUE),set_data())}),{sync:!0})}function show_hide_settings(){$("#vpn_connection_type").val()==g_VPN_ENABLE?($("#option_table").show(),g_vpn_settings.enable=g_VPN_ENABLE):(clearAllErrorLabel(),$("#option_table").hide(),$("#input_vpn_lns_address").val(g_vpn_settings.lns_addr),$("#input_vpn_hostname").val(g_vpn_settings.hostname),$("#input_vpn_tunnel_password").val(g_vpn_settings.tunnel_password),$("#input_hello_interval").val(g_vpn_settings.interval),$("#input_vpn_pppusername").val(g_vpn_settings.ppp_username),$("#input_vpn_ppppassword").val(g_vpn_settings.ppp_password),$("#auth_type").val(g_vpn_settings.auth_type),g_vpn_settings.enable=g_VPN_DISABLE)}function check_vpn_input(n){var t=$.trim($("#input_vpn_lns_address").val());return 0==isValidIpAddress(t)?(showErrorUnderTrEx("input_vpn_lns_address",IDS_VPN_Error_InvalidIP),$("#input_vpn_lns_address").focus(),$("#input_vpn_lns_address").select(),!1):0!=validateUsernameAndPassword()}function validateHelloInterval(){var n=$.trim($("#input_hello_interval").val());return""==n||null==n?(showErrorUnderTrEx("input_hello_interval",IDS_VPN_Error_interval_empty),$("#input_hello_interval").focus(),$("#input_hello_interval").select(),!1):1!=IsDigital(n)?(showErrorUnderTrEx("input_hello_interval",IDS_VPN_Error_Ivalid_interval),$("#input_hello_interval").focus(),$("#input_hello_interval").select(),!1):!(30>n||n>3600)||(showErrorUnderTrEx("input_hello_interval",IDS_VPN_Error_Ivalid_interval),$("#input_hello_interval").focus(),$("#input_hello_interval").select(),!1)}function validateUsernameAndPassword(){clearAllErrorLabel();var n=$.trim($("#input_vpn_hostname").val()),t=$.trim($("#input_vpn_tunnel_password").val()),_=$.trim($("#input_vpn_pppusername").val()),p=$.trim($("#input_vpn_ppppassword").val());return""==n||null==n?(showErrorUnderTrEx("input_vpn_hostname",IDS_VPN_Error_hostname_empty),$("#input_vpn_hostname").focus(),$("#input_vpn_hostname").select(),!1):n.length>32||n.length<1||0==checkInputChar(n)?(showErrorUnderTrEx("input_vpn_hostname",IDS_VPN_Error_input_invalidate),$("#input_vpn_hostname").focus(),$("#input_vpn_hostname").select(),!1):""==t||null==t?(showErrorUnderTrEx("input_vpn_tunnel_password",dialup_hint_password_empty),$("#input_vpn_tunnel_password").focus(),$("#input_vpn_tunnel_password").select(),!1):t.length>32||t.length<1||0==checkInputChar(t)?(showErrorUnderTrEx("input_vpn_tunnel_password",IDS_VPN_Error_input_invalidate),$("#input_vpn_tunnel_password").focus(),$("#input_vpn_tunnel_password").select(),!1):!(0==validateHelloInterval()||(""==_||null==_?(showErrorUnderTrEx("input_vpn_pppusername",settings_hint_user_name_empty),$("#input_vpn_pppusername").focus(),$("#input_vpn_pppusername").select(),1):_.length>32||_.length<1||0==checkInputChar(_)?(showErrorUnderTrEx("input_vpn_pppusername",IDS_VPN_Error_input_invalidate),$("#input_vpn_pppusername").focus(),$("#input_vpn_pppusername").select(),1):""==p||null==p?(showErrorUnderTrEx("input_vpn_ppppassword",dialup_hint_password_empty),$("#input_vpn_ppppassword").focus(),$("#input_vpn_ppppassword").select(),1):(p.length>32||p.length<1||0==checkInputChar(p))&&(showErrorUnderTrEx("input_vpn_ppppassword",IDS_VPN_Error_input_invalidate),$("#input_vpn_ppppassword").focus(),$("#input_vpn_ppppassword").select(),1)))}$(document).ready((function(){init_page(),clickPasswordEvent("input_vpn_tunnel_password",0),clickPasswordEvent("input_vpn_ppppassword",1),$("#apply_button").click((function(){isButtonEnable("apply_button")&&apply()})),$("#vpn_connection_type").change((function(){button_enable("apply_button","1"),show_hide_settings()})),button_enable("apply_button","0"),$(".input_style").bind("input change cut paste keydown",(function(n){MACRO_KEYCODE!=n.keyCode&&button_enable("apply_button","1")})),$("#auth_type").bind("change",(function(n){button_enable("apply_button","1")}))}));
