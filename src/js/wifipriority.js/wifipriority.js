var g_priority_wifi_ap_info_list=[],g_wifipriorityscanresult=[],WiFi_PRIORITY_NUM=16,ap_priority_info={WifiSsid:null,WifiSecMode:null,Preset:null,Index:null,Order:null},CURRENT_WISPRENABLE=1,CURRENT_PROFILEENABLE=1,g_current_index=-1,LENGHT_OF_INDEX=8,SECURITY_MODE_NONE="NONE",SECURITY_MODE_OPEN="OPEN",SECURITY_MODE_WEP="WEP",SECURITY_MODE_WPA_PSK="WPA-PSK",SECURITY_MODE_WPA2_PSK="WPA2-PSK",SECURITY_MODE_WPA_WPA2_PSK="WPA/WPA2-PSK";function change_list(i,t){var r;r=g_priority_wifi_ap_info_list[i],g_priority_wifi_ap_info_list[i]=g_priority_wifi_ap_info_list[t],g_priority_wifi_ap_info_list[t]=r}function apply(){if(isButtonEnable("wifi_priority_apply")&&isCradleStatusOK()){for(var i=g_priority_wifi_ap_info_list,t=0;t<i.length;t++)i[t].WifiSsid=wifiSsidResolveCannotParseChar(i[t].WifiSsid),"undefined"!=i[t].WifiAuthSecret&&null!=i[t].WifiAuthSecret&&""!=i[t].WifiAuthSecret&&(i[t].WifiAuthSecret=wifiSsidResolveCannotParseChar(i[t].WifiAuthSecret));var r=object2xml("request",{SsidLists:{sidList:i}});saveAjaxData("api/wlan/wifiprofile",r,(function(i){var t=xml2object(i);isAjaxReturnOK(t)?(button_enable("wifi_priority_apply","0"),showInfoDialog(common_success)):t.error.code==ERROR_SYSTEM_BUSY?showInfoDialog(common_system_busy):showInfoDialog(common_failed),getWiFiPriorityAPinfo()}),{enc:!0})}}function getWiFiPriorityAPinfo(){getAjaxData("api/wlan/wifiprofile",(function(i){var t=xml2object(i);"response"==t.type?(g_wifipriorityscanresult=t.response.SsidLists.SsidList,$("#noavaiableap").remove(),$.isArray(g_wifipriorityscanresult)||void 0!==g_wifipriorityscanresult&&null!=g_wifipriorityscanresult&&""!=g_wifipriorityscanresult?setWiFiPriorityList():$(".wifipriority_settings").after("<span id='noavaiableap'>"+IDS_wifi_message_priority_list_none+"</span>")):(g_wifipriorityscanresult=[],$(".wifipriority_settings").after("<span id='noavaiableap'>"+IDS_wifi_message_priority_list_none+"</span>"))}))}function setWiFiPriorityList(){if(g_priority_wifi_ap_info_list=[],$.isArray(g_wifipriorityscanresult))$.each(g_wifipriorityscanresult,(function(i){var t={WifiSsid:g_wifipriorityscanresult[i].WifiSsid,WifiSecMode:g_wifipriorityscanresult[i].WifiSecMode,Preset:g_wifipriorityscanresult[i].Preset,Index:g_wifipriorityscanresult[i].Index,Order:g_wifipriorityscanresult[i].Order,wifiwisprenable:g_wifipriorityscanresult[i].wifiwisprenable,wifiwispruser:g_wifipriorityscanresult[i].wifiwispruser,wifiwisprpwd:g_wifipriorityscanresult[i].wifiwisprpwd,WifiAuthSecret:g_wifipriorityscanresult[i].WifiAuthSecret,profileenable:g_wifipriorityscanresult[i].profileenable};g_priority_wifi_ap_info_list.push(t),creatWifiPriorityList()}));else{var i={WifiSsid:g_wifipriorityscanresult.WifiSsid,WifiSecMode:g_wifipriorityscanresult.WifiSecMode,Preset:g_wifipriorityscanresult.Preset,Index:g_wifipriorityscanresult.Index,Order:g_wifipriorityscanresult.Order,wifiwisprenable:g_wifipriorityscanresult.wifiwisprenable,wifiwispruser:g_wifipriorityscanresult.wifiwispruser,wifiwisprpwd:g_wifipriorityscanresult.wifiwisprpwd,WifiAuthSecret:g_wifipriorityscanresult.WifiAuthSecret,profileenable:g_wifipriorityscanresult.profileenable};g_priority_wifi_ap_info_list.push(i),creatWifiPriorityList()}}function creatWifiPriorityList(){for(var i="",t=0;t<g_priority_wifi_ap_info_list.length;t++){g_priority_wifi_ap_info_list[t].Index=t+1;var r="wifi_ap_"+t,e="wifi_up_"+t,s="wifi_down_"+t,_="";_=CURRENT_WISPRENABLE==g_priority_wifi_ap_info_list[t].wifiwisprenable?g_priority_wifi_ap_info_list[t].WifiSecMode+" "+common_comma+" "+IDS_wlan_wispr_title:g_priority_wifi_ap_info_list[t].WifiSecMode,i+="<tr class='wifi_ap' id='"+r+"'>",i+="<td width='180'>",i+="<div class='wifiName'><span>"+replaceSpaceOther(XSSResolveCannotParseChar(g_priority_wifi_ap_info_list[t].WifiSsid))+"</span></div>",i+="<div>"+XSSResolveCannotParseChar(_)+"</div>",i+="</td>",1!=g_priority_wifi_ap_info_list[t].Preset?(t<g_priority_wifi_ap_info_list.length-1?t>0&&1!=g_priority_wifi_ap_info_list[t-1].Preset?i+="<td width='50'><div  class='wifidown' id='"+s+"'><img src='../res/wifi_down.gif'></div></td>":i+="<td width='50' ><div  class='wifidown' id='"+s+"'><img src='../res/wifi_down.gif'></div></td>":i+="<td width='50'></td>",t>0&&1!=g_priority_wifi_ap_info_list[t-1].Preset?(g_priority_wifi_ap_info_list.length,i+="<td width='50'><div  class='wifiup'  id='"+e+"' ><img src='../res/wifi_up.gif'></div></td>"):i+="<td width='50'></td>"):i+="<td width='50'></td><td width='50'></td>",void 0!==g_priority_wifi_ap_info_list[t].profileenable&&""!=g_priority_wifi_ap_info_list[t].profileenable?(i+="<td width='40'>",i+="<label class = 'wifiedit'>",i+="<img src='../res/editor.gif' alt='' />",i+="</label>",i+="</td>"):i+="<td width='40'></td>",1!=g_priority_wifi_ap_info_list[t].Preset?(i+="<td width='30'>",i+="<label class = 'wifidelete'>",i+="<img src='../res/delete.gif' alt='' />",i+="</label>",i+="</td>"):i+="<td width='30'></td>"}$(".wifipriority_settings").html(i)}function wisprProfileSetting(i){var t="";t+="<div class='button_wrapper1 wispr_dialog_table'>",t+=" <table>",t+="<tr id=''>",t+="<td width='190px' height = '40px;'><p>"+wlan_label_ssid+common_colon+"</p></td>",t+=" <td width='290px'><span>"+replaceSpaceOther(g_priority_wifi_ap_info_list[i].WifiSsid)+"</span></td>",t+="</tr>",t+="<tr height = '45px'>",t+="<td style = 'width:149px;'><p>"+firewall_label_status+common_colon+"</p></td>",t+="<td class='show_password_style'><input type='radio' value='1' name='wispr_mode'/>",t+="<span class = 'wispr_span'>"+common_turn_on+"</span> &nbsp;&nbsp; <input type='radio' value='0' name='wispr_mode' />",t+="<span class = 'wispr_span'>"+common_turn_off+"</span></td></tr>",t+="<tr>",t+="<tr><td class='cut_off_rule' colspan='3'></td></tr>",t+="<tr id='authentication_div_1'>",t+="<td width='190px' height = '40px;'><p>"+wlan_label_authentication+common_colon+"</p></td>",SECURITY_MODE_NONE==g_priority_wifi_ap_info_list[i].WifiSecMode?wifiSecMode=wlan_label_open:wifiSecMode=g_priority_wifi_ap_info_list[i].WifiSecMode,t+=" <td width='290px'><span>"+wifiSecMode+"</span></td>",SECURITY_MODE_NONE!=g_priority_wifi_ap_info_list[i].WifiSecMode&&-1==g_priority_wifi_ap_info_list[i].WifiSecMode.indexOf("EAP")&&1!=g_priority_wifi_ap_info_list[i].Preset&&(t+="  </tr>",t+="<td  width='149px'   height = '40px;'><p>"+common_password+common_colon+"</p></td>",t+="<td>",t+="<input id='wlan_password' type='password' autocomplete='off' size='25'  maxlength='128'/></td>",t+="<td></td>",t+="</tr>",t+="<tr>",t+="<td  height = '30px;'>",t+="</td>",t+="<td class='show_password_style'><input type='checkbox'  id='check_wpa_psk' /><span> "+common_show_password+"</span></td>",t+="</tr>"),t+="</div>",t+="<div class = 'wispr_dialog_table'>",CURRENT_WISPRENABLE==g_priority_wifi_ap_info_list[i].wifiwisprenable&&(t+="<tr><td class='cut_off_rule' colspan='3'></td></tr>",t+="<tr height = '40px'><td ><p>"+wlan_label_authentication+common_colon+"</p></td>",t+="<td>WISPr</td></tr>",t+="<tr>",t+="<td width='149px' height = '40px;'><p>"+dialup_label_user_name+common_colon+"</p></td>",t+="<td>",t+="<input id='wispr_username' type='username' size='25'  maxlength='128'/></td>",t+="<td></td>",t+="</tr>",t+="<tr>",t+="<td  width='149px'   height = '40px;'><p>"+common_password+common_colon+"</p></td>",t+="<td>",t+="<input id='wispr_password' type='password' autocomplete='off' size='25'  maxlength='128'/></td>",t+="<td></td>",t+="</tr>",t+="<tr>",t+="<td  height = '30px;'>",t+="</td>",t+="<td class='show_password_style'><input type='checkbox'  id='check_wispr_psk' /><span> "+common_show_password+"</span></td>",t+="</tr>"),t+="</table>",t+="</div>",call_dialog(common_edit,t,common_save,"wispr_Save",common_cancel,"pop_cancel"),CURRENT_PROFILEENABLE!=g_priority_wifi_ap_info_list[i].profileenable&&($("#wlan_password").attr("disabled",!0),$("#wispr_username").attr("disabled",!0),$("#wispr_password").attr("disabled",!0),$("#check_wpa_psk").attr("disabled",!0),$("#check_wispr_psk").attr("disabled",!0))}function profile_apply(i){var t=$.trim($("#wispr_username").val()),r=$.trim($("#wispr_password").val()),e=$("#wlan_password").val(),s=$("[name='wispr_mode']:checked").val();if(isButtonEnable("wispr_Save")){for(var _={Username:t,Password:r},a=g_priority_wifi_ap_info_list,o=0;o<a.length;o++)a[o].WifiSsid=wifiSsidResolveCannotParseChar(a[o].WifiSsid),void 0!==a[o].WifiAuthSecret&&null!=a[o].WifiAuthSecret&&""!=a[o].WifiAuthSecret&&(a[o].WifiAuthSecret=wifiSsidResolveCannotParseChar(a[o].WifiAuthSecret));var n={SsidLists:{sidList:a}};if(1!=g_priority_wifi_ap_info_list[g_current_index].Preset&&void 0!==e){if(!checkWifiSecurity(e,g_priority_wifi_ap_info_list[g_current_index].WifiSecMode,"wlan_password"))return;n.SsidLists.sidList[g_current_index].WifiAuthSecret=wifiSsidResolveCannotParseChar(e)}if(CURRENT_WISPRENABLE==g_priority_wifi_ap_info_list[g_current_index].wifiwisprenable&&0!=$("[name='wispr_mode']:checked").val()){if(!wispr_validInput(_,"wispr_username","wispr_password"))return;n.SsidLists.sidList[g_current_index].wifiwispruser=t,n.SsidLists.sidList[g_current_index].wifiwisprpwd=r}n.SsidLists.sidList[g_current_index].profileenable=s;var p=object2xml("request",n);saveAjaxData("api/wlan/wifiprofile",p,(function(i){var t=xml2object(i);$(".dialog").remove(),isAjaxReturnOK(t)?showInfoDialog(common_success):showInfoDialog(common_failed),getWiFiPriorityAPinfo()}),{enc:!0})}}function getWiFiIndex(i){var t=i.substring(LENGHT_OF_INDEX,i.length);return parseInt(t,10)}function updateProfilrStatus(){0==$("[name='wispr_mode']:checked").val()?($("#wlan_password").attr("disabled",!0),$("#wispr_username").attr("disabled",!0),$("#wispr_password").attr("disabled",!0),$("#check_wpa_psk").attr("disabled",!0),$("#check_wispr_psk").attr("disabled",!0),$("#wlan_password").val(g_priority_wifi_ap_info_list[g_current_index].WifiAuthSecret),$("#wispr_username").val(g_priority_wifi_ap_info_list[g_current_index].wifiwispruser),$("#wispr_password").val(g_priority_wifi_ap_info_list[g_current_index].wifiwisprpwd),$(".error_message").remove()):($("#wlan_password").removeAttr("disabled"),$("#wispr_username").removeAttr("disabled"),$("#wispr_password").removeAttr("disabled"),$("#check_wpa_psk").removeAttr("disabled"),$("#check_wispr_psk").removeAttr("disabled"))}function getCradleStatus(){g_module.cradle_enabled&&getAjaxData("api/cradle/status-info",(function(i){var t=xml2object(i);"response"==t.type&&(G_cradleStationStatus=t.response)}),{sync:!0})}function isCradleStatusOK(){if(getCradleStatus(),g_module.cradle_enabled&&CRADLE_NETLINE_EXIST==G_cradleStationStatus.cradlestatus&&ETHERNET_LAN_MODE!=G_cradleStationStatus.connectionmode){var i=IDS_function_disabled.replace("%s1","cradle").replace("%s2","offload");return showInfoDialog(i,!1,disableEntirePage),!1}return!0}$(document).ready((function(){button_enable("wifi_priority_apply","0"),$("#wifipriority_setting").click((function(){g_module.cradle_enabled&&checkOffloadEnabled()})),$("#wifi_priority_apply").click((function(){apply()})),$(".wifidelete").live("click",(function(){if(isCradleStatusOK()){button_enable("wifi_priority_apply","1");var i=$(this).parent().parent().attr("id"),t=(i=i.split("_"))[2];g_priority_wifi_ap_info_list.splice(t,1),creatWifiPriorityList()}})),$(".wifiup").live("click",(function(){button_enable("wifi_priority_apply","1");var i=$(this).attr("id"),t=(i=i.split("_"))[2];change_list(t=parseInt(t,10),t-1),creatWifiPriorityList()})),$(".wifidown").live("click",(function(){button_enable("wifi_priority_apply","1");var i=$(this).attr("id"),t=(i=i.split("_"))[2];change_list(t=parseInt(t,10),t+1),creatWifiPriorityList()})),getWiFiPriorityAPinfo(),$("input").live("change input paste cut keydown",(function(){button_enable("wispr_Save","1")}));isButtonEnable("wispr_Save");$(".wifiedit").live("click",(function(){isCradleStatusOK()&&(g_current_id=$(this).parent().parent().attr("id"),wisprProfileSetting(g_current_index=getWiFiIndex(g_current_id)),button_enable("wispr_Save","0"),$("#wlan_password").val(g_priority_wifi_ap_info_list[g_current_index].WifiAuthSecret),$("#wispr_username").val(g_priority_wifi_ap_info_list[g_current_index].wifiwispruser),$("#wispr_password").val(g_priority_wifi_ap_info_list[g_current_index].wifiwisprpwd),$("input[name='wispr_mode'][value="+g_priority_wifi_ap_info_list[g_current_index].profileenable+"]").attr("checked",!0))})),$("#wispr_Save").live("click",(function(){if(!isCradleStatusOK())return $(".dialog").remove(),void $(".login_dialog").remove();profile_apply(g_current_index)})),$("#check_wpa_psk").live("click",(function(){showPassword("wlan_password","check_wpa_psk")})),$("#check_wispr_psk").live("click",(function(){showPassword("wispr_password","check_wispr_psk")})),$("[name='wispr_mode']").live("click",(function(){updateProfilrStatus()})),$("#pop_cancel").live("click",(function(){isButtonEnable("pop_cancel")&&($("#div_wrapper").remove(),$(".dialog").remove(),$(".login_dialog").remove())})),g_module.cradle_enabled&&checkOffloadEnabled()}));
